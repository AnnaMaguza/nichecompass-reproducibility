Run timestamp: 29082023_165903_19.
Script arguments:
['../train_nichecompass_benchmarking_models.py', '--adata_new_name', 'None', '--n_neighbors_list', '4', '--edge_batch_size_list', '512', '--node_batch_size_list', 'None', '--seeds', '1', '--run_index', '2', '--cell_type_key', 'cell_type', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', '--cat_covariates_no_edges', 'True', 'False', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'gatv2conv_sample_integration_method_benchmarking', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '10', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '5000000.0', '--contrastive_logits_pos_ratio', '0.0625', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--lambda_l1_addon', '0.', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_19']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.
Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...


Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 254146
Number of validation nodes: 28238
Number of training edges: 602179
Number of validation edges: 66908
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9127; val_auprc_score: 0.9684; val_best_acc_score: 0.8861; val_best_f1_score: 0.9284; train_kl_reg_loss: 20795.5880; train_edge_recon_loss: 1448034.8435; train_cat_covariates_contrastive_loss: 3161205.6638; train_gene_expr_recon_loss: 2917780.5578; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 7547816.6551; train_optim_loss: 7547816.6551; val_kl_reg_loss: 15335.8707; val_edge_recon_loss: 1381455.2347; val_cat_covariates_contrastive_loss: 3148895.2462; val_gene_expr_recon_loss: 2711480.1489; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 7257166.4885; val_optim_loss: 7257166.4885
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9320; val_auprc_score: 0.9749; val_best_acc_score: 0.9004; val_best_f1_score: 0.9368; train_kl_reg_loss: 17406.7490; train_edge_recon_loss: 1346227.2247; train_cat_covariates_contrastive_loss: 3148778.1710; train_gene_expr_recon_loss: 2617860.5550; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 7130272.7005; train_optim_loss: 7130272.7005; val_kl_reg_loss: 19627.5896; val_edge_recon_loss: 1371505.5315; val_cat_covariates_contrastive_loss: 3154703.1489; val_gene_expr_recon_loss: 2517434.8760; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 7063271.1756; val_optim_loss: 7063271.1756
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9308; val_auprc_score: 0.9732; val_best_acc_score: 0.9043; val_best_f1_score: 0.9393; train_kl_reg_loss: 22979.9722; train_edge_recon_loss: 1340823.2388; train_cat_covariates_contrastive_loss: 3152404.8052; train_gene_expr_recon_loss: 2403584.9520; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 6919792.9690; train_optim_loss: 6919792.9690; val_kl_reg_loss: 26958.5369; val_edge_recon_loss: 1373400.7805; val_cat_covariates_contrastive_loss: 3149308.3206; val_gene_expr_recon_loss: 2312967.7538; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 6862635.3855; val_optim_loss: 6862635.3855
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9418; val_auprc_score: 0.9771; val_best_acc_score: 0.9150; val_best_f1_score: 0.9456; train_kl_reg_loss: 26445.1660; train_edge_recon_loss: 1336765.4397; train_cat_covariates_contrastive_loss: 3154162.6619; train_gene_expr_recon_loss: 2233687.6162; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 6751060.8866; train_optim_loss: 6751060.8866; val_kl_reg_loss: 27296.7678; val_edge_recon_loss: 1362989.3168; val_cat_covariates_contrastive_loss: 3154829.3836; val_gene_expr_recon_loss: 2185561.9055; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 6730677.3588; val_optim_loss: 6730677.3588
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9465; val_auprc_score: 0.9790; val_best_acc_score: 0.9173; val_best_f1_score: 0.9471; train_kl_reg_loss: 27787.2749; train_edge_recon_loss: 1331634.2676; train_cat_covariates_contrastive_loss: 3154781.2908; train_gene_expr_recon_loss: 2130570.5278; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 6644773.3602; train_optim_loss: 6644773.3602; val_kl_reg_loss: 28084.4386; val_edge_recon_loss: 1365066.0658; val_cat_covariates_contrastive_loss: 3154580.3302; val_gene_expr_recon_loss: 2097680.7185; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 6645411.5191; val_optim_loss: 6645411.5191
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9521; val_auprc_score: 0.9812; val_best_acc_score: 0.9203; val_best_f1_score: 0.9490; train_kl_reg_loss: 28443.6907; train_edge_recon_loss: 1329523.6296; train_cat_covariates_contrastive_loss: 3154909.1954; train_gene_expr_recon_loss: 2068973.4834; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 6581849.9966; train_optim_loss: 6581849.9966; val_kl_reg_loss: 27512.7280; val_edge_recon_loss: 1371011.4666; val_cat_covariates_contrastive_loss: 3159952.7481; val_gene_expr_recon_loss: 2060391.6107; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 6618868.5000; val_optim_loss: 6618868.5000
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9454; val_auprc_score: 0.9784; val_best_acc_score: 0.9221; val_best_f1_score: 0.9502; train_kl_reg_loss: 29025.2590; train_edge_recon_loss: 1325747.3099; train_cat_covariates_contrastive_loss: 3154410.1041; train_gene_expr_recon_loss: 2030047.4596; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 6539230.1262; train_optim_loss: 6539230.1262; val_kl_reg_loss: 30832.6516; val_edge_recon_loss: 1352840.9876; val_cat_covariates_contrastive_loss: 3151685.1336; val_gene_expr_recon_loss: 2034239.4170; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 6569598.1679; val_optim_loss: 6569598.1679
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9467; val_auprc_score: 0.9789; val_best_acc_score: 0.9225; val_best_f1_score: 0.9504; train_kl_reg_loss: 29072.9764; train_edge_recon_loss: 1324343.3417; train_cat_covariates_contrastive_loss: 3154290.3700; train_gene_expr_recon_loss: 2006423.7754; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 6514130.4643; train_optim_loss: 6514130.4643; val_kl_reg_loss: 28662.1907; val_edge_recon_loss: 1357131.2109; val_cat_covariates_contrastive_loss: 3153810.9523; val_gene_expr_recon_loss: 2009756.7424; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 6549361.1145; val_optim_loss: 6549361.1145
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9495; val_auprc_score: 0.9800; val_best_acc_score: 0.9257; val_best_f1_score: 0.9525; train_kl_reg_loss: 29278.9780; train_edge_recon_loss: 1324269.3860; train_cat_covariates_contrastive_loss: 3153743.1130; train_gene_expr_recon_loss: 1991428.7398; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 6498720.2192; train_optim_loss: 6498720.2192; val_kl_reg_loss: 29656.9631; val_edge_recon_loss: 1344875.8578; val_cat_covariates_contrastive_loss: 3152713.7462; val_gene_expr_recon_loss: 1991039.8073; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 6518286.3817; val_optim_loss: 6518286.3817
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9503; val_auprc_score: 0.9796; val_best_acc_score: 0.9262; val_best_f1_score: 0.9528; train_kl_reg_loss: 29292.6539; train_edge_recon_loss: 1324849.1137; train_cat_covariates_contrastive_loss: 3153457.3621; train_gene_expr_recon_loss: 1975513.5577; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 6483112.6805; train_optim_loss: 6483112.6805; val_kl_reg_loss: 30048.8834; val_edge_recon_loss: 1354495.0830; val_cat_covariates_contrastive_loss: 3152229.3950; val_gene_expr_recon_loss: 1985023.2653; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 6521796.6260; val_optim_loss: 6521796.6260
