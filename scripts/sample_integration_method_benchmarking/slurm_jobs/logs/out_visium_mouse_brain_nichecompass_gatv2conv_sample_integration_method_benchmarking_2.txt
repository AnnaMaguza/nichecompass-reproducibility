Run timestamp: 29082023_175850_2.
Script arguments:
['../train_nichecompass_benchmarking_models.py', '--adata_new_name', 'None', '--n_neighbors_list', '6', '--edge_batch_size_list', '256', '--node_batch_size_list', 'None', '--seeds', '1', '--run_index', '2', '--cell_type_key', 'cell_type', '--filter_genes', '--n_svg', '5000', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--dataset', 'visium_mouse_brain', '--reference_batches', 'batch1', 'batch2', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'data', '--cat_covariates_no_edges', 'True', 'False', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'gatv2conv_sample_integration_method_benchmarking', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '10', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '2', '2', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '1000000.0', '--contrastive_logits_pos_ratio', '0.0625', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--lambda_l1_addon', '0.', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_2']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.
Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...


Filtering genes...
Starting with 32285 genes.
Keeping 32285 genes after filtering genes with expression in 0 cells.
Keeping 5000 spatially variable, highly variable or gene program relevant genes.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 5000, n_cat_covariates_embed_input: 0, n_hidden: 1530, n_latent: 1520, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1520, n_addon_gp_input: 10, n_cat_covariates_embed_input: 4, n_output: 5000
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1520, n_addon_gp_input: 10, n_cat_covariates_embed_input: 4, n_output: 5000

--- INITIALIZING TRAINER ---
Number of training nodes: 10948
Number of validation nodes: 1216
Number of training edges: 33527
Number of validation edges: 3725
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8508; val_auprc_score: 0.9216; val_best_acc_score: 0.7859; val_best_f1_score: 0.8522; train_kl_reg_loss: 142266.3304; train_edge_recon_loss: 2462235.3092; train_cat_covariates_contrastive_loss: 688679.3201; train_gene_expr_recon_loss: 72659327.6641; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 75952508.5496; train_optim_loss: 75952508.5496; val_kl_reg_loss: 116066.0667; val_edge_recon_loss: 2688003.4333; val_cat_covariates_contrastive_loss: 626640.2042; val_gene_expr_recon_loss: 55674879.2000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 59105588.8000; val_optim_loss: 59105588.8000
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8763; val_auprc_score: 0.9292; val_best_acc_score: 0.8155; val_best_f1_score: 0.8747; train_kl_reg_loss: 124871.0474; train_edge_recon_loss: 2446805.5859; train_cat_covariates_contrastive_loss: 652194.8669; train_gene_expr_recon_loss: 52526749.8931; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55750621.3435; train_optim_loss: 55750621.3435; val_kl_reg_loss: 103680.9734; val_edge_recon_loss: 2681039.4500; val_cat_covariates_contrastive_loss: 626937.8958; val_gene_expr_recon_loss: 50476543.2000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53888201.6000; val_optim_loss: 53888201.6000
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.8623; val_auprc_score: 0.9228; val_best_acc_score: 0.8107; val_best_f1_score: 0.8705; train_kl_reg_loss: 97474.6520; train_edge_recon_loss: 2337003.9552; train_cat_covariates_contrastive_loss: 639771.9499; train_gene_expr_recon_loss: 50063826.8397; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53138077.4046; train_optim_loss: 53138077.4046; val_kl_reg_loss: 87381.9089; val_edge_recon_loss: 2231506.8750; val_cat_covariates_contrastive_loss: 627374.7167; val_gene_expr_recon_loss: 49373879.2000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 52320142.6667; val_optim_loss: 52320142.6667
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.8692; val_auprc_score: 0.9259; val_best_acc_score: 0.8135; val_best_f1_score: 0.8754; train_kl_reg_loss: 96351.2078; train_edge_recon_loss: 2131451.5887; train_cat_covariates_contrastive_loss: 631710.9704; train_gene_expr_recon_loss: 49109308.4580; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 51968822.0763; train_optim_loss: 51968822.0763; val_kl_reg_loss: 104877.7443; val_edge_recon_loss: 2067562.5917; val_cat_covariates_contrastive_loss: 627412.1833; val_gene_expr_recon_loss: 48184592.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 50984444.5333; val_optim_loss: 50984444.5333
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.8740; val_auprc_score: 0.9330; val_best_acc_score: 0.8160; val_best_f1_score: 0.8760; train_kl_reg_loss: 106429.1076; train_edge_recon_loss: 2052215.0162; train_cat_covariates_contrastive_loss: 629118.4652; train_gene_expr_recon_loss: 48327501.2824; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 51115263.7863; train_optim_loss: 51115263.7863; val_kl_reg_loss: 105018.8307; val_edge_recon_loss: 2055425.1167; val_cat_covariates_contrastive_loss: 627400.9917; val_gene_expr_recon_loss: 47728798.4000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 50516643.2000; val_optim_loss: 50516643.2000
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.8864; val_auprc_score: 0.9373; val_best_acc_score: 0.8250; val_best_f1_score: 0.8833; train_kl_reg_loss: 101262.0192; train_edge_recon_loss: 2010570.4351; train_cat_covariates_contrastive_loss: 628552.7104; train_gene_expr_recon_loss: 47698538.0458; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 50438923.2366; train_optim_loss: 50438923.2366; val_kl_reg_loss: 96525.5771; val_edge_recon_loss: 1991508.3250; val_cat_covariates_contrastive_loss: 627889.0958; val_gene_expr_recon_loss: 46627245.3333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 49343168.2667; val_optim_loss: 49343168.2667
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.8914; val_auprc_score: 0.9399; val_best_acc_score: 0.8232; val_best_f1_score: 0.8817; train_kl_reg_loss: 93656.7201; train_edge_recon_loss: 1981835.7977; train_cat_covariates_contrastive_loss: 628869.3984; train_gene_expr_recon_loss: 47097588.7634; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 49801950.5038; train_optim_loss: 49801950.5038; val_kl_reg_loss: 90250.3833; val_edge_recon_loss: 2018627.8000; val_cat_covariates_contrastive_loss: 628566.4875; val_gene_expr_recon_loss: 46338513.6000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 49075958.6667; val_optim_loss: 49075958.6667
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.8990; val_auprc_score: 0.9457; val_best_acc_score: 0.8306; val_best_f1_score: 0.8871; train_kl_reg_loss: 86828.5734; train_edge_recon_loss: 1973085.3426; train_cat_covariates_contrastive_loss: 629563.5716; train_gene_expr_recon_loss: 46569192.9160; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 49258670.2901; train_optim_loss: 49258670.2901; val_kl_reg_loss: 84793.2339; val_edge_recon_loss: 1975901.0667; val_cat_covariates_contrastive_loss: 629589.1333; val_gene_expr_recon_loss: 46011140.5333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 48701424.0000; val_optim_loss: 48701424.0000
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9078; val_auprc_score: 0.9512; val_best_acc_score: 0.8368; val_best_f1_score: 0.8903; train_kl_reg_loss: 80229.6213; train_edge_recon_loss: 1944161.0983; train_cat_covariates_contrastive_loss: 630128.7085; train_gene_expr_recon_loss: 46076448.0305; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 48730967.5115; train_optim_loss: 48730967.5115; val_kl_reg_loss: 77487.3182; val_edge_recon_loss: 1955707.3333; val_cat_covariates_contrastive_loss: 630520.7917; val_gene_expr_recon_loss: 45409784.2667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 48073499.4667; val_optim_loss: 48073499.4667
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9168; val_auprc_score: 0.9530; val_best_acc_score: 0.8445; val_best_f1_score: 0.8930; train_kl_reg_loss: 72699.4232; train_edge_recon_loss: 1947862.1555; train_cat_covariates_contrastive_loss: 631378.4475; train_gene_expr_recon_loss: 45625575.7863; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 48277515.9084; train_optim_loss: 48277515.9084; val_kl_reg_loss: 71476.9573; val_edge_recon_loss: 1933639.5417; val_cat_covariates_contrastive_loss: 632171.2458; val_gene_expr_recon_loss: 45032527.4667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47669815.2000; val_optim_loss: 47669815.2000
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9205; val_auprc_score: 0.9553; val_best_acc_score: 0.8529; val_best_f1_score: 0.8966; train_kl_reg_loss: 66911.8437; train_edge_recon_loss: 1920310.4609; train_cat_covariates_contrastive_loss: 632479.6150; train_gene_expr_recon_loss: 45158483.4198; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 47778185.4351; train_optim_loss: 47778185.4351; val_kl_reg_loss: 65010.6570; val_edge_recon_loss: 1942211.8083; val_cat_covariates_contrastive_loss: 633772.9125; val_gene_expr_recon_loss: 44667118.9333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47308113.8667; val_optim_loss: 47308113.8667
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9323; val_auprc_score: 0.9605; val_best_acc_score: 0.8739; val_best_f1_score: 0.9110; train_kl_reg_loss: 62483.1231; train_edge_recon_loss: 1900750.7538; train_cat_covariates_contrastive_loss: 634529.6698; train_gene_expr_recon_loss: 44734192.0305; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 47331955.5115; train_optim_loss: 47331955.5115; val_kl_reg_loss: 60923.8286; val_edge_recon_loss: 1880295.9750; val_cat_covariates_contrastive_loss: 636516.9083; val_gene_expr_recon_loss: 44328116.5333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46905852.5333; val_optim_loss: 46905852.5333
