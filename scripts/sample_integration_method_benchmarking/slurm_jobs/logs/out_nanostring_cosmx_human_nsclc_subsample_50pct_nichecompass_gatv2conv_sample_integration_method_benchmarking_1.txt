Run timestamp: 03092023_113529_1.
Script arguments:
['../train_nichecompass_benchmarking_models.py', '--adata_new_name', 'None', '--n_neighbors_list', '16', '--edge_batch_size_list', '256', '--node_batch_size_list', 'None', '--seeds', '7', '--run_index', '8', '--cell_type_key', 'cell_type', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--dataset', 'nanostring_cosmx_human_nsclc_subsample_50pct', '--reference_batches', 'batch1', 'batch2', 'batch3', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', '--cat_covariates_no_edges', 'True', 'False', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'gatv2conv_sample_integration_method_benchmarking', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '10', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '1000000.0', '--contrastive_logits_pos_ratio', '0.0625', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--lambda_l1_addon', '0.', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_1']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.
Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...


Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 127072
Number of validation nodes: 14119
Number of training edges: 1142524
Number of validation edges: 126947
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9536; val_auprc_score: 0.9804; val_best_acc_score: 0.9332; val_best_f1_score: 0.9574; train_kl_reg_loss: 14922.6990; train_edge_recon_loss: 1367292.5573; train_cat_covariates_contrastive_loss: 635177.7890; train_gene_expr_recon_loss: 2847710.2147; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4865103.2603; train_optim_loss: 4865103.2603; val_kl_reg_loss: 17111.6353; val_edge_recon_loss: 1336134.3120; val_cat_covariates_contrastive_loss: 634072.5178; val_gene_expr_recon_loss: 2534221.3075; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4521539.7747; val_optim_loss: 4521539.7747
Run timestamp: 03092023_114744_1.
Script arguments:
['../train_nichecompass_benchmarking_models.py', '--adata_new_name', 'None', '--n_neighbors_list', '16', '--edge_batch_size_list', '256', '--node_batch_size_list', 'None', '--seeds', '7', '--run_index', '8', '--cell_type_key', 'cell_type', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--dataset', 'nanostring_cosmx_human_nsclc_subsample_50pct', '--reference_batches', 'batch1', 'batch2', 'batch3', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', '--cat_covariates_no_edges', 'True', 'False', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'gatv2conv_sample_integration_method_benchmarking', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '10', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '1000000.0', '--contrastive_logits_pos_ratio', '0.0625', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--lambda_l1_addon', '0.', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_1']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.
Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...


Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 127072
Number of validation nodes: 14119
Number of training edges: 1142524
Number of validation edges: 126947
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9572; val_auprc_score: 0.9819; val_best_acc_score: 0.9359; val_best_f1_score: 0.9590; train_kl_reg_loss: 15350.6836; train_edge_recon_loss: 1362064.4558; train_cat_covariates_contrastive_loss: 635483.3433; train_gene_expr_recon_loss: 2837906.6011; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4850805.0842; train_optim_loss: 4850805.0842; val_kl_reg_loss: 16535.7683; val_edge_recon_loss: 1343633.3826; val_cat_covariates_contrastive_loss: 635905.4360; val_gene_expr_recon_loss: 2537729.0771; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4533803.6658; val_optim_loss: 4533803.6658
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9597; val_auprc_score: 0.9827; val_best_acc_score: 0.9400; val_best_f1_score: 0.9616; train_kl_reg_loss: 20714.2325; train_edge_recon_loss: 1331604.0052; train_cat_covariates_contrastive_loss: 637094.4842; train_gene_expr_recon_loss: 2409532.2184; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4398944.9393; train_optim_loss: 4398944.9393; val_kl_reg_loss: 23177.5487; val_edge_recon_loss: 1340734.4814; val_cat_covariates_contrastive_loss: 637746.8924; val_gene_expr_recon_loss: 2328394.4970; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4330053.4158; val_optim_loss: 4330053.4158
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9629; val_auprc_score: 0.9836; val_best_acc_score: 0.9439; val_best_f1_score: 0.9639; train_kl_reg_loss: 24890.8347; train_edge_recon_loss: 1327051.9899; train_cat_covariates_contrastive_loss: 638435.6806; train_gene_expr_recon_loss: 2282737.4080; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4273115.9142; train_optim_loss: 4273115.9142; val_kl_reg_loss: 26911.9487; val_edge_recon_loss: 1342173.3420; val_cat_covariates_contrastive_loss: 638327.8516; val_gene_expr_recon_loss: 2239672.4252; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4247085.5680; val_optim_loss: 4247085.5680
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9674; val_auprc_score: 0.9857; val_best_acc_score: 0.9453; val_best_f1_score: 0.9646; train_kl_reg_loss: 27381.5548; train_edge_recon_loss: 1328949.0776; train_cat_covariates_contrastive_loss: 639540.1059; train_gene_expr_recon_loss: 2234580.9528; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4230451.6909; train_optim_loss: 4230451.6909; val_kl_reg_loss: 28082.4758; val_edge_recon_loss: 1338392.0814; val_cat_covariates_contrastive_loss: 641296.8305; val_gene_expr_recon_loss: 2247290.3639; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4255061.7424; val_optim_loss: 4255061.7424
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9625; val_auprc_score: 0.9836; val_best_acc_score: 0.9457; val_best_f1_score: 0.9651; train_kl_reg_loss: 29244.1952; train_edge_recon_loss: 1326254.2279; train_cat_covariates_contrastive_loss: 640097.7738; train_gene_expr_recon_loss: 2207523.2826; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4203119.4817; train_optim_loss: 4203119.4817; val_kl_reg_loss: 30159.1238; val_edge_recon_loss: 1334582.2271; val_cat_covariates_contrastive_loss: 639245.6851; val_gene_expr_recon_loss: 2206388.7087; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4210375.7324; val_optim_loss: 4210375.7324
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9660; val_auprc_score: 0.9851; val_best_acc_score: 0.9463; val_best_f1_score: 0.9654; train_kl_reg_loss: 30733.0517; train_edge_recon_loss: 1325842.9303; train_cat_covariates_contrastive_loss: 640665.0536; train_gene_expr_recon_loss: 2192810.0836; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4190051.1168; train_optim_loss: 4190051.1168; val_kl_reg_loss: 31374.1537; val_edge_recon_loss: 1329723.7475; val_cat_covariates_contrastive_loss: 640645.3344; val_gene_expr_recon_loss: 2213220.3634; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4214963.6023; val_optim_loss: 4214963.6023
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9672; val_auprc_score: 0.9854; val_best_acc_score: 0.9486; val_best_f1_score: 0.9669; train_kl_reg_loss: 31924.8357; train_edge_recon_loss: 1329057.9867; train_cat_covariates_contrastive_loss: 641125.4053; train_gene_expr_recon_loss: 2179400.8245; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4181509.0522; train_optim_loss: 4181509.0522; val_kl_reg_loss: 33104.4928; val_edge_recon_loss: 1330479.0910; val_cat_covariates_contrastive_loss: 642297.2070; val_gene_expr_recon_loss: 2179504.3385; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4185385.1295; val_optim_loss: 4185385.1295
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9662; val_auprc_score: 0.9846; val_best_acc_score: 0.9492; val_best_f1_score: 0.9673; train_kl_reg_loss: 33074.1503; train_edge_recon_loss: 1326932.7984; train_cat_covariates_contrastive_loss: 641360.1473; train_gene_expr_recon_loss: 2167246.5027; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4168613.5986; train_optim_loss: 4168613.5986; val_kl_reg_loss: 33195.6503; val_edge_recon_loss: 1328930.2886; val_cat_covariates_contrastive_loss: 641703.4267; val_gene_expr_recon_loss: 2161341.3022; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4165170.6678; val_optim_loss: 4165170.6678
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9653; val_auprc_score: 0.9846; val_best_acc_score: 0.9464; val_best_f1_score: 0.9654; train_kl_reg_loss: 33631.6007; train_edge_recon_loss: 1327668.4943; train_cat_covariates_contrastive_loss: 641579.4475; train_gene_expr_recon_loss: 2165070.8086; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4167950.3519; train_optim_loss: 4167950.3519; val_kl_reg_loss: 33999.2611; val_edge_recon_loss: 1333705.2474; val_cat_covariates_contrastive_loss: 641986.5682; val_gene_expr_recon_loss: 2165420.1164; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4175111.1799; val_optim_loss: 4175111.1799
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9682; val_auprc_score: 0.9857; val_best_acc_score: 0.9505; val_best_f1_score: 0.9681; train_kl_reg_loss: 34579.0893; train_edge_recon_loss: 1328455.0536; train_cat_covariates_contrastive_loss: 641860.4239; train_gene_expr_recon_loss: 2159368.1834; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4164262.7510; train_optim_loss: 4164262.7510; val_kl_reg_loss: 35315.4363; val_edge_recon_loss: 1328825.7051; val_cat_covariates_contrastive_loss: 642963.8198; val_gene_expr_recon_loss: 2189938.2389; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4197043.1935; val_optim_loss: 4197043.1935
