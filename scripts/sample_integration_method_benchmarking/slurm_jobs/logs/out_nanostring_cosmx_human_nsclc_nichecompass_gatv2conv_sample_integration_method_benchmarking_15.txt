Run timestamp: 29082023_164105_15.
Script arguments:
['../train_nichecompass_benchmarking_models.py', '--adata_new_name', 'None', '--n_neighbors_list', '4', '--edge_batch_size_list', '512', '--node_batch_size_list', 'None', '--seeds', '1', '--run_index', '2', '--cell_type_key', 'cell_type', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', '--cat_covariates_no_edges', 'True', 'False', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'gatv2conv_sample_integration_method_benchmarking', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '10', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '1000000.0', '--contrastive_logits_pos_ratio', '0.125', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--lambda_l1_addon', '0.', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_15']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.
Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...


Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 254146
Number of validation nodes: 28238
Number of training edges: 602179
Number of validation edges: 66908
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9408; val_auprc_score: 0.9806; val_best_acc_score: 0.9027; val_best_f1_score: 0.9390; train_kl_reg_loss: 17821.4316; train_edge_recon_loss: 1430485.0956; train_cat_covariates_contrastive_loss: 647885.2345; train_gene_expr_recon_loss: 2918870.2850; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5015062.0433; train_optim_loss: 5015062.0433; val_kl_reg_loss: 14092.9347; val_edge_recon_loss: 1401090.4847; val_cat_covariates_contrastive_loss: 641670.4394; val_gene_expr_recon_loss: 2709226.6546; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4766080.5458; val_optim_loss: 4766080.5458
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9560; val_auprc_score: 0.9849; val_best_acc_score: 0.9200; val_best_f1_score: 0.9496; train_kl_reg_loss: 15707.7087; train_edge_recon_loss: 1349257.2142; train_cat_covariates_contrastive_loss: 644224.6573; train_gene_expr_recon_loss: 2589588.8477; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4598778.4274; train_optim_loss: 4598778.4274; val_kl_reg_loss: 17264.6508; val_edge_recon_loss: 1363936.0668; val_cat_covariates_contrastive_loss: 646628.0124; val_gene_expr_recon_loss: 2462659.7214; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4490488.4466; val_optim_loss: 4490488.4466
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9569; val_auprc_score: 0.9856; val_best_acc_score: 0.9237; val_best_f1_score: 0.9523; train_kl_reg_loss: 19123.0943; train_edge_recon_loss: 1344236.9982; train_cat_covariates_contrastive_loss: 646065.4793; train_gene_expr_recon_loss: 2335434.8260; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4344860.3995; train_optim_loss: 4344860.3995; val_kl_reg_loss: 19891.7482; val_edge_recon_loss: 1368891.2052; val_cat_covariates_contrastive_loss: 646491.8993; val_gene_expr_recon_loss: 2247972.4179; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4283247.2710; val_optim_loss: 4283247.2710
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9553; val_auprc_score: 0.9850; val_best_acc_score: 0.9251; val_best_f1_score: 0.9530; train_kl_reg_loss: 20997.0681; train_edge_recon_loss: 1340280.1338; train_cat_covariates_contrastive_loss: 644999.8217; train_gene_expr_recon_loss: 2174044.4993; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4180321.5280; train_optim_loss: 4180321.5280; val_kl_reg_loss: 22259.6975; val_edge_recon_loss: 1359525.4695; val_cat_covariates_contrastive_loss: 643374.5701; val_gene_expr_recon_loss: 2128505.9838; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4153665.7271; val_optim_loss: 4153665.7271
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9569; val_auprc_score: 0.9855; val_best_acc_score: 0.9271; val_best_f1_score: 0.9542; train_kl_reg_loss: 22109.6147; train_edge_recon_loss: 1337583.2787; train_cat_covariates_contrastive_loss: 644425.2206; train_gene_expr_recon_loss: 2088101.8230; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4092219.9335; train_optim_loss: 4092219.9335; val_kl_reg_loss: 22858.5792; val_edge_recon_loss: 1367483.3368; val_cat_covariates_contrastive_loss: 643184.8230; val_gene_expr_recon_loss: 2065019.8798; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4098546.6221; val_optim_loss: 4098546.6221
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9569; val_auprc_score: 0.9852; val_best_acc_score: 0.9259; val_best_f1_score: 0.9535; train_kl_reg_loss: 22867.8486; train_edge_recon_loss: 1338515.2535; train_cat_covariates_contrastive_loss: 643800.7893; train_gene_expr_recon_loss: 2037084.3842; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4042268.2734; train_optim_loss: 4042268.2734; val_kl_reg_loss: 23099.3546; val_edge_recon_loss: 1370048.7490; val_cat_covariates_contrastive_loss: 642732.0720; val_gene_expr_recon_loss: 2026208.4113; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4062088.6011; val_optim_loss: 4062088.6011
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9583; val_auprc_score: 0.9858; val_best_acc_score: 0.9271; val_best_f1_score: 0.9543; train_kl_reg_loss: 23287.3372; train_edge_recon_loss: 1338993.6905; train_cat_covariates_contrastive_loss: 643598.8248; train_gene_expr_recon_loss: 2005049.1540; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4010929.0076; train_optim_loss: 4010929.0076; val_kl_reg_loss: 23904.8383; val_edge_recon_loss: 1371013.3969; val_cat_covariates_contrastive_loss: 644001.6737; val_gene_expr_recon_loss: 2001514.8836; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4040434.7996; val_optim_loss: 4040434.7996
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9585; val_auprc_score: 0.9857; val_best_acc_score: 0.9301; val_best_f1_score: 0.9562; train_kl_reg_loss: 23580.1675; train_edge_recon_loss: 1334104.7218; train_cat_covariates_contrastive_loss: 643415.9958; train_gene_expr_recon_loss: 1981830.6860; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3982931.5741; train_optim_loss: 3982931.5741; val_kl_reg_loss: 24035.5427; val_edge_recon_loss: 1351959.9456; val_cat_covariates_contrastive_loss: 642176.2867; val_gene_expr_recon_loss: 1983190.4905; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4001362.2576; val_optim_loss: 4001362.2576
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9569; val_auprc_score: 0.9853; val_best_acc_score: 0.9290; val_best_f1_score: 0.9556; train_kl_reg_loss: 23837.8807; train_edge_recon_loss: 1334435.7308; train_cat_covariates_contrastive_loss: 643162.5193; train_gene_expr_recon_loss: 1968545.8590; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3969981.9909; train_optim_loss: 3969981.9909; val_kl_reg_loss: 24175.8445; val_edge_recon_loss: 1355613.8416; val_cat_covariates_contrastive_loss: 642203.6102; val_gene_expr_recon_loss: 1977209.9714; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3999203.2691; val_optim_loss: 3999203.2691
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9601; val_auprc_score: 0.9862; val_best_acc_score: 0.9329; val_best_f1_score: 0.9578; train_kl_reg_loss: 24110.1000; train_edge_recon_loss: 1333206.0270; train_cat_covariates_contrastive_loss: 642990.1488; train_gene_expr_recon_loss: 1954778.9304; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3955085.2084; train_optim_loss: 3955085.2084; val_kl_reg_loss: 24094.3714; val_edge_recon_loss: 1346248.5134; val_cat_covariates_contrastive_loss: 642690.2075; val_gene_expr_recon_loss: 1962835.2567; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3975868.3550; val_optim_loss: 3975868.3550
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9620; val_auprc_score: 0.9871; val_best_acc_score: 0.9312; val_best_f1_score: 0.9570; train_kl_reg_loss: 24108.3725; train_edge_recon_loss: 1336373.7395; train_cat_covariates_contrastive_loss: 642800.8243; train_gene_expr_recon_loss: 1946209.4899; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3949492.4254; train_optim_loss: 3949492.4254; val_kl_reg_loss: 24504.1190; val_edge_recon_loss: 1358551.3788; val_cat_covariates_contrastive_loss: 644380.0258; val_gene_expr_recon_loss: 1954915.7920; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3982351.3244; val_optim_loss: 3982351.3244
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9588; val_auprc_score: 0.9858; val_best_acc_score: 0.9312; val_best_f1_score: 0.9569; train_kl_reg_loss: 24183.7570; train_edge_recon_loss: 1333480.7272; train_cat_covariates_contrastive_loss: 643058.2775; train_gene_expr_recon_loss: 1939157.4771; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3939880.2375; train_optim_loss: 3939880.2375; val_kl_reg_loss: 25104.1917; val_edge_recon_loss: 1354964.3760; val_cat_covariates_contrastive_loss: 641554.9189; val_gene_expr_recon_loss: 1950022.3626; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3971645.8416; val_optim_loss: 3971645.8416
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9612; val_auprc_score: 0.9864; val_best_acc_score: 0.9331; val_best_f1_score: 0.9579; train_kl_reg_loss: 24360.4723; train_edge_recon_loss: 1330144.2481; train_cat_covariates_contrastive_loss: 642919.0856; train_gene_expr_recon_loss: 1930872.6018; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3928296.4097; train_optim_loss: 3928296.4097; val_kl_reg_loss: 23881.5766; val_edge_recon_loss: 1362826.0143; val_cat_covariates_contrastive_loss: 642639.3526; val_gene_expr_recon_loss: 1952780.1097; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3982127.0706; val_optim_loss: 3982127.0706
