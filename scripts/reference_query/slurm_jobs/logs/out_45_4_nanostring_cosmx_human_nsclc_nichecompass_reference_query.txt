Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch4', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '19102023_180839_45', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 75351
Number of validation nodes: 8372
Number of training edges: 175771
Number of validation edges: 19530
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8145; val_auprc_score: 0.8158; val_best_acc_score: 0.7269; val_best_f1_score: 0.7478; train_kl_reg_loss: 94765.2108; train_edge_recon_loss: 34837962.8256; train_gene_expr_recon_loss: 48976888.6628; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 83909616.5349; train_optim_loss: 83909616.5349; val_kl_reg_loss: 94979.2596; val_edge_recon_loss: 35289430.1538; val_gene_expr_recon_loss: 42040167.7949; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 77424577.6410; val_optim_loss: 77424577.6410
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8147; val_auprc_score: 0.8149; val_best_acc_score: 0.7294; val_best_f1_score: 0.7479; train_kl_reg_loss: 94733.6405; train_edge_recon_loss: 34816926.7442; train_gene_expr_recon_loss: 37978490.5465; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 72890151.1395; train_optim_loss: 72890151.1395; val_kl_reg_loss: 94818.9119; val_edge_recon_loss: 35298152.4103; val_gene_expr_recon_loss: 34448453.7436; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69841425.4359; val_optim_loss: 69841425.4359
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.8170; val_auprc_score: 0.8187; val_best_acc_score: 0.7301; val_best_f1_score: 0.7492; train_kl_reg_loss: 94766.0762; train_edge_recon_loss: 34816021.3256; train_gene_expr_recon_loss: 32820812.0233; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 67731599.2791; train_optim_loss: 67731599.2791; val_kl_reg_loss: 94749.8456; val_edge_recon_loss: 35280214.5641; val_gene_expr_recon_loss: 31313710.2564; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 66688674.9744; val_optim_loss: 66688674.9744
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.8154; val_auprc_score: 0.8161; val_best_acc_score: 0.7286; val_best_f1_score: 0.7495; train_kl_reg_loss: 94759.1360; train_edge_recon_loss: 34815598.8140; train_gene_expr_recon_loss: 30659912.8081; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 65570270.6860; train_optim_loss: 65570270.6860; val_kl_reg_loss: 94695.3007; val_edge_recon_loss: 35274408.7179; val_gene_expr_recon_loss: 30002916.2051; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 65372020.2051; val_optim_loss: 65372020.2051
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.8191; val_auprc_score: 0.8215; val_best_acc_score: 0.7305; val_best_f1_score: 0.7507; train_kl_reg_loss: 94741.8061; train_edge_recon_loss: 34829127.8488; train_gene_expr_recon_loss: 29624984.6744; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 64548854.3140; train_optim_loss: 64548854.3140; val_kl_reg_loss: 94778.1923; val_edge_recon_loss: 35214746.5641; val_gene_expr_recon_loss: 29112175.8462; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64421700.7179; val_optim_loss: 64421700.7179
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.8194; val_auprc_score: 0.8202; val_best_acc_score: 0.7307; val_best_f1_score: 0.7530; train_kl_reg_loss: 94746.6045; train_edge_recon_loss: 34817348.6860; train_gene_expr_recon_loss: 28946227.5465; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63858322.8256; train_optim_loss: 63858322.8256; val_kl_reg_loss: 94646.5134; val_edge_recon_loss: 35202900.7179; val_gene_expr_recon_loss: 28504876.3590; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63802423.6923; val_optim_loss: 63802423.6923
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.8145; val_auprc_score: 0.8146; val_best_acc_score: 0.7273; val_best_f1_score: 0.7492; train_kl_reg_loss: 94729.7031; train_edge_recon_loss: 34825026.2791; train_gene_expr_recon_loss: 28351365.4593; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63271121.5116; train_optim_loss: 63271121.5116; val_kl_reg_loss: 94789.3946; val_edge_recon_loss: 35294474.7692; val_gene_expr_recon_loss: 28029444.1538; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63418708.9231; val_optim_loss: 63418708.9231
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.8151; val_auprc_score: 0.8160; val_best_acc_score: 0.7277; val_best_f1_score: 0.7483; train_kl_reg_loss: 94776.1289; train_edge_recon_loss: 34821559.5698; train_gene_expr_recon_loss: 27922294.8488; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62838630.5814; train_optim_loss: 62838630.5814; val_kl_reg_loss: 94817.8652; val_edge_recon_loss: 35310452.0000; val_gene_expr_recon_loss: 27657714.0513; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63062983.8974; val_optim_loss: 63062983.8974
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.8156; val_auprc_score: 0.8171; val_best_acc_score: 0.7283; val_best_f1_score: 0.7488; train_kl_reg_loss: 94710.4488; train_edge_recon_loss: 34814618.8605; train_gene_expr_recon_loss: 27562453.9012; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62471783.0814; train_optim_loss: 62471783.0814; val_kl_reg_loss: 94786.8027; val_edge_recon_loss: 35287696.8205; val_gene_expr_recon_loss: 27283500.8718; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62665984.4103; val_optim_loss: 62665984.4103
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.8160; val_auprc_score: 0.8170; val_best_acc_score: 0.7285; val_best_f1_score: 0.7489; train_kl_reg_loss: 94747.7311; train_edge_recon_loss: 34812251.8023; train_gene_expr_recon_loss: 27255237.0291; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62162236.6395; train_optim_loss: 62162236.6395; val_kl_reg_loss: 94711.3914; val_edge_recon_loss: 35274380.7179; val_gene_expr_recon_loss: 27012358.5641; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62381450.5641; val_optim_loss: 62381450.5641
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.8169; val_auprc_score: 0.8191; val_best_acc_score: 0.7274; val_best_f1_score: 0.7489; train_kl_reg_loss: 94687.5007; train_edge_recon_loss: 34820834.7907; train_gene_expr_recon_loss: 26977016.0872; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61892538.4651; train_optim_loss: 61892538.4651; val_kl_reg_loss: 94634.4507; val_edge_recon_loss: 35258257.1282; val_gene_expr_recon_loss: 26797810.3077; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62150702.0513; val_optim_loss: 62150702.0513
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.8172; val_auprc_score: 0.8183; val_best_acc_score: 0.7299; val_best_f1_score: 0.7495; train_kl_reg_loss: 94719.3581; train_edge_recon_loss: 34820782.5581; train_gene_expr_recon_loss: 26715073.3081; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61630575.2558; train_optim_loss: 61630575.2558; val_kl_reg_loss: 94815.1164; val_edge_recon_loss: 35249248.7179; val_gene_expr_recon_loss: 26534711.3333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61878775.5897; val_optim_loss: 61878775.5897
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.8133; val_auprc_score: 0.8147; val_best_acc_score: 0.7255; val_best_f1_score: 0.7479; train_kl_reg_loss: 94740.9816; train_edge_recon_loss: 34816205.5581; train_gene_expr_recon_loss: 26496826.8198; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61407773.3372; train_optim_loss: 61407773.3372; val_kl_reg_loss: 94738.5817; val_edge_recon_loss: 35260941.5385; val_gene_expr_recon_loss: 26341709.4872; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61697389.3333; val_optim_loss: 61697389.3333
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.8135; val_auprc_score: 0.8141; val_best_acc_score: 0.7272; val_best_f1_score: 0.7469; train_kl_reg_loss: 94747.2030; train_edge_recon_loss: 34817119.1744; train_gene_expr_recon_loss: 26348710.3372; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61260576.8488; train_optim_loss: 61260576.8488; val_kl_reg_loss: 94792.2752; val_edge_recon_loss: 35347744.8205; val_gene_expr_recon_loss: 26133835.7436; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61576372.8205; val_optim_loss: 61576372.8205
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.8128; val_auprc_score: 0.8141; val_best_acc_score: 0.7241; val_best_f1_score: 0.7470; train_kl_reg_loss: 94713.9933; train_edge_recon_loss: 34827178.5000; train_gene_expr_recon_loss: 26156560.2733; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61078452.7674; train_optim_loss: 61078452.7674; val_kl_reg_loss: 94783.1607; val_edge_recon_loss: 35318783.0769; val_gene_expr_recon_loss: 25906920.2564; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61320486.4615; val_optim_loss: 61320486.4615
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.8160; val_auprc_score: 0.8167; val_best_acc_score: 0.7274; val_best_f1_score: 0.7498; train_kl_reg_loss: 94763.1903; train_edge_recon_loss: 34826583.4070; train_gene_expr_recon_loss: 25980431.9070; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60901778.5698; train_optim_loss: 60901778.5698; val_kl_reg_loss: 94784.7196; val_edge_recon_loss: 35240173.6410; val_gene_expr_recon_loss: 25816907.0256; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61151865.0256; val_optim_loss: 61151865.0256
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.8167; val_auprc_score: 0.8185; val_best_acc_score: 0.7290; val_best_f1_score: 0.7497; train_kl_reg_loss: 94734.6534; train_edge_recon_loss: 34833758.5814; train_gene_expr_recon_loss: 25834896.4360; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60763389.5581; train_optim_loss: 60763389.5581; val_kl_reg_loss: 94807.7350; val_edge_recon_loss: 35253116.6154; val_gene_expr_recon_loss: 25754470.9231; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61102395.2821; val_optim_loss: 61102395.2821
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.8139; val_auprc_score: 0.8147; val_best_acc_score: 0.7270; val_best_f1_score: 0.7476; train_kl_reg_loss: 94730.3300; train_edge_recon_loss: 34824713.7791; train_gene_expr_recon_loss: 25719450.7035; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60638894.8140; train_optim_loss: 60638894.8140; val_kl_reg_loss: 94781.5413; val_edge_recon_loss: 35282688.8205; val_gene_expr_recon_loss: 25494110.7179; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60871580.8205; val_optim_loss: 60871580.8205
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.8176; val_auprc_score: 0.8191; val_best_acc_score: 0.7300; val_best_f1_score: 0.7494; train_kl_reg_loss: 94728.1871; train_edge_recon_loss: 34817176.2442; train_gene_expr_recon_loss: 25644601.7326; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60556506.1628; train_optim_loss: 60556506.1628; val_kl_reg_loss: 94831.0821; val_edge_recon_loss: 35254304.3077; val_gene_expr_recon_loss: 25453419.5385; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60802554.9744; val_optim_loss: 60802554.9744
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.8140; val_auprc_score: 0.8154; val_best_acc_score: 0.7267; val_best_f1_score: 0.7472; train_kl_reg_loss: 94769.8824; train_edge_recon_loss: 34832680.6395; train_gene_expr_recon_loss: 25577479.5349; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60504930.0698; train_optim_loss: 60504930.0698; val_kl_reg_loss: 94931.9876; val_edge_recon_loss: 35303146.7692; val_gene_expr_recon_loss: 25401758.4615; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60799837.2308; val_optim_loss: 60799837.2308
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.8163; val_auprc_score: 0.8176; val_best_acc_score: 0.7280; val_best_f1_score: 0.7499; train_kl_reg_loss: 94734.1301; train_edge_recon_loss: 34819776.3605; train_gene_expr_recon_loss: 25486259.6744; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60400770.2209; train_optim_loss: 60400770.2209; val_kl_reg_loss: 94775.0030; val_edge_recon_loss: 35268361.1282; val_gene_expr_recon_loss: 25318612.7179; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60681748.7179; val_optim_loss: 60681748.7179
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.8164; val_auprc_score: 0.8196; val_best_acc_score: 0.7282; val_best_f1_score: 0.7475; train_kl_reg_loss: 94746.2283; train_edge_recon_loss: 34821794.6395; train_gene_expr_recon_loss: 25442232.5291; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60358773.3721; train_optim_loss: 60358773.3721; val_kl_reg_loss: 94741.8225; val_edge_recon_loss: 35256733.5385; val_gene_expr_recon_loss: 25381358.4103; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60732833.6410; val_optim_loss: 60732833.6410
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.8151; val_auprc_score: 0.8158; val_best_acc_score: 0.7284; val_best_f1_score: 0.7482; train_kl_reg_loss: 94789.4058; train_edge_recon_loss: 34824087.8256; train_gene_expr_recon_loss: 25401537.2267; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60320414.5349; train_optim_loss: 60320414.5349; val_kl_reg_loss: 94771.9465; val_edge_recon_loss: 35255096.6154; val_gene_expr_recon_loss: 25284667.1282; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60634535.5897; val_optim_loss: 60634535.5897
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.8170; val_auprc_score: 0.8164; val_best_acc_score: 0.7310; val_best_f1_score: 0.7515; train_kl_reg_loss: 94760.1736; train_edge_recon_loss: 34830246.9535; train_gene_expr_recon_loss: 25383769.7965; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60308776.9186; train_optim_loss: 60308776.9186; val_kl_reg_loss: 94678.4379; val_edge_recon_loss: 35213658.7692; val_gene_expr_recon_loss: 25265544.7179; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60573881.8462; val_optim_loss: 60573881.8462
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.8167; val_auprc_score: 0.8173; val_best_acc_score: 0.7281; val_best_f1_score: 0.7504; train_kl_reg_loss: 94785.6994; train_edge_recon_loss: 34822725.1395; train_gene_expr_recon_loss: 25340131.3779; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60257642.3023; train_optim_loss: 60257642.3023; val_kl_reg_loss: 94619.7788; val_edge_recon_loss: 35208886.0513; val_gene_expr_recon_loss: 25219057.9487; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60522564.0000; val_optim_loss: 60522564.0000
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.8124; val_auprc_score: 0.8160; val_best_acc_score: 0.7259; val_best_f1_score: 0.7442; train_kl_reg_loss: 94794.4457; train_edge_recon_loss: 34827028.2326; train_gene_expr_recon_loss: 24902637.2791; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59824460.0000; train_optim_loss: 59824460.0000; val_kl_reg_loss: 76229.2402; val_edge_recon_loss: 35225565.7436; val_gene_expr_recon_loss: 24768041.4359; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60069836.4103; val_optim_loss: 60069836.4103
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.8097; val_auprc_score: 0.8114; val_best_acc_score: 0.7235; val_best_f1_score: 0.7442; train_kl_reg_loss: 94744.6985; train_edge_recon_loss: 34774271.9767; train_gene_expr_recon_loss: 24886713.3198; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59755729.8488; train_optim_loss: 59755729.8488; val_kl_reg_loss: 76194.7939; val_edge_recon_loss: 35264644.7179; val_gene_expr_recon_loss: 24815464.8205; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60156304.1026; val_optim_loss: 60156304.1026
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.8115; val_auprc_score: 0.8149; val_best_acc_score: 0.7242; val_best_f1_score: 0.7444; train_kl_reg_loss: 94755.9265; train_edge_recon_loss: 34775198.6163; train_gene_expr_recon_loss: 24865590.3198; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59735544.8953; train_optim_loss: 59735544.8953; val_kl_reg_loss: 76190.7326; val_edge_recon_loss: 35231668.0000; val_gene_expr_recon_loss: 24742257.0769; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60050115.4872; val_optim_loss: 60050115.4872
Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.8098; val_auprc_score: 0.8120; val_best_acc_score: 0.7239; val_best_f1_score: 0.7441; train_kl_reg_loss: 94770.0366; train_edge_recon_loss: 34790013.6395; train_gene_expr_recon_loss: 24845677.7093; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59730461.3372; train_optim_loss: 59730461.3372; val_kl_reg_loss: 76275.6657; val_edge_recon_loss: 35264072.4103; val_gene_expr_recon_loss: 24718292.3077; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60058640.0000; val_optim_loss: 60058640.0000
Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.8117; val_auprc_score: 0.8140; val_best_acc_score: 0.7248; val_best_f1_score: 0.7454; train_kl_reg_loss: 94740.4030; train_edge_recon_loss: 34784382.7558; train_gene_expr_recon_loss: 24851868.9942; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59730992.2093; train_optim_loss: 59730992.2093; val_kl_reg_loss: 76124.1611; val_edge_recon_loss: 35210649.6410; val_gene_expr_recon_loss: 24747388.5641; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60034162.5641; val_optim_loss: 60034162.5641
Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.8135; val_auprc_score: 0.8177; val_best_acc_score: 0.7262; val_best_f1_score: 0.7443; train_kl_reg_loss: 94701.5250; train_edge_recon_loss: 34763303.1977; train_gene_expr_recon_loss: 24824007.3663; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59682012.1977; train_optim_loss: 59682012.1977; val_kl_reg_loss: 76221.7708; val_edge_recon_loss: 35228422.7692; val_gene_expr_recon_loss: 24691903.0769; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 59996547.6923; val_optim_loss: 59996547.6923
Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.8124; val_auprc_score: 0.8132; val_best_acc_score: 0.7266; val_best_f1_score: 0.7456; train_kl_reg_loss: 94730.5252; train_edge_recon_loss: 34772730.9186; train_gene_expr_recon_loss: 24810491.4012; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59677952.7907; train_optim_loss: 59677952.7907; val_kl_reg_loss: 76183.8235; val_edge_recon_loss: 35215964.0000; val_gene_expr_recon_loss: 24603790.9744; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 59895938.9744; val_optim_loss: 59895938.9744
Epoch 33/400 |█-------------------| 8.2% val_auroc_score: 0.8139; val_auprc_score: 0.8159; val_best_acc_score: 0.7280; val_best_f1_score: 0.7461; train_kl_reg_loss: 94725.4236; train_edge_recon_loss: 34779601.3605; train_gene_expr_recon_loss: 24800300.7674; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59674627.5814; train_optim_loss: 59674627.5814; val_kl_reg_loss: 76286.9125; val_edge_recon_loss: 35216910.4615; val_gene_expr_recon_loss: 24756301.6923; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60049499.1795; val_optim_loss: 60049499.1795
Epoch 34/400 |█-------------------| 8.5% val_auroc_score: 0.8127; val_auprc_score: 0.8159; val_best_acc_score: 0.7246; val_best_f1_score: 0.7457; train_kl_reg_loss: 94771.0478; train_edge_recon_loss: 34780422.6744; train_gene_expr_recon_loss: 24795188.6395; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59670382.4302; train_optim_loss: 59670382.4302; val_kl_reg_loss: 76287.3494; val_edge_recon_loss: 35223424.3077; val_gene_expr_recon_loss: 24650110.1538; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 59949821.8462; val_optim_loss: 59949821.8462
Epoch 35/400 |█-------------------| 8.8% val_auroc_score: 0.8108; val_auprc_score: 0.8130; val_best_acc_score: 0.7242; val_best_f1_score: 0.7443; train_kl_reg_loss: 94781.8409; train_edge_recon_loss: 34774997.9419; train_gene_expr_recon_loss: 24799383.2733; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59669163.1395; train_optim_loss: 59669163.1395; val_kl_reg_loss: 76238.0925; val_edge_recon_loss: 35264443.4872; val_gene_expr_recon_loss: 24680976.3077; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60021657.7436; val_optim_loss: 60021657.7436
Epoch 36/400 |█-------------------| 9.0% val_auroc_score: 0.8134; val_auprc_score: 0.8141; val_best_acc_score: 0.7267; val_best_f1_score: 0.7464; train_kl_reg_loss: 94719.2979; train_edge_recon_loss: 34781208.9884; train_gene_expr_recon_loss: 24782008.4244; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59657936.7093; train_optim_loss: 59657936.7093; val_kl_reg_loss: 76341.8846; val_edge_recon_loss: 35176340.1026; val_gene_expr_recon_loss: 24704385.0769; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 59957067.2821; val_optim_loss: 59957067.2821

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 37/400 |█-------------------| 9.2% val_auroc_score: 0.8083; val_auprc_score: 0.8104; val_best_acc_score: 0.7235; val_best_f1_score: 0.7427; train_kl_reg_loss: 94727.6618; train_edge_recon_loss: 34766816.9419; train_gene_expr_recon_loss: 24789368.1977; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59650912.7558; train_optim_loss: 59650912.7558; val_kl_reg_loss: 76251.1953; val_edge_recon_loss: 35284288.7179; val_gene_expr_recon_loss: 24674078.2051; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60034617.6410; val_optim_loss: 60034617.6410
Epoch 38/400 |█-------------------| 9.5% val_auroc_score: 0.8128; val_auprc_score: 0.8148; val_best_acc_score: 0.7273; val_best_f1_score: 0.7462; train_kl_reg_loss: 94733.6722; train_edge_recon_loss: 34767323.9535; train_gene_expr_recon_loss: 24775150.8372; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59637208.3721; train_optim_loss: 59637208.3721; val_kl_reg_loss: 76235.0779; val_edge_recon_loss: 35217943.3846; val_gene_expr_recon_loss: 24682614.9744; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 59976793.0256; val_optim_loss: 59976793.0256
Epoch 39/400 |█-------------------| 9.8% val_auroc_score: 0.8102; val_auprc_score: 0.8125; val_best_acc_score: 0.7228; val_best_f1_score: 0.7435; train_kl_reg_loss: 94746.5522; train_edge_recon_loss: 34744833.6163; train_gene_expr_recon_loss: 24778660.7674; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59618240.7326; train_optim_loss: 59618240.7326; val_kl_reg_loss: 76256.6336; val_edge_recon_loss: 35283767.5897; val_gene_expr_recon_loss: 24700281.2821; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60060305.2308; val_optim_loss: 60060305.2308
Epoch 40/400 |██------------------| 10.0% val_auroc_score: 0.8127; val_auprc_score: 0.8153; val_best_acc_score: 0.7243; val_best_f1_score: 0.7459; train_kl_reg_loss: 94756.9325; train_edge_recon_loss: 34795037.0000; train_gene_expr_recon_loss: 24805970.2965; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 59695764.0698; train_optim_loss: 59695764.0698; val_kl_reg_loss: 76255.1246; val_edge_recon_loss: 35233847.8974; val_gene_expr_recon_loss: 24766891.8462; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60076995.4872; val_optim_loss: 60076995.4872

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 48 min 54 sec.
Using best model state, which was in epoch 32.

--- MODEL EVALUATION ---
val AUROC score: 0.8145
val AUPRC score: 0.8170
val best accuracy score: 0.7275
val best F1 score: 0.7471
val target rna MSE score: 10.3061
val source rna MSE score: 0.7724
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0261
Val cat covariate2 mean sim diff: nan

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
