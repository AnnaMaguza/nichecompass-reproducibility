Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch4', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '19102023_172905_48', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '50', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 75351
Number of validation nodes: 8372
Number of training edges: 175771
Number of validation edges: 19530
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8420; val_auprc_score: 0.8448; val_best_acc_score: 0.7516; val_best_f1_score: 0.7624; train_kl_reg_loss: 104627.5543; train_edge_recon_loss: 35095735.2791; train_gene_expr_recon_loss: 41481654.2035; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 76690504.9302; train_optim_loss: 76690504.9302; val_kl_reg_loss: 105258.4918; val_edge_recon_loss: 35489864.7179; val_gene_expr_recon_loss: 35823002.9744; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 71426614.7692; val_optim_loss: 71426614.7692
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8408; val_auprc_score: 0.8417; val_best_acc_score: 0.7521; val_best_f1_score: 0.7628; train_kl_reg_loss: 104652.1378; train_edge_recon_loss: 35105048.5349; train_gene_expr_recon_loss: 33468965.6802; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 68687154.2907; train_optim_loss: 68687154.2907; val_kl_reg_loss: 105242.4954; val_edge_recon_loss: 35515081.9487; val_gene_expr_recon_loss: 32444173.2821; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 68072985.6410; val_optim_loss: 68072985.6410
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.8428; val_auprc_score: 0.8449; val_best_acc_score: 0.7537; val_best_f1_score: 0.7628; train_kl_reg_loss: 104623.1099; train_edge_recon_loss: 35105238.8721; train_gene_expr_recon_loss: 31165644.4070; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 66383994.4767; train_optim_loss: 66383994.4767; val_kl_reg_loss: 105173.9774; val_edge_recon_loss: 35450330.8718; val_gene_expr_recon_loss: 30923227.7949; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 66487221.5385; val_optim_loss: 66487221.5385
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.8417; val_auprc_score: 0.8443; val_best_acc_score: 0.7527; val_best_f1_score: 0.7614; train_kl_reg_loss: 104658.0627; train_edge_recon_loss: 35110039.9884; train_gene_expr_recon_loss: 30050663.5523; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 65273849.4651; train_optim_loss: 65273849.4651; val_kl_reg_loss: 105147.5615; val_edge_recon_loss: 35499520.4103; val_gene_expr_recon_loss: 29954927.3333; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 65568083.3846; val_optim_loss: 65568083.3846
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.8417; val_auprc_score: 0.8450; val_best_acc_score: 0.7521; val_best_f1_score: 0.7610; train_kl_reg_loss: 104677.1763; train_edge_recon_loss: 35114733.6395; train_gene_expr_recon_loss: 29351762.9767; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 64579661.9070; train_optim_loss: 64579661.9070; val_kl_reg_loss: 105328.9463; val_edge_recon_loss: 35531795.3846; val_gene_expr_recon_loss: 29540651.6923; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 65186264.1026; val_optim_loss: 65186264.1026
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.8419; val_auprc_score: 0.8440; val_best_acc_score: 0.7528; val_best_f1_score: 0.7625; train_kl_reg_loss: 104673.1904; train_edge_recon_loss: 35114472.1163; train_gene_expr_recon_loss: 28878075.3198; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 64105708.6279; train_optim_loss: 64105708.6279; val_kl_reg_loss: 105283.0369; val_edge_recon_loss: 35499293.0256; val_gene_expr_recon_loss: 29121838.6667; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64734903.0769; val_optim_loss: 64734903.0769
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.8415; val_auprc_score: 0.8443; val_best_acc_score: 0.7508; val_best_f1_score: 0.7609; train_kl_reg_loss: 104626.1717; train_edge_recon_loss: 35111070.1279; train_gene_expr_recon_loss: 28609613.2093; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63833797.5814; train_optim_loss: 63833797.5814; val_kl_reg_loss: 105168.4798; val_edge_recon_loss: 35472788.6154; val_gene_expr_recon_loss: 28878989.2308; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64465434.3590; val_optim_loss: 64465434.3590
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.8393; val_auprc_score: 0.8418; val_best_acc_score: 0.7490; val_best_f1_score: 0.7606; train_kl_reg_loss: 104665.0234; train_edge_recon_loss: 35104707.5698; train_gene_expr_recon_loss: 28337136.9419; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63554997.4419; train_optim_loss: 63554997.4419; val_kl_reg_loss: 105230.0903; val_edge_recon_loss: 35484219.0769; val_gene_expr_recon_loss: 28501198.5641; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64099135.6923; val_optim_loss: 64099135.6923
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.8414; val_auprc_score: 0.8433; val_best_acc_score: 0.7520; val_best_f1_score: 0.7623; train_kl_reg_loss: 104680.3217; train_edge_recon_loss: 35084387.4186; train_gene_expr_recon_loss: 28135747.8605; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63333303.6977; train_optim_loss: 63333303.6977; val_kl_reg_loss: 105332.0609; val_edge_recon_loss: 35477122.0513; val_gene_expr_recon_loss: 28444161.7436; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64035104.1026; val_optim_loss: 64035104.1026
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.8417; val_auprc_score: 0.8439; val_best_acc_score: 0.7535; val_best_f1_score: 0.7627; train_kl_reg_loss: 104628.5342; train_edge_recon_loss: 35118769.5000; train_gene_expr_recon_loss: 27979668.7733; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63211554.8721; train_optim_loss: 63211554.8721; val_kl_reg_loss: 105302.5140; val_edge_recon_loss: 35491954.8718; val_gene_expr_recon_loss: 28232929.5385; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63838675.4872; val_optim_loss: 63838675.4872
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.8412; val_auprc_score: 0.8444; val_best_acc_score: 0.7510; val_best_f1_score: 0.7604; train_kl_reg_loss: 104681.2703; train_edge_recon_loss: 35117587.4186; train_gene_expr_recon_loss: 27862473.4360; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63093230.0814; train_optim_loss: 63093230.0814; val_kl_reg_loss: 105188.0094; val_edge_recon_loss: 35459317.3333; val_gene_expr_recon_loss: 28099106.0000; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63672098.5641; val_optim_loss: 63672098.5641
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.8413; val_auprc_score: 0.8434; val_best_acc_score: 0.7518; val_best_f1_score: 0.7617; train_kl_reg_loss: 104650.1243; train_edge_recon_loss: 35115674.6977; train_gene_expr_recon_loss: 27720468.0116; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62949280.9419; train_optim_loss: 62949280.9419; val_kl_reg_loss: 105075.0719; val_edge_recon_loss: 35532229.1282; val_gene_expr_recon_loss: 27901001.8462; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63546794.2564; val_optim_loss: 63546794.2564
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.8429; val_auprc_score: 0.8455; val_best_acc_score: 0.7533; val_best_f1_score: 0.7635; train_kl_reg_loss: 104659.3643; train_edge_recon_loss: 35143235.5000; train_gene_expr_recon_loss: 27567665.2733; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62824048.2442; train_optim_loss: 62824048.2442; val_kl_reg_loss: 105223.1142; val_edge_recon_loss: 35491653.3333; val_gene_expr_recon_loss: 27824216.1026; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63429580.6154; val_optim_loss: 63429580.6154
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.8433; val_auprc_score: 0.8458; val_best_acc_score: 0.7531; val_best_f1_score: 0.7645; train_kl_reg_loss: 104632.0069; train_edge_recon_loss: 35112497.9884; train_gene_expr_recon_loss: 27456582.1105; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62682200.0349; train_optim_loss: 62682200.0349; val_kl_reg_loss: 105341.0483; val_edge_recon_loss: 35496596.2051; val_gene_expr_recon_loss: 27770368.6154; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63380793.8462; val_optim_loss: 63380793.8462
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.8410; val_auprc_score: 0.8442; val_best_acc_score: 0.7509; val_best_f1_score: 0.7602; train_kl_reg_loss: 104639.4734; train_edge_recon_loss: 35096990.0814; train_gene_expr_recon_loss: 27331114.5058; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62541232.1395; train_optim_loss: 62541232.1395; val_kl_reg_loss: 105226.3079; val_edge_recon_loss: 35511332.1026; val_gene_expr_recon_loss: 27660146.0513; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63285192.3077; val_optim_loss: 63285192.3077
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.8419; val_auprc_score: 0.8434; val_best_acc_score: 0.7528; val_best_f1_score: 0.7619; train_kl_reg_loss: 104602.1540; train_edge_recon_loss: 35103232.1047; train_gene_expr_recon_loss: 27269569.6686; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62485891.7442; train_optim_loss: 62485891.7442; val_kl_reg_loss: 105364.5978; val_edge_recon_loss: 35477205.8462; val_gene_expr_recon_loss: 27641258.9744; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63232317.5385; val_optim_loss: 63232317.5385
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.8405; val_auprc_score: 0.8420; val_best_acc_score: 0.7508; val_best_f1_score: 0.7625; train_kl_reg_loss: 104683.7054; train_edge_recon_loss: 35133968.8953; train_gene_expr_recon_loss: 27172720.2558; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62419860.9419; train_optim_loss: 62419860.9419; val_kl_reg_loss: 105121.5164; val_edge_recon_loss: 35510613.2308; val_gene_expr_recon_loss: 27427272.4615; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63051495.6923; val_optim_loss: 63051495.6923
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.8423; val_auprc_score: 0.8439; val_best_acc_score: 0.7520; val_best_f1_score: 0.7623; train_kl_reg_loss: 104600.3760; train_edge_recon_loss: 35109009.5233; train_gene_expr_recon_loss: 27114219.6919; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62336317.6395; train_optim_loss: 62336317.6395; val_kl_reg_loss: 105180.0529; val_edge_recon_loss: 35478562.4615; val_gene_expr_recon_loss: 27340092.8205; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62932323.3846; val_optim_loss: 62932323.3846
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.8431; val_auprc_score: 0.8459; val_best_acc_score: 0.7524; val_best_f1_score: 0.7635; train_kl_reg_loss: 104659.9205; train_edge_recon_loss: 35104114.5233; train_gene_expr_recon_loss: 27097208.1453; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62314470.5930; train_optim_loss: 62314470.5930; val_kl_reg_loss: 105208.5036; val_edge_recon_loss: 35428174.6667; val_gene_expr_recon_loss: 27339937.9487; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62881809.5385; val_optim_loss: 62881809.5385
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.8444; val_auprc_score: 0.8464; val_best_acc_score: 0.7548; val_best_f1_score: 0.7641; train_kl_reg_loss: 104657.7316; train_edge_recon_loss: 35105919.1628; train_gene_expr_recon_loss: 27024558.1802; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62243623.0814; train_optim_loss: 62243623.0814; val_kl_reg_loss: 105440.3169; val_edge_recon_loss: 35456460.3077; val_gene_expr_recon_loss: 27347705.7436; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62918094.8718; val_optim_loss: 62918094.8718
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.8394; val_auprc_score: 0.8409; val_best_acc_score: 0.7498; val_best_f1_score: 0.7601; train_kl_reg_loss: 104655.6015; train_edge_recon_loss: 35106476.6163; train_gene_expr_recon_loss: 26959987.4360; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62179607.7558; train_optim_loss: 62179607.7558; val_kl_reg_loss: 105312.4946; val_edge_recon_loss: 35559543.0769; val_gene_expr_recon_loss: 27286696.2564; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62960040.2051; val_optim_loss: 62960040.2051
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.8426; val_auprc_score: 0.8450; val_best_acc_score: 0.7536; val_best_f1_score: 0.7631; train_kl_reg_loss: 104670.0848; train_edge_recon_loss: 35108489.1279; train_gene_expr_recon_loss: 26925006.7093; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62146653.8605; train_optim_loss: 62146653.8605; val_kl_reg_loss: 105210.0421; val_edge_recon_loss: 35468150.6667; val_gene_expr_recon_loss: 27280741.2821; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62862590.1538; val_optim_loss: 62862590.1538
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.8404; val_auprc_score: 0.8437; val_best_acc_score: 0.7494; val_best_f1_score: 0.7604; train_kl_reg_loss: 104569.8953; train_edge_recon_loss: 35093127.9884; train_gene_expr_recon_loss: 26855651.2035; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62061836.9302; train_optim_loss: 62061836.9302; val_kl_reg_loss: 105084.3413; val_edge_recon_loss: 35525647.3846; val_gene_expr_recon_loss: 27122735.5385; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62761955.2821; val_optim_loss: 62761955.2821
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.8412; val_auprc_score: 0.8432; val_best_acc_score: 0.7503; val_best_f1_score: 0.7631; train_kl_reg_loss: 104613.8188; train_edge_recon_loss: 35116533.6395; train_gene_expr_recon_loss: 26848408.7558; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62078044.2558; train_optim_loss: 62078044.2558; val_kl_reg_loss: 105220.6102; val_edge_recon_loss: 35504279.0769; val_gene_expr_recon_loss: 27171029.3333; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62789016.7179; val_optim_loss: 62789016.7179
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.8432; val_auprc_score: 0.8448; val_best_acc_score: 0.7525; val_best_f1_score: 0.7648; train_kl_reg_loss: 104675.3249; train_edge_recon_loss: 35122406.6977; train_gene_expr_recon_loss: 26832397.0407; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62067967.0930; train_optim_loss: 62067967.0930; val_kl_reg_loss: 105190.9329; val_edge_recon_loss: 35447085.2308; val_gene_expr_recon_loss: 27047418.4615; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62608182.5641; val_optim_loss: 62608182.5641
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.8218; val_auprc_score: 0.8294; val_best_acc_score: 0.7325; val_best_f1_score: 0.7443; train_kl_reg_loss: 104661.9333; train_edge_recon_loss: 35799648.2907; train_gene_expr_recon_loss: 26737956.0872; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62650754.3605; train_optim_loss: 62650754.3605; val_kl_reg_loss: 87353.6789; val_edge_recon_loss: 36154258.8718; val_gene_expr_recon_loss: 26948315.0769; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63198415.8974; val_optim_loss: 63198415.8974
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.8177; val_auprc_score: 0.8225; val_best_acc_score: 0.7292; val_best_f1_score: 0.7445; train_kl_reg_loss: 104624.3958; train_edge_recon_loss: 35769349.7791; train_gene_expr_recon_loss: 26549059.2035; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62431521.4302; train_optim_loss: 62431521.4302; val_kl_reg_loss: 87338.1420; val_edge_recon_loss: 36105954.0513; val_gene_expr_recon_loss: 26813140.4103; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63014920.4103; val_optim_loss: 63014920.4103
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.8191; val_auprc_score: 0.8251; val_best_acc_score: 0.7314; val_best_f1_score: 0.7445; train_kl_reg_loss: 104645.6630; train_edge_recon_loss: 35798300.9651; train_gene_expr_recon_loss: 26501094.3081; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62412528.8721; train_optim_loss: 62412528.8721; val_kl_reg_loss: 87404.4147; val_edge_recon_loss: 36151659.4872; val_gene_expr_recon_loss: 26841894.9231; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63089446.8718; val_optim_loss: 63089446.8718
Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.8186; val_auprc_score: 0.8237; val_best_acc_score: 0.7311; val_best_f1_score: 0.7448; train_kl_reg_loss: 104721.9027; train_edge_recon_loss: 35791456.2442; train_gene_expr_recon_loss: 26514096.4767; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62418762.7558; train_optim_loss: 62418762.7558; val_kl_reg_loss: 87279.8980; val_edge_recon_loss: 36131513.4359; val_gene_expr_recon_loss: 26750855.9487; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62978137.4359; val_optim_loss: 62978137.4359

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.8193; val_auprc_score: 0.8249; val_best_acc_score: 0.7318; val_best_f1_score: 0.7441; train_kl_reg_loss: 104655.0037; train_edge_recon_loss: 35803649.2093; train_gene_expr_recon_loss: 26480887.1860; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62397679.4186; train_optim_loss: 62397679.4186; val_kl_reg_loss: 87291.5821; val_edge_recon_loss: 36133897.5385; val_gene_expr_recon_loss: 26729780.7179; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62959458.1538; val_optim_loss: 62959458.1538
Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.8201; val_auprc_score: 0.8266; val_best_acc_score: 0.7318; val_best_f1_score: 0.7442; train_kl_reg_loss: 104649.7395; train_edge_recon_loss: 35795692.9767; train_gene_expr_recon_loss: 26474277.3547; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62383107.9302; train_optim_loss: 62383107.9302; val_kl_reg_loss: 87286.2798; val_edge_recon_loss: 36136650.7692; val_gene_expr_recon_loss: 26782217.5897; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63014642.8718; val_optim_loss: 63014642.8718
Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.8192; val_auprc_score: 0.8253; val_best_acc_score: 0.7305; val_best_f1_score: 0.7450; train_kl_reg_loss: 104659.5467; train_edge_recon_loss: 35783975.5000; train_gene_expr_recon_loss: 26467158.7209; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62364281.7674; train_optim_loss: 62364281.7674; val_kl_reg_loss: 87289.8466; val_edge_recon_loss: 36133254.4615; val_gene_expr_recon_loss: 26743031.7949; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62972063.8974; val_optim_loss: 62972063.8974
Epoch 33/400 |█-------------------| 8.2% val_auroc_score: 0.8196; val_auprc_score: 0.8251; val_best_acc_score: 0.7318; val_best_f1_score: 0.7452; train_kl_reg_loss: 104625.2149; train_edge_recon_loss: 35804502.1860; train_gene_expr_recon_loss: 26444515.3081; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62362130.8023; train_optim_loss: 62362130.8023; val_kl_reg_loss: 87274.1370; val_edge_recon_loss: 36122613.2308; val_gene_expr_recon_loss: 26760708.3590; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62979083.7949; val_optim_loss: 62979083.7949

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 25 min 43 sec.
Using best model state, which was in epoch 25.

--- MODEL EVALUATION ---
val AUROC score: 0.8254
val AUPRC score: 0.8295
val best accuracy score: 0.7385
val best F1 score: 0.7489
val target rna MSE score: 23.8500
val source rna MSE score: 1.3973
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0246
Val cat covariate2 mean sim diff: nan

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
