Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch4', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '19102023_172844_42', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 75351
Number of validation nodes: 8372
Number of training edges: 175771
Number of validation edges: 19530
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8107; val_auprc_score: 0.8136; val_best_acc_score: 0.7241; val_best_f1_score: 0.7427; train_kl_reg_loss: 130123.5166; train_edge_recon_loss: 34468903.6279; train_gene_expr_recon_loss: 40255530.6744; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 74854558.1163; train_optim_loss: 74854558.1163; val_kl_reg_loss: 130327.8431; val_edge_recon_loss: 35082625.5385; val_gene_expr_recon_loss: 34128478.1026; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69341431.1795; val_optim_loss: 69341431.1795
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8112; val_auprc_score: 0.8132; val_best_acc_score: 0.7246; val_best_f1_score: 0.7436; train_kl_reg_loss: 130142.3656; train_edge_recon_loss: 34471974.2558; train_gene_expr_recon_loss: 31366256.7384; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 65968373.2791; train_optim_loss: 65968373.2791; val_kl_reg_loss: 130416.3009; val_edge_recon_loss: 35033919.1795; val_gene_expr_recon_loss: 30154968.1026; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 65319303.5897; val_optim_loss: 65319303.5897
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.8148; val_auprc_score: 0.8174; val_best_acc_score: 0.7287; val_best_f1_score: 0.7456; train_kl_reg_loss: 130130.6171; train_edge_recon_loss: 34480115.9535; train_gene_expr_recon_loss: 29435838.2791; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 64046084.9302; train_optim_loss: 64046084.9302; val_kl_reg_loss: 130300.2987; val_edge_recon_loss: 35038138.5641; val_gene_expr_recon_loss: 29311359.4359; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64479798.0513; val_optim_loss: 64479798.0513
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.8143; val_auprc_score: 0.8163; val_best_acc_score: 0.7277; val_best_f1_score: 0.7458; train_kl_reg_loss: 130164.5464; train_edge_recon_loss: 34487083.8140; train_gene_expr_recon_loss: 28963340.2093; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63580588.6047; train_optim_loss: 63580588.6047; val_kl_reg_loss: 130298.1623; val_edge_recon_loss: 35032756.0000; val_gene_expr_recon_loss: 28946389.0256; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64109442.9744; val_optim_loss: 64109442.9744
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.8105; val_auprc_score: 0.8138; val_best_acc_score: 0.7232; val_best_f1_score: 0.7425; train_kl_reg_loss: 130110.0794; train_edge_recon_loss: 34455874.9070; train_gene_expr_recon_loss: 28657673.6744; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63243658.5930; train_optim_loss: 63243658.5930; val_kl_reg_loss: 130474.6819; val_edge_recon_loss: 35085645.3333; val_gene_expr_recon_loss: 28680141.0256; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63896261.1282; val_optim_loss: 63896261.1282
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.8122; val_auprc_score: 0.8148; val_best_acc_score: 0.7248; val_best_f1_score: 0.7440; train_kl_reg_loss: 130061.3311; train_edge_recon_loss: 34473168.5698; train_gene_expr_recon_loss: 28397801.2267; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63001031.0930; train_optim_loss: 63001031.0930; val_kl_reg_loss: 130519.0375; val_edge_recon_loss: 35035536.4103; val_gene_expr_recon_loss: 28529116.3590; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63695171.7949; val_optim_loss: 63695171.7949
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.8139; val_auprc_score: 0.8172; val_best_acc_score: 0.7270; val_best_f1_score: 0.7437; train_kl_reg_loss: 130120.9268; train_edge_recon_loss: 34460410.6744; train_gene_expr_recon_loss: 28230638.8023; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62821170.4535; train_optim_loss: 62821170.4535; val_kl_reg_loss: 130500.6911; val_edge_recon_loss: 35010615.0769; val_gene_expr_recon_loss: 28298912.5128; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63440028.5128; val_optim_loss: 63440028.5128
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.8130; val_auprc_score: 0.8151; val_best_acc_score: 0.7265; val_best_f1_score: 0.7461; train_kl_reg_loss: 130144.4555; train_edge_recon_loss: 34471668.5465; train_gene_expr_recon_loss: 28041018.1860; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62642831.0814; train_optim_loss: 62642831.0814; val_kl_reg_loss: 130529.2063; val_edge_recon_loss: 35014819.1795; val_gene_expr_recon_loss: 28110536.2564; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63255884.9231; val_optim_loss: 63255884.9231
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.8138; val_auprc_score: 0.8162; val_best_acc_score: 0.7273; val_best_f1_score: 0.7456; train_kl_reg_loss: 130073.2653; train_edge_recon_loss: 34448372.1512; train_gene_expr_recon_loss: 27881544.1919; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62459989.5349; train_optim_loss: 62459989.5349; val_kl_reg_loss: 130376.9892; val_edge_recon_loss: 34972012.0000; val_gene_expr_recon_loss: 28051470.3077; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63153859.3846; val_optim_loss: 63153859.3846
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.8133; val_auprc_score: 0.8147; val_best_acc_score: 0.7267; val_best_f1_score: 0.7459; train_kl_reg_loss: 130238.1127; train_edge_recon_loss: 34471794.4419; train_gene_expr_recon_loss: 27756084.0407; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62358116.4884; train_optim_loss: 62358116.4884; val_kl_reg_loss: 130152.3878; val_edge_recon_loss: 35031392.4103; val_gene_expr_recon_loss: 27816376.6667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62977921.0256; val_optim_loss: 62977921.0256
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.8120; val_auprc_score: 0.8142; val_best_acc_score: 0.7269; val_best_f1_score: 0.7438; train_kl_reg_loss: 130210.4647; train_edge_recon_loss: 34499684.5233; train_gene_expr_recon_loss: 27647115.2093; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62277010.0581; train_optim_loss: 62277010.0581; val_kl_reg_loss: 130840.4635; val_edge_recon_loss: 35027157.6410; val_gene_expr_recon_loss: 27719807.3333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62877805.4359; val_optim_loss: 62877805.4359
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.8151; val_auprc_score: 0.8181; val_best_acc_score: 0.7281; val_best_f1_score: 0.7460; train_kl_reg_loss: 130079.8922; train_edge_recon_loss: 34481911.3372; train_gene_expr_recon_loss: 27520657.0988; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62132648.2674; train_optim_loss: 62132648.2674; val_kl_reg_loss: 130600.0050; val_edge_recon_loss: 34994416.0000; val_gene_expr_recon_loss: 27707130.7692; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62832146.4615; val_optim_loss: 62832146.4615
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.8131; val_auprc_score: 0.8172; val_best_acc_score: 0.7258; val_best_f1_score: 0.7437; train_kl_reg_loss: 130134.3676; train_edge_recon_loss: 34461147.8605; train_gene_expr_recon_loss: 27436982.3779; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62028264.6163; train_optim_loss: 62028264.6163; val_kl_reg_loss: 130325.3914; val_edge_recon_loss: 35059814.2564; val_gene_expr_recon_loss: 27482427.3846; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62672566.8718; val_optim_loss: 62672566.8718
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.8144; val_auprc_score: 0.8152; val_best_acc_score: 0.7277; val_best_f1_score: 0.7466; train_kl_reg_loss: 130195.4269; train_edge_recon_loss: 34472760.0349; train_gene_expr_recon_loss: 27370806.7442; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61973762.1512; train_optim_loss: 61973762.1512; val_kl_reg_loss: 130394.6651; val_edge_recon_loss: 34965098.0513; val_gene_expr_recon_loss: 27537177.0769; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62632669.9487; val_optim_loss: 62632669.9487
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.8156; val_auprc_score: 0.8187; val_best_acc_score: 0.7277; val_best_f1_score: 0.7465; train_kl_reg_loss: 130079.9896; train_edge_recon_loss: 34467974.8605; train_gene_expr_recon_loss: 27310750.9419; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61908805.7674; train_optim_loss: 61908805.7674; val_kl_reg_loss: 130559.2652; val_edge_recon_loss: 35007246.0513; val_gene_expr_recon_loss: 27511860.1538; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62649665.4359; val_optim_loss: 62649665.4359
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.8119; val_auprc_score: 0.8141; val_best_acc_score: 0.7253; val_best_f1_score: 0.7435; train_kl_reg_loss: 130070.8509; train_edge_recon_loss: 34475013.4070; train_gene_expr_recon_loss: 27216326.3140; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61821410.6047; train_optim_loss: 61821410.6047; val_kl_reg_loss: 130304.2504; val_edge_recon_loss: 35047653.0256; val_gene_expr_recon_loss: 27394137.6923; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62572094.7692; val_optim_loss: 62572094.7692
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.8162; val_auprc_score: 0.8186; val_best_acc_score: 0.7295; val_best_f1_score: 0.7454; train_kl_reg_loss: 130130.9736; train_edge_recon_loss: 34481430.2674; train_gene_expr_recon_loss: 27156481.9070; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61768043.1512; train_optim_loss: 61768043.1512; val_kl_reg_loss: 130455.3798; val_edge_recon_loss: 34942177.1282; val_gene_expr_recon_loss: 27271510.6667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62344143.2821; val_optim_loss: 62344143.2821
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.8144; val_auprc_score: 0.8165; val_best_acc_score: 0.7271; val_best_f1_score: 0.7451; train_kl_reg_loss: 130196.1071; train_edge_recon_loss: 34481706.1395; train_gene_expr_recon_loss: 27153728.1512; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61765630.4070; train_optim_loss: 61765630.4070; val_kl_reg_loss: 130604.8307; val_edge_recon_loss: 35013010.6667; val_gene_expr_recon_loss: 27276048.2564; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62419663.0769; val_optim_loss: 62419663.0769
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.8120; val_auprc_score: 0.8141; val_best_acc_score: 0.7282; val_best_f1_score: 0.7422; train_kl_reg_loss: 130150.9200; train_edge_recon_loss: 34465340.2558; train_gene_expr_recon_loss: 27084150.3895; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61679641.4070; train_optim_loss: 61679641.4070; val_kl_reg_loss: 130464.9321; val_edge_recon_loss: 35088472.9231; val_gene_expr_recon_loss: 27208244.2564; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62427182.2564; val_optim_loss: 62427182.2564
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.8128; val_auprc_score: 0.8151; val_best_acc_score: 0.7264; val_best_f1_score: 0.7455; train_kl_reg_loss: 130125.8487; train_edge_recon_loss: 34458337.3488; train_gene_expr_recon_loss: 27043065.3895; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61631528.7558; train_optim_loss: 61631528.7558; val_kl_reg_loss: 130450.1597; val_edge_recon_loss: 34986389.0256; val_gene_expr_recon_loss: 27263533.9487; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62380373.2308; val_optim_loss: 62380373.2308
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.8155; val_auprc_score: 0.8180; val_best_acc_score: 0.7290; val_best_f1_score: 0.7459; train_kl_reg_loss: 130147.5499; train_edge_recon_loss: 34473337.3023; train_gene_expr_recon_loss: 27024785.7326; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61628270.6047; train_optim_loss: 61628270.6047; val_kl_reg_loss: 130459.4343; val_edge_recon_loss: 34994548.1026; val_gene_expr_recon_loss: 27240103.4359; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62365110.7692; val_optim_loss: 62365110.7692

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.8132; val_auprc_score: 0.8172; val_best_acc_score: 0.7270; val_best_f1_score: 0.7442; train_kl_reg_loss: 130147.4733; train_edge_recon_loss: 34479285.1628; train_gene_expr_recon_loss: 27001210.2791; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61610642.8953; train_optim_loss: 61610642.8953; val_kl_reg_loss: 130527.5300; val_edge_recon_loss: 35065847.7949; val_gene_expr_recon_loss: 27238853.1282; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62435227.6923; val_optim_loss: 62435227.6923
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.8126; val_auprc_score: 0.8142; val_best_acc_score: 0.7258; val_best_f1_score: 0.7453; train_kl_reg_loss: 130111.7541; train_edge_recon_loss: 34462673.7326; train_gene_expr_recon_loss: 27002198.7093; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61594984.1744; train_optim_loss: 61594984.1744; val_kl_reg_loss: 130533.0415; val_edge_recon_loss: 35021139.4872; val_gene_expr_recon_loss: 27139777.8462; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62291450.4615; val_optim_loss: 62291450.4615
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.8107; val_auprc_score: 0.8137; val_best_acc_score: 0.7243; val_best_f1_score: 0.7432; train_kl_reg_loss: 130098.4383; train_edge_recon_loss: 34462120.2907; train_gene_expr_recon_loss: 26996080.0581; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61588298.6860; train_optim_loss: 61588298.6860; val_kl_reg_loss: 130281.8265; val_edge_recon_loss: 35061705.1282; val_gene_expr_recon_loss: 27078342.6667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62270329.7436; val_optim_loss: 62270329.7436
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.8146; val_auprc_score: 0.8162; val_best_acc_score: 0.7289; val_best_f1_score: 0.7451; train_kl_reg_loss: 130122.2923; train_edge_recon_loss: 34476307.5233; train_gene_expr_recon_loss: 27021877.8779; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61628307.6628; train_optim_loss: 61628307.6628; val_kl_reg_loss: 130627.1581; val_edge_recon_loss: 34994632.0000; val_gene_expr_recon_loss: 27286100.2051; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62411359.1795; val_optim_loss: 62411359.1795
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.7904; val_auprc_score: 0.8012; val_best_acc_score: 0.7047; val_best_f1_score: 0.7304; train_kl_reg_loss: 130130.4742; train_edge_recon_loss: 34732282.6395; train_gene_expr_recon_loss: 29137343.7791; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63999756.8953; train_optim_loss: 63999756.8953; val_kl_reg_loss: 71090.2929; val_edge_recon_loss: 35231775.5897; val_gene_expr_recon_loss: 29133602.6667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64436468.7179; val_optim_loss: 64436468.7179
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.7889; val_auprc_score: 0.7992; val_best_acc_score: 0.7047; val_best_f1_score: 0.7294; train_kl_reg_loss: 130178.0203; train_edge_recon_loss: 34791932.9767; train_gene_expr_recon_loss: 28970865.3605; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63892976.2791; train_optim_loss: 63892976.2791; val_kl_reg_loss: 71106.8830; val_edge_recon_loss: 35301906.7692; val_gene_expr_recon_loss: 29060733.3846; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64433746.7692; val_optim_loss: 64433746.7692
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.7904; val_auprc_score: 0.8007; val_best_acc_score: 0.7052; val_best_f1_score: 0.7298; train_kl_reg_loss: 130200.7784; train_edge_recon_loss: 34770130.6512; train_gene_expr_recon_loss: 28962244.5291; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63862576.0000; train_optim_loss: 63862576.0000; val_kl_reg_loss: 71268.2997; val_edge_recon_loss: 35243429.8462; val_gene_expr_recon_loss: 29109717.2821; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64424415.3846; val_optim_loss: 64424415.3846

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.7874; val_auprc_score: 0.7974; val_best_acc_score: 0.7031; val_best_f1_score: 0.7281; train_kl_reg_loss: 130113.0004; train_edge_recon_loss: 34772582.6744; train_gene_expr_recon_loss: 28936637.1744; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63839332.8721; train_optim_loss: 63839332.8721; val_kl_reg_loss: 71173.1861; val_edge_recon_loss: 35308737.0256; val_gene_expr_recon_loss: 29138906.9744; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64518817.4359; val_optim_loss: 64518817.4359
Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.7899; val_auprc_score: 0.8022; val_best_acc_score: 0.7067; val_best_f1_score: 0.7289; train_kl_reg_loss: 130119.5997; train_edge_recon_loss: 34780032.3721; train_gene_expr_recon_loss: 28961482.8547; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63871635.0000; train_optim_loss: 63871635.0000; val_kl_reg_loss: 71074.3431; val_edge_recon_loss: 35295233.6410; val_gene_expr_recon_loss: 29231753.9487; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64598062.3590; val_optim_loss: 64598062.3590
Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.7907; val_auprc_score: 0.8024; val_best_acc_score: 0.7033; val_best_f1_score: 0.7309; train_kl_reg_loss: 130106.1944; train_edge_recon_loss: 34754190.3605; train_gene_expr_recon_loss: 28927109.7035; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63811406.2558; train_optim_loss: 63811406.2558; val_kl_reg_loss: 70993.4669; val_edge_recon_loss: 35239711.0769; val_gene_expr_recon_loss: 29141152.3590; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64451857.0256; val_optim_loss: 64451857.0256
Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.7927; val_auprc_score: 0.8038; val_best_acc_score: 0.7081; val_best_f1_score: 0.7309; train_kl_reg_loss: 130112.9853; train_edge_recon_loss: 34785283.7093; train_gene_expr_recon_loss: 28918059.5756; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63833456.2442; train_optim_loss: 63833456.2442; val_kl_reg_loss: 71120.4425; val_edge_recon_loss: 35225373.9487; val_gene_expr_recon_loss: 29163945.2821; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64460439.5897; val_optim_loss: 64460439.5897

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 34 min 25 sec.
Using best model state, which was in epoch 24.

--- MODEL EVALUATION ---
val AUROC score: 0.7938
val AUPRC score: 0.8035
val best accuracy score: 0.7076
val best F1 score: 0.7313
val target rna MSE score: 30.5291
val source rna MSE score: 1.0534
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0266
Val cat covariate2 mean sim diff: nan

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
