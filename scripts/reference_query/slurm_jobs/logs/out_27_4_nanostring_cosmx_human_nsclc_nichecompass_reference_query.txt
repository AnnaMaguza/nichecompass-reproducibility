Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch4', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '06102023_173136_27', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 75351
Number of validation nodes: 8372
Number of training edges: 175771
Number of validation edges: 19530
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8329; val_auprc_score: 0.8326; val_best_acc_score: 0.7414; val_best_f1_score: 0.7626; train_kl_reg_loss: 66428.6157; train_edge_recon_loss: 34109832.9767; train_gene_expr_recon_loss: 90349954.1744; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 124526215.8140; train_optim_loss: 124526215.8140; val_kl_reg_loss: 66499.0837; val_edge_recon_loss: 34531822.6667; val_gene_expr_recon_loss: 60350294.0513; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 94948615.3846; val_optim_loss: 94948615.3846
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8335; val_auprc_score: 0.8320; val_best_acc_score: 0.7451; val_best_f1_score: 0.7624; train_kl_reg_loss: 66440.7303; train_edge_recon_loss: 34120756.5000; train_gene_expr_recon_loss: 57015556.7674; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 91202753.9767; train_optim_loss: 91202753.9767; val_kl_reg_loss: 66549.5769; val_edge_recon_loss: 34504440.7179; val_gene_expr_recon_loss: 52808884.5128; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 87379875.0769; val_optim_loss: 87379875.0769
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.8305; val_auprc_score: 0.8305; val_best_acc_score: 0.7402; val_best_f1_score: 0.7601; train_kl_reg_loss: 66449.9913; train_edge_recon_loss: 34115398.7209; train_gene_expr_recon_loss: 53642293.0814; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 87824141.5581; train_optim_loss: 87824141.5581; val_kl_reg_loss: 66581.3005; val_edge_recon_loss: 34608945.1282; val_gene_expr_recon_loss: 51142825.8462; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 85818352.0000; val_optim_loss: 85818352.0000
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.8276; val_auprc_score: 0.8271; val_best_acc_score: 0.7379; val_best_f1_score: 0.7569; train_kl_reg_loss: 66460.5762; train_edge_recon_loss: 34118179.4767; train_gene_expr_recon_loss: 52211014.4419; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 86395654.5116; train_optim_loss: 86395654.5116; val_kl_reg_loss: 66607.9409; val_edge_recon_loss: 34612443.8974; val_gene_expr_recon_loss: 49773014.1538; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 84452065.4359; val_optim_loss: 84452065.4359
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.8295; val_auprc_score: 0.8286; val_best_acc_score: 0.7392; val_best_f1_score: 0.7590; train_kl_reg_loss: 66432.7523; train_edge_recon_loss: 34107403.6279; train_gene_expr_recon_loss: 50743670.5698; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 84917506.8605; train_optim_loss: 84917506.8605; val_kl_reg_loss: 66543.1532; val_edge_recon_loss: 34555712.7179; val_gene_expr_recon_loss: 48454080.6154; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 83076337.0256; val_optim_loss: 83076337.0256
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.8293; val_auprc_score: 0.8289; val_best_acc_score: 0.7395; val_best_f1_score: 0.7587; train_kl_reg_loss: 66446.3924; train_edge_recon_loss: 34107028.5581; train_gene_expr_recon_loss: 49283682.9070; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 83457157.9070; train_optim_loss: 83457157.9070; val_kl_reg_loss: 66547.3303; val_edge_recon_loss: 34583272.4103; val_gene_expr_recon_loss: 46955191.0769; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 81605010.4615; val_optim_loss: 81605010.4615
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.8306; val_auprc_score: 0.8298; val_best_acc_score: 0.7400; val_best_f1_score: 0.7605; train_kl_reg_loss: 66458.9137; train_edge_recon_loss: 34113794.6977; train_gene_expr_recon_loss: 47856438.3605; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 82036691.9070; train_optim_loss: 82036691.9070; val_kl_reg_loss: 66503.2468; val_edge_recon_loss: 34562434.1538; val_gene_expr_recon_loss: 45425795.3846; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 80054732.3077; val_optim_loss: 80054732.3077
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.8317; val_auprc_score: 0.8314; val_best_acc_score: 0.7407; val_best_f1_score: 0.7608; train_kl_reg_loss: 66432.5088; train_edge_recon_loss: 34090945.3081; train_gene_expr_recon_loss: 46480983.5233; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 80638361.2791; train_optim_loss: 80638361.2791; val_kl_reg_loss: 66513.6421; val_edge_recon_loss: 34543702.2564; val_gene_expr_recon_loss: 44121457.1282; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 78731673.2308; val_optim_loss: 78731673.2308
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.8298; val_auprc_score: 0.8289; val_best_acc_score: 0.7407; val_best_f1_score: 0.7589; train_kl_reg_loss: 66477.7761; train_edge_recon_loss: 34129849.4244; train_gene_expr_recon_loss: 45164242.2791; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 79360569.2791; train_optim_loss: 79360569.2791; val_kl_reg_loss: 66610.4842; val_edge_recon_loss: 34594833.2308; val_gene_expr_recon_loss: 42837747.3846; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 77499190.9744; val_optim_loss: 77499190.9744
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.8291; val_auprc_score: 0.8287; val_best_acc_score: 0.7370; val_best_f1_score: 0.7594; train_kl_reg_loss: 66438.7178; train_edge_recon_loss: 34107806.8023; train_gene_expr_recon_loss: 43878523.5465; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 78052768.9302; train_optim_loss: 78052768.9302; val_kl_reg_loss: 66629.6064; val_edge_recon_loss: 34572347.0769; val_gene_expr_recon_loss: 41548062.3590; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 76187039.5897; val_optim_loss: 76187039.5897
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.8249; val_auprc_score: 0.8228; val_best_acc_score: 0.7348; val_best_f1_score: 0.7587; train_kl_reg_loss: 66497.7767; train_edge_recon_loss: 34102564.9419; train_gene_expr_recon_loss: 42657867.9535; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 76826930.5349; train_optim_loss: 76826930.5349; val_kl_reg_loss: 66605.7782; val_edge_recon_loss: 34613063.4872; val_gene_expr_recon_loss: 40505581.9487; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 75185251.4872; val_optim_loss: 75185251.4872
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.8310; val_auprc_score: 0.8296; val_best_acc_score: 0.7414; val_best_f1_score: 0.7612; train_kl_reg_loss: 66460.5026; train_edge_recon_loss: 34108220.4884; train_gene_expr_recon_loss: 41511247.7791; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 75685928.8605; train_optim_loss: 75685928.8605; val_kl_reg_loss: 66559.1748; val_edge_recon_loss: 34531251.2821; val_gene_expr_recon_loss: 39386009.9487; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 73983820.3077; val_optim_loss: 73983820.3077
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.8313; val_auprc_score: 0.8310; val_best_acc_score: 0.7397; val_best_f1_score: 0.7608; train_kl_reg_loss: 66444.2748; train_edge_recon_loss: 34102671.1744; train_gene_expr_recon_loss: 40495550.5814; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 74664666.2791; train_optim_loss: 74664666.2791; val_kl_reg_loss: 66560.8476; val_edge_recon_loss: 34531076.5128; val_gene_expr_recon_loss: 38678435.0769; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 73276070.9744; val_optim_loss: 73276070.9744
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.8300; val_auprc_score: 0.8292; val_best_acc_score: 0.7402; val_best_f1_score: 0.7597; train_kl_reg_loss: 66459.8818; train_edge_recon_loss: 34106907.6279; train_gene_expr_recon_loss: 39649088.3023; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 73822456.0233; train_optim_loss: 73822456.0233; val_kl_reg_loss: 66567.7099; val_edge_recon_loss: 34564600.2051; val_gene_expr_recon_loss: 37791271.6923; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 72422438.5641; val_optim_loss: 72422438.5641
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.8303; val_auprc_score: 0.8303; val_best_acc_score: 0.7384; val_best_f1_score: 0.7596; train_kl_reg_loss: 66460.8291; train_edge_recon_loss: 34122749.6860; train_gene_expr_recon_loss: 38993733.3605; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 73182944.1860; train_optim_loss: 73182944.1860; val_kl_reg_loss: 66644.9514; val_edge_recon_loss: 34550274.5641; val_gene_expr_recon_loss: 37272547.5897; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 71889467.6923; val_optim_loss: 71889467.6923
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.8315; val_auprc_score: 0.8302; val_best_acc_score: 0.7415; val_best_f1_score: 0.7613; train_kl_reg_loss: 66421.9665; train_edge_recon_loss: 34116902.7674; train_gene_expr_recon_loss: 38406110.6047; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 72589435.2791; train_optim_loss: 72589435.2791; val_kl_reg_loss: 66601.8028; val_edge_recon_loss: 34530729.4359; val_gene_expr_recon_loss: 36632584.1026; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 71229914.6667; val_optim_loss: 71229914.6667
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.8305; val_auprc_score: 0.8296; val_best_acc_score: 0.7406; val_best_f1_score: 0.7603; train_kl_reg_loss: 66442.1576; train_edge_recon_loss: 34086076.5814; train_gene_expr_recon_loss: 37959733.6047; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 72112252.1860; train_optim_loss: 72112252.1860; val_kl_reg_loss: 66589.9349; val_edge_recon_loss: 34557654.3590; val_gene_expr_recon_loss: 36381073.5385; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 71005316.9231; val_optim_loss: 71005316.9231
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.8280; val_auprc_score: 0.8276; val_best_acc_score: 0.7375; val_best_f1_score: 0.7584; train_kl_reg_loss: 66408.6169; train_edge_recon_loss: 34100225.6628; train_gene_expr_recon_loss: 37630699.3256; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 71797333.4884; train_optim_loss: 71797333.4884; val_kl_reg_loss: 66499.7051; val_edge_recon_loss: 34592015.2821; val_gene_expr_recon_loss: 36037168.6667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70695684.3077; val_optim_loss: 70695684.3077
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.8315; val_auprc_score: 0.8303; val_best_acc_score: 0.7402; val_best_f1_score: 0.7615; train_kl_reg_loss: 66438.0998; train_edge_recon_loss: 34128361.6512; train_gene_expr_recon_loss: 37387752.9302; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 71582552.9070; train_optim_loss: 71582552.9070; val_kl_reg_loss: 66573.1080; val_edge_recon_loss: 34511057.6410; val_gene_expr_recon_loss: 35879528.7692; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70457159.5897; val_optim_loss: 70457159.5897
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.8312; val_auprc_score: 0.8312; val_best_acc_score: 0.7404; val_best_f1_score: 0.7622; train_kl_reg_loss: 66442.7889; train_edge_recon_loss: 34112712.6977; train_gene_expr_recon_loss: 37246528.6279; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 71425683.8837; train_optim_loss: 71425683.8837; val_kl_reg_loss: 66616.1488; val_edge_recon_loss: 34529207.4872; val_gene_expr_recon_loss: 35710631.4872; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70306454.9744; val_optim_loss: 70306454.9744
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.8315; val_auprc_score: 0.8313; val_best_acc_score: 0.7412; val_best_f1_score: 0.7600; train_kl_reg_loss: 66445.9183; train_edge_recon_loss: 34115881.1744; train_gene_expr_recon_loss: 37036931.6977; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 71219258.6512; train_optim_loss: 71219258.6512; val_kl_reg_loss: 66559.8035; val_edge_recon_loss: 34552924.7179; val_gene_expr_recon_loss: 35492536.2051; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70112020.6154; val_optim_loss: 70112020.6154
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.8296; val_auprc_score: 0.8293; val_best_acc_score: 0.7395; val_best_f1_score: 0.7581; train_kl_reg_loss: 66422.9031; train_edge_recon_loss: 34092452.1977; train_gene_expr_recon_loss: 36922311.9826; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 71081186.7442; train_optim_loss: 71081186.7442; val_kl_reg_loss: 66609.7448; val_edge_recon_loss: 34587047.4872; val_gene_expr_recon_loss: 35506711.5897; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70160367.7949; val_optim_loss: 70160367.7949
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.8309; val_auprc_score: 0.8298; val_best_acc_score: 0.7396; val_best_f1_score: 0.7608; train_kl_reg_loss: 66438.3514; train_edge_recon_loss: 34092120.0698; train_gene_expr_recon_loss: 36772330.6221; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70930889.5000; train_optim_loss: 70930889.5000; val_kl_reg_loss: 66547.1744; val_edge_recon_loss: 34515776.6154; val_gene_expr_recon_loss: 35367234.7692; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69949558.3590; val_optim_loss: 69949558.3590
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.8292; val_auprc_score: 0.8271; val_best_acc_score: 0.7399; val_best_f1_score: 0.7593; train_kl_reg_loss: 66467.4926; train_edge_recon_loss: 34108913.6047; train_gene_expr_recon_loss: 36682359.1628; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70857740.2326; train_optim_loss: 70857740.2326; val_kl_reg_loss: 66593.5863; val_edge_recon_loss: 34585373.4359; val_gene_expr_recon_loss: 35411620.8718; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70063587.4872; val_optim_loss: 70063587.4872
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.8320; val_auprc_score: 0.8315; val_best_acc_score: 0.7418; val_best_f1_score: 0.7614; train_kl_reg_loss: 66448.9733; train_edge_recon_loss: 34112296.8081; train_gene_expr_recon_loss: 36531168.2733; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70709913.8372; train_optim_loss: 70709913.8372; val_kl_reg_loss: 66527.4349; val_edge_recon_loss: 34518767.4872; val_gene_expr_recon_loss: 35193540.9231; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69778835.6923; val_optim_loss: 69778835.6923
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.8166; val_auprc_score: 0.8161; val_best_acc_score: 0.7265; val_best_f1_score: 0.7516; train_kl_reg_loss: 66408.4198; train_edge_recon_loss: 34621526.8488; train_gene_expr_recon_loss: 36216327.1047; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70904262.3023; train_optim_loss: 70904262.3023; val_kl_reg_loss: 55150.6902; val_edge_recon_loss: 35155923.8974; val_gene_expr_recon_loss: 34885665.2308; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70096738.4615; val_optim_loss: 70096738.4615
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.8211; val_auprc_score: 0.8198; val_best_acc_score: 0.7311; val_best_f1_score: 0.7556; train_kl_reg_loss: 66420.4438; train_edge_recon_loss: 34639640.7674; train_gene_expr_recon_loss: 36139401.1279; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70845462.0814; train_optim_loss: 70845462.0814; val_kl_reg_loss: 55070.5967; val_edge_recon_loss: 35063149.7436; val_gene_expr_recon_loss: 34877511.8974; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69995732.9231; val_optim_loss: 69995732.9231
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.8167; val_auprc_score: 0.8165; val_best_acc_score: 0.7275; val_best_f1_score: 0.7509; train_kl_reg_loss: 66430.6717; train_edge_recon_loss: 34639785.1279; train_gene_expr_recon_loss: 36064407.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70770622.7558; train_optim_loss: 70770622.7558; val_kl_reg_loss: 55114.5789; val_edge_recon_loss: 35161601.0256; val_gene_expr_recon_loss: 34665932.5128; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69882647.5897; val_optim_loss: 69882647.5897
Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.8164; val_auprc_score: 0.8132; val_best_acc_score: 0.7291; val_best_f1_score: 0.7530; train_kl_reg_loss: 66413.7351; train_edge_recon_loss: 34620379.2442; train_gene_expr_recon_loss: 35973405.6860; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70660198.4302; train_optim_loss: 70660198.4302; val_kl_reg_loss: 55124.3430; val_edge_recon_loss: 35096082.2564; val_gene_expr_recon_loss: 34702877.3846; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69854084.3077; val_optim_loss: 69854084.3077

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.8193; val_auprc_score: 0.8179; val_best_acc_score: 0.7283; val_best_f1_score: 0.7537; train_kl_reg_loss: 66425.3700; train_edge_recon_loss: 34625516.2558; train_gene_expr_recon_loss: 35959002.7733; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70650944.4419; train_optim_loss: 70650944.4419; val_kl_reg_loss: 55168.6501; val_edge_recon_loss: 35030495.2821; val_gene_expr_recon_loss: 34743329.1282; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69828993.4359; val_optim_loss: 69828993.4359
Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.8169; val_auprc_score: 0.8154; val_best_acc_score: 0.7292; val_best_f1_score: 0.7526; train_kl_reg_loss: 66417.1758; train_edge_recon_loss: 34615964.4884; train_gene_expr_recon_loss: 35968269.9302; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70650651.6744; train_optim_loss: 70650651.6744; val_kl_reg_loss: 55092.9243; val_edge_recon_loss: 35116742.6667; val_gene_expr_recon_loss: 34601977.2308; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69773811.6923; val_optim_loss: 69773811.6923
Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.8186; val_auprc_score: 0.8163; val_best_acc_score: 0.7285; val_best_f1_score: 0.7531; train_kl_reg_loss: 66436.9557; train_edge_recon_loss: 34622309.9651; train_gene_expr_recon_loss: 35959666.8779; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70648413.8140; train_optim_loss: 70648413.8140; val_kl_reg_loss: 55159.4658; val_edge_recon_loss: 35055082.6667; val_gene_expr_recon_loss: 34567466.3590; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69677707.7949; val_optim_loss: 69677707.7949
Epoch 33/400 |█-------------------| 8.2% val_auroc_score: 0.8166; val_auprc_score: 0.8163; val_best_acc_score: 0.7268; val_best_f1_score: 0.7529; train_kl_reg_loss: 66419.8616; train_edge_recon_loss: 34620809.2442; train_gene_expr_recon_loss: 35902803.0116; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70590032.0465; train_optim_loss: 70590032.0465; val_kl_reg_loss: 55066.1496; val_edge_recon_loss: 35168723.5897; val_gene_expr_recon_loss: 34748880.5128; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69972670.6667; val_optim_loss: 69972670.6667
Epoch 34/400 |█-------------------| 8.5% val_auroc_score: 0.8167; val_auprc_score: 0.8156; val_best_acc_score: 0.7284; val_best_f1_score: 0.7515; train_kl_reg_loss: 66437.0761; train_edge_recon_loss: 34608932.8023; train_gene_expr_recon_loss: 35919369.3779; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70594738.9070; train_optim_loss: 70594738.9070; val_kl_reg_loss: 55024.1782; val_edge_recon_loss: 35134829.0256; val_gene_expr_recon_loss: 34591517.6410; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69781370.8718; val_optim_loss: 69781370.8718
Epoch 35/400 |█-------------------| 8.8% val_auroc_score: 0.8207; val_auprc_score: 0.8203; val_best_acc_score: 0.7313; val_best_f1_score: 0.7541; train_kl_reg_loss: 66466.7693; train_edge_recon_loss: 34621691.9767; train_gene_expr_recon_loss: 35938045.9186; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70626204.6279; train_optim_loss: 70626204.6279; val_kl_reg_loss: 55015.9536; val_edge_recon_loss: 35069914.4615; val_gene_expr_recon_loss: 34486200.2564; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69611130.6667; val_optim_loss: 69611130.6667
Epoch 36/400 |█-------------------| 9.0% val_auroc_score: 0.8192; val_auprc_score: 0.8180; val_best_acc_score: 0.7284; val_best_f1_score: 0.7555; train_kl_reg_loss: 66440.5662; train_edge_recon_loss: 34621399.3023; train_gene_expr_recon_loss: 35949925.2849; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70637765.1279; train_optim_loss: 70637765.1279; val_kl_reg_loss: 55174.9452; val_edge_recon_loss: 35041216.9231; val_gene_expr_recon_loss: 34519020.4615; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69615412.2051; val_optim_loss: 69615412.2051
Epoch 37/400 |█-------------------| 9.2% val_auroc_score: 0.8186; val_auprc_score: 0.8174; val_best_acc_score: 0.7281; val_best_f1_score: 0.7536; train_kl_reg_loss: 66458.1826; train_edge_recon_loss: 34633049.6628; train_gene_expr_recon_loss: 35905068.9477; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70604576.9535; train_optim_loss: 70604576.9535; val_kl_reg_loss: 55078.8395; val_edge_recon_loss: 35101206.0513; val_gene_expr_recon_loss: 34530936.2051; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69687220.3077; val_optim_loss: 69687220.3077
Epoch 38/400 |█-------------------| 9.5% val_auroc_score: 0.8184; val_auprc_score: 0.8172; val_best_acc_score: 0.7291; val_best_f1_score: 0.7540; train_kl_reg_loss: 66429.7957; train_edge_recon_loss: 34641395.4535; train_gene_expr_recon_loss: 35843657.5291; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70551482.7442; train_optim_loss: 70551482.7442; val_kl_reg_loss: 55070.3626; val_edge_recon_loss: 35074018.8718; val_gene_expr_recon_loss: 34584802.3077; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69713891.4872; val_optim_loss: 69713891.4872
Epoch 39/400 |█-------------------| 9.8% val_auroc_score: 0.8204; val_auprc_score: 0.8196; val_best_acc_score: 0.7304; val_best_f1_score: 0.7540; train_kl_reg_loss: 66437.3509; train_edge_recon_loss: 34640300.9884; train_gene_expr_recon_loss: 35885376.9128; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70592115.1977; train_optim_loss: 70592115.1977; val_kl_reg_loss: 55092.9957; val_edge_recon_loss: 35057906.4615; val_gene_expr_recon_loss: 34506421.5385; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69619420.5128; val_optim_loss: 69619420.5128

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 40/400 |██------------------| 10.0% val_auroc_score: 0.8180; val_auprc_score: 0.8151; val_best_acc_score: 0.7299; val_best_f1_score: 0.7524; train_kl_reg_loss: 66464.5380; train_edge_recon_loss: 34630101.2442; train_gene_expr_recon_loss: 35889153.4477; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70585719.2791; train_optim_loss: 70585719.2791; val_kl_reg_loss: 55096.5014; val_edge_recon_loss: 35122684.3077; val_gene_expr_recon_loss: 34582651.3846; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69760431.3846; val_optim_loss: 69760431.3846
Epoch 41/400 |██------------------| 10.2% val_auroc_score: 0.8188; val_auprc_score: 0.8171; val_best_acc_score: 0.7280; val_best_f1_score: 0.7544; train_kl_reg_loss: 66422.4920; train_edge_recon_loss: 34633985.7326; train_gene_expr_recon_loss: 35881392.7791; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70581801.2442; train_optim_loss: 70581801.2442; val_kl_reg_loss: 55048.3968; val_edge_recon_loss: 35044677.6410; val_gene_expr_recon_loss: 34513693.1282; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69613418.4615; val_optim_loss: 69613418.4615
Epoch 42/400 |██------------------| 10.5% val_auroc_score: 0.8193; val_auprc_score: 0.8176; val_best_acc_score: 0.7304; val_best_f1_score: 0.7530; train_kl_reg_loss: 66433.8199; train_edge_recon_loss: 34627077.4419; train_gene_expr_recon_loss: 35891252.4128; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70584763.3023; train_optim_loss: 70584763.3023; val_kl_reg_loss: 55179.0084; val_edge_recon_loss: 35072901.2308; val_gene_expr_recon_loss: 34593386.6667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69721467.3846; val_optim_loss: 69721467.3846
Epoch 43/400 |██------------------| 10.8% val_auroc_score: 0.8180; val_auprc_score: 0.8165; val_best_acc_score: 0.7301; val_best_f1_score: 0.7530; train_kl_reg_loss: 66438.0925; train_edge_recon_loss: 34648309.2674; train_gene_expr_recon_loss: 35884934.1453; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70599681.7442; train_optim_loss: 70599681.7442; val_kl_reg_loss: 55170.6823; val_edge_recon_loss: 35079994.6667; val_gene_expr_recon_loss: 34547441.2821; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69682606.6667; val_optim_loss: 69682606.6667

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 38 min 13 sec.
Using best model state, which was in epoch 35.

--- MODEL EVALUATION ---
val AUROC score: 0.8170
val AUPRC score: 0.8146
val best accuracy score: 0.7269
val best F1 score: 0.7537
val target rna MSE score: 46.7398
val source rna MSE score: 1.3966
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0305
Val cat covariate2 mean sim diff: nan

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
