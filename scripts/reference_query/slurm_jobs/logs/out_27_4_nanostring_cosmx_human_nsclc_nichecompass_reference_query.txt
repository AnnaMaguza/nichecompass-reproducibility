Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch4', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '06102023_173136_27', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 75351
Number of validation nodes: 8372
Number of training edges: 175771
Number of validation edges: 19530
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8302; val_auprc_score: 0.8280; val_best_acc_score: 0.7386; val_best_f1_score: 0.7628; train_kl_reg_loss: 66447.3520; train_edge_recon_loss: 34123890.4186; train_gene_expr_recon_loss: 57567482.0116; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 91757819.9302; train_optim_loss: 91757819.9302; val_kl_reg_loss: 66407.7639; val_edge_recon_loss: 34544411.6923; val_gene_expr_recon_loss: 50811869.7436; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 85422689.4359; val_optim_loss: 85422689.4359
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8278; val_auprc_score: 0.8255; val_best_acc_score: 0.7361; val_best_f1_score: 0.7607; train_kl_reg_loss: 66443.8278; train_edge_recon_loss: 34107992.0407; train_gene_expr_recon_loss: 50732688.7791; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 84907124.4651; train_optim_loss: 84907124.4651; val_kl_reg_loss: 66377.2965; val_edge_recon_loss: 34564522.0513; val_gene_expr_recon_loss: 48119915.0769; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 82750814.9744; val_optim_loss: 82750814.9744
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.8267; val_auprc_score: 0.8248; val_best_acc_score: 0.7332; val_best_f1_score: 0.7601; train_kl_reg_loss: 66441.0088; train_edge_recon_loss: 34096626.9651; train_gene_expr_recon_loss: 48147811.6512; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 82310879.3488; train_optim_loss: 82310879.3488; val_kl_reg_loss: 66386.6805; val_edge_recon_loss: 34617143.7949; val_gene_expr_recon_loss: 45951293.0256; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 80634823.3846; val_optim_loss: 80634823.3846
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.8289; val_auprc_score: 0.8264; val_best_acc_score: 0.7372; val_best_f1_score: 0.7626; train_kl_reg_loss: 66441.3330; train_edge_recon_loss: 34117722.4419; train_gene_expr_recon_loss: 45946001.5116; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 80130165.5349; train_optim_loss: 80130165.5349; val_kl_reg_loss: 66396.2925; val_edge_recon_loss: 34530772.6154; val_gene_expr_recon_loss: 43823738.4615; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 78420907.8974; val_optim_loss: 78420907.8974
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.8285; val_auprc_score: 0.8251; val_best_acc_score: 0.7374; val_best_f1_score: 0.7629; train_kl_reg_loss: 66470.3613; train_edge_recon_loss: 34129913.0407; train_gene_expr_recon_loss: 44200534.3953; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 78396917.6744; train_optim_loss: 78396917.6744; val_kl_reg_loss: 66357.6009; val_edge_recon_loss: 34497610.6154; val_gene_expr_recon_loss: 42156010.2564; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 76719978.8718; val_optim_loss: 76719978.8718
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.8254; val_auprc_score: 0.8208; val_best_acc_score: 0.7349; val_best_f1_score: 0.7604; train_kl_reg_loss: 66416.1485; train_edge_recon_loss: 34100207.8605; train_gene_expr_recon_loss: 42667912.1395; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 76834536.0233; train_optim_loss: 76834536.0233; val_kl_reg_loss: 66350.0407; val_edge_recon_loss: 34562701.9487; val_gene_expr_recon_loss: 40520011.8974; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 75149063.7949; val_optim_loss: 75149063.7949
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.8279; val_auprc_score: 0.8273; val_best_acc_score: 0.7382; val_best_f1_score: 0.7595; train_kl_reg_loss: 66417.5697; train_edge_recon_loss: 34110716.7907; train_gene_expr_recon_loss: 41376284.0116; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 75553418.5116; train_optim_loss: 75553418.5116; val_kl_reg_loss: 66525.2560; val_edge_recon_loss: 34622790.0513; val_gene_expr_recon_loss: 39384181.4359; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 74073497.4359; val_optim_loss: 74073497.4359
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.8293; val_auprc_score: 0.8269; val_best_acc_score: 0.7394; val_best_f1_score: 0.7632; train_kl_reg_loss: 66396.4516; train_edge_recon_loss: 34098588.0756; train_gene_expr_recon_loss: 40218705.8953; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 74383690.3488; train_optim_loss: 74383690.3488; val_kl_reg_loss: 66365.3320; val_edge_recon_loss: 34505711.0769; val_gene_expr_recon_loss: 38651871.0769; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 73223947.6923; val_optim_loss: 73223947.6923
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.8302; val_auprc_score: 0.8281; val_best_acc_score: 0.7405; val_best_f1_score: 0.7624; train_kl_reg_loss: 66448.1198; train_edge_recon_loss: 34112474.5988; train_gene_expr_recon_loss: 39389882.9186; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 73568805.4651; train_optim_loss: 73568805.4651; val_kl_reg_loss: 66407.7007; val_edge_recon_loss: 34561292.7179; val_gene_expr_recon_loss: 37789144.9231; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 72416845.7436; val_optim_loss: 72416845.7436
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.8291; val_auprc_score: 0.8262; val_best_acc_score: 0.7371; val_best_f1_score: 0.7617; train_kl_reg_loss: 66435.7256; train_edge_recon_loss: 34120012.6512; train_gene_expr_recon_loss: 38687626.4302; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 72874074.8605; train_optim_loss: 72874074.8605; val_kl_reg_loss: 66386.0801; val_edge_recon_loss: 34532516.6154; val_gene_expr_recon_loss: 37230130.3590; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 71829032.6154; val_optim_loss: 71829032.6154
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.8249; val_auprc_score: 0.8222; val_best_acc_score: 0.7338; val_best_f1_score: 0.7601; train_kl_reg_loss: 66426.1114; train_edge_recon_loss: 34123326.7791; train_gene_expr_recon_loss: 38163346.4070; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 72353099.3023; train_optim_loss: 72353099.3023; val_kl_reg_loss: 66362.4004; val_edge_recon_loss: 34625820.4103; val_gene_expr_recon_loss: 36575338.6154; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 71267521.0256; val_optim_loss: 71267521.0256
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.8281; val_auprc_score: 0.8269; val_best_acc_score: 0.7369; val_best_f1_score: 0.7602; train_kl_reg_loss: 66439.5115; train_edge_recon_loss: 34102585.3256; train_gene_expr_recon_loss: 37657173.4070; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 71826198.1628; train_optim_loss: 71826198.1628; val_kl_reg_loss: 66381.4690; val_edge_recon_loss: 34588949.7436; val_gene_expr_recon_loss: 36232792.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70888123.2821; val_optim_loss: 70888123.2821
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.8282; val_auprc_score: 0.8253; val_best_acc_score: 0.7366; val_best_f1_score: 0.7610; train_kl_reg_loss: 66440.3749; train_edge_recon_loss: 34114521.1163; train_gene_expr_recon_loss: 37348594.2209; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 71529555.8140; train_optim_loss: 71529555.8140; val_kl_reg_loss: 66383.3265; val_edge_recon_loss: 34574010.9744; val_gene_expr_recon_loss: 35901318.9744; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70541713.6410; val_optim_loss: 70541713.6410
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.8293; val_auprc_score: 0.8282; val_best_acc_score: 0.7382; val_best_f1_score: 0.7623; train_kl_reg_loss: 66453.3940; train_edge_recon_loss: 34102742.3023; train_gene_expr_recon_loss: 37122649.5581; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 71291845.1628; train_optim_loss: 71291845.1628; val_kl_reg_loss: 66520.5895; val_edge_recon_loss: 34548478.4615; val_gene_expr_recon_loss: 35795209.8974; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70410208.1026; val_optim_loss: 70410208.1026
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.8253; val_auprc_score: 0.8242; val_best_acc_score: 0.7339; val_best_f1_score: 0.7586; train_kl_reg_loss: 66451.6494; train_edge_recon_loss: 34108450.7733; train_gene_expr_recon_loss: 36874342.1395; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 71049244.6744; train_optim_loss: 71049244.6744; val_kl_reg_loss: 66464.1385; val_edge_recon_loss: 34637843.5897; val_gene_expr_recon_loss: 35713662.6667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70417970.8718; val_optim_loss: 70417970.8718
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.8252; val_auprc_score: 0.8241; val_best_acc_score: 0.7340; val_best_f1_score: 0.7587; train_kl_reg_loss: 66433.3594; train_edge_recon_loss: 34103867.6802; train_gene_expr_recon_loss: 36688915.7674; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70859216.7674; train_optim_loss: 70859216.7674; val_kl_reg_loss: 66362.0797; val_edge_recon_loss: 34657430.6667; val_gene_expr_recon_loss: 35438834.7692; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70162628.1026; val_optim_loss: 70162628.1026
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.8297; val_auprc_score: 0.8280; val_best_acc_score: 0.7396; val_best_f1_score: 0.7613; train_kl_reg_loss: 66415.8326; train_edge_recon_loss: 34113561.7558; train_gene_expr_recon_loss: 36560114.8837; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70740092.6163; train_optim_loss: 70740092.6163; val_kl_reg_loss: 66441.7912; val_edge_recon_loss: 34553261.4359; val_gene_expr_recon_loss: 35356603.1282; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69976306.0513; val_optim_loss: 69976306.0513
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.8292; val_auprc_score: 0.8273; val_best_acc_score: 0.7379; val_best_f1_score: 0.7619; train_kl_reg_loss: 66407.1692; train_edge_recon_loss: 34107514.6860; train_gene_expr_recon_loss: 36429662.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70603583.7674; train_optim_loss: 70603583.7674; val_kl_reg_loss: 66293.8941; val_edge_recon_loss: 34584600.6154; val_gene_expr_recon_loss: 35130840.6667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69781734.9744; val_optim_loss: 69781734.9744
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.8273; val_auprc_score: 0.8247; val_best_acc_score: 0.7379; val_best_f1_score: 0.7619; train_kl_reg_loss: 66436.3797; train_edge_recon_loss: 34121890.4360; train_gene_expr_recon_loss: 36327506.8140; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70515833.5233; train_optim_loss: 70515833.5233; val_kl_reg_loss: 66368.2764; val_edge_recon_loss: 34534123.8974; val_gene_expr_recon_loss: 35153289.9487; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69753782.1538; val_optim_loss: 69753782.1538
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.8295; val_auprc_score: 0.8285; val_best_acc_score: 0.7396; val_best_f1_score: 0.7613; train_kl_reg_loss: 66423.3833; train_edge_recon_loss: 34110160.9070; train_gene_expr_recon_loss: 36220157.9535; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70396742.1163; train_optim_loss: 70396742.1163; val_kl_reg_loss: 66335.0946; val_edge_recon_loss: 34611838.6667; val_gene_expr_recon_loss: 35169441.0256; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69847615.1795; val_optim_loss: 69847615.1795
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.8273; val_auprc_score: 0.8241; val_best_acc_score: 0.7357; val_best_f1_score: 0.7617; train_kl_reg_loss: 66425.4350; train_edge_recon_loss: 34112375.6977; train_gene_expr_recon_loss: 36151199.4070; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70330000.6977; train_optim_loss: 70330000.6977; val_kl_reg_loss: 66426.1625; val_edge_recon_loss: 34591567.6923; val_gene_expr_recon_loss: 35111237.7949; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69769232.2051; val_optim_loss: 69769232.2051
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.8283; val_auprc_score: 0.8256; val_best_acc_score: 0.7377; val_best_f1_score: 0.7619; train_kl_reg_loss: 66453.4878; train_edge_recon_loss: 34103843.5116; train_gene_expr_recon_loss: 36074870.5291; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70245167.4186; train_optim_loss: 70245167.4186; val_kl_reg_loss: 66350.1171; val_edge_recon_loss: 34559201.9487; val_gene_expr_recon_loss: 35009097.4872; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69634650.0513; val_optim_loss: 69634650.0513
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.8269; val_auprc_score: 0.8251; val_best_acc_score: 0.7364; val_best_f1_score: 0.7601; train_kl_reg_loss: 66423.8469; train_edge_recon_loss: 34094586.0814; train_gene_expr_recon_loss: 36050305.4244; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70211315.2558; train_optim_loss: 70211315.2558; val_kl_reg_loss: 66320.9200; val_edge_recon_loss: 34584350.9744; val_gene_expr_recon_loss: 35000021.2821; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69650693.1282; val_optim_loss: 69650693.1282
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.8310; val_auprc_score: 0.8296; val_best_acc_score: 0.7394; val_best_f1_score: 0.7624; train_kl_reg_loss: 66413.4680; train_edge_recon_loss: 34113524.5116; train_gene_expr_recon_loss: 35982316.0930; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70162254.0581; train_optim_loss: 70162254.0581; val_kl_reg_loss: 66475.0298; val_edge_recon_loss: 34511131.1795; val_gene_expr_recon_loss: 34931897.8974; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69509504.6154; val_optim_loss: 69509504.6154
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.8283; val_auprc_score: 0.8267; val_best_acc_score: 0.7372; val_best_f1_score: 0.7607; train_kl_reg_loss: 66454.5270; train_edge_recon_loss: 34128452.2849; train_gene_expr_recon_loss: 35974780.0116; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70169686.6744; train_optim_loss: 70169686.6744; val_kl_reg_loss: 66374.1686; val_edge_recon_loss: 34566575.8974; val_gene_expr_recon_loss: 34883557.8974; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69516508.5128; val_optim_loss: 69516508.5128
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.8138; val_auprc_score: 0.8106; val_best_acc_score: 0.7242; val_best_f1_score: 0.7528; train_kl_reg_loss: 66455.3091; train_edge_recon_loss: 34633341.6744; train_gene_expr_recon_loss: 35701033.6279; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70400830.5698; train_optim_loss: 70400830.5698; val_kl_reg_loss: 55097.5993; val_edge_recon_loss: 35138574.1538; val_gene_expr_recon_loss: 34622072.1026; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69815743.3846; val_optim_loss: 69815743.3846
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.8174; val_auprc_score: 0.8149; val_best_acc_score: 0.7262; val_best_f1_score: 0.7537; train_kl_reg_loss: 66432.3281; train_edge_recon_loss: 34640243.0814; train_gene_expr_recon_loss: 35624048.6802; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70330723.8605; train_optim_loss: 70330723.8605; val_kl_reg_loss: 55007.7201; val_edge_recon_loss: 35055570.9744; val_gene_expr_recon_loss: 34434655.6410; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69545233.8462; val_optim_loss: 69545233.8462
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.8146; val_auprc_score: 0.8117; val_best_acc_score: 0.7255; val_best_f1_score: 0.7535; train_kl_reg_loss: 66423.0932; train_edge_recon_loss: 34643680.1744; train_gene_expr_recon_loss: 35539786.5116; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70249890.1279; train_optim_loss: 70249890.1279; val_kl_reg_loss: 54887.3331; val_edge_recon_loss: 35106335.1795; val_gene_expr_recon_loss: 34425694.5128; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69586918.0513; val_optim_loss: 69586918.0513

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.8146; val_auprc_score: 0.8122; val_best_acc_score: 0.7261; val_best_f1_score: 0.7529; train_kl_reg_loss: 66414.1486; train_edge_recon_loss: 34626158.0116; train_gene_expr_recon_loss: 35580758.4477; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70273330.7326; train_optim_loss: 70273330.7326; val_kl_reg_loss: 54986.2217; val_edge_recon_loss: 35128974.1538; val_gene_expr_recon_loss: 34500882.4103; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69684843.8974; val_optim_loss: 69684843.8974
Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.8192; val_auprc_score: 0.8171; val_best_acc_score: 0.7280; val_best_f1_score: 0.7549; train_kl_reg_loss: 66427.7417; train_edge_recon_loss: 34646621.0814; train_gene_expr_recon_loss: 35564163.0581; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70277211.5930; train_optim_loss: 70277211.5930; val_kl_reg_loss: 54865.4648; val_edge_recon_loss: 35061246.3590; val_gene_expr_recon_loss: 34494674.3590; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69610785.7436; val_optim_loss: 69610785.7436
Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.8132; val_auprc_score: 0.8100; val_best_acc_score: 0.7229; val_best_f1_score: 0.7521; train_kl_reg_loss: 66396.5118; train_edge_recon_loss: 34646854.1977; train_gene_expr_recon_loss: 35495108.5756; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70208359.3721; train_optim_loss: 70208359.3721; val_kl_reg_loss: 54969.4244; val_edge_recon_loss: 35125643.6923; val_gene_expr_recon_loss: 34330877.3846; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69511490.0513; val_optim_loss: 69511490.0513
Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.8157; val_auprc_score: 0.8135; val_best_acc_score: 0.7270; val_best_f1_score: 0.7529; train_kl_reg_loss: 66424.3791; train_edge_recon_loss: 34631267.7674; train_gene_expr_recon_loss: 35536369.0698; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70234061.3605; train_optim_loss: 70234061.3605; val_kl_reg_loss: 55009.1837; val_edge_recon_loss: 35144392.6154; val_gene_expr_recon_loss: 34407335.2821; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69606737.4359; val_optim_loss: 69606737.4359

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 34 min 8 sec.
Using best model state, which was in epoch 24.

--- MODEL EVALUATION ---
val AUROC score: 0.8173
val AUPRC score: 0.8152
val best accuracy score: 0.7269
val best F1 score: 0.7537
val target rna MSE score: 46.3169
val source rna MSE score: 1.4053
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0317
Val cat covariate2 mean sim diff: nan

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
