Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch3', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '06102023_193135_28', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 82522
Number of validation nodes: 9169
Number of training edges: 195815
Number of validation edges: 21757
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9454; val_auprc_score: 0.9385; val_best_acc_score: 0.8774; val_best_f1_score: 0.8822; train_kl_reg_loss: 51798.7516; train_edge_recon_loss: 27453554.0940; train_gene_expr_recon_loss: 48039243.3629; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 75544596.0000; train_optim_loss: 75544596.0000; val_kl_reg_loss: 51819.8117; val_edge_recon_loss: 28110341.8140; val_gene_expr_recon_loss: 39583393.8605; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 67745555.0698; val_optim_loss: 67745555.0698
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9456; val_auprc_score: 0.9382; val_best_acc_score: 0.8785; val_best_f1_score: 0.8837; train_kl_reg_loss: 51807.2678; train_edge_recon_loss: 27460434.3290; train_gene_expr_recon_loss: 38510026.6110; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 66022268.0313; train_optim_loss: 66022268.0313; val_kl_reg_loss: 51745.8109; val_edge_recon_loss: 28085012.1395; val_gene_expr_recon_loss: 35596330.5581; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63733088.5581; val_optim_loss: 63733088.5581
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9464; val_auprc_score: 0.9392; val_best_acc_score: 0.8780; val_best_f1_score: 0.8825; train_kl_reg_loss: 51797.9085; train_edge_recon_loss: 27460030.2037; train_gene_expr_recon_loss: 36299104.0313; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63810932.2820; train_optim_loss: 63810932.2820; val_kl_reg_loss: 51664.4309; val_edge_recon_loss: 28068392.3256; val_gene_expr_recon_loss: 34189480.1860; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62309537.1163; val_optim_loss: 62309537.1163
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9459; val_auprc_score: 0.9386; val_best_acc_score: 0.8780; val_best_f1_score: 0.8829; train_kl_reg_loss: 51839.1508; train_edge_recon_loss: 27472465.1018; train_gene_expr_recon_loss: 35081977.3995; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62606281.5770; train_optim_loss: 62606281.5770; val_kl_reg_loss: 51757.6483; val_edge_recon_loss: 28086615.9070; val_gene_expr_recon_loss: 33262836.8837; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61401210.6047; val_optim_loss: 61401210.6047
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9452; val_auprc_score: 0.9374; val_best_acc_score: 0.8775; val_best_f1_score: 0.8825; train_kl_reg_loss: 51815.3345; train_edge_recon_loss: 27455962.2245; train_gene_expr_recon_loss: 34169488.0627; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61677265.6188; train_optim_loss: 61677265.6188; val_kl_reg_loss: 51806.1344; val_edge_recon_loss: 28069053.0698; val_gene_expr_recon_loss: 32510265.1163; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60631124.0000; val_optim_loss: 60631124.0000
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9458; val_auprc_score: 0.9378; val_best_acc_score: 0.8789; val_best_f1_score: 0.8838; train_kl_reg_loss: 51840.6135; train_edge_recon_loss: 27460529.2010; train_gene_expr_recon_loss: 33574324.9608; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61086694.5379; train_optim_loss: 61086694.5379; val_kl_reg_loss: 51707.6438; val_edge_recon_loss: 28061576.2326; val_gene_expr_recon_loss: 31977318.2326; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60090602.0465; val_optim_loss: 60090602.0465
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9461; val_auprc_score: 0.9382; val_best_acc_score: 0.8793; val_best_f1_score: 0.8834; train_kl_reg_loss: 51809.5224; train_edge_recon_loss: 27450272.7102; train_gene_expr_recon_loss: 33138719.1749; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60640801.3681; train_optim_loss: 60640801.3681; val_kl_reg_loss: 51700.4689; val_edge_recon_loss: 28051109.5349; val_gene_expr_recon_loss: 31771309.8140; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 59874119.9070; val_optim_loss: 59874119.9070
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9459; val_auprc_score: 0.9378; val_best_acc_score: 0.8792; val_best_f1_score: 0.8838; train_kl_reg_loss: 51801.5018; train_edge_recon_loss: 27460198.3133; train_gene_expr_recon_loss: 32873766.8512; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 60385766.6110; train_optim_loss: 60385766.6110; val_kl_reg_loss: 51772.9700; val_edge_recon_loss: 28046417.6279; val_gene_expr_recon_loss: 31531686.8837; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 59629877.4884; val_optim_loss: 59629877.4884
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9457; val_auprc_score: 0.9379; val_best_acc_score: 0.8786; val_best_f1_score: 0.8828; train_kl_reg_loss: 51809.4572; train_edge_recon_loss: 27453372.1305; train_gene_expr_recon_loss: 30652638.1514; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 58157819.7285; train_optim_loss: 58157819.7285; val_kl_reg_loss: 51782.6093; val_edge_recon_loss: 28088463.6744; val_gene_expr_recon_loss: 27953953.2093; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 56094199.5349; val_optim_loss: 56094199.5349
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9454; val_auprc_score: 0.9375; val_best_acc_score: 0.8776; val_best_f1_score: 0.8823; train_kl_reg_loss: 51791.1494; train_edge_recon_loss: 27460871.7911; train_gene_expr_recon_loss: 29194645.8172; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 56707308.7624; train_optim_loss: 56707308.7624; val_kl_reg_loss: 51805.9873; val_edge_recon_loss: 28097239.9535; val_gene_expr_recon_loss: 27852835.5349; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 56001881.2093; val_optim_loss: 56001881.2093
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9460; val_auprc_score: 0.9388; val_best_acc_score: 0.8781; val_best_f1_score: 0.8828; train_kl_reg_loss: 51792.7017; train_edge_recon_loss: 27462390.7363; train_gene_expr_recon_loss: 28984570.0627; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 56498753.4726; train_optim_loss: 56498753.4726; val_kl_reg_loss: 51694.0021; val_edge_recon_loss: 28087137.6744; val_gene_expr_recon_loss: 27681651.6744; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 55820483.2558; val_optim_loss: 55820483.2558
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9456; val_auprc_score: 0.9381; val_best_acc_score: 0.8774; val_best_f1_score: 0.8822; train_kl_reg_loss: 51813.7708; train_edge_recon_loss: 27455054.4856; train_gene_expr_recon_loss: 28719615.8903; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 56226483.9896; train_optim_loss: 56226483.9896; val_kl_reg_loss: 51746.0745; val_edge_recon_loss: 28084871.3023; val_gene_expr_recon_loss: 27009573.0698; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 55146190.5116; val_optim_loss: 55146190.5116
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9454; val_auprc_score: 0.9381; val_best_acc_score: 0.8773; val_best_f1_score: 0.8825; train_kl_reg_loss: 51823.2659; train_edge_recon_loss: 27453972.0313; train_gene_expr_recon_loss: 28195659.9426; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55701455.2272; train_optim_loss: 55701455.2272; val_kl_reg_loss: 51674.1214; val_edge_recon_loss: 28101973.4419; val_gene_expr_recon_loss: 26809865.7674; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54963513.4884; val_optim_loss: 54963513.4884
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9461; val_auprc_score: 0.9376; val_best_acc_score: 0.8796; val_best_f1_score: 0.8840; train_kl_reg_loss: 51804.8887; train_edge_recon_loss: 27467443.1436; train_gene_expr_recon_loss: 28093493.6867; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55612741.7755; train_optim_loss: 55612741.7755; val_kl_reg_loss: 51658.6000; val_edge_recon_loss: 28077853.9535; val_gene_expr_recon_loss: 26691102.5116; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54820615.0698; val_optim_loss: 54820615.0698
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9451; val_auprc_score: 0.9375; val_best_acc_score: 0.8763; val_best_f1_score: 0.8811; train_kl_reg_loss: 51804.3073; train_edge_recon_loss: 27472000.6110; train_gene_expr_recon_loss: 28036003.8381; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55559808.7833; train_optim_loss: 55559808.7833; val_kl_reg_loss: 51753.1006; val_edge_recon_loss: 28113551.3488; val_gene_expr_recon_loss: 26658484.3721; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54823788.5581; val_optim_loss: 54823788.5581
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9469; val_auprc_score: 0.9401; val_best_acc_score: 0.8782; val_best_f1_score: 0.8827; train_kl_reg_loss: 51820.9989; train_edge_recon_loss: 27471134.2507; train_gene_expr_recon_loss: 28002137.8433; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55525093.0862; train_optim_loss: 55525093.0862; val_kl_reg_loss: 51813.0134; val_edge_recon_loss: 28069021.3953; val_gene_expr_recon_loss: 26638005.0233; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54758839.2558; val_optim_loss: 54758839.2558
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9450; val_auprc_score: 0.9365; val_best_acc_score: 0.8774; val_best_f1_score: 0.8820; train_kl_reg_loss: 51796.2234; train_edge_recon_loss: 27485691.5979; train_gene_expr_recon_loss: 27897795.7702; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55435283.5927; train_optim_loss: 55435283.5927; val_kl_reg_loss: 51678.6357; val_edge_recon_loss: 28124442.5581; val_gene_expr_recon_loss: 26588830.2791; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54764951.4419; val_optim_loss: 54764951.4419
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.9462; val_auprc_score: 0.9393; val_best_acc_score: 0.8786; val_best_f1_score: 0.8827; train_kl_reg_loss: 51829.1441; train_edge_recon_loss: 27453409.8747; train_gene_expr_recon_loss: 27849366.0313; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55354605.0757; train_optim_loss: 55354605.0757; val_kl_reg_loss: 51670.6199; val_edge_recon_loss: 28117208.6977; val_gene_expr_recon_loss: 26507283.6279; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54676162.9767; val_optim_loss: 54676162.9767
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.9458; val_auprc_score: 0.9390; val_best_acc_score: 0.8769; val_best_f1_score: 0.8822; train_kl_reg_loss: 51832.8982; train_edge_recon_loss: 27461325.5875; train_gene_expr_recon_loss: 27850928.5640; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55364086.9452; train_optim_loss: 55364086.9452; val_kl_reg_loss: 51777.7366; val_edge_recon_loss: 28122067.4419; val_gene_expr_recon_loss: 26556777.3953; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54730622.5116; val_optim_loss: 54730622.5116
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.9441; val_auprc_score: 0.9360; val_best_acc_score: 0.8765; val_best_f1_score: 0.8815; train_kl_reg_loss: 51800.6156; train_edge_recon_loss: 27463970.2037; train_gene_expr_recon_loss: 27754994.0731; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55270764.9713; train_optim_loss: 55270764.9713; val_kl_reg_loss: 51799.1023; val_edge_recon_loss: 28116065.8140; val_gene_expr_recon_loss: 26572187.2558; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54740052.2791; val_optim_loss: 54740052.2791
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.9451; val_auprc_score: 0.9366; val_best_acc_score: 0.8774; val_best_f1_score: 0.8823; train_kl_reg_loss: 51816.7511; train_edge_recon_loss: 27466643.5509; train_gene_expr_recon_loss: 27757921.1227; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55276381.3368; train_optim_loss: 55276381.3368; val_kl_reg_loss: 51695.9367; val_edge_recon_loss: 28098625.4884; val_gene_expr_recon_loss: 26448624.2791; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54598946.0465; val_optim_loss: 54598946.0465
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.9461; val_auprc_score: 0.9382; val_best_acc_score: 0.8791; val_best_f1_score: 0.8829; train_kl_reg_loss: 51804.6108; train_edge_recon_loss: 27475184.7990; train_gene_expr_recon_loss: 27776725.6606; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55303714.9556; train_optim_loss: 55303714.9556; val_kl_reg_loss: 51746.1462; val_edge_recon_loss: 28051469.8605; val_gene_expr_recon_loss: 26547337.3488; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54650553.3953; val_optim_loss: 54650553.3953
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.9459; val_auprc_score: 0.9384; val_best_acc_score: 0.8788; val_best_f1_score: 0.8835; train_kl_reg_loss: 51824.1744; train_edge_recon_loss: 27449817.0026; train_gene_expr_recon_loss: 27690134.1514; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55191775.4151; train_optim_loss: 55191775.4151; val_kl_reg_loss: 51770.1160; val_edge_recon_loss: 28063929.7209; val_gene_expr_recon_loss: 26515527.1163; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54631227.0698; val_optim_loss: 54631227.0698
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.9468; val_auprc_score: 0.9394; val_best_acc_score: 0.8798; val_best_f1_score: 0.8845; train_kl_reg_loss: 51775.6057; train_edge_recon_loss: 27465239.4621; train_gene_expr_recon_loss: 27688962.5849; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55205977.6606; train_optim_loss: 55205977.6606; val_kl_reg_loss: 51748.2142; val_edge_recon_loss: 28042556.3256; val_gene_expr_recon_loss: 26384344.6047; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54478649.1163; val_optim_loss: 54478649.1163
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.9467; val_auprc_score: 0.9401; val_best_acc_score: 0.8778; val_best_f1_score: 0.8830; train_kl_reg_loss: 51831.2618; train_edge_recon_loss: 27466401.0496; train_gene_expr_recon_loss: 27707927.0966; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 55226159.3107; train_optim_loss: 55226159.3107; val_kl_reg_loss: 51646.5032; val_edge_recon_loss: 28084387.9070; val_gene_expr_recon_loss: 26441378.0465; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 54577412.3721; val_optim_loss: 54577412.3721
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.9478; val_auprc_score: 0.9406; val_best_acc_score: 0.8810; val_best_f1_score: 0.8844; train_kl_reg_loss: 51784.7619; train_edge_recon_loss: 27058211.7337; train_gene_expr_recon_loss: 26945645.9112; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 54055642.3081; train_optim_loss: 54055642.3081; val_kl_reg_loss: 46707.3736; val_edge_recon_loss: 27796162.5116; val_gene_expr_recon_loss: 25714692.4186; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53557562.3256; val_optim_loss: 53557562.3256
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.9471; val_auprc_score: 0.9391; val_best_acc_score: 0.8815; val_best_f1_score: 0.8851; train_kl_reg_loss: 51782.7294; train_edge_recon_loss: 27046997.2167; train_gene_expr_recon_loss: 26907091.1175; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 54005871.1332; train_optim_loss: 54005871.1332; val_kl_reg_loss: 46786.0908; val_edge_recon_loss: 27774901.6279; val_gene_expr_recon_loss: 25725974.2791; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53547662.2326; val_optim_loss: 53547662.2326
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.9478; val_auprc_score: 0.9408; val_best_acc_score: 0.8818; val_best_f1_score: 0.8852; train_kl_reg_loss: 51792.2019; train_edge_recon_loss: 27059708.9086; train_gene_expr_recon_loss: 26924518.5431; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 54036019.5927; train_optim_loss: 54036019.5927; val_kl_reg_loss: 46818.6699; val_edge_recon_loss: 27790211.1628; val_gene_expr_recon_loss: 25756123.9535; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53593153.5814; val_optim_loss: 53593153.5814
Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.9460; val_auprc_score: 0.9377; val_best_acc_score: 0.8789; val_best_f1_score: 0.8835; train_kl_reg_loss: 51825.2568; train_edge_recon_loss: 27033009.7128; train_gene_expr_recon_loss: 26939923.5352; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 54024758.4752; train_optim_loss: 54024758.4752; val_kl_reg_loss: 46748.9066; val_edge_recon_loss: 27838244.9302; val_gene_expr_recon_loss: 25690612.4651; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53575606.4186; val_optim_loss: 53575606.4186
Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.9476; val_auprc_score: 0.9413; val_best_acc_score: 0.8803; val_best_f1_score: 0.8848; train_kl_reg_loss: 51804.4373; train_edge_recon_loss: 27048677.1279; train_gene_expr_recon_loss: 26901464.4386; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 54001946.0261; train_optim_loss: 54001946.0261; val_kl_reg_loss: 46693.1743; val_edge_recon_loss: 27810297.9070; val_gene_expr_recon_loss: 25580493.1628; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53437484.2791; val_optim_loss: 53437484.2791
Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.9487; val_auprc_score: 0.9418; val_best_acc_score: 0.8818; val_best_f1_score: 0.8853; train_kl_reg_loss: 51824.3274; train_edge_recon_loss: 27045823.7023; train_gene_expr_recon_loss: 26848107.7859; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53945755.9478; train_optim_loss: 53945755.9478; val_kl_reg_loss: 46839.6952; val_edge_recon_loss: 27775284.2326; val_gene_expr_recon_loss: 25659783.1628; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53481906.9767; val_optim_loss: 53481906.9767
Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.9462; val_auprc_score: 0.9391; val_best_acc_score: 0.8802; val_best_f1_score: 0.8838; train_kl_reg_loss: 51847.2313; train_edge_recon_loss: 27054446.1253; train_gene_expr_recon_loss: 26915568.2507; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 54021861.6292; train_optim_loss: 54021861.6292; val_kl_reg_loss: 46721.6717; val_edge_recon_loss: 27858692.3256; val_gene_expr_recon_loss: 25647183.4884; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53552597.7674; val_optim_loss: 53552597.7674
Epoch 33/400 |█-------------------| 8.2% val_auroc_score: 0.9470; val_auprc_score: 0.9396; val_best_acc_score: 0.8800; val_best_f1_score: 0.8841; train_kl_reg_loss: 51792.5878; train_edge_recon_loss: 27073249.3943; train_gene_expr_recon_loss: 26857789.2219; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53982831.2272; train_optim_loss: 53982831.2272; val_kl_reg_loss: 46789.2017; val_edge_recon_loss: 27828336.8837; val_gene_expr_recon_loss: 25696071.9070; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53571197.8605; val_optim_loss: 53571197.8605
Epoch 34/400 |█-------------------| 8.5% val_auroc_score: 0.9468; val_auprc_score: 0.9385; val_best_acc_score: 0.8816; val_best_f1_score: 0.8855; train_kl_reg_loss: 51805.2605; train_edge_recon_loss: 27046658.1044; train_gene_expr_recon_loss: 26841747.3107; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53940210.6736; train_optim_loss: 53940210.6736; val_kl_reg_loss: 46738.8601; val_edge_recon_loss: 27798773.6279; val_gene_expr_recon_loss: 25677198.4651; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53522710.9767; val_optim_loss: 53522710.9767

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 35/400 |█-------------------| 8.8% val_auroc_score: 0.9469; val_auprc_score: 0.9393; val_best_acc_score: 0.8808; val_best_f1_score: 0.8846; train_kl_reg_loss: 51815.0440; train_edge_recon_loss: 27040789.8277; train_gene_expr_recon_loss: 26849481.4413; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53942086.2559; train_optim_loss: 53942086.2559; val_kl_reg_loss: 46772.7922; val_edge_recon_loss: 27819170.3256; val_gene_expr_recon_loss: 25626206.8372; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53492150.2326; val_optim_loss: 53492150.2326
Epoch 36/400 |█-------------------| 9.0% val_auroc_score: 0.9478; val_auprc_score: 0.9407; val_best_acc_score: 0.8805; val_best_f1_score: 0.8860; train_kl_reg_loss: 51823.9476; train_edge_recon_loss: 27047427.4465; train_gene_expr_recon_loss: 26863316.0313; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53962567.4151; train_optim_loss: 53962567.4151; val_kl_reg_loss: 46809.1713; val_edge_recon_loss: 27798319.9535; val_gene_expr_recon_loss: 25567068.3721; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53412197.4884; val_optim_loss: 53412197.4884
Epoch 37/400 |█-------------------| 9.2% val_auroc_score: 0.9461; val_auprc_score: 0.9386; val_best_acc_score: 0.8787; val_best_f1_score: 0.8833; train_kl_reg_loss: 51829.4809; train_edge_recon_loss: 27066258.1358; train_gene_expr_recon_loss: 26852119.4935; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53970207.2585; train_optim_loss: 53970207.2585; val_kl_reg_loss: 46699.1629; val_edge_recon_loss: 27868357.4419; val_gene_expr_recon_loss: 25611782.3721; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53526838.8837; val_optim_loss: 53526838.8837
Epoch 38/400 |█-------------------| 9.5% val_auroc_score: 0.9464; val_auprc_score: 0.9394; val_best_acc_score: 0.8798; val_best_f1_score: 0.8840; train_kl_reg_loss: 51834.0597; train_edge_recon_loss: 27055500.3342; train_gene_expr_recon_loss: 26869994.8407; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53977329.2637; train_optim_loss: 53977329.2637; val_kl_reg_loss: 46820.7033; val_edge_recon_loss: 27848556.4651; val_gene_expr_recon_loss: 25642788.6047; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53538165.6744; val_optim_loss: 53538165.6744
Epoch 39/400 |█-------------------| 9.8% val_auroc_score: 0.9473; val_auprc_score: 0.9399; val_best_acc_score: 0.8803; val_best_f1_score: 0.8843; train_kl_reg_loss: 51821.4626; train_edge_recon_loss: 27046703.0548; train_gene_expr_recon_loss: 26839476.8198; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53938001.2010; train_optim_loss: 53938001.2010; val_kl_reg_loss: 46716.3311; val_edge_recon_loss: 27823582.3721; val_gene_expr_recon_loss: 25563349.3488; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53433647.7209; val_optim_loss: 53433647.7209
Epoch 40/400 |██------------------| 10.0% val_auroc_score: 0.9464; val_auprc_score: 0.9392; val_best_acc_score: 0.8786; val_best_f1_score: 0.8826; train_kl_reg_loss: 51786.8679; train_edge_recon_loss: 27043531.2376; train_gene_expr_recon_loss: 26829880.4804; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53925198.5274; train_optim_loss: 53925198.5274; val_kl_reg_loss: 46852.9558; val_edge_recon_loss: 27853741.0698; val_gene_expr_recon_loss: 25726003.3023; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53626597.4884; val_optim_loss: 53626597.4884

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 41/400 |██------------------| 10.2% val_auroc_score: 0.9479; val_auprc_score: 0.9408; val_best_acc_score: 0.8811; val_best_f1_score: 0.8851; train_kl_reg_loss: 51824.8108; train_edge_recon_loss: 27033393.0862; train_gene_expr_recon_loss: 26880747.0862; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53965964.9713; train_optim_loss: 53965964.9713; val_kl_reg_loss: 46751.1242; val_edge_recon_loss: 27772737.6744; val_gene_expr_recon_loss: 25650782.4651; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53470271.0698; val_optim_loss: 53470271.0698
Epoch 42/400 |██------------------| 10.5% val_auroc_score: 0.9463; val_auprc_score: 0.9382; val_best_acc_score: 0.8795; val_best_f1_score: 0.8841; train_kl_reg_loss: 51805.9495; train_edge_recon_loss: 27058805.0287; train_gene_expr_recon_loss: 26860322.0470; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53970933.0339; train_optim_loss: 53970933.0339; val_kl_reg_loss: 46740.5749; val_edge_recon_loss: 27824811.1163; val_gene_expr_recon_loss: 25685934.7442; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53557486.4186; val_optim_loss: 53557486.4186
Epoch 43/400 |██------------------| 10.8% val_auroc_score: 0.9468; val_auprc_score: 0.9391; val_best_acc_score: 0.8788; val_best_f1_score: 0.8828; train_kl_reg_loss: 51812.1440; train_edge_recon_loss: 27033685.6084; train_gene_expr_recon_loss: 26863235.3159; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 53948733.1697; train_optim_loss: 53948733.1697; val_kl_reg_loss: 46734.3979; val_edge_recon_loss: 27813472.2326; val_gene_expr_recon_loss: 25670104.1860; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53530310.4186; val_optim_loss: 53530310.4186
Epoch 44/400 |██------------------| 11.0% val_auroc_score: 0.9464; val_auprc_score: 0.9388; val_best_acc_score: 0.8794; val_best_f1_score: 0.8835; train_kl_reg_loss: 51862.2170; train_edge_recon_loss: 27060793.2010; train_gene_expr_recon_loss: 26908049.8747; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 54020705.4726; train_optim_loss: 54020705.4726; val_kl_reg_loss: 46796.6649; val_edge_recon_loss: 27850720.6512; val_gene_expr_recon_loss: 25624965.7209; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 53522483.0698; val_optim_loss: 53522483.0698

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 66 min 12 sec.
Using best model state, which was in epoch 36.

--- MODEL EVALUATION ---
val AUROC score: 0.9481
val AUPRC score: 0.9408
val best accuracy score: 0.8820
val best F1 score: 0.8856
val target rna MSE score: 16.8031
val source rna MSE score: 0.8038
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0710
Val cat covariate2 mean sim diff: nan

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
