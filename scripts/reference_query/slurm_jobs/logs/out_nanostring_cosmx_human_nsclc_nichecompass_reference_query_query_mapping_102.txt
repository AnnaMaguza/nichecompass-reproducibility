Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch3', 'batch8', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '29092023_233507_102', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.01
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch8...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.01
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 151404
Number of validation nodes: 16823
Number of training edges: 357995
Number of validation edges: 39777
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9140; val_auprc_score: 0.9367; val_best_acc_score: 0.8642; val_best_f1_score: 0.9021; train_kl_reg_loss: 19136.3419; train_edge_recon_loss: 1938186.9475; train_gene_expr_recon_loss: 3109539.4311; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5066862.7207; train_optim_loss: 5066862.7207; val_kl_reg_loss: 19207.8848; val_edge_recon_loss: 1978394.2228; val_gene_expr_recon_loss: 2534944.9968; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4532547.1090; val_optim_loss: 4532547.1090
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9131; val_auprc_score: 0.9356; val_best_acc_score: 0.8627; val_best_f1_score: 0.9004; train_kl_reg_loss: 19128.4943; train_edge_recon_loss: 1941544.8409; train_gene_expr_recon_loss: 2292089.5096; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4252762.8518; train_optim_loss: 4252762.8518; val_kl_reg_loss: 19203.1276; val_edge_recon_loss: 2000252.1186; val_gene_expr_recon_loss: 2109169.3526; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4128624.5865; val_optim_loss: 4128624.5865
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9145; val_auprc_score: 0.9380; val_best_acc_score: 0.8650; val_best_f1_score: 0.9013; train_kl_reg_loss: 19141.4300; train_edge_recon_loss: 1939351.9648; train_gene_expr_recon_loss: 2039380.5686; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3997873.9646; train_optim_loss: 3997873.9646; val_kl_reg_loss: 19173.9034; val_edge_recon_loss: 1980269.3013; val_gene_expr_recon_loss: 1977079.7772; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3976522.9808; val_optim_loss: 3976522.9808
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9160; val_auprc_score: 0.9389; val_best_acc_score: 0.8655; val_best_f1_score: 0.9024; train_kl_reg_loss: 19124.9659; train_edge_recon_loss: 1942855.9405; train_gene_expr_recon_loss: 1947871.7593; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3909852.6693; train_optim_loss: 3909852.6693; val_kl_reg_loss: 19161.2339; val_edge_recon_loss: 1980358.6699; val_gene_expr_recon_loss: 1911454.7564; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3910974.6667; val_optim_loss: 3910974.6667
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9155; val_auprc_score: 0.9392; val_best_acc_score: 0.8639; val_best_f1_score: 0.9016; train_kl_reg_loss: 19131.3932; train_edge_recon_loss: 1941536.9995; train_gene_expr_recon_loss: 1898696.0955; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3859364.4889; train_optim_loss: 3859364.4889; val_kl_reg_loss: 19191.0998; val_edge_recon_loss: 1974136.1410; val_gene_expr_recon_loss: 1876438.0529; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3869765.2981; val_optim_loss: 3869765.2981
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9126; val_auprc_score: 0.9357; val_best_acc_score: 0.8624; val_best_f1_score: 0.9001; train_kl_reg_loss: 19139.6821; train_edge_recon_loss: 1939551.8139; train_gene_expr_recon_loss: 1867519.7989; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3826211.2954; train_optim_loss: 3826211.2954; val_kl_reg_loss: 19198.4686; val_edge_recon_loss: 1999919.4311; val_gene_expr_recon_loss: 1853560.4391; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3872678.3141; val_optim_loss: 3872678.3141
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9140; val_auprc_score: 0.9367; val_best_acc_score: 0.8649; val_best_f1_score: 0.9017; train_kl_reg_loss: 19127.6885; train_edge_recon_loss: 1937020.7500; train_gene_expr_recon_loss: 1848622.0018; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3804770.4371; train_optim_loss: 3804770.4371; val_kl_reg_loss: 19195.7222; val_edge_recon_loss: 1990936.7788; val_gene_expr_recon_loss: 1842342.5096; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3852475.0000; val_optim_loss: 3852475.0000
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9143; val_auprc_score: 0.9368; val_best_acc_score: 0.8640; val_best_f1_score: 0.9011; train_kl_reg_loss: 19133.3972; train_edge_recon_loss: 1942938.4688; train_gene_expr_recon_loss: 1834809.2320; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3796881.1011; train_optim_loss: 3796881.1011; val_kl_reg_loss: 19187.4584; val_edge_recon_loss: 1988672.5497; val_gene_expr_recon_loss: 1826606.8606; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3834466.8718; val_optim_loss: 3834466.8718
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9139; val_auprc_score: 0.9378; val_best_acc_score: 0.8638; val_best_f1_score: 0.9008; train_kl_reg_loss: 19135.7187; train_edge_recon_loss: 1937531.9411; train_gene_expr_recon_loss: 1825060.4464; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3781728.1043; train_optim_loss: 3781728.1043; val_kl_reg_loss: 19193.9204; val_edge_recon_loss: 1987594.6939; val_gene_expr_recon_loss: 1822716.5962; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3829505.2179; val_optim_loss: 3829505.2179
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9143; val_auprc_score: 0.9364; val_best_acc_score: 0.8647; val_best_f1_score: 0.9016; train_kl_reg_loss: 19135.6007; train_edge_recon_loss: 1938220.2232; train_gene_expr_recon_loss: 1819170.9345; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3776526.7571; train_optim_loss: 3776526.7571; val_kl_reg_loss: 19169.4403; val_edge_recon_loss: 1988456.4487; val_gene_expr_recon_loss: 1811194.7981; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3818820.6859; val_optim_loss: 3818820.6859
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9134; val_auprc_score: 0.9364; val_best_acc_score: 0.8636; val_best_f1_score: 0.9009; train_kl_reg_loss: 19131.2737; train_edge_recon_loss: 1939006.3441; train_gene_expr_recon_loss: 1815768.5618; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3773906.1779; train_optim_loss: 3773906.1779; val_kl_reg_loss: 19234.0877; val_edge_recon_loss: 1982773.8526; val_gene_expr_recon_loss: 1810026.2532; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3812034.1923; val_optim_loss: 3812034.1923
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9159; val_auprc_score: 0.9387; val_best_acc_score: 0.8655; val_best_f1_score: 0.9016; train_kl_reg_loss: 19138.7468; train_edge_recon_loss: 1938059.2121; train_gene_expr_recon_loss: 1812380.0066; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3769577.9607; train_optim_loss: 3769577.9607; val_kl_reg_loss: 19141.7316; val_edge_recon_loss: 1983078.7147; val_gene_expr_recon_loss: 1807544.0513; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3809764.4712; val_optim_loss: 3809764.4712
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9143; val_auprc_score: 0.9375; val_best_acc_score: 0.8638; val_best_f1_score: 0.9010; train_kl_reg_loss: 19134.6365; train_edge_recon_loss: 1943581.9564; train_gene_expr_recon_loss: 1812663.9964; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3775380.5914; train_optim_loss: 3775380.5914; val_kl_reg_loss: 19209.3414; val_edge_recon_loss: 1982263.8670; val_gene_expr_recon_loss: 1811499.0385; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3812972.2532; val_optim_loss: 3812972.2532
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9154; val_auprc_score: 0.9388; val_best_acc_score: 0.8641; val_best_f1_score: 0.9013; train_kl_reg_loss: 19151.2253; train_edge_recon_loss: 1937781.1150; train_gene_expr_recon_loss: 1810902.1143; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3767834.4525; train_optim_loss: 3767834.4525; val_kl_reg_loss: 19178.9214; val_edge_recon_loss: 1984295.3654; val_gene_expr_recon_loss: 1808224.6138; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3811698.8782; val_optim_loss: 3811698.8782
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9157; val_auprc_score: 0.9390; val_best_acc_score: 0.8654; val_best_f1_score: 0.9021; train_kl_reg_loss: 19145.4032; train_edge_recon_loss: 1938815.5707; train_gene_expr_recon_loss: 1810804.0991; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3768765.0700; train_optim_loss: 3768765.0700; val_kl_reg_loss: 19194.8737; val_edge_recon_loss: 1987196.1490; val_gene_expr_recon_loss: 1807536.9808; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3813927.9904; val_optim_loss: 3813927.9904
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9131; val_auprc_score: 0.9372; val_best_acc_score: 0.8636; val_best_f1_score: 0.9012; train_kl_reg_loss: 19134.6584; train_edge_recon_loss: 1936741.7464; train_gene_expr_recon_loss: 1810990.5918; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3766866.9950; train_optim_loss: 3766866.9950; val_kl_reg_loss: 19177.6636; val_edge_recon_loss: 1981500.9295; val_gene_expr_recon_loss: 1806182.7308; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3806861.3141; val_optim_loss: 3806861.3141
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9165; val_auprc_score: 0.9399; val_best_acc_score: 0.8652; val_best_f1_score: 0.9021; train_kl_reg_loss: 19137.3690; train_edge_recon_loss: 1938386.1707; train_gene_expr_recon_loss: 1810153.0454; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3767676.5811; train_optim_loss: 3767676.5811; val_kl_reg_loss: 19188.0119; val_edge_recon_loss: 1977644.1971; val_gene_expr_recon_loss: 1806493.0865; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3803325.2821; val_optim_loss: 3803325.2821
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.9163; val_auprc_score: 0.9388; val_best_acc_score: 0.8640; val_best_f1_score: 0.9007; train_kl_reg_loss: 19137.5439; train_edge_recon_loss: 1937963.8066; train_gene_expr_recon_loss: 1809456.0175; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3766557.3732; train_optim_loss: 3766557.3732; val_kl_reg_loss: 19192.6828; val_edge_recon_loss: 1992844.1635; val_gene_expr_recon_loss: 1811032.3269; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3823069.1763; val_optim_loss: 3823069.1763
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.9126; val_auprc_score: 0.9362; val_best_acc_score: 0.8630; val_best_f1_score: 0.9012; train_kl_reg_loss: 19151.5954; train_edge_recon_loss: 1938940.7745; train_gene_expr_recon_loss: 1811992.3184; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3770084.6889; train_optim_loss: 3770084.6889; val_kl_reg_loss: 19178.1153; val_edge_recon_loss: 1975541.9888; val_gene_expr_recon_loss: 1807890.5032; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3802610.6154; val_optim_loss: 3802610.6154
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.9139; val_auprc_score: 0.9374; val_best_acc_score: 0.8634; val_best_f1_score: 0.9016; train_kl_reg_loss: 19142.8644; train_edge_recon_loss: 1940804.3614; train_gene_expr_recon_loss: 1809598.3384; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3769545.5607; train_optim_loss: 3769545.5607; val_kl_reg_loss: 19193.6587; val_edge_recon_loss: 1980369.6442; val_gene_expr_recon_loss: 1809953.5481; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3809516.8622; val_optim_loss: 3809516.8622
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.9118; val_auprc_score: 0.9355; val_best_acc_score: 0.8633; val_best_f1_score: 0.9010; train_kl_reg_loss: 19141.6470; train_edge_recon_loss: 1934575.3441; train_gene_expr_recon_loss: 1809762.8984; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3763479.8939; train_optim_loss: 3763479.8939; val_kl_reg_loss: 19203.9532; val_edge_recon_loss: 1986518.8862; val_gene_expr_recon_loss: 1804259.9231; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3809982.7692; val_optim_loss: 3809982.7692
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.9149; val_auprc_score: 0.9376; val_best_acc_score: 0.8649; val_best_f1_score: 0.9021; train_kl_reg_loss: 19148.1582; train_edge_recon_loss: 1937296.3913; train_gene_expr_recon_loss: 1810026.2127; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3766470.7650; train_optim_loss: 3766470.7650; val_kl_reg_loss: 19195.7075; val_edge_recon_loss: 1977483.0593; val_gene_expr_recon_loss: 1807141.9375; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3803820.7083; val_optim_loss: 3803820.7083
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.9144; val_auprc_score: 0.9385; val_best_acc_score: 0.8631; val_best_f1_score: 0.9009; train_kl_reg_loss: 19135.1821; train_edge_recon_loss: 1937119.3245; train_gene_expr_recon_loss: 1809600.8723; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3765855.3825; train_optim_loss: 3765855.3825; val_kl_reg_loss: 19189.1259; val_edge_recon_loss: 1978396.9824; val_gene_expr_recon_loss: 1812122.0513; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3809708.1571; val_optim_loss: 3809708.1571

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.9153; val_auprc_score: 0.9385; val_best_acc_score: 0.8638; val_best_f1_score: 0.9011; train_kl_reg_loss: 19147.7258; train_edge_recon_loss: 1936449.9207; train_gene_expr_recon_loss: 1810203.2002; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3765800.8546; train_optim_loss: 3765800.8546; val_kl_reg_loss: 19168.5859; val_edge_recon_loss: 1992537.2917; val_gene_expr_recon_loss: 1809623.5096; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3821329.3750; val_optim_loss: 3821329.3750
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.9139; val_auprc_score: 0.9370; val_best_acc_score: 0.8642; val_best_f1_score: 0.9015; train_kl_reg_loss: 19126.3468; train_edge_recon_loss: 1938213.6600; train_gene_expr_recon_loss: 1809219.9655; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3766559.9646; train_optim_loss: 3766559.9646; val_kl_reg_loss: 19203.3761; val_edge_recon_loss: 1994000.9311; val_gene_expr_recon_loss: 1807777.2692; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3820981.5833; val_optim_loss: 3820981.5833
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.9120; val_auprc_score: 0.9359; val_best_acc_score: 0.8627; val_best_f1_score: 0.9007; train_kl_reg_loss: 19132.0107; train_edge_recon_loss: 1937269.3800; train_gene_expr_recon_loss: 1766354.9909; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3722756.3814; train_optim_loss: 3722756.3814; val_kl_reg_loss: 19139.5972; val_edge_recon_loss: 1982455.6042; val_gene_expr_recon_loss: 1768596.3910; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3770191.5994; val_optim_loss: 3770191.5994
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.9126; val_auprc_score: 0.9362; val_best_acc_score: 0.8635; val_best_f1_score: 0.9017; train_kl_reg_loss: 19142.7492; train_edge_recon_loss: 1931293.0764; train_gene_expr_recon_loss: 1765330.9607; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3715766.7861; train_optim_loss: 3715766.7861; val_kl_reg_loss: 19100.4504; val_edge_recon_loss: 1976382.3814; val_gene_expr_recon_loss: 1761076.0256; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3756558.8526; val_optim_loss: 3756558.8526
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.9136; val_auprc_score: 0.9354; val_best_acc_score: 0.8645; val_best_f1_score: 0.9012; train_kl_reg_loss: 19147.4571; train_edge_recon_loss: 1936665.3921; train_gene_expr_recon_loss: 1765440.4320; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3721253.2868; train_optim_loss: 3721253.2868; val_kl_reg_loss: 19126.9199; val_edge_recon_loss: 1990077.1378; val_gene_expr_recon_loss: 1765929.1891; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3775133.2628; val_optim_loss: 3775133.2628
Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.9126; val_auprc_score: 0.9364; val_best_acc_score: 0.8624; val_best_f1_score: 0.9010; train_kl_reg_loss: 19140.5788; train_edge_recon_loss: 1932140.5202; train_gene_expr_recon_loss: 1764427.6023; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3715708.7064; train_optim_loss: 3715708.7064; val_kl_reg_loss: 19101.5960; val_edge_recon_loss: 1979440.9679; val_gene_expr_recon_loss: 1763755.7083; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3762298.2564; val_optim_loss: 3762298.2564
Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.9120; val_auprc_score: 0.9356; val_best_acc_score: 0.8624; val_best_f1_score: 0.9002; train_kl_reg_loss: 19145.6752; train_edge_recon_loss: 1933264.9912; train_gene_expr_recon_loss: 1764549.3716; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3716960.0379; train_optim_loss: 3716960.0379; val_kl_reg_loss: 19100.0869; val_edge_recon_loss: 1993281.9311; val_gene_expr_recon_loss: 1763296.6234; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3775678.6506; val_optim_loss: 3775678.6506
Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.9127; val_auprc_score: 0.9349; val_best_acc_score: 0.8636; val_best_f1_score: 0.9006; train_kl_reg_loss: 19149.2582; train_edge_recon_loss: 1935260.1757; train_gene_expr_recon_loss: 1764648.3402; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3719057.7729; train_optim_loss: 3719057.7729; val_kl_reg_loss: 19126.1044; val_edge_recon_loss: 1994787.8670; val_gene_expr_recon_loss: 1764505.7308; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3778419.7147; val_optim_loss: 3778419.7147

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.9144; val_auprc_score: 0.9375; val_best_acc_score: 0.8646; val_best_f1_score: 0.9013; train_kl_reg_loss: 19164.7578; train_edge_recon_loss: 1937510.1307; train_gene_expr_recon_loss: 1765286.1020; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3721960.9882; train_optim_loss: 3721960.9882; val_kl_reg_loss: 19137.7787; val_edge_recon_loss: 1987089.3381; val_gene_expr_recon_loss: 1761747.2452; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3767974.3558; val_optim_loss: 3767974.3558
Epoch 33/400 |█-------------------| 8.2% val_auroc_score: 0.9120; val_auprc_score: 0.9354; val_best_acc_score: 0.8627; val_best_f1_score: 0.9005; train_kl_reg_loss: 19145.8862; train_edge_recon_loss: 1933656.2554; train_gene_expr_recon_loss: 1764213.5873; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3717015.7218; train_optim_loss: 3717015.7218; val_kl_reg_loss: 19116.7614; val_edge_recon_loss: 1992610.2869; val_gene_expr_recon_loss: 1762529.2003; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3774256.2596; val_optim_loss: 3774256.2596
Epoch 34/400 |█-------------------| 8.5% val_auroc_score: 0.9143; val_auprc_score: 0.9380; val_best_acc_score: 0.8630; val_best_f1_score: 0.9003; train_kl_reg_loss: 19145.3924; train_edge_recon_loss: 1938770.3707; train_gene_expr_recon_loss: 1764729.0823; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3722644.8454; train_optim_loss: 3722644.8454; val_kl_reg_loss: 19104.5898; val_edge_recon_loss: 1991788.2804; val_gene_expr_recon_loss: 1763838.3109; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3774731.1891; val_optim_loss: 3774731.1891
Epoch 35/400 |█-------------------| 8.8% val_auroc_score: 0.9127; val_auprc_score: 0.9357; val_best_acc_score: 0.8645; val_best_f1_score: 0.9017; train_kl_reg_loss: 19134.1345; train_edge_recon_loss: 1933109.8166; train_gene_expr_recon_loss: 1764474.5200; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3716718.4654; train_optim_loss: 3716718.4654; val_kl_reg_loss: 19082.7001; val_edge_recon_loss: 1977878.2628; val_gene_expr_recon_loss: 1764453.3910; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 3761414.3397; val_optim_loss: 3761414.3397

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 1135 min 24 sec.
Using best model state, which was in epoch 27.

--- MODEL EVALUATION ---
val AUROC score: 0.9134
val AUPRC score: 0.9358
val best accuracy score: 0.8630
val best F1 score: 0.9008
val target rna MSE score: 0.4232
val source rna MSE score: 0.5542
Val cat covariate0 mean sim diff: -0.0402
Val cat covariate1 mean sim diff: -0.0671
Val cat covariate2 mean sim diff: -0.0402

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
