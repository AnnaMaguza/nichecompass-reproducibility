Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch8', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '06102023_193135_28', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch8...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 68882
Number of validation nodes: 7654
Number of training edges: 162180
Number of validation edges: 18020
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8822; val_auprc_score: 0.8806; val_best_acc_score: 0.7973; val_best_f1_score: 0.8067; train_kl_reg_loss: 50519.8056; train_edge_recon_loss: 32102048.3722; train_gene_expr_recon_loss: 64887237.6404; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 97039805.7287; train_optim_loss: 97039805.7287; val_kl_reg_loss: 50276.2240; val_edge_recon_loss: 32764017.8889; val_gene_expr_recon_loss: 47069223.7778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 79883517.7778; val_optim_loss: 79883517.7778
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8846; val_auprc_score: 0.8824; val_best_acc_score: 0.8011; val_best_f1_score: 0.8078; train_kl_reg_loss: 50542.9095; train_edge_recon_loss: 32103130.9022; train_gene_expr_recon_loss: 44495734.6751; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 76649408.5300; train_optim_loss: 76649408.5300; val_kl_reg_loss: 50349.2127; val_edge_recon_loss: 32707377.4444; val_gene_expr_recon_loss: 40263163.8889; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 73020890.2222; val_optim_loss: 73020890.2222
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.8854; val_auprc_score: 0.8846; val_best_acc_score: 0.8011; val_best_f1_score: 0.8087; train_kl_reg_loss: 50542.0000; train_edge_recon_loss: 32116591.4700; train_gene_expr_recon_loss: 41120655.4700; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 73287788.9464; train_optim_loss: 73287788.9464; val_kl_reg_loss: 50312.2058; val_edge_recon_loss: 32689919.1111; val_gene_expr_recon_loss: 38460371.2222; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 71200603.1111; val_optim_loss: 71200603.1111
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.8845; val_auprc_score: 0.8820; val_best_acc_score: 0.8001; val_best_f1_score: 0.8095; train_kl_reg_loss: 50546.3924; train_edge_recon_loss: 32108742.0568; train_gene_expr_recon_loss: 39719109.8423; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 71878398.3975; train_optim_loss: 71878398.3975; val_kl_reg_loss: 50305.0111; val_edge_recon_loss: 32701278.8889; val_gene_expr_recon_loss: 37429467.7778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70181051.7778; val_optim_loss: 70181051.7778
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.8852; val_auprc_score: 0.8845; val_best_acc_score: 0.8003; val_best_f1_score: 0.8093; train_kl_reg_loss: 50530.8396; train_edge_recon_loss: 32111548.2461; train_gene_expr_recon_loss: 38590253.3754; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70752332.6688; train_optim_loss: 70752332.6688; val_kl_reg_loss: 50415.4235; val_edge_recon_loss: 32719255.1667; val_gene_expr_recon_loss: 36355558.1111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69125228.6667; val_optim_loss: 69125228.6667
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.8842; val_auprc_score: 0.8830; val_best_acc_score: 0.7998; val_best_f1_score: 0.8086; train_kl_reg_loss: 50550.0213; train_edge_recon_loss: 32108641.8864; train_gene_expr_recon_loss: 37630287.7413; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 69789479.7476; train_optim_loss: 69789479.7476; val_kl_reg_loss: 50383.4570; val_edge_recon_loss: 32710608.1111; val_gene_expr_recon_loss: 35510735.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 68271726.5556; val_optim_loss: 68271726.5556
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.8829; val_auprc_score: 0.8809; val_best_acc_score: 0.8001; val_best_f1_score: 0.8076; train_kl_reg_loss: 50567.3609; train_edge_recon_loss: 32116317.4700; train_gene_expr_recon_loss: 36735360.5931; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 68902245.4511; train_optim_loss: 68902245.4511; val_kl_reg_loss: 50397.7900; val_edge_recon_loss: 32733010.8333; val_gene_expr_recon_loss: 34568670.7778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 67352079.6667; val_optim_loss: 67352079.6667
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.8848; val_auprc_score: 0.8824; val_best_acc_score: 0.8020; val_best_f1_score: 0.8109; train_kl_reg_loss: 50536.4699; train_edge_recon_loss: 32125978.7319; train_gene_expr_recon_loss: 35832895.7413; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 68009411.0158; train_optim_loss: 68009411.0158; val_kl_reg_loss: 50401.0531; val_edge_recon_loss: 32729404.7222; val_gene_expr_recon_loss: 33632916.3889; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 66412722.1111; val_optim_loss: 66412722.1111
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.8827; val_auprc_score: 0.8814; val_best_acc_score: 0.7964; val_best_f1_score: 0.8061; train_kl_reg_loss: 50529.6839; train_edge_recon_loss: 32104393.6025; train_gene_expr_recon_loss: 34856722.6751; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 67011646.0315; train_optim_loss: 67011646.0315; val_kl_reg_loss: 50385.2642; val_edge_recon_loss: 32757188.4444; val_gene_expr_recon_loss: 32871767.8889; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 65679341.5556; val_optim_loss: 65679341.5556
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.8835; val_auprc_score: 0.8822; val_best_acc_score: 0.7973; val_best_f1_score: 0.8081; train_kl_reg_loss: 50532.1823; train_edge_recon_loss: 32117697.4196; train_gene_expr_recon_loss: 34143426.5678; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 66311656.2650; train_optim_loss: 66311656.2650; val_kl_reg_loss: 50301.2203; val_edge_recon_loss: 32733491.3889; val_gene_expr_recon_loss: 32129089.7778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64912882.1111; val_optim_loss: 64912882.1111
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.8834; val_auprc_score: 0.8817; val_best_acc_score: 0.7992; val_best_f1_score: 0.8078; train_kl_reg_loss: 50528.3765; train_edge_recon_loss: 32109952.7129; train_gene_expr_recon_loss: 33528175.8423; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 65688657.0095; train_optim_loss: 65688657.0095; val_kl_reg_loss: 50325.6031; val_edge_recon_loss: 32772305.6667; val_gene_expr_recon_loss: 31485619.5556; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64308250.7778; val_optim_loss: 64308250.7778
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.8831; val_auprc_score: 0.8830; val_best_acc_score: 0.7982; val_best_f1_score: 0.8071; train_kl_reg_loss: 50580.4400; train_edge_recon_loss: 32109332.9590; train_gene_expr_recon_loss: 33012944.4101; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 65172857.9180; train_optim_loss: 65172857.9180; val_kl_reg_loss: 50305.9446; val_edge_recon_loss: 32775053.1667; val_gene_expr_recon_loss: 31015968.1111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63841326.8889; val_optim_loss: 63841326.8889
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.8853; val_auprc_score: 0.8842; val_best_acc_score: 0.8014; val_best_f1_score: 0.8093; train_kl_reg_loss: 50534.0734; train_edge_recon_loss: 32110834.5678; train_gene_expr_recon_loss: 32489282.1262; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 64650650.8896; train_optim_loss: 64650650.8896; val_kl_reg_loss: 50387.7807; val_edge_recon_loss: 32722786.7222; val_gene_expr_recon_loss: 30704585.2222; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63477759.7778; val_optim_loss: 63477759.7778
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.8816; val_auprc_score: 0.8786; val_best_acc_score: 0.7971; val_best_f1_score: 0.8071; train_kl_reg_loss: 50545.2292; train_edge_recon_loss: 32139939.6719; train_gene_expr_recon_loss: 32174651.5205; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 64365136.6057; train_optim_loss: 64365136.6057; val_kl_reg_loss: 50397.9695; val_edge_recon_loss: 32763796.0556; val_gene_expr_recon_loss: 30401511.1111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63215705.2222; val_optim_loss: 63215705.2222
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.8869; val_auprc_score: 0.8856; val_best_acc_score: 0.8013; val_best_f1_score: 0.8116; train_kl_reg_loss: 50486.8891; train_edge_recon_loss: 32115429.3375; train_gene_expr_recon_loss: 31889423.8612; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 64055340.1262; train_optim_loss: 64055340.1262; val_kl_reg_loss: 50372.7478; val_edge_recon_loss: 32628256.5556; val_gene_expr_recon_loss: 30221550.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62900179.3333; val_optim_loss: 62900179.3333
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.8863; val_auprc_score: 0.8843; val_best_acc_score: 0.8028; val_best_f1_score: 0.8107; train_kl_reg_loss: 50531.0098; train_edge_recon_loss: 32101702.9211; train_gene_expr_recon_loss: 31662519.5079; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63814753.4385; train_optim_loss: 63814753.4385; val_kl_reg_loss: 50443.8177; val_edge_recon_loss: 32695863.1667; val_gene_expr_recon_loss: 30046521.1111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62792828.0000; val_optim_loss: 62792828.0000
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.8835; val_auprc_score: 0.8816; val_best_acc_score: 0.7991; val_best_f1_score: 0.8086; train_kl_reg_loss: 50542.2821; train_edge_recon_loss: 32119107.7161; train_gene_expr_recon_loss: 31428690.9527; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63598340.8580; train_optim_loss: 63598340.8580; val_kl_reg_loss: 50308.0357; val_edge_recon_loss: 32728441.4444; val_gene_expr_recon_loss: 29709094.6667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62487844.1111; val_optim_loss: 62487844.1111
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.8835; val_auprc_score: 0.8825; val_best_acc_score: 0.7986; val_best_f1_score: 0.8078; train_kl_reg_loss: 50550.2465; train_edge_recon_loss: 32112501.1987; train_gene_expr_recon_loss: 31276572.8896; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63439624.3155; train_optim_loss: 63439624.3155; val_kl_reg_loss: 50430.2600; val_edge_recon_loss: 32765182.6667; val_gene_expr_recon_loss: 29679729.7778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62495342.3333; val_optim_loss: 62495342.3333
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.8843; val_auprc_score: 0.8827; val_best_acc_score: 0.8007; val_best_f1_score: 0.8089; train_kl_reg_loss: 50561.9643; train_edge_recon_loss: 32116559.4259; train_gene_expr_recon_loss: 31170401.9243; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63337523.2808; train_optim_loss: 63337523.2808; val_kl_reg_loss: 50409.8528; val_edge_recon_loss: 32717497.6667; val_gene_expr_recon_loss: 29575193.0556; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62343100.1111; val_optim_loss: 62343100.1111
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.8834; val_auprc_score: 0.8829; val_best_acc_score: 0.7993; val_best_f1_score: 0.8074; train_kl_reg_loss: 50541.1650; train_edge_recon_loss: 32123008.9211; train_gene_expr_recon_loss: 31037082.3912; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63210632.5426; train_optim_loss: 63210632.5426; val_kl_reg_loss: 50351.6377; val_edge_recon_loss: 32748424.7778; val_gene_expr_recon_loss: 29514879.3333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62313656.1111; val_optim_loss: 62313656.1111
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.8818; val_auprc_score: 0.8799; val_best_acc_score: 0.7966; val_best_f1_score: 0.8068; train_kl_reg_loss: 50510.7590; train_edge_recon_loss: 32123759.2177; train_gene_expr_recon_loss: 30905164.9211; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63079434.9274; train_optim_loss: 63079434.9274; val_kl_reg_loss: 50369.0699; val_edge_recon_loss: 32772022.3889; val_gene_expr_recon_loss: 29380936.1667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62203327.7778; val_optim_loss: 62203327.7778
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.8838; val_auprc_score: 0.8820; val_best_acc_score: 0.7991; val_best_f1_score: 0.8080; train_kl_reg_loss: 50555.5432; train_edge_recon_loss: 32114594.7382; train_gene_expr_recon_loss: 30854349.9180; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63019500.1136; train_optim_loss: 63019500.1136; val_kl_reg_loss: 50385.3892; val_edge_recon_loss: 32744634.2778; val_gene_expr_recon_loss: 29358589.2222; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62153609.1111; val_optim_loss: 62153609.1111
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.8860; val_auprc_score: 0.8855; val_best_acc_score: 0.8016; val_best_f1_score: 0.8096; train_kl_reg_loss: 50534.0472; train_edge_recon_loss: 32106950.9464; train_gene_expr_recon_loss: 30776914.5489; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62934399.5205; train_optim_loss: 62934399.5205; val_kl_reg_loss: 50354.6428; val_edge_recon_loss: 32686901.1667; val_gene_expr_recon_loss: 29110045.2778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61847300.4444; val_optim_loss: 61847300.4444
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.8854; val_auprc_score: 0.8834; val_best_acc_score: 0.8014; val_best_f1_score: 0.8086; train_kl_reg_loss: 50552.1539; train_edge_recon_loss: 32096954.7508; train_gene_expr_recon_loss: 30775831.5836; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62923338.5489; train_optim_loss: 62923338.5489; val_kl_reg_loss: 50428.8097; val_edge_recon_loss: 32693275.9444; val_gene_expr_recon_loss: 29165687.5000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61909392.2222; val_optim_loss: 61909392.2222
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.8844; val_auprc_score: 0.8830; val_best_acc_score: 0.8007; val_best_f1_score: 0.8087; train_kl_reg_loss: 50582.7861; train_edge_recon_loss: 32118147.4322; train_gene_expr_recon_loss: 30654799.8864; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62823530.1451; train_optim_loss: 62823530.1451; val_kl_reg_loss: 50330.9041; val_edge_recon_loss: 32764593.8333; val_gene_expr_recon_loss: 29109304.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61924228.4444; val_optim_loss: 61924228.4444
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.8818; val_auprc_score: 0.8790; val_best_acc_score: 0.7982; val_best_f1_score: 0.8068; train_kl_reg_loss: 50514.3222; train_edge_recon_loss: 32277308.0379; train_gene_expr_recon_loss: 29897331.6278; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62225154.0442; train_optim_loss: 62225154.0442; val_kl_reg_loss: 44698.8537; val_edge_recon_loss: 33017302.7222; val_gene_expr_recon_loss: 28269443.8333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61331445.3333; val_optim_loss: 61331445.3333
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.8810; val_auprc_score: 0.8775; val_best_acc_score: 0.7961; val_best_f1_score: 0.8057; train_kl_reg_loss: 50511.3143; train_edge_recon_loss: 32282099.6656; train_gene_expr_recon_loss: 29682007.3565; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62014618.1830; train_optim_loss: 62014618.1830; val_kl_reg_loss: 44921.8409; val_edge_recon_loss: 33016443.4444; val_gene_expr_recon_loss: 28209426.4444; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61270791.7778; val_optim_loss: 61270791.7778
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.8808; val_auprc_score: 0.8780; val_best_acc_score: 0.7966; val_best_f1_score: 0.8053; train_kl_reg_loss: 50556.2542; train_edge_recon_loss: 32278973.3060; train_gene_expr_recon_loss: 29659776.6877; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61989306.3849; train_optim_loss: 61989306.3849; val_kl_reg_loss: 44883.7530; val_edge_recon_loss: 33012946.2222; val_gene_expr_recon_loss: 28267094.8333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61324924.5556; val_optim_loss: 61324924.5556
Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.8827; val_auprc_score: 0.8782; val_best_acc_score: 0.8001; val_best_f1_score: 0.8088; train_kl_reg_loss: 50541.7515; train_edge_recon_loss: 32275799.2934; train_gene_expr_recon_loss: 29582115.5016; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61908456.5174; train_optim_loss: 61908456.5174; val_kl_reg_loss: 44809.7816; val_edge_recon_loss: 32979997.3889; val_gene_expr_recon_loss: 28129042.2778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61153849.4444; val_optim_loss: 61153849.4444
Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.8802; val_auprc_score: 0.8765; val_best_acc_score: 0.7948; val_best_f1_score: 0.8073; train_kl_reg_loss: 50533.2772; train_edge_recon_loss: 32267317.4132; train_gene_expr_recon_loss: 29611922.1009; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61929772.7571; train_optim_loss: 61929772.7571; val_kl_reg_loss: 44813.6251; val_edge_recon_loss: 33019598.4444; val_gene_expr_recon_loss: 28078247.6111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61142659.6667; val_optim_loss: 61142659.6667
Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.8837; val_auprc_score: 0.8815; val_best_acc_score: 0.7988; val_best_f1_score: 0.8086; train_kl_reg_loss: 50540.0418; train_edge_recon_loss: 32280388.3218; train_gene_expr_recon_loss: 29552611.9748; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61883540.2271; train_optim_loss: 61883540.2271; val_kl_reg_loss: 44784.0961; val_edge_recon_loss: 32982469.6111; val_gene_expr_recon_loss: 28073372.3889; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61100625.5556; val_optim_loss: 61100625.5556
Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.8822; val_auprc_score: 0.8795; val_best_acc_score: 0.7982; val_best_f1_score: 0.8084; train_kl_reg_loss: 50589.8933; train_edge_recon_loss: 32291279.2177; train_gene_expr_recon_loss: 29531150.1009; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61873019.2934; train_optim_loss: 61873019.2934; val_kl_reg_loss: 44792.8490; val_edge_recon_loss: 32958500.2778; val_gene_expr_recon_loss: 28084755.6111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61088048.8889; val_optim_loss: 61088048.8889
Epoch 33/400 |█-------------------| 8.2% val_auroc_score: 0.8819; val_auprc_score: 0.8756; val_best_acc_score: 0.7989; val_best_f1_score: 0.8091; train_kl_reg_loss: 50556.5717; train_edge_recon_loss: 32283135.3817; train_gene_expr_recon_loss: 29555787.4953; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61889479.4574; train_optim_loss: 61889479.4574; val_kl_reg_loss: 44807.8047; val_edge_recon_loss: 32936593.1667; val_gene_expr_recon_loss: 27991950.1111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60973351.2222; val_optim_loss: 60973351.2222
Epoch 34/400 |█-------------------| 8.5% val_auroc_score: 0.8834; val_auprc_score: 0.8794; val_best_acc_score: 0.7993; val_best_f1_score: 0.8075; train_kl_reg_loss: 50570.9520; train_edge_recon_loss: 32273276.3155; train_gene_expr_recon_loss: 29511628.7445; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61835475.9369; train_optim_loss: 61835475.9369; val_kl_reg_loss: 44745.3847; val_edge_recon_loss: 32979884.2778; val_gene_expr_recon_loss: 28126786.9444; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61151417.0000; val_optim_loss: 61151417.0000
Epoch 35/400 |█-------------------| 8.8% val_auroc_score: 0.8810; val_auprc_score: 0.8755; val_best_acc_score: 0.7984; val_best_f1_score: 0.8092; train_kl_reg_loss: 50540.2504; train_edge_recon_loss: 32294175.0095; train_gene_expr_recon_loss: 29485979.5205; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61830694.7382; train_optim_loss: 61830694.7382; val_kl_reg_loss: 44868.2296; val_edge_recon_loss: 32967179.3333; val_gene_expr_recon_loss: 27876841.5000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60888889.2222; val_optim_loss: 60888889.2222
Epoch 36/400 |█-------------------| 9.0% val_auroc_score: 0.8837; val_auprc_score: 0.8799; val_best_acc_score: 0.7997; val_best_f1_score: 0.8098; train_kl_reg_loss: 50540.3227; train_edge_recon_loss: 32298625.0410; train_gene_expr_recon_loss: 29438735.6845; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61787900.8833; train_optim_loss: 61787900.8833; val_kl_reg_loss: 44791.7492; val_edge_recon_loss: 32930479.0000; val_gene_expr_recon_loss: 27974726.9444; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60949998.1111; val_optim_loss: 60949998.1111
Epoch 37/400 |█-------------------| 9.2% val_auroc_score: 0.8832; val_auprc_score: 0.8793; val_best_acc_score: 0.8003; val_best_f1_score: 0.8094; train_kl_reg_loss: 50518.5111; train_edge_recon_loss: 32272289.8170; train_gene_expr_recon_loss: 29513171.6972; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61835979.8612; train_optim_loss: 61835979.8612; val_kl_reg_loss: 44896.7248; val_edge_recon_loss: 32967606.7222; val_gene_expr_recon_loss: 27969029.4444; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60981532.6667; val_optim_loss: 60981532.6667
Epoch 38/400 |█-------------------| 9.5% val_auroc_score: 0.8815; val_auprc_score: 0.8788; val_best_acc_score: 0.7972; val_best_f1_score: 0.8080; train_kl_reg_loss: 50533.3576; train_edge_recon_loss: 32304432.8707; train_gene_expr_recon_loss: 29436493.2555; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61791459.3943; train_optim_loss: 61791459.3943; val_kl_reg_loss: 44899.0812; val_edge_recon_loss: 33013340.6667; val_gene_expr_recon_loss: 28008321.5000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61066561.0000; val_optim_loss: 61066561.0000
Epoch 39/400 |█-------------------| 9.8% val_auroc_score: 0.8816; val_auprc_score: 0.8785; val_best_acc_score: 0.7969; val_best_f1_score: 0.8065; train_kl_reg_loss: 50549.7153; train_edge_recon_loss: 32281463.0978; train_gene_expr_recon_loss: 29453749.0662; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61785761.9811; train_optim_loss: 61785761.9811; val_kl_reg_loss: 44813.1782; val_edge_recon_loss: 32987250.5556; val_gene_expr_recon_loss: 27941504.8333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60973568.4444; val_optim_loss: 60973568.4444

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 40/400 |██------------------| 10.0% val_auroc_score: 0.8805; val_auprc_score: 0.8769; val_best_acc_score: 0.7970; val_best_f1_score: 0.8073; train_kl_reg_loss: 50523.8390; train_edge_recon_loss: 32268583.2050; train_gene_expr_recon_loss: 29363315.1609; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61682422.2334; train_optim_loss: 61682422.2334; val_kl_reg_loss: 44918.4554; val_edge_recon_loss: 33076281.1667; val_gene_expr_recon_loss: 28122745.2778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61243945.3333; val_optim_loss: 61243945.3333
Epoch 41/400 |██------------------| 10.2% val_auroc_score: 0.8825; val_auprc_score: 0.8793; val_best_acc_score: 0.7985; val_best_f1_score: 0.8076; train_kl_reg_loss: 50553.3316; train_edge_recon_loss: 32264900.5047; train_gene_expr_recon_loss: 29469173.5521; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61784627.3565; train_optim_loss: 61784627.3565; val_kl_reg_loss: 44883.3574; val_edge_recon_loss: 32959064.2778; val_gene_expr_recon_loss: 27920157.2222; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60924104.8889; val_optim_loss: 60924104.8889
Epoch 42/400 |██------------------| 10.5% val_auroc_score: 0.8810; val_auprc_score: 0.8779; val_best_acc_score: 0.7963; val_best_f1_score: 0.8050; train_kl_reg_loss: 50566.4922; train_edge_recon_loss: 32258834.7950; train_gene_expr_recon_loss: 29440606.0505; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61750007.3565; train_optim_loss: 61750007.3565; val_kl_reg_loss: 44851.3429; val_edge_recon_loss: 32993617.0000; val_gene_expr_recon_loss: 27942231.5556; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 60980700.1111; val_optim_loss: 60980700.1111
Epoch 43/400 |██------------------| 10.8% val_auroc_score: 0.8813; val_auprc_score: 0.8780; val_best_acc_score: 0.7986; val_best_f1_score: 0.8080; train_kl_reg_loss: 50561.9199; train_edge_recon_loss: 32277784.0189; train_gene_expr_recon_loss: 29487672.5804; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61816018.5489; train_optim_loss: 61816018.5489; val_kl_reg_loss: 44826.7414; val_edge_recon_loss: 33005128.2778; val_gene_expr_recon_loss: 27951067.7778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61001022.8889; val_optim_loss: 61001022.8889

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 52 min 31 sec.
Using best model state, which was in epoch 35.

--- MODEL EVALUATION ---
val AUROC score: 0.8837
val AUPRC score: 0.8795
val best accuracy score: 0.7992
val best F1 score: 0.8083
val target rna MSE score: 20.3131
val source rna MSE score: 0.9116
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0104
Val cat covariate2 mean sim diff: nan

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
