Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch8', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '06102023_193135_28', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch8...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 68882
Number of validation nodes: 7654
Number of training edges: 162180
Number of validation edges: 18020
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8854; val_auprc_score: 0.8838; val_best_acc_score: 0.8021; val_best_f1_score: 0.8103; train_kl_reg_loss: 50531.2306; train_edge_recon_loss: 32098894.4101; train_gene_expr_recon_loss: 54970633.2871; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 87120058.9527; train_optim_loss: 87120058.9527; val_kl_reg_loss: 50630.1485; val_edge_recon_loss: 32703319.1667; val_gene_expr_recon_loss: 41222218.1111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 73976167.3333; val_optim_loss: 73976167.3333
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8826; val_auprc_score: 0.8809; val_best_acc_score: 0.7959; val_best_f1_score: 0.8060; train_kl_reg_loss: 50515.1456; train_edge_recon_loss: 32106513.2050; train_gene_expr_recon_loss: 40939374.3091; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 73096402.4732; train_optim_loss: 73096402.4732; val_kl_reg_loss: 50659.6304; val_edge_recon_loss: 32739911.3333; val_gene_expr_recon_loss: 38729327.1111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 71519898.2222; val_optim_loss: 71519898.2222
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.8839; val_auprc_score: 0.8810; val_best_acc_score: 0.8010; val_best_f1_score: 0.8091; train_kl_reg_loss: 50500.5038; train_edge_recon_loss: 32101400.4921; train_gene_expr_recon_loss: 39544313.2050; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 71696214.1199; train_optim_loss: 71696214.1199; val_kl_reg_loss: 50676.4366; val_edge_recon_loss: 32738020.1111; val_gene_expr_recon_loss: 37661801.3333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 70450498.8889; val_optim_loss: 70450498.8889
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.8853; val_auprc_score: 0.8836; val_best_acc_score: 0.8009; val_best_f1_score: 0.8101; train_kl_reg_loss: 50479.9680; train_edge_recon_loss: 32121488.8707; train_gene_expr_recon_loss: 38594944.0757; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 70766913.0852; train_optim_loss: 70766913.0852; val_kl_reg_loss: 50698.8088; val_edge_recon_loss: 32685440.8333; val_gene_expr_recon_loss: 36759525.5556; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 69495665.5556; val_optim_loss: 69495665.5556
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.8828; val_auprc_score: 0.8808; val_best_acc_score: 0.7981; val_best_f1_score: 0.8076; train_kl_reg_loss: 50534.5063; train_edge_recon_loss: 32118519.4132; train_gene_expr_recon_loss: 37635289.3817; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 69804343.0789; train_optim_loss: 69804343.0789; val_kl_reg_loss: 50576.4098; val_edge_recon_loss: 32740511.1667; val_gene_expr_recon_loss: 35775756.2778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 68566844.0000; val_optim_loss: 68566844.0000
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.8856; val_auprc_score: 0.8835; val_best_acc_score: 0.8007; val_best_f1_score: 0.8088; train_kl_reg_loss: 50506.7212; train_edge_recon_loss: 32098367.2934; train_gene_expr_recon_loss: 36595584.6498; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 68744458.6625; train_optim_loss: 68744458.6625; val_kl_reg_loss: 50639.3332; val_edge_recon_loss: 32688230.0556; val_gene_expr_recon_loss: 34733760.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 67472629.7778; val_optim_loss: 67472629.7778
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.8851; val_auprc_score: 0.8821; val_best_acc_score: 0.8016; val_best_f1_score: 0.8087; train_kl_reg_loss: 50479.0830; train_edge_recon_loss: 32103179.5205; train_gene_expr_recon_loss: 35669505.6909; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 67823164.3155; train_optim_loss: 67823164.3155; val_kl_reg_loss: 50645.5637; val_edge_recon_loss: 32720431.0000; val_gene_expr_recon_loss: 33778724.3333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 66549800.5556; val_optim_loss: 66549800.5556
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.8846; val_auprc_score: 0.8825; val_best_acc_score: 0.7996; val_best_f1_score: 0.8101; train_kl_reg_loss: 50522.1549; train_edge_recon_loss: 32108809.2240; train_gene_expr_recon_loss: 34827336.2965; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 66986667.7603; train_optim_loss: 66986667.7603; val_kl_reg_loss: 50707.3619; val_edge_recon_loss: 32696472.5556; val_gene_expr_recon_loss: 33137521.2778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 65884700.7778; val_optim_loss: 65884700.7778
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.8862; val_auprc_score: 0.8858; val_best_acc_score: 0.8004; val_best_f1_score: 0.8081; train_kl_reg_loss: 50539.5011; train_edge_recon_loss: 32099268.5363; train_gene_expr_recon_loss: 33985900.7760; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 66135708.7823; train_optim_loss: 66135708.7823; val_kl_reg_loss: 50622.1172; val_edge_recon_loss: 32710487.4444; val_gene_expr_recon_loss: 32210033.5000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64971143.2222; val_optim_loss: 64971143.2222
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.8861; val_auprc_score: 0.8840; val_best_acc_score: 0.8019; val_best_f1_score: 0.8104; train_kl_reg_loss: 50493.6708; train_edge_recon_loss: 32105182.4164; train_gene_expr_recon_loss: 33286366.4164; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 65442042.3975; train_optim_loss: 65442042.3975; val_kl_reg_loss: 50667.8203; val_edge_recon_loss: 32702950.3333; val_gene_expr_recon_loss: 31754753.6111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64508371.7778; val_optim_loss: 64508371.7778
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.8832; val_auprc_score: 0.8814; val_best_acc_score: 0.7976; val_best_f1_score: 0.8075; train_kl_reg_loss: 50490.8604; train_edge_recon_loss: 32098818.2965; train_gene_expr_recon_loss: 32711004.8580; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 64860313.8423; train_optim_loss: 64860313.8423; val_kl_reg_loss: 50600.7297; val_edge_recon_loss: 32741843.8889; val_gene_expr_recon_loss: 31229417.2778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 64021862.0000; val_optim_loss: 64021862.0000
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.8850; val_auprc_score: 0.8847; val_best_acc_score: 0.7980; val_best_f1_score: 0.8067; train_kl_reg_loss: 50508.5484; train_edge_recon_loss: 32119672.3912; train_gene_expr_recon_loss: 32236794.8265; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 64406975.7224; train_optim_loss: 64406975.7224; val_kl_reg_loss: 50683.1241; val_edge_recon_loss: 32689783.8889; val_gene_expr_recon_loss: 30752348.4444; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63492815.4444; val_optim_loss: 63492815.4444
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.8845; val_auprc_score: 0.8823; val_best_acc_score: 0.8000; val_best_f1_score: 0.8087; train_kl_reg_loss: 50513.0280; train_edge_recon_loss: 32106444.8707; train_gene_expr_recon_loss: 31859931.3691; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 64016889.3628; train_optim_loss: 64016889.3628; val_kl_reg_loss: 50654.6773; val_edge_recon_loss: 32723661.8333; val_gene_expr_recon_loss: 30473427.3889; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 63247743.5556; val_optim_loss: 63247743.5556
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.8828; val_auprc_score: 0.8799; val_best_acc_score: 0.7988; val_best_f1_score: 0.8075; train_kl_reg_loss: 50511.0782; train_edge_recon_loss: 32103909.6845; train_gene_expr_recon_loss: 31513426.8833; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63667847.6467; train_optim_loss: 63667847.6467; val_kl_reg_loss: 50651.6404; val_edge_recon_loss: 32751478.0000; val_gene_expr_recon_loss: 30134775.8333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62936905.6667; val_optim_loss: 62936905.6667
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.8849; val_auprc_score: 0.8828; val_best_acc_score: 0.8010; val_best_f1_score: 0.8083; train_kl_reg_loss: 50500.5626; train_edge_recon_loss: 32110927.0095; train_gene_expr_recon_loss: 31274924.6688; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63436352.1388; train_optim_loss: 63436352.1388; val_kl_reg_loss: 50686.4405; val_edge_recon_loss: 32686679.6111; val_gene_expr_recon_loss: 30009449.5000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62746815.1111; val_optim_loss: 62746815.1111
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.8840; val_auprc_score: 0.8825; val_best_acc_score: 0.7981; val_best_f1_score: 0.8079; train_kl_reg_loss: 50537.8632; train_edge_recon_loss: 32110310.9274; train_gene_expr_recon_loss: 31164174.4732; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63325023.1672; train_optim_loss: 63325023.1672; val_kl_reg_loss: 50649.6715; val_edge_recon_loss: 32719852.5556; val_gene_expr_recon_loss: 29921202.2222; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62691704.0000; val_optim_loss: 62691704.0000
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.8840; val_auprc_score: 0.8826; val_best_acc_score: 0.7998; val_best_f1_score: 0.8084; train_kl_reg_loss: 50487.4770; train_edge_recon_loss: 32107350.2839; train_gene_expr_recon_loss: 30982017.4511; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63139855.1672; train_optim_loss: 63139855.1672; val_kl_reg_loss: 50622.6375; val_edge_recon_loss: 32740862.5000; val_gene_expr_recon_loss: 29723279.8889; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62514764.7778; val_optim_loss: 62514764.7778
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.8825; val_auprc_score: 0.8810; val_best_acc_score: 0.7967; val_best_f1_score: 0.8064; train_kl_reg_loss: 50480.0209; train_edge_recon_loss: 32108637.1420; train_gene_expr_recon_loss: 30889735.9369; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 63048853.0221; train_optim_loss: 63048853.0221; val_kl_reg_loss: 50694.5903; val_edge_recon_loss: 32801297.5000; val_gene_expr_recon_loss: 29812604.7222; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62664596.8889; val_optim_loss: 62664596.8889
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.8828; val_auprc_score: 0.8813; val_best_acc_score: 0.7993; val_best_f1_score: 0.8079; train_kl_reg_loss: 50523.1585; train_edge_recon_loss: 32120981.2681; train_gene_expr_recon_loss: 30769332.5552; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62940837.0221; train_optim_loss: 62940837.0221; val_kl_reg_loss: 50752.8990; val_edge_recon_loss: 32787286.1111; val_gene_expr_recon_loss: 29690554.3889; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62528594.0000; val_optim_loss: 62528594.0000
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.8835; val_auprc_score: 0.8817; val_best_acc_score: 0.7994; val_best_f1_score: 0.8083; train_kl_reg_loss: 50492.6420; train_edge_recon_loss: 32119342.9590; train_gene_expr_recon_loss: 30731712.9653; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62901548.7066; train_optim_loss: 62901548.7066; val_kl_reg_loss: 50776.0265; val_edge_recon_loss: 32723470.6111; val_gene_expr_recon_loss: 29469413.9444; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62243660.6667; val_optim_loss: 62243660.6667
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.8836; val_auprc_score: 0.8820; val_best_acc_score: 0.7980; val_best_f1_score: 0.8088; train_kl_reg_loss: 50472.9834; train_edge_recon_loss: 32124665.7539; train_gene_expr_recon_loss: 30598245.6404; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62773384.3533; train_optim_loss: 62773384.3533; val_kl_reg_loss: 50665.0437; val_edge_recon_loss: 32756045.1667; val_gene_expr_recon_loss: 29420322.8333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62227032.6667; val_optim_loss: 62227032.6667
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.8856; val_auprc_score: 0.8832; val_best_acc_score: 0.8008; val_best_f1_score: 0.8097; train_kl_reg_loss: 50514.7678; train_edge_recon_loss: 32121690.5174; train_gene_expr_recon_loss: 30603851.0473; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62776056.2776; train_optim_loss: 62776056.2776; val_kl_reg_loss: 50673.4791; val_edge_recon_loss: 32713866.3333; val_gene_expr_recon_loss: 29582817.5000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62347357.3333; val_optim_loss: 62347357.3333
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.8833; val_auprc_score: 0.8817; val_best_acc_score: 0.7998; val_best_f1_score: 0.8078; train_kl_reg_loss: 50481.2935; train_edge_recon_loss: 32096480.2082; train_gene_expr_recon_loss: 30524437.2366; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62671398.6877; train_optim_loss: 62671398.6877; val_kl_reg_loss: 50538.5038; val_edge_recon_loss: 32726719.1667; val_gene_expr_recon_loss: 29395537.1667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62172795.2222; val_optim_loss: 62172795.2222
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.8857; val_auprc_score: 0.8847; val_best_acc_score: 0.8018; val_best_f1_score: 0.8106; train_kl_reg_loss: 50490.5163; train_edge_recon_loss: 32126373.5016; train_gene_expr_recon_loss: 30458519.3502; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62635383.4322; train_optim_loss: 62635383.4322; val_kl_reg_loss: 50657.6814; val_edge_recon_loss: 32725339.6111; val_gene_expr_recon_loss: 29350102.2778; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62126099.6667; val_optim_loss: 62126099.6667
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.8816; val_auprc_score: 0.8787; val_best_acc_score: 0.7957; val_best_f1_score: 0.8057; train_kl_reg_loss: 50480.5376; train_edge_recon_loss: 32111181.2934; train_gene_expr_recon_loss: 30438244.9842; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 62599906.9527; train_optim_loss: 62599906.9527; val_kl_reg_loss: 50778.3808; val_edge_recon_loss: 32753498.2222; val_gene_expr_recon_loss: 29334105.5556; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 62138382.4444; val_optim_loss: 62138382.4444
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.8843; val_auprc_score: 0.8798; val_best_acc_score: 0.8003; val_best_f1_score: 0.8102; train_kl_reg_loss: 50509.6286; train_edge_recon_loss: 32274742.9653; train_gene_expr_recon_loss: 29647483.1924; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61972735.6341; train_optim_loss: 61972735.6341; val_kl_reg_loss: 45035.2460; val_edge_recon_loss: 32941678.0000; val_gene_expr_recon_loss: 28478931.1667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61465644.4444; val_optim_loss: 61465644.4444
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.8826; val_auprc_score: 0.8784; val_best_acc_score: 0.7981; val_best_f1_score: 0.8089; train_kl_reg_loss: 50542.7494; train_edge_recon_loss: 32269712.3407; train_gene_expr_recon_loss: 29505999.7792; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61826254.9527; train_optim_loss: 61826254.9527; val_kl_reg_loss: 45050.2097; val_edge_recon_loss: 32933227.8889; val_gene_expr_recon_loss: 28272665.2222; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61250943.0000; val_optim_loss: 61250943.0000
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.8834; val_auprc_score: 0.8805; val_best_acc_score: 0.7993; val_best_f1_score: 0.8091; train_kl_reg_loss: 50490.0990; train_edge_recon_loss: 32268288.8202; train_gene_expr_recon_loss: 29519125.4890; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61837904.3912; train_optim_loss: 61837904.3912; val_kl_reg_loss: 45098.6585; val_edge_recon_loss: 32967031.1667; val_gene_expr_recon_loss: 28346877.8889; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61359007.1111; val_optim_loss: 61359007.1111
Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.8834; val_auprc_score: 0.8781; val_best_acc_score: 0.7999; val_best_f1_score: 0.8104; train_kl_reg_loss: 50508.0766; train_edge_recon_loss: 32266613.6467; train_gene_expr_recon_loss: 29451760.4984; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61768882.2461; train_optim_loss: 61768882.2461; val_kl_reg_loss: 45094.5735; val_edge_recon_loss: 32935794.0556; val_gene_expr_recon_loss: 28331057.1667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61311946.5556; val_optim_loss: 61311946.5556
Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.8815; val_auprc_score: 0.8773; val_best_acc_score: 0.7977; val_best_f1_score: 0.8077; train_kl_reg_loss: 50506.6346; train_edge_recon_loss: 32284277.9369; train_gene_expr_recon_loss: 29473423.7918; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61808208.4164; train_optim_loss: 61808208.4164; val_kl_reg_loss: 45101.3549; val_edge_recon_loss: 33026979.4444; val_gene_expr_recon_loss: 28378991.5000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61451072.3333; val_optim_loss: 61451072.3333
Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.8829; val_auprc_score: 0.8803; val_best_acc_score: 0.7978; val_best_f1_score: 0.8087; train_kl_reg_loss: 50500.7832; train_edge_recon_loss: 32286491.8801; train_gene_expr_recon_loss: 29380954.0063; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61717946.6751; train_optim_loss: 61717946.6751; val_kl_reg_loss: 45046.8493; val_edge_recon_loss: 32985412.1111; val_gene_expr_recon_loss: 28314120.8333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61344579.3333; val_optim_loss: 61344579.3333

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.8792; val_auprc_score: 0.8749; val_best_acc_score: 0.7935; val_best_f1_score: 0.8052; train_kl_reg_loss: 50499.9523; train_edge_recon_loss: 32261086.3596; train_gene_expr_recon_loss: 29443516.0442; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61755102.4732; train_optim_loss: 61755102.4732; val_kl_reg_loss: 45050.3900; val_edge_recon_loss: 33028930.7222; val_gene_expr_recon_loss: 28378077.1111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61452058.6667; val_optim_loss: 61452058.6667
Epoch 33/400 |█-------------------| 8.2% val_auroc_score: 0.8833; val_auprc_score: 0.8785; val_best_acc_score: 0.7986; val_best_f1_score: 0.8099; train_kl_reg_loss: 50521.0365; train_edge_recon_loss: 32263444.8328; train_gene_expr_recon_loss: 29409447.5457; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61723413.4763; train_optim_loss: 61723413.4763; val_kl_reg_loss: 45119.3078; val_edge_recon_loss: 32959170.9444; val_gene_expr_recon_loss: 28321230.8889; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61325521.2222; val_optim_loss: 61325521.2222
Epoch 34/400 |█-------------------| 8.5% val_auroc_score: 0.8841; val_auprc_score: 0.8799; val_best_acc_score: 0.7994; val_best_f1_score: 0.8104; train_kl_reg_loss: 50507.0204; train_edge_recon_loss: 32273891.1672; train_gene_expr_recon_loss: 29390719.9369; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61715118.2334; train_optim_loss: 61715118.2334; val_kl_reg_loss: 45034.0955; val_edge_recon_loss: 32937807.7778; val_gene_expr_recon_loss: 28356414.5556; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61339256.2222; val_optim_loss: 61339256.2222
Epoch 35/400 |█-------------------| 8.8% val_auroc_score: 0.8831; val_auprc_score: 0.8789; val_best_acc_score: 0.7987; val_best_f1_score: 0.8104; train_kl_reg_loss: 50497.3762; train_edge_recon_loss: 32268964.1262; train_gene_expr_recon_loss: 29438118.2902; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 61757579.8360; train_optim_loss: 61757579.8360; val_kl_reg_loss: 45091.3604; val_edge_recon_loss: 32929891.0000; val_gene_expr_recon_loss: 28351677.5000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 61326660.1111; val_optim_loss: 61326660.1111

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 38 min 35 sec.
Using best model state, which was in epoch 27.

--- MODEL EVALUATION ---
val AUROC score: 0.8843
val AUPRC score: 0.8807
val best accuracy score: 0.7999
val best F1 score: 0.8102
val target rna MSE score: 21.3898
val source rna MSE score: 0.9468
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0133
Val cat covariate2 mean sim diff: nan

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
