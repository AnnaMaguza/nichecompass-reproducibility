Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch3', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '19102023_172844_43', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 82522
Number of validation nodes: 9169
Number of training edges: 195815
Number of validation edges: 21757
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9387; val_auprc_score: 0.9298; val_best_acc_score: 0.8681; val_best_f1_score: 0.8744; train_kl_reg_loss: 70801.9635; train_edge_recon_loss: 27074290.4856; train_gene_expr_recon_loss: 20312637.5822; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 47457730.0157; train_optim_loss: 47457730.0157; val_kl_reg_loss: 70825.7233; val_edge_recon_loss: 27991831.9535; val_gene_expr_recon_loss: 20064077.3953; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 48126734.6047; val_optim_loss: 48126734.6047
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9376; val_auprc_score: 0.9284; val_best_acc_score: 0.8669; val_best_f1_score: 0.8728; train_kl_reg_loss: 70778.4124; train_edge_recon_loss: 27058843.7807; train_gene_expr_recon_loss: 19916639.8068; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 47046262.0783; train_optim_loss: 47046262.0783; val_kl_reg_loss: 71079.9117; val_edge_recon_loss: 28054016.0000; val_gene_expr_recon_loss: 19856847.3023; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47981942.7907; val_optim_loss: 47981942.7907
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9387; val_auprc_score: 0.9298; val_best_acc_score: 0.8683; val_best_f1_score: 0.8732; train_kl_reg_loss: 70791.2556; train_edge_recon_loss: 27083583.6710; train_gene_expr_recon_loss: 19780639.7389; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46935014.5274; train_optim_loss: 46935014.5274; val_kl_reg_loss: 70941.8721; val_edge_recon_loss: 28006927.2558; val_gene_expr_recon_loss: 19766352.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47844221.1163; val_optim_loss: 47844221.1163
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9398; val_auprc_score: 0.9313; val_best_acc_score: 0.8699; val_best_f1_score: 0.8758; train_kl_reg_loss: 70769.7846; train_edge_recon_loss: 27059122.2715; train_gene_expr_recon_loss: 19730096.9347; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46859989.0548; train_optim_loss: 46859989.0548; val_kl_reg_loss: 70882.2811; val_edge_recon_loss: 27966548.7907; val_gene_expr_recon_loss: 19742370.3721; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47779801.3023; val_optim_loss: 47779801.3023
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9380; val_auprc_score: 0.9300; val_best_acc_score: 0.8664; val_best_f1_score: 0.8723; train_kl_reg_loss: 70792.6484; train_edge_recon_loss: 27075857.7023; train_gene_expr_recon_loss: 19694327.4099; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46840977.7859; train_optim_loss: 46840977.7859; val_kl_reg_loss: 70961.2495; val_edge_recon_loss: 28049781.6744; val_gene_expr_recon_loss: 19748135.0233; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47868877.8605; val_optim_loss: 47868877.8605
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9383; val_auprc_score: 0.9296; val_best_acc_score: 0.8670; val_best_f1_score: 0.8721; train_kl_reg_loss: 70766.6470; train_edge_recon_loss: 27038877.9269; train_gene_expr_recon_loss: 19650042.9974; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46759687.5405; train_optim_loss: 46759687.5405; val_kl_reg_loss: 70939.2851; val_edge_recon_loss: 28046706.9767; val_gene_expr_recon_loss: 19743934.4651; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47861581.2093; val_optim_loss: 47861581.2093
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9382; val_auprc_score: 0.9298; val_best_acc_score: 0.8661; val_best_f1_score: 0.8724; train_kl_reg_loss: 70811.4118; train_edge_recon_loss: 27072165.4360; train_gene_expr_recon_loss: 19659006.8825; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46801983.7598; train_optim_loss: 46801983.7598; val_kl_reg_loss: 70970.0581; val_edge_recon_loss: 28059716.0465; val_gene_expr_recon_loss: 19720963.8140; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47851650.0465; val_optim_loss: 47851650.0465
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9381; val_auprc_score: 0.9298; val_best_acc_score: 0.8659; val_best_f1_score: 0.8719; train_kl_reg_loss: 70799.6909; train_edge_recon_loss: 27064144.6057; train_gene_expr_recon_loss: 19637201.2689; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46772145.7650; train_optim_loss: 46772145.7650; val_kl_reg_loss: 70884.2507; val_edge_recon_loss: 28062387.8605; val_gene_expr_recon_loss: 19620524.7907; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47753796.8372; val_optim_loss: 47753796.8372
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9378; val_auprc_score: 0.9294; val_best_acc_score: 0.8655; val_best_f1_score: 0.8726; train_kl_reg_loss: 70779.9150; train_edge_recon_loss: 27054265.6136; train_gene_expr_recon_loss: 19634217.0705; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46759262.5796; train_optim_loss: 46759262.5796; val_kl_reg_loss: 70893.3218; val_edge_recon_loss: 28031746.5116; val_gene_expr_recon_loss: 19635133.7209; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47737773.8605; val_optim_loss: 47737773.8605
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9387; val_auprc_score: 0.9305; val_best_acc_score: 0.8687; val_best_f1_score: 0.8740; train_kl_reg_loss: 70786.5667; train_edge_recon_loss: 27059024.0157; train_gene_expr_recon_loss: 19629110.1044; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46758920.7102; train_optim_loss: 46758920.7102; val_kl_reg_loss: 70882.7158; val_edge_recon_loss: 28027593.8140; val_gene_expr_recon_loss: 19666867.5349; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47765344.5581; val_optim_loss: 47765344.5581
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9393; val_auprc_score: 0.9312; val_best_acc_score: 0.8687; val_best_f1_score: 0.8741; train_kl_reg_loss: 70778.9370; train_edge_recon_loss: 27070127.2428; train_gene_expr_recon_loss: 19606017.9948; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46746924.1358; train_optim_loss: 46746924.1358; val_kl_reg_loss: 70932.2851; val_edge_recon_loss: 28006788.1395; val_gene_expr_recon_loss: 19642261.2093; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47719981.5814; val_optim_loss: 47719981.5814
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9377; val_auprc_score: 0.9281; val_best_acc_score: 0.8687; val_best_f1_score: 0.8745; train_kl_reg_loss: 70780.3665; train_edge_recon_loss: 27070462.0836; train_gene_expr_recon_loss: 19616028.3499; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46757270.7990; train_optim_loss: 46757270.7990; val_kl_reg_loss: 70952.4132; val_edge_recon_loss: 28026061.0698; val_gene_expr_recon_loss: 19653929.9070; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47750943.3488; val_optim_loss: 47750943.3488
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9374; val_auprc_score: 0.9287; val_best_acc_score: 0.8660; val_best_f1_score: 0.8714; train_kl_reg_loss: 70764.1355; train_edge_recon_loss: 27086406.9869; train_gene_expr_recon_loss: 19611948.6789; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46769119.8538; train_optim_loss: 46769119.8538; val_kl_reg_loss: 70957.1077; val_edge_recon_loss: 28053920.1860; val_gene_expr_recon_loss: 19623394.3256; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47748271.2558; val_optim_loss: 47748271.2558
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9382; val_auprc_score: 0.9298; val_best_acc_score: 0.8664; val_best_f1_score: 0.8722; train_kl_reg_loss: 70757.6432; train_edge_recon_loss: 27074868.7050; train_gene_expr_recon_loss: 19606001.7076; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46751628.1567; train_optim_loss: 46751628.1567; val_kl_reg_loss: 70965.0968; val_edge_recon_loss: 28043997.8605; val_gene_expr_recon_loss: 19600901.4419; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47715864.5581; val_optim_loss: 47715864.5581
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9378; val_auprc_score: 0.9298; val_best_acc_score: 0.8659; val_best_f1_score: 0.8723; train_kl_reg_loss: 70796.9356; train_edge_recon_loss: 27062581.1645; train_gene_expr_recon_loss: 19614680.1984; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46748058.2663; train_optim_loss: 46748058.2663; val_kl_reg_loss: 70816.8970; val_edge_recon_loss: 28046258.3256; val_gene_expr_recon_loss: 19607435.7674; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47724511.2558; val_optim_loss: 47724511.2558
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9367; val_auprc_score: 0.9291; val_best_acc_score: 0.8651; val_best_f1_score: 0.8707; train_kl_reg_loss: 70754.7800; train_edge_recon_loss: 27045475.3681; train_gene_expr_recon_loss: 19602210.4648; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46718440.6162; train_optim_loss: 46718440.6162; val_kl_reg_loss: 70825.9508; val_edge_recon_loss: 28089463.6279; val_gene_expr_recon_loss: 19588533.6744; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47748823.5349; val_optim_loss: 47748823.5349
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9366; val_auprc_score: 0.9272; val_best_acc_score: 0.8660; val_best_f1_score: 0.8728; train_kl_reg_loss: 70748.4657; train_edge_recon_loss: 27059586.7833; train_gene_expr_recon_loss: 19593773.8851; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46724109.1802; train_optim_loss: 46724109.1802; val_kl_reg_loss: 70814.6297; val_edge_recon_loss: 28077016.9302; val_gene_expr_recon_loss: 19641079.1628; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47788910.6977; val_optim_loss: 47788910.6977
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.9384; val_auprc_score: 0.9308; val_best_acc_score: 0.8666; val_best_f1_score: 0.8719; train_kl_reg_loss: 70788.0912; train_edge_recon_loss: 27063765.0757; train_gene_expr_recon_loss: 19610445.3211; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46744998.5065; train_optim_loss: 46744998.5065; val_kl_reg_loss: 70907.6074; val_edge_recon_loss: 28056806.5116; val_gene_expr_recon_loss: 19611068.7442; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47738782.8837; val_optim_loss: 47738782.8837

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.9399; val_auprc_score: 0.9326; val_best_acc_score: 0.8683; val_best_f1_score: 0.8751; train_kl_reg_loss: 70783.1169; train_edge_recon_loss: 27068522.6266; train_gene_expr_recon_loss: 19591193.9217; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46730499.5196; train_optim_loss: 46730499.5196; val_kl_reg_loss: 70888.1830; val_edge_recon_loss: 27983604.9767; val_gene_expr_recon_loss: 19659730.0930; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47714223.0698; val_optim_loss: 47714223.0698
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.9370; val_auprc_score: 0.9278; val_best_acc_score: 0.8655; val_best_f1_score: 0.8719; train_kl_reg_loss: 70775.6588; train_edge_recon_loss: 27057979.3943; train_gene_expr_recon_loss: 19584737.1906; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46713492.1358; train_optim_loss: 46713492.1358; val_kl_reg_loss: 70965.5521; val_edge_recon_loss: 28068445.0233; val_gene_expr_recon_loss: 19633928.6512; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47773339.3488; val_optim_loss: 47773339.3488
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.9380; val_auprc_score: 0.9297; val_best_acc_score: 0.8671; val_best_f1_score: 0.8725; train_kl_reg_loss: 70775.0146; train_edge_recon_loss: 27048972.3446; train_gene_expr_recon_loss: 19602271.3159; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46722018.7258; train_optim_loss: 46722018.7258; val_kl_reg_loss: 70924.0967; val_edge_recon_loss: 28062158.3256; val_gene_expr_recon_loss: 19624580.8372; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47757663.3488; val_optim_loss: 47757663.3488
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.9391; val_auprc_score: 0.9309; val_best_acc_score: 0.8679; val_best_f1_score: 0.8728; train_kl_reg_loss: 70754.7123; train_edge_recon_loss: 27070189.0601; train_gene_expr_recon_loss: 19608794.0522; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46749737.8172; train_optim_loss: 46749737.8172; val_kl_reg_loss: 71007.8532; val_edge_recon_loss: 28036336.0465; val_gene_expr_recon_loss: 19622949.7674; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47730293.8605; val_optim_loss: 47730293.8605
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.9373; val_auprc_score: 0.9281; val_best_acc_score: 0.8655; val_best_f1_score: 0.8712; train_kl_reg_loss: 70833.4792; train_edge_recon_loss: 27078351.4987; train_gene_expr_recon_loss: 19608447.8277; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46757632.7415; train_optim_loss: 46757632.7415; val_kl_reg_loss: 70940.4515; val_edge_recon_loss: 28072772.7442; val_gene_expr_recon_loss: 19671376.5581; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47815089.7674; val_optim_loss: 47815089.7674

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.9382; val_auprc_score: 0.9300; val_best_acc_score: 0.8671; val_best_f1_score: 0.8728; train_kl_reg_loss: 70784.0612; train_edge_recon_loss: 27070345.5144; train_gene_expr_recon_loss: 19585847.9896; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46726977.6084; train_optim_loss: 46726977.6084; val_kl_reg_loss: 70939.2640; val_edge_recon_loss: 28019289.1163; val_gene_expr_recon_loss: 19600712.1860; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47690940.6512; val_optim_loss: 47690940.6512
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.9399; val_auprc_score: 0.9321; val_best_acc_score: 0.8702; val_best_f1_score: 0.8749; train_kl_reg_loss: 70795.4846; train_edge_recon_loss: 27069425.3577; train_gene_expr_recon_loss: 19597244.4282; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46737465.2533; train_optim_loss: 46737465.2533; val_kl_reg_loss: 70919.1421; val_edge_recon_loss: 27960726.9302; val_gene_expr_recon_loss: 19659308.1395; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47690954.0465; val_optim_loss: 47690954.0465
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.9369; val_auprc_score: 0.9272; val_best_acc_score: 0.8662; val_best_f1_score: 0.8715; train_kl_reg_loss: 70784.5303; train_edge_recon_loss: 27214536.1044; train_gene_expr_recon_loss: 21056446.9295; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 48341767.6658; train_optim_loss: 48341767.6658; val_kl_reg_loss: 50702.6979; val_edge_recon_loss: 28148479.8140; val_gene_expr_recon_loss: 21077837.9070; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 49277020.6512; val_optim_loss: 49277020.6512
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.9369; val_auprc_score: 0.9273; val_best_acc_score: 0.8664; val_best_f1_score: 0.8719; train_kl_reg_loss: 70752.8850; train_edge_recon_loss: 27200208.0209; train_gene_expr_recon_loss: 21093280.4595; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 48364241.3786; train_optim_loss: 48364241.3786; val_kl_reg_loss: 50749.7364; val_edge_recon_loss: 28134955.4419; val_gene_expr_recon_loss: 21154379.3023; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 49340084.6512; val_optim_loss: 49340084.6512
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.9365; val_auprc_score: 0.9279; val_best_acc_score: 0.8659; val_best_f1_score: 0.8711; train_kl_reg_loss: 70716.9980; train_edge_recon_loss: 27174768.1462; train_gene_expr_recon_loss: 21077725.3629; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 48323210.4334; train_optim_loss: 48323210.4334; val_kl_reg_loss: 50804.1950; val_edge_recon_loss: 28122805.3488; val_gene_expr_recon_loss: 21121401.7209; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 49295011.6279; val_optim_loss: 49295011.6279

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1.0000000000000002e-06.

Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.9360; val_auprc_score: 0.9254; val_best_acc_score: 0.8659; val_best_f1_score: 0.8718; train_kl_reg_loss: 70777.2802; train_edge_recon_loss: 27207005.3003; train_gene_expr_recon_loss: 21112009.1645; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 48389791.9060; train_optim_loss: 48389791.9060; val_kl_reg_loss: 50900.3881; val_edge_recon_loss: 28133936.3721; val_gene_expr_recon_loss: 21192487.3023; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 49377323.9070; val_optim_loss: 49377323.9070
Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.9346; val_auprc_score: 0.9242; val_best_acc_score: 0.8628; val_best_f1_score: 0.8692; train_kl_reg_loss: 70793.5165; train_edge_recon_loss: 27185987.5457; train_gene_expr_recon_loss: 21114208.5953; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 48370989.6919; train_optim_loss: 48370989.6919; val_kl_reg_loss: 50767.9965; val_edge_recon_loss: 28208452.6512; val_gene_expr_recon_loss: 21155836.4186; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 49415057.0233; val_optim_loss: 49415057.0233
Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.9369; val_auprc_score: 0.9277; val_best_acc_score: 0.8665; val_best_f1_score: 0.8711; train_kl_reg_loss: 70759.8427; train_edge_recon_loss: 27194492.9243; train_gene_expr_recon_loss: 21124961.0809; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 48390213.8277; train_optim_loss: 48390213.8277; val_kl_reg_loss: 50732.1364; val_edge_recon_loss: 28129734.3256; val_gene_expr_recon_loss: 21165451.0233; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 49345917.3953; val_optim_loss: 49345917.3953
Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.9365; val_auprc_score: 0.9264; val_best_acc_score: 0.8658; val_best_f1_score: 0.8713; train_kl_reg_loss: 70795.9770; train_edge_recon_loss: 27181727.2794; train_gene_expr_recon_loss: 21110248.4752; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 48362771.7076; train_optim_loss: 48362771.7076; val_kl_reg_loss: 50750.5723; val_edge_recon_loss: 28119226.4186; val_gene_expr_recon_loss: 21155257.7209; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 49325234.6977; val_optim_loss: 49325234.6977

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 37 min 37 sec.
Using best model state, which was in epoch 24.

--- MODEL EVALUATION ---
val AUROC score: 0.9358
val AUPRC score: 0.9257
val best accuracy score: 0.8654
val best F1 score: 0.8717
val target rna MSE score: 1.4858
val source rna MSE score: 0.3330
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0623
Val cat covariate2 mean sim diff: nan

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
