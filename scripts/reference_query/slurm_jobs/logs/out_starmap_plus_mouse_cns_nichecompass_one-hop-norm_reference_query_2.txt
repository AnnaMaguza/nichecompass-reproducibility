[True]
Run timestamp: 07072023_185811_2.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'starmap_plus_mouse_cns', '--reference_batches', 'batch1', 'batch2', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '0.1', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference_query_reference_only', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000.', '--lambda_gene_expr_recon', '300.', '--lambda_cat_covariates_contrastive', '250000.0', '--contrastive_logits_pos_ratio', '0.03125', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--edge_batch_size', '1024', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_2']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ENCODER -> n_input: 1022, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 1022, n_latent: 1423, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1423, n_cat_covariates_embed_input: 3, n_addon_input: 0, n_output: 2044
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 193574
Number of validation nodes: 21508
Number of training edges: 1323311
Number of validation edges: 147034
Edge batch size: 1024
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9626; val_auprc_score: 0.9706; val_best_acc_score: 0.9530; val_best_f1_score: 0.9654; train_kl_reg_loss: 6304.7968; train_edge_recon_loss: 182746.7424; train_cat_covariates_contrastive_loss: 79722.6233; train_gene_expr_recon_loss: 104553.8532; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 373328.0157; train_optim_loss: 373328.0157; val_kl_reg_loss: 5864.6176; val_edge_recon_loss: 175358.8672; val_cat_covariates_contrastive_loss: 78752.7016; val_gene_expr_recon_loss: 93708.6963; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 353684.8835; val_optim_loss: 353684.8835
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9644; val_auprc_score: 0.9696; val_best_acc_score: 0.9602; val_best_f1_score: 0.9706; train_kl_reg_loss: 5933.7582; train_edge_recon_loss: 175837.5225; train_cat_covariates_contrastive_loss: 79034.2729; train_gene_expr_recon_loss: 92071.8295; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 352877.3838; train_optim_loss: 352877.3838; val_kl_reg_loss: 5861.3189; val_edge_recon_loss: 175031.8387; val_cat_covariates_contrastive_loss: 78697.5405; val_gene_expr_recon_loss: 90511.1283; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 350101.8260; val_optim_loss: 350101.8260
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9642; val_auprc_score: 0.9685; val_best_acc_score: 0.9628; val_best_f1_score: 0.9725; train_kl_reg_loss: 5898.7961; train_edge_recon_loss: 175290.5686; train_cat_covariates_contrastive_loss: 78974.0105; train_gene_expr_recon_loss: 89996.9024; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 350160.2776; train_optim_loss: 350160.2776; val_kl_reg_loss: 5874.7652; val_edge_recon_loss: 174665.1313; val_cat_covariates_contrastive_loss: 78620.6146; val_gene_expr_recon_loss: 89262.4092; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 348422.9212; val_optim_loss: 348422.9212
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9652; val_auprc_score: 0.9694; val_best_acc_score: 0.9644; val_best_f1_score: 0.9736; train_kl_reg_loss: 5907.5944; train_edge_recon_loss: 175127.9294; train_cat_covariates_contrastive_loss: 78972.7026; train_gene_expr_recon_loss: 89067.2550; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 349075.4817; train_optim_loss: 349075.4817; val_kl_reg_loss: 5678.2181; val_edge_recon_loss: 174389.6143; val_cat_covariates_contrastive_loss: 78677.9946; val_gene_expr_recon_loss: 88488.0434; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 347233.8717; val_optim_loss: 347233.8717
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9643; val_auprc_score: 0.9678; val_best_acc_score: 0.9661; val_best_f1_score: 0.9749; train_kl_reg_loss: 5925.7742; train_edge_recon_loss: 174891.8722; train_cat_covariates_contrastive_loss: 78970.5320; train_gene_expr_recon_loss: 88478.6110; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 348266.7894; train_optim_loss: 348266.7894; val_kl_reg_loss: 5890.1835; val_edge_recon_loss: 174057.7179; val_cat_covariates_contrastive_loss: 78648.1214; val_gene_expr_recon_loss: 88238.5556; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 346834.5788; val_optim_loss: 346834.5788
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9637; val_auprc_score: 0.9673; val_best_acc_score: 0.9663; val_best_f1_score: 0.9750; train_kl_reg_loss: 5942.9091; train_edge_recon_loss: 174676.3070; train_cat_covariates_contrastive_loss: 78983.7410; train_gene_expr_recon_loss: 88041.3891; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 347644.3455; train_optim_loss: 347644.3455; val_kl_reg_loss: 5989.3528; val_edge_recon_loss: 174749.0463; val_cat_covariates_contrastive_loss: 78632.6430; val_gene_expr_recon_loss: 87757.0862; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 347128.1278; val_optim_loss: 347128.1278
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9639; val_auprc_score: 0.9680; val_best_acc_score: 0.9663; val_best_f1_score: 0.9750; train_kl_reg_loss: 5970.8755; train_edge_recon_loss: 174795.3343; train_cat_covariates_contrastive_loss: 78975.2278; train_gene_expr_recon_loss: 87815.4636; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 347556.9009; train_optim_loss: 347556.9009; val_kl_reg_loss: 5798.4383; val_edge_recon_loss: 174344.1991; val_cat_covariates_contrastive_loss: 78661.1175; val_gene_expr_recon_loss: 87720.4979; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 346524.2513; val_optim_loss: 346524.2513
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9642; val_auprc_score: 0.9684; val_best_acc_score: 0.9673; val_best_f1_score: 0.9757; train_kl_reg_loss: 5992.7675; train_edge_recon_loss: 174777.0067; train_cat_covariates_contrastive_loss: 78978.1940; train_gene_expr_recon_loss: 87508.1501; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 347256.1183; train_optim_loss: 347256.1183; val_kl_reg_loss: 5872.0207; val_edge_recon_loss: 174323.8716; val_cat_covariates_contrastive_loss: 78680.1738; val_gene_expr_recon_loss: 87532.6447; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 346408.7109; val_optim_loss: 346408.7109
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9666; val_auprc_score: 0.9707; val_best_acc_score: 0.9677; val_best_f1_score: 0.9761; train_kl_reg_loss: 6017.8359; train_edge_recon_loss: 174736.9762; train_cat_covariates_contrastive_loss: 78982.2516; train_gene_expr_recon_loss: 87311.3300; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 347048.3937; train_optim_loss: 347048.3937; val_kl_reg_loss: 5886.8710; val_edge_recon_loss: 173368.7549; val_cat_covariates_contrastive_loss: 78762.6933; val_gene_expr_recon_loss: 87357.7374; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 345376.0579; val_optim_loss: 345376.0579
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9672; val_auprc_score: 0.9708; val_best_acc_score: 0.9682; val_best_f1_score: 0.9764; train_kl_reg_loss: 6038.8684; train_edge_recon_loss: 174471.1426; train_cat_covariates_contrastive_loss: 78970.6560; train_gene_expr_recon_loss: 87131.3746; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 346612.0417; train_optim_loss: 346612.0417; val_kl_reg_loss: 6134.6114; val_edge_recon_loss: 174169.6248; val_cat_covariates_contrastive_loss: 78747.9141; val_gene_expr_recon_loss: 87217.5891; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 346269.7391; val_optim_loss: 346269.7391
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9657; val_auprc_score: 0.9690; val_best_acc_score: 0.9684; val_best_f1_score: 0.9766; train_kl_reg_loss: 6064.1396; train_edge_recon_loss: 174634.3708; train_cat_covariates_contrastive_loss: 78971.6729; train_gene_expr_recon_loss: 87023.9327; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 346694.1157; train_optim_loss: 346694.1157; val_kl_reg_loss: 6005.1141; val_edge_recon_loss: 173677.8822; val_cat_covariates_contrastive_loss: 78698.6906; val_gene_expr_recon_loss: 87210.3427; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 345592.0291; val_optim_loss: 345592.0291
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9647; val_auprc_score: 0.9678; val_best_acc_score: 0.9685; val_best_f1_score: 0.9766; train_kl_reg_loss: 6082.6107; train_edge_recon_loss: 174791.0346; train_cat_covariates_contrastive_loss: 78985.4264; train_gene_expr_recon_loss: 86888.9289; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 346748.0003; train_optim_loss: 346748.0003; val_kl_reg_loss: 5966.1410; val_edge_recon_loss: 174127.7477; val_cat_covariates_contrastive_loss: 78771.6459; val_gene_expr_recon_loss: 87317.5982; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 346183.1339; val_optim_loss: 346183.1339
