Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc_modified', '--query_batches', 'batch3', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '31082023_080508_3', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 33, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 82522
Number of validation nodes: 9169
Number of training edges: 195815
Number of validation edges: 21757
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9336; val_auprc_score: 0.8985; val_best_acc_score: 0.8859; val_best_f1_score: 0.8907; train_kl_reg_loss: 23256.6291; train_edge_recon_loss: 2662638.8166; train_gene_expr_recon_loss: 2636059.9537; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5321955.3812; train_optim_loss: 5321955.3812; val_kl_reg_loss: 23278.5837; val_edge_recon_loss: 2707296.4942; val_gene_expr_recon_loss: 2062264.8517; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4792839.9767; val_optim_loss: 4792839.9767
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9330; val_auprc_score: 0.8975; val_best_acc_score: 0.8830; val_best_f1_score: 0.8889; train_kl_reg_loss: 23250.0592; train_edge_recon_loss: 2661930.6044; train_gene_expr_recon_loss: 1881300.1106; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4566480.7598; train_optim_loss: 4566480.7598; val_kl_reg_loss: 23284.3693; val_edge_recon_loss: 2715400.5988; val_gene_expr_recon_loss: 1791152.5814; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4529837.5465; val_optim_loss: 4529837.5465
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9343; val_auprc_score: 0.9008; val_best_acc_score: 0.8866; val_best_f1_score: 0.8916; train_kl_reg_loss: 23244.0854; train_edge_recon_loss: 2665699.1201; train_gene_expr_recon_loss: 1777676.6230; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4466619.8146; train_optim_loss: 4466619.8146; val_kl_reg_loss: 23300.8470; val_edge_recon_loss: 2709812.5814; val_gene_expr_recon_loss: 1768979.0465; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4502092.4535; val_optim_loss: 4502092.4535
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9317; val_auprc_score: 0.8971; val_best_acc_score: 0.8833; val_best_f1_score: 0.8890; train_kl_reg_loss: 23248.1821; train_edge_recon_loss: 2661992.1181; train_gene_expr_recon_loss: 1765533.8084; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4450774.1136; train_optim_loss: 4450774.1136; val_kl_reg_loss: 23303.4636; val_edge_recon_loss: 2716166.8547; val_gene_expr_recon_loss: 1757284.4012; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4496754.6744; val_optim_loss: 4496754.6744
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9327; val_auprc_score: 0.8981; val_best_acc_score: 0.8825; val_best_f1_score: 0.8886; train_kl_reg_loss: 23250.7681; train_edge_recon_loss: 2663184.2879; train_gene_expr_recon_loss: 1754873.0042; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4441308.0640; train_optim_loss: 4441308.0640; val_kl_reg_loss: 23274.1119; val_edge_recon_loss: 2718763.0407; val_gene_expr_recon_loss: 1748888.2674; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4490925.4186; val_optim_loss: 4490925.4186
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9315; val_auprc_score: 0.8954; val_best_acc_score: 0.8829; val_best_f1_score: 0.8885; train_kl_reg_loss: 23244.9574; train_edge_recon_loss: 2665160.3649; train_gene_expr_recon_loss: 1745609.7663; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4434015.0849; train_optim_loss: 4434015.0849; val_kl_reg_loss: 23279.2608; val_edge_recon_loss: 2717428.0814; val_gene_expr_recon_loss: 1737541.7384; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4478249.0698; val_optim_loss: 4478249.0698
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9314; val_auprc_score: 0.8956; val_best_acc_score: 0.8837; val_best_f1_score: 0.8891; train_kl_reg_loss: 23255.0596; train_edge_recon_loss: 2663223.6227; train_gene_expr_recon_loss: 1738403.3606; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4424882.0561; train_optim_loss: 4424882.0561; val_kl_reg_loss: 23280.8631; val_edge_recon_loss: 2715679.6163; val_gene_expr_recon_loss: 1736859.7122; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4475820.1860; val_optim_loss: 4475820.1860
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9333; val_auprc_score: 0.8984; val_best_acc_score: 0.8856; val_best_f1_score: 0.8905; train_kl_reg_loss: 23246.8550; train_edge_recon_loss: 2662751.5548; train_gene_expr_recon_loss: 1732403.0124; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4418401.4164; train_optim_loss: 4418401.4164; val_kl_reg_loss: 23291.9307; val_edge_recon_loss: 2714035.9942; val_gene_expr_recon_loss: 1727742.4826; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4465070.3953; val_optim_loss: 4465070.3953
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9351; val_auprc_score: 0.9022; val_best_acc_score: 0.8851; val_best_f1_score: 0.8907; train_kl_reg_loss: 23248.7318; train_edge_recon_loss: 2663341.6247; train_gene_expr_recon_loss: 1727645.6041; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4414235.9674; train_optim_loss: 4414235.9674; val_kl_reg_loss: 23258.8894; val_edge_recon_loss: 2710794.8895; val_gene_expr_recon_loss: 1724231.5494; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4458285.3605; val_optim_loss: 4458285.3605
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9310; val_auprc_score: 0.8959; val_best_acc_score: 0.8808; val_best_f1_score: 0.8866; train_kl_reg_loss: 23256.3755; train_edge_recon_loss: 2662235.5196; train_gene_expr_recon_loss: 1724228.8544; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4409720.7454; train_optim_loss: 4409720.7454; val_kl_reg_loss: 23260.8177; val_edge_recon_loss: 2722818.3372; val_gene_expr_recon_loss: 1716711.9302; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4462791.0698; val_optim_loss: 4462791.0698
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9312; val_auprc_score: 0.8945; val_best_acc_score: 0.8822; val_best_f1_score: 0.8875; train_kl_reg_loss: 23259.7231; train_edge_recon_loss: 2662594.2174; train_gene_expr_recon_loss: 1721207.5052; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4407061.4465; train_optim_loss: 4407061.4465; val_kl_reg_loss: 23307.8793; val_edge_recon_loss: 2720705.0756; val_gene_expr_recon_loss: 1718766.7180; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4462779.6628; val_optim_loss: 4462779.6628
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9325; val_auprc_score: 0.8974; val_best_acc_score: 0.8844; val_best_f1_score: 0.8900; train_kl_reg_loss: 23264.7518; train_edge_recon_loss: 2663338.3538; train_gene_expr_recon_loss: 1718205.7497; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4404808.8629; train_optim_loss: 4404808.8629; val_kl_reg_loss: 23301.9578; val_edge_recon_loss: 2712665.1860; val_gene_expr_recon_loss: 1717354.1105; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4453321.2558; val_optim_loss: 4453321.2558
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9318; val_auprc_score: 0.8965; val_best_acc_score: 0.8829; val_best_f1_score: 0.8890; train_kl_reg_loss: 23254.2647; train_edge_recon_loss: 2660440.5261; train_gene_expr_recon_loss: 1716996.2102; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4400691.0026; train_optim_loss: 4400691.0026; val_kl_reg_loss: 23260.7895; val_edge_recon_loss: 2719735.4651; val_gene_expr_recon_loss: 1714879.0349; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4457875.3605; val_optim_loss: 4457875.3605
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9332; val_auprc_score: 0.8974; val_best_acc_score: 0.8847; val_best_f1_score: 0.8903; train_kl_reg_loss: 23250.1420; train_edge_recon_loss: 2662706.7950; train_gene_expr_recon_loss: 1715389.6279; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4401346.5614; train_optim_loss: 4401346.5614; val_kl_reg_loss: 23306.9550; val_edge_recon_loss: 2710720.6163; val_gene_expr_recon_loss: 1714394.6250; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4448422.2093; val_optim_loss: 4448422.2093
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9325; val_auprc_score: 0.8976; val_best_acc_score: 0.8837; val_best_f1_score: 0.8890; train_kl_reg_loss: 23266.4251; train_edge_recon_loss: 2663823.7089; train_gene_expr_recon_loss: 1713669.6772; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4400759.8029; train_optim_loss: 4400759.8029; val_kl_reg_loss: 23330.8080; val_edge_recon_loss: 2716539.6570; val_gene_expr_recon_loss: 1711629.8256; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4451500.3140; val_optim_loss: 4451500.3140
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9319; val_auprc_score: 0.8971; val_best_acc_score: 0.8827; val_best_f1_score: 0.8882; train_kl_reg_loss: 23250.5160; train_edge_recon_loss: 2661774.2676; train_gene_expr_recon_loss: 1712942.5764; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4397967.3655; train_optim_loss: 4397967.3655; val_kl_reg_loss: 23308.1554; val_edge_recon_loss: 2717956.9884; val_gene_expr_recon_loss: 1713134.9302; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4454400.0698; val_optim_loss: 4454400.0698
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9349; val_auprc_score: 0.9010; val_best_acc_score: 0.8855; val_best_f1_score: 0.8906; train_kl_reg_loss: 23243.6869; train_edge_recon_loss: 2663954.6090; train_gene_expr_recon_loss: 1712318.9820; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4399517.2794; train_optim_loss: 4399517.2794; val_kl_reg_loss: 23316.3121; val_edge_recon_loss: 2707777.4535; val_gene_expr_recon_loss: 1711592.1221; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4442685.9186; val_optim_loss: 4442685.9186
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9334; val_auprc_score: 0.8986; val_best_acc_score: 0.8851; val_best_f1_score: 0.8901; train_kl_reg_loss: 23244.8314; train_edge_recon_loss: 2661318.3133; train_gene_expr_recon_loss: 1711093.6309; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4395656.7715; train_optim_loss: 4395656.7715; val_kl_reg_loss: 23277.7291; val_edge_recon_loss: 2712179.3314; val_gene_expr_recon_loss: 1711753.3983; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4447210.4651; val_optim_loss: 4447210.4651
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9322; val_auprc_score: 0.8976; val_best_acc_score: 0.8831; val_best_f1_score: 0.8888; train_kl_reg_loss: 23243.7261; train_edge_recon_loss: 2662469.7245; train_gene_expr_recon_loss: 1710790.8055; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4396504.2585; train_optim_loss: 4396504.2585; val_kl_reg_loss: 23302.2254; val_edge_recon_loss: 2717800.4826; val_gene_expr_recon_loss: 1709133.4099; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4450236.1512; val_optim_loss: 4450236.1512
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9325; val_auprc_score: 0.8973; val_best_acc_score: 0.8833; val_best_f1_score: 0.8886; train_kl_reg_loss: 23264.3976; train_edge_recon_loss: 2660705.4889; train_gene_expr_recon_loss: 1710360.8887; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4394330.7794; train_optim_loss: 4394330.7794; val_kl_reg_loss: 23278.1173; val_edge_recon_loss: 2717731.3256; val_gene_expr_recon_loss: 1710629.8052; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4451639.2209; val_optim_loss: 4451639.2209
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9318; val_auprc_score: 0.8969; val_best_acc_score: 0.8819; val_best_f1_score: 0.8880; train_kl_reg_loss: 23261.8699; train_edge_recon_loss: 2662611.5444; train_gene_expr_recon_loss: 1711620.9279; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4397494.3342; train_optim_loss: 4397494.3342; val_kl_reg_loss: 23279.7961; val_edge_recon_loss: 2720753.8779; val_gene_expr_recon_loss: 1707628.0698; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4451661.6977; val_optim_loss: 4451661.6977

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9324; val_auprc_score: 0.8964; val_best_acc_score: 0.8835; val_best_f1_score: 0.8886; train_kl_reg_loss: 23250.0615; train_edge_recon_loss: 2663108.1514; train_gene_expr_recon_loss: 1710719.6593; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4397077.8786; train_optim_loss: 4397077.8786; val_kl_reg_loss: 23278.3075; val_edge_recon_loss: 2715352.6802; val_gene_expr_recon_loss: 1709768.8256; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4448399.8140; val_optim_loss: 4448399.8140
Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.9328; val_auprc_score: 0.8990; val_best_acc_score: 0.8838; val_best_f1_score: 0.8896; train_kl_reg_loss: 23255.4175; train_edge_recon_loss: 2661984.6717; train_gene_expr_recon_loss: 1709963.0711; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4395203.1710; train_optim_loss: 4395203.1710; val_kl_reg_loss: 23269.1118; val_edge_recon_loss: 2715433.9302; val_gene_expr_recon_loss: 1707794.5959; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4446497.6628; val_optim_loss: 4446497.6628
Epoch 24/100 |████----------------| 24.0% val_auroc_score: 0.9331; val_auprc_score: 0.8990; val_best_acc_score: 0.8833; val_best_f1_score: 0.8891; train_kl_reg_loss: 23246.9933; train_edge_recon_loss: 2660402.4772; train_gene_expr_recon_loss: 1709330.0088; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4392979.4713; train_optim_loss: 4392979.4713; val_kl_reg_loss: 23248.0876; val_edge_recon_loss: 2714094.3023; val_gene_expr_recon_loss: 1704824.1076; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4442166.5698; val_optim_loss: 4442166.5698
Epoch 25/100 |█████---------------| 25.0% val_auroc_score: 0.9343; val_auprc_score: 0.9006; val_best_acc_score: 0.8847; val_best_f1_score: 0.8898; train_kl_reg_loss: 23250.7589; train_edge_recon_loss: 2664294.3962; train_gene_expr_recon_loss: 1709423.2141; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4396968.3708; train_optim_loss: 4396968.3708; val_kl_reg_loss: 23303.6427; val_edge_recon_loss: 2714065.1512; val_gene_expr_recon_loss: 1710163.7442; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4447532.5000; val_optim_loss: 4447532.5000
Epoch 26/100 |█████---------------| 26.0% val_auroc_score: 0.9312; val_auprc_score: 0.8945; val_best_acc_score: 0.8833; val_best_f1_score: 0.8895; train_kl_reg_loss: 23249.3982; train_edge_recon_loss: 2661977.8956; train_gene_expr_recon_loss: 1710230.8681; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4395458.1514; train_optim_loss: 4395458.1514; val_kl_reg_loss: 23280.0614; val_edge_recon_loss: 2716308.2616; val_gene_expr_recon_loss: 1707079.8663; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4446668.1977; val_optim_loss: 4446668.1977
Epoch 27/100 |█████---------------| 27.0% val_auroc_score: 0.9316; val_auprc_score: 0.8966; val_best_acc_score: 0.8830; val_best_f1_score: 0.8885; train_kl_reg_loss: 23247.1659; train_edge_recon_loss: 2662542.2396; train_gene_expr_recon_loss: 1710443.7892; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4396233.1997; train_optim_loss: 4396233.1997; val_kl_reg_loss: 23271.0757; val_edge_recon_loss: 2716970.1395; val_gene_expr_recon_loss: 1706329.7529; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4446570.9767; val_optim_loss: 4446570.9767
Epoch 28/100 |█████---------------| 28.0% val_auroc_score: 0.9307; val_auprc_score: 0.8937; val_best_acc_score: 0.8844; val_best_f1_score: 0.8899; train_kl_reg_loss: 23254.9108; train_edge_recon_loss: 2662370.5725; train_gene_expr_recon_loss: 1709900.3339; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4395525.8238; train_optim_loss: 4395525.8238; val_kl_reg_loss: 23317.1584; val_edge_recon_loss: 2716736.5640; val_gene_expr_recon_loss: 1713340.5058; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4453394.2442; val_optim_loss: 4453394.2442

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 29/100 |█████---------------| 29.0% val_auroc_score: 0.9319; val_auprc_score: 0.8970; val_best_acc_score: 0.8830; val_best_f1_score: 0.8884; train_kl_reg_loss: 23250.6140; train_edge_recon_loss: 2662677.2533; train_gene_expr_recon_loss: 1710396.2249; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4396324.0888; train_optim_loss: 4396324.0888; val_kl_reg_loss: 23314.4549; val_edge_recon_loss: 2713522.7442; val_gene_expr_recon_loss: 1712114.4622; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4448951.5814; val_optim_loss: 4448951.5814
Epoch 30/100 |██████--------------| 30.0% val_auroc_score: 0.9314; val_auprc_score: 0.8951; val_best_acc_score: 0.8830; val_best_f1_score: 0.8890; train_kl_reg_loss: 23252.2432; train_edge_recon_loss: 2661858.0594; train_gene_expr_recon_loss: 1709644.2500; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4394754.5535; train_optim_loss: 4394754.5535; val_kl_reg_loss: 23287.2583; val_edge_recon_loss: 2717130.3837; val_gene_expr_recon_loss: 1709936.1134; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4450353.7558; val_optim_loss: 4450353.7558
Epoch 31/100 |██████--------------| 31.0% val_auroc_score: 0.9312; val_auprc_score: 0.8948; val_best_acc_score: 0.8838; val_best_f1_score: 0.8893; train_kl_reg_loss: 23253.1328; train_edge_recon_loss: 2661918.5209; train_gene_expr_recon_loss: 1709980.1208; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4395151.7702; train_optim_loss: 4395151.7702; val_kl_reg_loss: 23257.6259; val_edge_recon_loss: 2715420.3547; val_gene_expr_recon_loss: 1707659.4913; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4446337.4419; val_optim_loss: 4446337.4419
Epoch 32/100 |██████--------------| 32.0% val_auroc_score: 0.9323; val_auprc_score: 0.8971; val_best_acc_score: 0.8841; val_best_f1_score: 0.8891; train_kl_reg_loss: 23242.6944; train_edge_recon_loss: 2662153.7376; train_gene_expr_recon_loss: 1709889.5437; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4395285.9830; train_optim_loss: 4395285.9830; val_kl_reg_loss: 23285.8638; val_edge_recon_loss: 2717001.0291; val_gene_expr_recon_loss: 1704378.7500; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4444665.6512; val_optim_loss: 4444665.6512

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 47 min 40 sec.
Using best model state, which was in epoch 24.

--- MODEL EVALUATION ---
val AUROC score: 0.9336
val AUPRC score: 0.8995
val best accuracy score: 0.8848
val best F1 score: 0.8895
val target rna MSE score: 0.6125
val source rna MSE score: 0.1261
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0839

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
