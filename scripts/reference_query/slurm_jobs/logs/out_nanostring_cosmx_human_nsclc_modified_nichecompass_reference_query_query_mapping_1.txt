Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc_modified', '--query_batches', 'batch3', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '01092023_182943_6', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 33, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 33, n_output: 960

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 33, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 33, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 82522
Number of validation nodes: 9169
Number of training edges: 195815
Number of validation edges: 21757
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9345; val_auprc_score: 0.9034; val_best_acc_score: 0.8877; val_best_f1_score: 0.8916; train_kl_reg_loss: 24288.1196; train_edge_recon_loss: 2661068.0372; train_gene_expr_recon_loss: 2343684.9586; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5029041.1240; train_optim_loss: 5029041.1240; val_kl_reg_loss: 24399.2757; val_edge_recon_loss: 2722455.8663; val_gene_expr_recon_loss: 1973773.3953; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4720628.5465; val_optim_loss: 4720628.5465
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9334; val_auprc_score: 0.9032; val_best_acc_score: 0.8860; val_best_f1_score: 0.8906; train_kl_reg_loss: 24262.6331; train_edge_recon_loss: 2661752.0679; train_gene_expr_recon_loss: 1880082.5196; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4566097.2154; train_optim_loss: 4566097.2154; val_kl_reg_loss: 24400.0377; val_edge_recon_loss: 2727382.6628; val_gene_expr_recon_loss: 1848786.8983; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4600569.6279; val_optim_loss: 4600569.6279
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9339; val_auprc_score: 0.9019; val_best_acc_score: 0.8874; val_best_f1_score: 0.8924; train_kl_reg_loss: 24246.5094; train_edge_recon_loss: 2659110.4243; train_gene_expr_recon_loss: 1834211.9765; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4517568.9099; train_optim_loss: 4517568.9099; val_kl_reg_loss: 24371.5857; val_edge_recon_loss: 2718412.6744; val_gene_expr_recon_loss: 1830447.1192; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4573231.4186; val_optim_loss: 4573231.4186
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9355; val_auprc_score: 0.9038; val_best_acc_score: 0.8887; val_best_f1_score: 0.8933; train_kl_reg_loss: 24249.5692; train_edge_recon_loss: 2660733.0522; train_gene_expr_recon_loss: 1824430.8636; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4509413.4843; train_optim_loss: 4509413.4843; val_kl_reg_loss: 24395.5507; val_edge_recon_loss: 2714985.8663; val_gene_expr_recon_loss: 1828450.4593; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4567831.8488; val_optim_loss: 4567831.8488
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9344; val_auprc_score: 0.9030; val_best_acc_score: 0.8880; val_best_f1_score: 0.8925; train_kl_reg_loss: 24271.1381; train_edge_recon_loss: 2661832.7363; train_gene_expr_recon_loss: 1818781.5725; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4504885.4582; train_optim_loss: 4504885.4582; val_kl_reg_loss: 24444.7927; val_edge_recon_loss: 2721861.2965; val_gene_expr_recon_loss: 1817979.8547; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4564285.9186; val_optim_loss: 4564285.9186
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9360; val_auprc_score: 0.9054; val_best_acc_score: 0.8888; val_best_f1_score: 0.8933; train_kl_reg_loss: 24258.4208; train_edge_recon_loss: 2661545.3825; train_gene_expr_recon_loss: 1812790.1671; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4498593.9752; train_optim_loss: 4498593.9752; val_kl_reg_loss: 24346.5816; val_edge_recon_loss: 2716641.6686; val_gene_expr_recon_loss: 1814284.2093; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4555272.5116; val_optim_loss: 4555272.5116
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9355; val_auprc_score: 0.9039; val_best_acc_score: 0.8898; val_best_f1_score: 0.8943; train_kl_reg_loss: 24278.6865; train_edge_recon_loss: 2658854.4876; train_gene_expr_recon_loss: 1807039.5020; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4490172.6828; train_optim_loss: 4490172.6828; val_kl_reg_loss: 24409.1093; val_edge_recon_loss: 2714200.0058; val_gene_expr_recon_loss: 1804049.1570; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4542658.2791; val_optim_loss: 4542658.2791
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9342; val_auprc_score: 0.9028; val_best_acc_score: 0.8883; val_best_f1_score: 0.8926; train_kl_reg_loss: 24268.5502; train_edge_recon_loss: 2658220.1410; train_gene_expr_recon_loss: 1803667.8260; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4486156.5170; train_optim_loss: 4486156.5170; val_kl_reg_loss: 24351.2308; val_edge_recon_loss: 2719391.8953; val_gene_expr_recon_loss: 1802155.3401; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4545898.4535; val_optim_loss: 4545898.4535
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9360; val_auprc_score: 0.9067; val_best_acc_score: 0.8887; val_best_f1_score: 0.8931; train_kl_reg_loss: 24265.9176; train_edge_recon_loss: 2659476.5718; train_gene_expr_recon_loss: 1801410.5581; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4485153.0444; train_optim_loss: 4485153.0444; val_kl_reg_loss: 24400.9361; val_edge_recon_loss: 2718253.8663; val_gene_expr_recon_loss: 1803791.7471; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4546446.5698; val_optim_loss: 4546446.5698
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9348; val_auprc_score: 0.9031; val_best_acc_score: 0.8877; val_best_f1_score: 0.8923; train_kl_reg_loss: 24267.1612; train_edge_recon_loss: 2658885.2402; train_gene_expr_recon_loss: 1797258.7373; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4480411.1253; train_optim_loss: 4480411.1253; val_kl_reg_loss: 24404.3216; val_edge_recon_loss: 2717830.0581; val_gene_expr_recon_loss: 1801607.4331; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4543841.8372; val_optim_loss: 4543841.8372
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9343; val_auprc_score: 0.9030; val_best_acc_score: 0.8869; val_best_f1_score: 0.8918; train_kl_reg_loss: 24264.3565; train_edge_recon_loss: 2660629.5000; train_gene_expr_recon_loss: 1794483.4602; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4479377.3159; train_optim_loss: 4479377.3159; val_kl_reg_loss: 24369.7065; val_edge_recon_loss: 2718596.1453; val_gene_expr_recon_loss: 1797906.2122; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4540872.0465; val_optim_loss: 4540872.0465
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9362; val_auprc_score: 0.9068; val_best_acc_score: 0.8888; val_best_f1_score: 0.8932; train_kl_reg_loss: 24274.5588; train_edge_recon_loss: 2660470.4941; train_gene_expr_recon_loss: 1793882.3221; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4478627.3760; train_optim_loss: 4478627.3760; val_kl_reg_loss: 24374.0721; val_edge_recon_loss: 2717357.1395; val_gene_expr_recon_loss: 1794849.8430; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4536581.0465; val_optim_loss: 4536581.0465
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9364; val_auprc_score: 0.9067; val_best_acc_score: 0.8872; val_best_f1_score: 0.8917; train_kl_reg_loss: 24258.0906; train_edge_recon_loss: 2661050.0516; train_gene_expr_recon_loss: 1793375.0999; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4478683.2533; train_optim_loss: 4478683.2533; val_kl_reg_loss: 24386.5742; val_edge_recon_loss: 2722208.7384; val_gene_expr_recon_loss: 1795482.3169; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4542077.6744; val_optim_loss: 4542077.6744
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9370; val_auprc_score: 0.9057; val_best_acc_score: 0.8894; val_best_f1_score: 0.8938; train_kl_reg_loss: 24269.6625; train_edge_recon_loss: 2659813.1821; train_gene_expr_recon_loss: 1790927.7451; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4475010.6005; train_optim_loss: 4475010.6005; val_kl_reg_loss: 24404.9180; val_edge_recon_loss: 2711414.0291; val_gene_expr_recon_loss: 1791280.0669; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4527098.9651; val_optim_loss: 4527098.9651
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9360; val_auprc_score: 0.9055; val_best_acc_score: 0.8880; val_best_f1_score: 0.8930; train_kl_reg_loss: 24253.7537; train_edge_recon_loss: 2660452.5242; train_gene_expr_recon_loss: 1790399.8796; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4475106.1514; train_optim_loss: 4475106.1514; val_kl_reg_loss: 24380.2622; val_edge_recon_loss: 2718881.5349; val_gene_expr_recon_loss: 1795024.4622; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4538286.2326; val_optim_loss: 4538286.2326
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9338; val_auprc_score: 0.9022; val_best_acc_score: 0.8859; val_best_f1_score: 0.8907; train_kl_reg_loss: 24258.0126; train_edge_recon_loss: 2658889.5770; train_gene_expr_recon_loss: 1790125.4778; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4473273.0679; train_optim_loss: 4473273.0679; val_kl_reg_loss: 24426.3157; val_edge_recon_loss: 2723666.0872; val_gene_expr_recon_loss: 1792135.0988; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4540227.4767; val_optim_loss: 4540227.4767
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9362; val_auprc_score: 0.9067; val_best_acc_score: 0.8883; val_best_f1_score: 0.8926; train_kl_reg_loss: 24256.1863; train_edge_recon_loss: 2661249.4922; train_gene_expr_recon_loss: 1788722.0734; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4474227.7493; train_optim_loss: 4474227.7493; val_kl_reg_loss: 24418.1152; val_edge_recon_loss: 2716794.5349; val_gene_expr_recon_loss: 1790796.2849; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4532008.9535; val_optim_loss: 4532008.9535
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.9356; val_auprc_score: 0.9058; val_best_acc_score: 0.8881; val_best_f1_score: 0.8927; train_kl_reg_loss: 24266.4698; train_edge_recon_loss: 2660464.4230; train_gene_expr_recon_loss: 1788311.5773; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4473042.4621; train_optim_loss: 4473042.4621; val_kl_reg_loss: 24409.3568; val_edge_recon_loss: 2720330.2849; val_gene_expr_recon_loss: 1789978.3023; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4534717.9535; val_optim_loss: 4534717.9535

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.9369; val_auprc_score: 0.9072; val_best_acc_score: 0.8901; val_best_f1_score: 0.8945; train_kl_reg_loss: 24278.6551; train_edge_recon_loss: 2659487.8701; train_gene_expr_recon_loss: 1787305.6527; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4471072.1762; train_optim_loss: 4471072.1762; val_kl_reg_loss: 24407.4821; val_edge_recon_loss: 2709264.5988; val_gene_expr_recon_loss: 1790503.1279; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4524175.2326; val_optim_loss: 4524175.2326
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.9358; val_auprc_score: 0.9057; val_best_acc_score: 0.8892; val_best_f1_score: 0.8935; train_kl_reg_loss: 24263.1511; train_edge_recon_loss: 2660190.9269; train_gene_expr_recon_loss: 1787449.8163; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4471903.8995; train_optim_loss: 4471903.8995; val_kl_reg_loss: 24390.2966; val_edge_recon_loss: 2713114.6628; val_gene_expr_recon_loss: 1789874.2035; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4527379.1744; val_optim_loss: 4527379.1744
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.9357; val_auprc_score: 0.9036; val_best_acc_score: 0.8894; val_best_f1_score: 0.8933; train_kl_reg_loss: 24267.7795; train_edge_recon_loss: 2662224.1625; train_gene_expr_recon_loss: 1786277.4791; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4472769.4191; train_optim_loss: 4472769.4191; val_kl_reg_loss: 24408.5412; val_edge_recon_loss: 2719177.6395; val_gene_expr_recon_loss: 1786562.3692; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4530148.5000; val_optim_loss: 4530148.5000
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.9342; val_auprc_score: 0.9012; val_best_acc_score: 0.8873; val_best_f1_score: 0.8917; train_kl_reg_loss: 24274.3351; train_edge_recon_loss: 2661485.4863; train_gene_expr_recon_loss: 1790028.9971; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4475788.8146; train_optim_loss: 4475788.8146; val_kl_reg_loss: 24428.5148; val_edge_recon_loss: 2723917.2035; val_gene_expr_recon_loss: 1787963.3314; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4536309.0698; val_optim_loss: 4536309.0698
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.9342; val_auprc_score: 0.9037; val_best_acc_score: 0.8865; val_best_f1_score: 0.8918; train_kl_reg_loss: 24269.8859; train_edge_recon_loss: 2659935.0274; train_gene_expr_recon_loss: 1789017.5698; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4473222.4713; train_optim_loss: 4473222.4713; val_kl_reg_loss: 24421.1260; val_edge_recon_loss: 2722773.1163; val_gene_expr_recon_loss: 1790308.2151; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4537502.4070; val_optim_loss: 4537502.4070

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.9325; val_auprc_score: 0.8993; val_best_acc_score: 0.8874; val_best_f1_score: 0.8924; train_kl_reg_loss: 24271.8323; train_edge_recon_loss: 2658238.4386; train_gene_expr_recon_loss: 1787832.6309; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4470342.8864; train_optim_loss: 4470342.8864; val_kl_reg_loss: 24420.2564; val_edge_recon_loss: 2723228.4535; val_gene_expr_recon_loss: 1783939.3895; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4531588.1395; val_optim_loss: 4531588.1395
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.9362; val_auprc_score: 0.9062; val_best_acc_score: 0.8895; val_best_f1_score: 0.8936; train_kl_reg_loss: 24261.2922; train_edge_recon_loss: 2660144.2030; train_gene_expr_recon_loss: 1788219.9533; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4472625.4334; train_optim_loss: 4472625.4334; val_kl_reg_loss: 24380.2123; val_edge_recon_loss: 2717400.8488; val_gene_expr_recon_loss: 1790487.0145; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4532268.0930; val_optim_loss: 4532268.0930
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.9354; val_auprc_score: 0.9045; val_best_acc_score: 0.8873; val_best_f1_score: 0.8919; train_kl_reg_loss: 24256.0390; train_edge_recon_loss: 2659099.8368; train_gene_expr_recon_loss: 1787436.8469; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4470792.7272; train_optim_loss: 4470792.7272; val_kl_reg_loss: 24405.0910; val_edge_recon_loss: 2718970.7558; val_gene_expr_recon_loss: 1791633.8837; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4535009.7209; val_optim_loss: 4535009.7209
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.9337; val_auprc_score: 0.9011; val_best_acc_score: 0.8870; val_best_f1_score: 0.8924; train_kl_reg_loss: 24266.6825; train_edge_recon_loss: 2661224.8792; train_gene_expr_recon_loss: 1787723.5898; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4473215.1449; train_optim_loss: 4473215.1449; val_kl_reg_loss: 24409.8415; val_edge_recon_loss: 2722669.5465; val_gene_expr_recon_loss: 1789013.0058; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4536092.4302; val_optim_loss: 4536092.4302

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 49 min 36 sec.
Using best model state, which was in epoch 19.

--- MODEL EVALUATION ---
val AUROC score: 0.9381
val AUPRC score: 0.9096
val best accuracy score: 0.8910
val best F1 score: 0.8950
val target rna MSE score: 1.4144
val source rna MSE score: 0.3870
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0946

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
