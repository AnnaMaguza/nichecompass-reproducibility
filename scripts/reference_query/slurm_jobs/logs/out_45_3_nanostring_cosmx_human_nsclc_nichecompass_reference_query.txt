Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch3', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '19102023_180839_45', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 82522
Number of validation nodes: 9169
Number of training edges: 195815
Number of validation edges: 21757
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9452; val_auprc_score: 0.9387; val_best_acc_score: 0.8775; val_best_f1_score: 0.8811; train_kl_reg_loss: 83980.7775; train_edge_recon_loss: 27079070.6997; train_gene_expr_recon_loss: 21242123.3211; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 48405174.7781; train_optim_loss: 48405174.7781; val_kl_reg_loss: 84280.0710; val_edge_recon_loss: 27998283.7209; val_gene_expr_recon_loss: 19876647.2558; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47959211.0698; val_optim_loss: 47959211.0698
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9441; val_auprc_score: 0.9363; val_best_acc_score: 0.8756; val_best_f1_score: 0.8794; train_kl_reg_loss: 84019.1861; train_edge_recon_loss: 27074324.1880; train_gene_expr_recon_loss: 19587873.5770; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46746216.7937; train_optim_loss: 46746216.7937; val_kl_reg_loss: 84297.9560; val_edge_recon_loss: 28003123.5814; val_gene_expr_recon_loss: 19356026.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47443447.7209; val_optim_loss: 47443447.7209
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9464; val_auprc_score: 0.9396; val_best_acc_score: 0.8788; val_best_f1_score: 0.8821; train_kl_reg_loss: 83926.4984; train_edge_recon_loss: 27086638.3916; train_gene_expr_recon_loss: 19248967.5352; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46419532.3133; train_optim_loss: 46419532.3133; val_kl_reg_loss: 84156.1846; val_edge_recon_loss: 27934998.0000; val_gene_expr_recon_loss: 19072799.3488; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47091953.6744; val_optim_loss: 47091953.6744
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9455; val_auprc_score: 0.9373; val_best_acc_score: 0.8796; val_best_f1_score: 0.8836; train_kl_reg_loss: 83954.4905; train_edge_recon_loss: 27094317.2219; train_gene_expr_recon_loss: 19086012.4961; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46264284.1253; train_optim_loss: 46264284.1253; val_kl_reg_loss: 84217.8550; val_edge_recon_loss: 27924095.5814; val_gene_expr_recon_loss: 19027777.5814; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47036091.1628; val_optim_loss: 47036091.1628
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9463; val_auprc_score: 0.9395; val_best_acc_score: 0.8788; val_best_f1_score: 0.8822; train_kl_reg_loss: 83966.6924; train_edge_recon_loss: 27078860.7206; train_gene_expr_recon_loss: 18988390.4021; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46151217.8381; train_optim_loss: 46151217.8381; val_kl_reg_loss: 84314.4371; val_edge_recon_loss: 27916510.5116; val_gene_expr_recon_loss: 18913051.3953; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46913876.0930; val_optim_loss: 46913876.0930
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9460; val_auprc_score: 0.9394; val_best_acc_score: 0.8780; val_best_f1_score: 0.8818; train_kl_reg_loss: 83934.7752; train_edge_recon_loss: 27105775.5666; train_gene_expr_recon_loss: 18913148.4595; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46102858.7676; train_optim_loss: 46102858.7676; val_kl_reg_loss: 84266.3403; val_edge_recon_loss: 27939238.5581; val_gene_expr_recon_loss: 18867650.1860; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46891155.0698; val_optim_loss: 46891155.0698
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9435; val_auprc_score: 0.9358; val_best_acc_score: 0.8751; val_best_f1_score: 0.8795; train_kl_reg_loss: 83937.2574; train_edge_recon_loss: 27103911.0235; train_gene_expr_recon_loss: 18873012.9295; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46060861.1384; train_optim_loss: 46060861.1384; val_kl_reg_loss: 84127.3634; val_edge_recon_loss: 28008081.7209; val_gene_expr_recon_loss: 18847331.8140; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46939541.1163; val_optim_loss: 46939541.1163
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9444; val_auprc_score: 0.9371; val_best_acc_score: 0.8764; val_best_f1_score: 0.8805; train_kl_reg_loss: 83967.5602; train_edge_recon_loss: 27067190.8877; train_gene_expr_recon_loss: 18841035.0287; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45992193.4308; train_optim_loss: 45992193.4308; val_kl_reg_loss: 84024.9408; val_edge_recon_loss: 27981070.8372; val_gene_expr_recon_loss: 18727496.0465; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46792591.6279; val_optim_loss: 46792591.6279
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9424; val_auprc_score: 0.9349; val_best_acc_score: 0.8738; val_best_f1_score: 0.8784; train_kl_reg_loss: 83948.7959; train_edge_recon_loss: 27073210.1410; train_gene_expr_recon_loss: 18817182.9974; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45974341.9321; train_optim_loss: 45974341.9321; val_kl_reg_loss: 84191.7769; val_edge_recon_loss: 28036149.2558; val_gene_expr_recon_loss: 18764362.3256; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46884703.6279; val_optim_loss: 46884703.6279
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9443; val_auprc_score: 0.9372; val_best_acc_score: 0.8771; val_best_f1_score: 0.8805; train_kl_reg_loss: 84014.4623; train_edge_recon_loss: 27105085.2272; train_gene_expr_recon_loss: 18793378.3342; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45982477.9217; train_optim_loss: 45982477.9217; val_kl_reg_loss: 84155.4513; val_edge_recon_loss: 28010426.9302; val_gene_expr_recon_loss: 18736061.1628; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46830643.6279; val_optim_loss: 46830643.6279
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9443; val_auprc_score: 0.9371; val_best_acc_score: 0.8752; val_best_f1_score: 0.8798; train_kl_reg_loss: 84008.1641; train_edge_recon_loss: 27103182.6475; train_gene_expr_recon_loss: 18794792.0888; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45981982.7885; train_optim_loss: 45981982.7885; val_kl_reg_loss: 84040.0242; val_edge_recon_loss: 27993358.9302; val_gene_expr_recon_loss: 18726967.7209; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46804366.9767; val_optim_loss: 46804366.9767
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9449; val_auprc_score: 0.9375; val_best_acc_score: 0.8785; val_best_f1_score: 0.8826; train_kl_reg_loss: 83924.1620; train_edge_recon_loss: 27117553.1697; train_gene_expr_recon_loss: 18767896.3499; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45969373.8381; train_optim_loss: 45969373.8381; val_kl_reg_loss: 84086.5271; val_edge_recon_loss: 27966558.7442; val_gene_expr_recon_loss: 18739125.3953; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46789771.1628; val_optim_loss: 46789771.1628
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9450; val_auprc_score: 0.9368; val_best_acc_score: 0.8785; val_best_f1_score: 0.8818; train_kl_reg_loss: 83933.3996; train_edge_recon_loss: 27082446.5744; train_gene_expr_recon_loss: 18742537.2689; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45908917.2219; train_optim_loss: 45908917.2219; val_kl_reg_loss: 84179.2816; val_edge_recon_loss: 27936657.0233; val_gene_expr_recon_loss: 18701332.1395; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46722168.4651; val_optim_loss: 46722168.4651
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9441; val_auprc_score: 0.9371; val_best_acc_score: 0.8757; val_best_f1_score: 0.8796; train_kl_reg_loss: 83991.2033; train_edge_recon_loss: 27090328.2037; train_gene_expr_recon_loss: 18765380.8042; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45939700.0627; train_optim_loss: 45939700.0627; val_kl_reg_loss: 84034.8492; val_edge_recon_loss: 27991556.3256; val_gene_expr_recon_loss: 18714443.1163; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46790034.3256; val_optim_loss: 46790034.3256
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9449; val_auprc_score: 0.9376; val_best_acc_score: 0.8775; val_best_f1_score: 0.8812; train_kl_reg_loss: 83967.6257; train_edge_recon_loss: 27103846.3081; train_gene_expr_recon_loss: 18740621.5248; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45928435.3943; train_optim_loss: 45928435.3943; val_kl_reg_loss: 84168.5887; val_edge_recon_loss: 27991558.7907; val_gene_expr_recon_loss: 18700373.2093; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46776100.6512; val_optim_loss: 46776100.6512
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9448; val_auprc_score: 0.9372; val_best_acc_score: 0.8772; val_best_f1_score: 0.8810; train_kl_reg_loss: 83987.8932; train_edge_recon_loss: 27092157.3159; train_gene_expr_recon_loss: 18744820.9504; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45920966.2872; train_optim_loss: 45920966.2872; val_kl_reg_loss: 84168.4090; val_edge_recon_loss: 27996625.7209; val_gene_expr_recon_loss: 18704107.5349; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46784901.6744; val_optim_loss: 46784901.6744
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9444; val_auprc_score: 0.9379; val_best_acc_score: 0.8754; val_best_f1_score: 0.8799; train_kl_reg_loss: 83962.3333; train_edge_recon_loss: 27086827.8120; train_gene_expr_recon_loss: 18764048.7311; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45934838.9138; train_optim_loss: 45934838.9138; val_kl_reg_loss: 84042.5972; val_edge_recon_loss: 28018004.2326; val_gene_expr_recon_loss: 18678174.0465; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46780221.0233; val_optim_loss: 46780221.0233

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.9452; val_auprc_score: 0.9374; val_best_acc_score: 0.8780; val_best_f1_score: 0.8819; train_kl_reg_loss: 83939.9864; train_edge_recon_loss: 27099864.8460; train_gene_expr_recon_loss: 18741479.9896; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45925284.8773; train_optim_loss: 45925284.8773; val_kl_reg_loss: 84112.2442; val_edge_recon_loss: 27951652.1860; val_gene_expr_recon_loss: 18721567.6744; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46757332.1860; val_optim_loss: 46757332.1860
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.9452; val_auprc_score: 0.9390; val_best_acc_score: 0.8765; val_best_f1_score: 0.8812; train_kl_reg_loss: 83953.4993; train_edge_recon_loss: 27094318.6945; train_gene_expr_recon_loss: 18742774.1775; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45921046.3499; train_optim_loss: 45921046.3499; val_kl_reg_loss: 84351.9384; val_edge_recon_loss: 27986851.1163; val_gene_expr_recon_loss: 18722940.8837; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46794144.0000; val_optim_loss: 46794144.0000
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.9453; val_auprc_score: 0.9388; val_best_acc_score: 0.8771; val_best_f1_score: 0.8808; train_kl_reg_loss: 83962.8853; train_edge_recon_loss: 27101151.8225; train_gene_expr_recon_loss: 18749157.5666; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45934272.3029; train_optim_loss: 45934272.3029; val_kl_reg_loss: 84009.8712; val_edge_recon_loss: 27990165.3023; val_gene_expr_recon_loss: 18695600.0465; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46769775.3488; val_optim_loss: 46769775.3488
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.9457; val_auprc_score: 0.9389; val_best_acc_score: 0.8780; val_best_f1_score: 0.8815; train_kl_reg_loss: 84006.7056; train_edge_recon_loss: 27094604.9922; train_gene_expr_recon_loss: 18742418.3916; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45921030.0679; train_optim_loss: 45921030.0679; val_kl_reg_loss: 84283.4377; val_edge_recon_loss: 27923889.2558; val_gene_expr_recon_loss: 18697609.1628; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46705781.7674; val_optim_loss: 46705781.7674
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.9453; val_auprc_score: 0.9381; val_best_acc_score: 0.8776; val_best_f1_score: 0.8819; train_kl_reg_loss: 83954.2837; train_edge_recon_loss: 27093891.8329; train_gene_expr_recon_loss: 18739040.3760; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45916886.5483; train_optim_loss: 45916886.5483; val_kl_reg_loss: 84318.3525; val_edge_recon_loss: 27944474.3256; val_gene_expr_recon_loss: 18721860.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46750652.3721; val_optim_loss: 46750652.3721
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.9453; val_auprc_score: 0.9378; val_best_acc_score: 0.8773; val_best_f1_score: 0.8815; train_kl_reg_loss: 83942.4890; train_edge_recon_loss: 27075714.6371; train_gene_expr_recon_loss: 18731061.5091; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45890718.6319; train_optim_loss: 45890718.6319; val_kl_reg_loss: 84123.8463; val_edge_recon_loss: 27954532.2326; val_gene_expr_recon_loss: 18695376.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46734032.0930; val_optim_loss: 46734032.0930
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.9450; val_auprc_score: 0.9381; val_best_acc_score: 0.8778; val_best_f1_score: 0.8815; train_kl_reg_loss: 83885.3863; train_edge_recon_loss: 27106282.3708; train_gene_expr_recon_loss: 18738172.7572; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45928340.4909; train_optim_loss: 45928340.4909; val_kl_reg_loss: 84130.9531; val_edge_recon_loss: 27954288.4186; val_gene_expr_recon_loss: 18715583.1163; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46754002.4186; val_optim_loss: 46754002.4186
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.9454; val_auprc_score: 0.9384; val_best_acc_score: 0.8769; val_best_f1_score: 0.8821; train_kl_reg_loss: 83961.4985; train_edge_recon_loss: 27103737.2428; train_gene_expr_recon_loss: 18739403.5196; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45927102.3185; train_optim_loss: 45927102.3185; val_kl_reg_loss: 84237.9762; val_edge_recon_loss: 27958358.3721; val_gene_expr_recon_loss: 18705288.3721; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46747884.3721; val_optim_loss: 46747884.3721

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.9444; val_auprc_score: 0.9360; val_best_acc_score: 0.8760; val_best_f1_score: 0.8814; train_kl_reg_loss: 84011.0290; train_edge_recon_loss: 26986238.4909; train_gene_expr_recon_loss: 18472168.5901; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45542418.1305; train_optim_loss: 45542418.1305; val_kl_reg_loss: 70064.2487; val_edge_recon_loss: 27896104.3256; val_gene_expr_recon_loss: 18394898.1860; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46361066.6047; val_optim_loss: 46361066.6047
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.9440; val_auprc_score: 0.9368; val_best_acc_score: 0.8754; val_best_f1_score: 0.8801; train_kl_reg_loss: 83978.6621; train_edge_recon_loss: 26998072.4491; train_gene_expr_recon_loss: 18469429.4047; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45551480.3655; train_optim_loss: 45551480.3655; val_kl_reg_loss: 70303.7531; val_edge_recon_loss: 27924395.2558; val_gene_expr_recon_loss: 18407123.5814; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46401822.7907; val_optim_loss: 46401822.7907
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.9445; val_auprc_score: 0.9370; val_best_acc_score: 0.8760; val_best_f1_score: 0.8809; train_kl_reg_loss: 83996.1144; train_edge_recon_loss: 26980175.3838; train_gene_expr_recon_loss: 18456214.0052; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45520385.5248; train_optim_loss: 45520385.5248; val_kl_reg_loss: 70106.4431; val_edge_recon_loss: 27895436.0465; val_gene_expr_recon_loss: 18421676.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46387218.6047; val_optim_loss: 46387218.6047
Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.9429; val_auprc_score: 0.9342; val_best_acc_score: 0.8748; val_best_f1_score: 0.8796; train_kl_reg_loss: 83960.2604; train_edge_recon_loss: 26991446.6057; train_gene_expr_recon_loss: 18459327.6919; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45534734.5692; train_optim_loss: 45534734.5692; val_kl_reg_loss: 70361.7426; val_edge_recon_loss: 27960747.1628; val_gene_expr_recon_loss: 18429951.3488; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46461060.4651; val_optim_loss: 46461060.4651
Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.9446; val_auprc_score: 0.9370; val_best_acc_score: 0.8773; val_best_f1_score: 0.8821; train_kl_reg_loss: 83945.2273; train_edge_recon_loss: 27012031.5144; train_gene_expr_recon_loss: 18456208.9243; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45552185.7023; train_optim_loss: 45552185.7023; val_kl_reg_loss: 70329.7131; val_edge_recon_loss: 27892639.0698; val_gene_expr_recon_loss: 18422465.2558; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46385433.8605; val_optim_loss: 46385433.8605

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1.0000000000000002e-06.

Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.9437; val_auprc_score: 0.9350; val_best_acc_score: 0.8772; val_best_f1_score: 0.8812; train_kl_reg_loss: 83945.7505; train_edge_recon_loss: 26995612.0104; train_gene_expr_recon_loss: 18459222.9295; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45538780.6997; train_optim_loss: 45538780.6997; val_kl_reg_loss: 70281.1784; val_edge_recon_loss: 27914913.6744; val_gene_expr_recon_loss: 18418122.9767; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46403317.9535; val_optim_loss: 46403317.9535
Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.9437; val_auprc_score: 0.9361; val_best_acc_score: 0.8749; val_best_f1_score: 0.8794; train_kl_reg_loss: 83967.9128; train_edge_recon_loss: 26989141.2585; train_gene_expr_recon_loss: 18450290.9922; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45523400.1358; train_optim_loss: 45523400.1358; val_kl_reg_loss: 70133.8241; val_edge_recon_loss: 27976849.4419; val_gene_expr_recon_loss: 18387608.7907; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46434591.9070; val_optim_loss: 46434591.9070
Epoch 33/400 |█-------------------| 8.2% val_auroc_score: 0.9458; val_auprc_score: 0.9378; val_best_acc_score: 0.8800; val_best_f1_score: 0.8849; train_kl_reg_loss: 83968.9853; train_edge_recon_loss: 27003163.6606; train_gene_expr_recon_loss: 18460265.1332; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45547397.7128; train_optim_loss: 45547397.7128; val_kl_reg_loss: 70215.9965; val_edge_recon_loss: 27885396.9767; val_gene_expr_recon_loss: 18447131.0698; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46402744.2791; val_optim_loss: 46402744.2791
Epoch 34/400 |█-------------------| 8.5% val_auroc_score: 0.9430; val_auprc_score: 0.9344; val_best_acc_score: 0.8754; val_best_f1_score: 0.8806; train_kl_reg_loss: 83991.7849; train_edge_recon_loss: 26991967.2428; train_gene_expr_recon_loss: 18467284.9243; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45543243.9582; train_optim_loss: 45543243.9582; val_kl_reg_loss: 70285.9773; val_edge_recon_loss: 27938046.4651; val_gene_expr_recon_loss: 18447001.2558; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46455333.8605; val_optim_loss: 46455333.8605

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 29 min 17 sec.
Using best model state, which was in epoch 26.

--- MODEL EVALUATION ---
val AUROC score: 0.9448
val AUPRC score: 0.9378
val best accuracy score: 0.8769
val best F1 score: 0.8811
val target rna MSE score: 0.6888
val source rna MSE score: 0.1829
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0699
Val cat covariate2 mean sim diff: nan

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
