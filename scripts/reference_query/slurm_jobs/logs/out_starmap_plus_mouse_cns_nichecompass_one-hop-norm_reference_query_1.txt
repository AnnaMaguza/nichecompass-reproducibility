[True]
Run timestamp: 06072023_114143_1.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'starmap_plus_mouse_cns', '--reference_batches', 'batch1', 'batch2', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '0.1', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference_query_reference_only', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000.', '--lambda_gene_expr_recon', '300.', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '5.0', '--edge_batch_size', '1024', '--node_batch_size', 'None', '--timestamp_suffix', '_1']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.05
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ENCODER -> n_input: 1022, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 1022, n_latent: 1423, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1423, n_cat_covariates_embed_input: 3, n_addon_input: 0, n_output: 2044
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 193574
Number of validation nodes: 21508
Number of training edges: 1323311
Number of validation edges: 147034
Edge batch size: 1024
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9884; val_auprc_score: 0.9915; val_best_acc_score: 0.9707; val_best_f1_score: 0.9782; train_kl_reg_loss: 5598.4989; train_edge_recon_loss: 178576.4333; train_gene_expr_recon_loss: 102066.4931; train_masked_gp_l1_reg_loss: 933.7732; train_group_lasso_reg_loss: 0.0000; train_global_loss: 287175.1992; train_optim_loss: 287175.1992; val_kl_reg_loss: 4992.2227; val_edge_recon_loss: 174568.2401; val_gene_expr_recon_loss: 92776.9064; val_masked_gp_l1_reg_loss: 783.6719; val_group_lasso_reg_loss: 0.0000; val_global_loss: 273121.0425; val_optim_loss: 273121.0425
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9908; val_auprc_score: 0.9935; val_best_acc_score: 0.9755; val_best_f1_score: 0.9817; train_kl_reg_loss: 5193.2573; train_edge_recon_loss: 174767.6003; train_gene_expr_recon_loss: 91407.1163; train_masked_gp_l1_reg_loss: 732.9650; train_group_lasso_reg_loss: 0.0000; train_global_loss: 272100.9390; train_optim_loss: 272100.9390; val_kl_reg_loss: 5170.2857; val_edge_recon_loss: 173712.8967; val_gene_expr_recon_loss: 90067.7012; val_masked_gp_l1_reg_loss: 697.0948; val_group_lasso_reg_loss: 0.0000; val_global_loss: 269647.9773; val_optim_loss: 269647.9773
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9918; val_auprc_score: 0.9943; val_best_acc_score: 0.9771; val_best_f1_score: 0.9829; train_kl_reg_loss: 5195.8899; train_edge_recon_loss: 174689.9477; train_gene_expr_recon_loss: 89789.0025; train_masked_gp_l1_reg_loss: 678.3894; train_group_lasso_reg_loss: 0.0000; train_global_loss: 270353.2297; train_optim_loss: 270353.2297; val_kl_reg_loss: 5152.6584; val_edge_recon_loss: 173805.7646; val_gene_expr_recon_loss: 89129.4256; val_masked_gp_l1_reg_loss: 664.0107; val_group_lasso_reg_loss: 0.0000; val_global_loss: 268751.8509; val_optim_loss: 268751.8509
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9928; val_auprc_score: 0.9950; val_best_acc_score: 0.9793; val_best_f1_score: 0.9845; train_kl_reg_loss: 5197.7331; train_edge_recon_loss: 174347.3467; train_gene_expr_recon_loss: 88879.0487; train_masked_gp_l1_reg_loss: 649.7877; train_group_lasso_reg_loss: 0.0000; train_global_loss: 269073.9166; train_optim_loss: 269073.9166; val_kl_reg_loss: 5135.5887; val_edge_recon_loss: 172788.7696; val_gene_expr_recon_loss: 88529.6360; val_masked_gp_l1_reg_loss: 640.0227; val_group_lasso_reg_loss: 0.0000; val_global_loss: 267094.0248; val_optim_loss: 267094.0248
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9933; val_auprc_score: 0.9953; val_best_acc_score: 0.9803; val_best_f1_score: 0.9852; train_kl_reg_loss: 5212.7093; train_edge_recon_loss: 174402.3910; train_gene_expr_recon_loss: 88474.1936; train_masked_gp_l1_reg_loss: 634.9051; train_group_lasso_reg_loss: 0.0000; train_global_loss: 268724.1990; train_optim_loss: 268724.1990; val_kl_reg_loss: 5053.0293; val_edge_recon_loss: 173896.8717; val_gene_expr_recon_loss: 88182.4619; val_masked_gp_l1_reg_loss: 631.1401; val_group_lasso_reg_loss: 0.0000; val_global_loss: 267763.4895; val_optim_loss: 267763.4895
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9940; val_auprc_score: 0.9959; val_best_acc_score: 0.9813; val_best_f1_score: 0.9860; train_kl_reg_loss: 5227.8312; train_edge_recon_loss: 174212.0328; train_gene_expr_recon_loss: 88104.2592; train_masked_gp_l1_reg_loss: 629.8475; train_group_lasso_reg_loss: 0.0000; train_global_loss: 268173.9710; train_optim_loss: 268173.9710; val_kl_reg_loss: 5120.4288; val_edge_recon_loss: 173452.8898; val_gene_expr_recon_loss: 87919.1346; val_masked_gp_l1_reg_loss: 628.1055; val_group_lasso_reg_loss: 0.0000; val_global_loss: 267120.5498; val_optim_loss: 267120.5498
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9939; val_auprc_score: 0.9959; val_best_acc_score: 0.9814; val_best_f1_score: 0.9861; train_kl_reg_loss: 5242.1755; train_edge_recon_loss: 174275.1111; train_gene_expr_recon_loss: 87884.1658; train_masked_gp_l1_reg_loss: 630.0999; train_group_lasso_reg_loss: 0.0000; train_global_loss: 268031.5520; train_optim_loss: 268031.5520; val_kl_reg_loss: 5174.5873; val_edge_recon_loss: 173370.0429; val_gene_expr_recon_loss: 87685.8257; val_masked_gp_l1_reg_loss: 628.5374; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266858.9883; val_optim_loss: 266858.9883
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9947; val_auprc_score: 0.9965; val_best_acc_score: 0.9817; val_best_f1_score: 0.9863; train_kl_reg_loss: 5251.5495; train_edge_recon_loss: 174061.1738; train_gene_expr_recon_loss: 87668.5825; train_masked_gp_l1_reg_loss: 632.1196; train_group_lasso_reg_loss: 0.0000; train_global_loss: 267613.4253; train_optim_loss: 267613.4253; val_kl_reg_loss: 5259.5790; val_edge_recon_loss: 173417.4074; val_gene_expr_recon_loss: 87341.3750; val_masked_gp_l1_reg_loss: 632.2766; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266650.6427; val_optim_loss: 266650.6427
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9946; val_auprc_score: 0.9965; val_best_acc_score: 0.9822; val_best_f1_score: 0.9866; train_kl_reg_loss: 5267.5228; train_edge_recon_loss: 174158.2481; train_gene_expr_recon_loss: 87532.7005; train_masked_gp_l1_reg_loss: 635.5415; train_group_lasso_reg_loss: 0.0000; train_global_loss: 267594.0127; train_optim_loss: 267594.0127; val_kl_reg_loss: 5245.8983; val_edge_recon_loss: 173294.1874; val_gene_expr_recon_loss: 87467.6329; val_masked_gp_l1_reg_loss: 636.9407; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266644.6554; val_optim_loss: 266644.6554
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9950; val_auprc_score: 0.9967; val_best_acc_score: 0.9829; val_best_f1_score: 0.9872; train_kl_reg_loss: 5278.1923; train_edge_recon_loss: 174098.9523; train_gene_expr_recon_loss: 87375.0897; train_masked_gp_l1_reg_loss: 639.1605; train_group_lasso_reg_loss: 0.0000; train_global_loss: 267391.3950; train_optim_loss: 267391.3950; val_kl_reg_loss: 5249.0150; val_edge_recon_loss: 173353.9813; val_gene_expr_recon_loss: 87276.0860; val_masked_gp_l1_reg_loss: 641.9186; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266520.9910; val_optim_loss: 266520.9910
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9951; val_auprc_score: 0.9967; val_best_acc_score: 0.9834; val_best_f1_score: 0.9876; train_kl_reg_loss: 5286.4989; train_edge_recon_loss: 174091.6820; train_gene_expr_recon_loss: 87244.5163; train_masked_gp_l1_reg_loss: 643.3028; train_group_lasso_reg_loss: 0.0000; train_global_loss: 267265.9999; train_optim_loss: 267265.9999; val_kl_reg_loss: 5265.9842; val_edge_recon_loss: 173225.3563; val_gene_expr_recon_loss: 87255.9958; val_masked_gp_l1_reg_loss: 647.2155; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266394.5540; val_optim_loss: 266394.5540
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9952; val_auprc_score: 0.9968; val_best_acc_score: 0.9833; val_best_f1_score: 0.9875; train_kl_reg_loss: 5298.7793; train_edge_recon_loss: 174116.4623; train_gene_expr_recon_loss: 87149.3072; train_masked_gp_l1_reg_loss: 647.1592; train_group_lasso_reg_loss: 0.0000; train_global_loss: 267211.7083; train_optim_loss: 267211.7083; val_kl_reg_loss: 5291.6089; val_edge_recon_loss: 173605.1981; val_gene_expr_recon_loss: 87174.0234; val_masked_gp_l1_reg_loss: 647.0529; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266717.8899; val_optim_loss: 266717.8899
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9957; val_auprc_score: 0.9972; val_best_acc_score: 0.9842; val_best_f1_score: 0.9882; train_kl_reg_loss: 5306.6367; train_edge_recon_loss: 174009.6738; train_gene_expr_recon_loss: 87060.3019; train_masked_gp_l1_reg_loss: 651.6943; train_group_lasso_reg_loss: 0.0000; train_global_loss: 267028.3066; train_optim_loss: 267028.3066; val_kl_reg_loss: 5328.0389; val_edge_recon_loss: 173197.2573; val_gene_expr_recon_loss: 87073.4103; val_masked_gp_l1_reg_loss: 655.0590; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266253.7692; val_optim_loss: 266253.7692
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9954; val_auprc_score: 0.9969; val_best_acc_score: 0.9840; val_best_f1_score: 0.9880; train_kl_reg_loss: 5319.4775; train_edge_recon_loss: 174069.4129; train_gene_expr_recon_loss: 86966.8593; train_masked_gp_l1_reg_loss: 656.8135; train_group_lasso_reg_loss: 0.0000; train_global_loss: 267012.5637; train_optim_loss: 267012.5637; val_kl_reg_loss: 5303.6834; val_edge_recon_loss: 173105.1368; val_gene_expr_recon_loss: 87098.7083; val_masked_gp_l1_reg_loss: 661.0472; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266168.5887; val_optim_loss: 266168.5887
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9959; val_auprc_score: 0.9973; val_best_acc_score: 0.9846; val_best_f1_score: 0.9884; train_kl_reg_loss: 5328.1410; train_edge_recon_loss: 174162.7326; train_gene_expr_recon_loss: 86888.9354; train_masked_gp_l1_reg_loss: 661.1372; train_group_lasso_reg_loss: 0.0000; train_global_loss: 267040.9464; train_optim_loss: 267040.9464; val_kl_reg_loss: 5270.5970; val_edge_recon_loss: 173282.0882; val_gene_expr_recon_loss: 86998.6350; val_masked_gp_l1_reg_loss: 661.0200; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266212.3487; val_optim_loss: 266212.3487
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9961; val_auprc_score: 0.9975; val_best_acc_score: 0.9853; val_best_f1_score: 0.9890; train_kl_reg_loss: 5333.7345; train_edge_recon_loss: 173876.1062; train_gene_expr_recon_loss: 86817.9611; train_masked_gp_l1_reg_loss: 665.4813; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266693.2832; train_optim_loss: 266693.2832; val_kl_reg_loss: 5330.2270; val_edge_recon_loss: 173073.8165; val_gene_expr_recon_loss: 87030.5047; val_masked_gp_l1_reg_loss: 665.3595; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266099.9196; val_optim_loss: 266099.9196
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9962; val_auprc_score: 0.9974; val_best_acc_score: 0.9854; val_best_f1_score: 0.9890; train_kl_reg_loss: 5342.7884; train_edge_recon_loss: 174093.3468; train_gene_expr_recon_loss: 86778.0827; train_masked_gp_l1_reg_loss: 668.0966; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266882.3145; train_optim_loss: 266882.3145; val_kl_reg_loss: 5349.1851; val_edge_recon_loss: 173643.9069; val_gene_expr_recon_loss: 86922.1745; val_masked_gp_l1_reg_loss: 667.6783; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266582.9514; val_optim_loss: 266582.9514
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9965; val_auprc_score: 0.9977; val_best_acc_score: 0.9855; val_best_f1_score: 0.9891; train_kl_reg_loss: 5348.7282; train_edge_recon_loss: 174152.1565; train_gene_expr_recon_loss: 86713.0036; train_masked_gp_l1_reg_loss: 671.0404; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266884.9290; train_optim_loss: 266884.9290; val_kl_reg_loss: 5338.2989; val_edge_recon_loss: 173268.6354; val_gene_expr_recon_loss: 86959.9365; val_masked_gp_l1_reg_loss: 674.5367; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266241.4016; val_optim_loss: 266241.4016
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9961; val_auprc_score: 0.9975; val_best_acc_score: 0.9854; val_best_f1_score: 0.9890; train_kl_reg_loss: 5353.9852; train_edge_recon_loss: 173942.5596; train_gene_expr_recon_loss: 86673.6988; train_masked_gp_l1_reg_loss: 675.3128; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266645.5567; train_optim_loss: 266645.5567; val_kl_reg_loss: 5279.6680; val_edge_recon_loss: 173079.7244; val_gene_expr_recon_loss: 86793.6577; val_masked_gp_l1_reg_loss: 677.9790; val_group_lasso_reg_loss: 0.0000; val_global_loss: 265831.0231; val_optim_loss: 265831.0231
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9966; val_auprc_score: 0.9978; val_best_acc_score: 0.9857; val_best_f1_score: 0.9893; train_kl_reg_loss: 5359.5314; train_edge_recon_loss: 173908.2324; train_gene_expr_recon_loss: 86625.9404; train_masked_gp_l1_reg_loss: 679.1471; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266572.8514; train_optim_loss: 266572.8514; val_kl_reg_loss: 5298.4417; val_edge_recon_loss: 173120.0299; val_gene_expr_recon_loss: 86948.4866; val_masked_gp_l1_reg_loss: 678.7106; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266045.6735; val_optim_loss: 266045.6735
