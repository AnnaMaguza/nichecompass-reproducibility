Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch4', 'batch8', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '30092023_031623_104', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.01
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch8...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.01
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 144233
Number of validation nodes: 16026
Number of training edges: 337951
Number of validation edges: 37550
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.7120; val_auprc_score: 0.7947; val_best_acc_score: 0.7743; val_best_f1_score: 0.8477; train_kl_reg_loss: 20303.7488; train_edge_recon_loss: 2200841.7283; train_gene_expr_recon_loss: 2751064.1002; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4972209.5832; train_optim_loss: 4972209.5832; val_kl_reg_loss: 20219.0204; val_edge_recon_loss: 2246275.8885; val_gene_expr_recon_loss: 2347371.9155; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4613866.8176; val_optim_loss: 4613866.8176
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.7112; val_auprc_score: 0.7955; val_best_acc_score: 0.7744; val_best_f1_score: 0.8475; train_kl_reg_loss: 20287.1621; train_edge_recon_loss: 2191922.7220; train_gene_expr_recon_loss: 2271477.0681; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4483686.9505; train_optim_loss: 4483686.9505; val_kl_reg_loss: 20233.1753; val_edge_recon_loss: 2238481.1622; val_gene_expr_recon_loss: 2219499.1774; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4478213.5338; val_optim_loss: 4478213.5338
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.7123; val_auprc_score: 0.7938; val_best_acc_score: 0.7738; val_best_f1_score: 0.8469; train_kl_reg_loss: 20309.1303; train_edge_recon_loss: 2192569.8419; train_gene_expr_recon_loss: 2203777.5168; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4416656.4917; train_optim_loss: 4416656.4917; val_kl_reg_loss: 20237.0977; val_edge_recon_loss: 2246331.2449; val_gene_expr_recon_loss: 2172090.4291; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4438658.7838; val_optim_loss: 4438658.7838
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.7183; val_auprc_score: 0.7991; val_best_acc_score: 0.7758; val_best_f1_score: 0.8474; train_kl_reg_loss: 20279.3918; train_edge_recon_loss: 2189887.5877; train_gene_expr_recon_loss: 2169052.4902; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4379219.4731; train_optim_loss: 4379219.4731; val_kl_reg_loss: 20237.8235; val_edge_recon_loss: 2245119.3851; val_gene_expr_recon_loss: 2149584.1351; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4414941.3345; val_optim_loss: 4414941.3345
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.7163; val_auprc_score: 0.7976; val_best_acc_score: 0.7743; val_best_f1_score: 0.8482; train_kl_reg_loss: 20304.6425; train_edge_recon_loss: 2188183.2413; train_gene_expr_recon_loss: 2149290.6398; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4357778.5064; train_optim_loss: 4357778.5064; val_kl_reg_loss: 20187.6947; val_edge_recon_loss: 2232546.3953; val_gene_expr_recon_loss: 2132893.4679; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4385627.6014; val_optim_loss: 4385627.6014
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.7133; val_auprc_score: 0.7983; val_best_acc_score: 0.7730; val_best_f1_score: 0.8473; train_kl_reg_loss: 20296.4173; train_edge_recon_loss: 2194200.4181; train_gene_expr_recon_loss: 2135448.6880; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4349945.5166; train_optim_loss: 4349945.5166; val_kl_reg_loss: 20270.3938; val_edge_recon_loss: 2237616.5777; val_gene_expr_recon_loss: 2127665.0980; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4385552.0574; val_optim_loss: 4385552.0574
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.7099; val_auprc_score: 0.7938; val_best_acc_score: 0.7720; val_best_f1_score: 0.8459; train_kl_reg_loss: 20298.0420; train_edge_recon_loss: 2192478.1744; train_gene_expr_recon_loss: 2128664.9410; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4341441.1615; train_optim_loss: 4341441.1615; val_kl_reg_loss: 20210.5013; val_edge_recon_loss: 2246092.2584; val_gene_expr_recon_loss: 2113765.4020; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4380068.1993; val_optim_loss: 4380068.1993
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.7135; val_auprc_score: 0.7969; val_best_acc_score: 0.7733; val_best_f1_score: 0.8474; train_kl_reg_loss: 20292.2118; train_edge_recon_loss: 2196042.2307; train_gene_expr_recon_loss: 2123362.6507; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4339697.1059; train_optim_loss: 4339697.1059; val_kl_reg_loss: 20227.3159; val_edge_recon_loss: 2232545.8716; val_gene_expr_recon_loss: 2112994.4966; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4365767.6993; val_optim_loss: 4365767.6993
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.7134; val_auprc_score: 0.7972; val_best_acc_score: 0.7753; val_best_f1_score: 0.8485; train_kl_reg_loss: 20299.7609; train_edge_recon_loss: 2190424.8300; train_gene_expr_recon_loss: 2119480.6861; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4330205.2712; train_optim_loss: 4330205.2712; val_kl_reg_loss: 20222.5504; val_edge_recon_loss: 2228781.2922; val_gene_expr_recon_loss: 2109753.9578; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4358757.7905; val_optim_loss: 4358757.7905
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.7187; val_auprc_score: 0.7983; val_best_acc_score: 0.7752; val_best_f1_score: 0.8480; train_kl_reg_loss: 20310.3303; train_edge_recon_loss: 2196922.1019; train_gene_expr_recon_loss: 2116632.6154; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4333865.0530; train_optim_loss: 4333865.0530; val_kl_reg_loss: 20182.7738; val_edge_recon_loss: 2242082.0338; val_gene_expr_recon_loss: 2105176.1976; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4367441.0169; val_optim_loss: 4367441.0169
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.7112; val_auprc_score: 0.7941; val_best_acc_score: 0.7741; val_best_f1_score: 0.8475; train_kl_reg_loss: 20305.1192; train_edge_recon_loss: 2193206.2665; train_gene_expr_recon_loss: 2116293.8761; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4329805.2757; train_optim_loss: 4329805.2757; val_kl_reg_loss: 20231.9054; val_edge_recon_loss: 2245822.4949; val_gene_expr_recon_loss: 2103953.5709; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4370007.9865; val_optim_loss: 4370007.9865
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.7146; val_auprc_score: 0.7954; val_best_acc_score: 0.7746; val_best_f1_score: 0.8477; train_kl_reg_loss: 20298.2023; train_edge_recon_loss: 2188734.4576; train_gene_expr_recon_loss: 2114489.4363; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4323522.0972; train_optim_loss: 4323522.0972; val_kl_reg_loss: 20213.1523; val_edge_recon_loss: 2243072.3750; val_gene_expr_recon_loss: 2102208.8395; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4365494.3345; val_optim_loss: 4365494.3345
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.7098; val_auprc_score: 0.7946; val_best_acc_score: 0.7720; val_best_f1_score: 0.8465; train_kl_reg_loss: 20302.5818; train_edge_recon_loss: 2196893.4196; train_gene_expr_recon_loss: 2113853.6080; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4331049.6188; train_optim_loss: 4331049.6188; val_kl_reg_loss: 20207.6334; val_edge_recon_loss: 2246024.4459; val_gene_expr_recon_loss: 2099477.9814; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4365710.0946; val_optim_loss: 4365710.0946

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.7159; val_auprc_score: 0.7974; val_best_acc_score: 0.7742; val_best_f1_score: 0.8472; train_kl_reg_loss: 20295.3500; train_edge_recon_loss: 2192627.3773; train_gene_expr_recon_loss: 2110224.2916; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4323147.0374; train_optim_loss: 4323147.0374; val_kl_reg_loss: 20216.8666; val_edge_recon_loss: 2237891.7483; val_gene_expr_recon_loss: 2102614.9189; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4360723.5203; val_optim_loss: 4360723.5203
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.7127; val_auprc_score: 0.7971; val_best_acc_score: 0.7742; val_best_f1_score: 0.8482; train_kl_reg_loss: 20301.2437; train_edge_recon_loss: 2193446.0070; train_gene_expr_recon_loss: 2110991.8003; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4324739.0461; train_optim_loss: 4324739.0461; val_kl_reg_loss: 20227.1741; val_edge_recon_loss: 2224850.6892; val_gene_expr_recon_loss: 2103488.3564; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4348566.2095; val_optim_loss: 4348566.2095
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.7118; val_auprc_score: 0.7964; val_best_acc_score: 0.7737; val_best_f1_score: 0.8476; train_kl_reg_loss: 20280.9211; train_edge_recon_loss: 2190720.8828; train_gene_expr_recon_loss: 2109897.0176; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4320898.8385; train_optim_loss: 4320898.8385; val_kl_reg_loss: 20235.1897; val_edge_recon_loss: 2233473.0963; val_gene_expr_recon_loss: 2102589.0743; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4356297.3919; val_optim_loss: 4356297.3919
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.7144; val_auprc_score: 0.7970; val_best_acc_score: 0.7753; val_best_f1_score: 0.8482; train_kl_reg_loss: 20293.2384; train_edge_recon_loss: 2191445.2341; train_gene_expr_recon_loss: 2110320.4839; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4322058.9573; train_optim_loss: 4322058.9573; val_kl_reg_loss: 20246.9683; val_edge_recon_loss: 2226105.5997; val_gene_expr_recon_loss: 2104687.7247; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4351040.2939; val_optim_loss: 4351040.2939
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.7128; val_auprc_score: 0.7987; val_best_acc_score: 0.7754; val_best_f1_score: 0.8487; train_kl_reg_loss: 20304.7299; train_edge_recon_loss: 2190835.4658; train_gene_expr_recon_loss: 2110991.8990; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4322132.0930; train_optim_loss: 4322132.0930; val_kl_reg_loss: 20217.7668; val_edge_recon_loss: 2219883.3497; val_gene_expr_recon_loss: 2101842.5997; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4341943.7230; val_optim_loss: 4341943.7230
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.7153; val_auprc_score: 0.7985; val_best_acc_score: 0.7739; val_best_f1_score: 0.8478; train_kl_reg_loss: 20300.0575; train_edge_recon_loss: 2188823.1541; train_gene_expr_recon_loss: 2109730.2457; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4318853.4542; train_optim_loss: 4318853.4542; val_kl_reg_loss: 20199.4450; val_edge_recon_loss: 2234890.2872; val_gene_expr_recon_loss: 2104103.5929; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4359193.3446; val_optim_loss: 4359193.3446
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.7142; val_auprc_score: 0.7963; val_best_acc_score: 0.7739; val_best_f1_score: 0.8471; train_kl_reg_loss: 20305.9646; train_edge_recon_loss: 2195565.3476; train_gene_expr_recon_loss: 2108703.0142; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4324574.3306; train_optim_loss: 4324574.3306; val_kl_reg_loss: 20229.0888; val_edge_recon_loss: 2241508.9527; val_gene_expr_recon_loss: 2105308.5422; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4367046.5743; val_optim_loss: 4367046.5743
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.7097; val_auprc_score: 0.7949; val_best_acc_score: 0.7714; val_best_f1_score: 0.8461; train_kl_reg_loss: 20295.0926; train_edge_recon_loss: 2192089.4858; train_gene_expr_recon_loss: 2109869.7267; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4322254.2954; train_optim_loss: 4322254.2954; val_kl_reg_loss: 20236.6249; val_edge_recon_loss: 2247988.7449; val_gene_expr_recon_loss: 2106648.1605; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4374873.5405; val_optim_loss: 4374873.5405
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.7141; val_auprc_score: 0.7980; val_best_acc_score: 0.7765; val_best_f1_score: 0.8490; train_kl_reg_loss: 20312.8495; train_edge_recon_loss: 2195593.8387; train_gene_expr_recon_loss: 2109044.6305; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4324951.3283; train_optim_loss: 4324951.3283; val_kl_reg_loss: 20222.0370; val_edge_recon_loss: 2212721.4459; val_gene_expr_recon_loss: 2100130.9189; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4333074.3615; val_optim_loss: 4333074.3615
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.7124; val_auprc_score: 0.7959; val_best_acc_score: 0.7740; val_best_f1_score: 0.8474; train_kl_reg_loss: 20295.4846; train_edge_recon_loss: 2193786.4323; train_gene_expr_recon_loss: 2109779.1959; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4323861.1040; train_optim_loss: 4323861.1040; val_kl_reg_loss: 20235.6664; val_edge_recon_loss: 2236939.8007; val_gene_expr_recon_loss: 2099376.1047; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4356551.5574; val_optim_loss: 4356551.5574
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.7156; val_auprc_score: 0.7976; val_best_acc_score: 0.7756; val_best_f1_score: 0.8485; train_kl_reg_loss: 20297.5004; train_edge_recon_loss: 2191815.8716; train_gene_expr_recon_loss: 2110504.8376; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4322618.2076; train_optim_loss: 4322618.2076; val_kl_reg_loss: 20222.0238; val_edge_recon_loss: 2232654.8328; val_gene_expr_recon_loss: 2105663.3091; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4358540.1689; val_optim_loss: 4358540.1689
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.7118; val_auprc_score: 0.7968; val_best_acc_score: 0.7755; val_best_f1_score: 0.8487; train_kl_reg_loss: 20298.2749; train_edge_recon_loss: 2195047.3899; train_gene_expr_recon_loss: 2108733.3086; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4324078.9724; train_optim_loss: 4324078.9724; val_kl_reg_loss: 20193.3540; val_edge_recon_loss: 2218292.1537; val_gene_expr_recon_loss: 2100583.1858; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4339068.6791; val_optim_loss: 4339068.6791
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.7087; val_auprc_score: 0.7919; val_best_acc_score: 0.7696; val_best_f1_score: 0.8454; train_kl_reg_loss: 20296.2788; train_edge_recon_loss: 2197909.8277; train_gene_expr_recon_loss: 2097901.5669; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4316107.6660; train_optim_loss: 4316107.6660; val_kl_reg_loss: 19921.5855; val_edge_recon_loss: 2245065.1571; val_gene_expr_recon_loss: 2092279.0659; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4357265.7804; val_optim_loss: 4357265.7804

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.7061; val_auprc_score: 0.7931; val_best_acc_score: 0.7720; val_best_f1_score: 0.8468; train_kl_reg_loss: 20294.8873; train_edge_recon_loss: 2193184.6783; train_gene_expr_recon_loss: 2097192.7118; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4310672.2791; train_optim_loss: 4310672.2791; val_kl_reg_loss: 19917.7293; val_edge_recon_loss: 2227189.8429; val_gene_expr_recon_loss: 2089677.2297; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4336784.8142; val_optim_loss: 4336784.8142
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.7064; val_auprc_score: 0.7921; val_best_acc_score: 0.7693; val_best_f1_score: 0.8452; train_kl_reg_loss: 20305.8364; train_edge_recon_loss: 2194826.6248; train_gene_expr_recon_loss: 2097871.3599; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4313003.8132; train_optim_loss: 4313003.8132; val_kl_reg_loss: 19909.6053; val_edge_recon_loss: 2242796.4561; val_gene_expr_recon_loss: 2087290.8564; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4349996.9088; val_optim_loss: 4349996.9088
Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.7093; val_auprc_score: 0.7921; val_best_acc_score: 0.7705; val_best_f1_score: 0.8452; train_kl_reg_loss: 20292.7175; train_edge_recon_loss: 2197868.3937; train_gene_expr_recon_loss: 2096960.3947; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4315121.5102; train_optim_loss: 4315121.5102; val_kl_reg_loss: 19928.5595; val_edge_recon_loss: 2248266.6571; val_gene_expr_recon_loss: 2091670.9932; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4359866.2027; val_optim_loss: 4359866.2027
Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.7057; val_auprc_score: 0.7909; val_best_acc_score: 0.7676; val_best_f1_score: 0.8437; train_kl_reg_loss: 20292.1191; train_edge_recon_loss: 2198387.8582; train_gene_expr_recon_loss: 2097938.1237; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4316618.1025; train_optim_loss: 4316618.1025; val_kl_reg_loss: 19906.5783; val_edge_recon_loss: 2261338.6757; val_gene_expr_recon_loss: 2087792.8581; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4369038.1284; val_optim_loss: 4369038.1284

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 43 min 34 sec.
Using best model state, which was in epoch 22.

--- MODEL EVALUATION ---
val AUROC score: 0.7095
val AUPRC score: 0.7920
val best accuracy score: 0.7733
val best F1 score: 0.8474
val target rna MSE score: 8.5755
val source rna MSE score: 0.7292
Val cat covariate0 mean sim diff: -0.1468
Val cat covariate1 mean sim diff: -0.0911
Val cat covariate2 mean sim diff: -0.1468

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
