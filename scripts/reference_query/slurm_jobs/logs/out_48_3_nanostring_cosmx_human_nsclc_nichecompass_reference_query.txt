Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch3', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '19102023_172905_48', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_cat_covariates_contrastive', '0.', '--contrastive_logits_pos_ratio', '0.', '--contrastive_logits_neg_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '50', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 82522
Number of validation nodes: 9169
Number of training edges: 195815
Number of validation edges: 21757
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9593; val_auprc_score: 0.9543; val_best_acc_score: 0.8945; val_best_f1_score: 0.8974; train_kl_reg_loss: 80927.0857; train_edge_recon_loss: 26924058.6214; train_gene_expr_recon_loss: 20812620.5379; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 47826094.2559; train_optim_loss: 47826094.2559; val_kl_reg_loss: 81317.4359; val_edge_recon_loss: 27749253.2093; val_gene_expr_recon_loss: 20150003.3023; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47989062.0465; val_optim_loss: 47989062.0465
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9584; val_auprc_score: 0.9532; val_best_acc_score: 0.8945; val_best_f1_score: 0.8973; train_kl_reg_loss: 80916.7151; train_edge_recon_loss: 26921558.5744; train_gene_expr_recon_loss: 19921119.2846; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46932082.4334; train_optim_loss: 46932082.4334; val_kl_reg_loss: 81348.3788; val_edge_recon_loss: 27758266.7907; val_gene_expr_recon_loss: 19863749.3953; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47711852.9302; val_optim_loss: 47711852.9302
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9578; val_auprc_score: 0.9531; val_best_acc_score: 0.8944; val_best_f1_score: 0.8976; train_kl_reg_loss: 80895.7675; train_edge_recon_loss: 26911950.7154; train_gene_expr_recon_loss: 19728864.7258; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46730199.2585; train_optim_loss: 46730199.2585; val_kl_reg_loss: 81265.5144; val_edge_recon_loss: 27807438.4186; val_gene_expr_recon_loss: 19748529.7674; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47645721.5814; val_optim_loss: 47645721.5814
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9576; val_auprc_score: 0.9519; val_best_acc_score: 0.8951; val_best_f1_score: 0.8978; train_kl_reg_loss: 80904.7737; train_edge_recon_loss: 26900497.2742; train_gene_expr_recon_loss: 19634714.9713; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46624605.1175; train_optim_loss: 46624605.1175; val_kl_reg_loss: 81364.6288; val_edge_recon_loss: 27762701.5349; val_gene_expr_recon_loss: 19664851.0233; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47517405.2093; val_optim_loss: 47517405.2093
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9580; val_auprc_score: 0.9525; val_best_acc_score: 0.8957; val_best_f1_score: 0.8979; train_kl_reg_loss: 80923.1283; train_edge_recon_loss: 26906696.9347; train_gene_expr_recon_loss: 19560378.8616; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46556486.9661; train_optim_loss: 46556486.9661; val_kl_reg_loss: 81173.8810; val_edge_recon_loss: 27783408.0000; val_gene_expr_recon_loss: 19577300.6512; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47450370.6047; val_optim_loss: 47450370.6047
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9582; val_auprc_score: 0.9530; val_best_acc_score: 0.8952; val_best_f1_score: 0.8981; train_kl_reg_loss: 80891.7057; train_edge_recon_loss: 26902026.9869; train_gene_expr_recon_loss: 19511749.5144; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46503156.2820; train_optim_loss: 46503156.2820; val_kl_reg_loss: 81212.4488; val_edge_recon_loss: 27769103.5814; val_gene_expr_recon_loss: 19531551.3953; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47390355.3488; val_optim_loss: 47390355.3488
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9565; val_auprc_score: 0.9499; val_best_acc_score: 0.8941; val_best_f1_score: 0.8973; train_kl_reg_loss: 80870.3876; train_edge_recon_loss: 26910609.3525; train_gene_expr_recon_loss: 19453501.0496; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46453468.8146; train_optim_loss: 46453468.8146; val_kl_reg_loss: 81185.0498; val_edge_recon_loss: 27788670.3721; val_gene_expr_recon_loss: 19467527.5349; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47345870.6977; val_optim_loss: 47345870.6977
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9562; val_auprc_score: 0.9505; val_best_acc_score: 0.8920; val_best_f1_score: 0.8950; train_kl_reg_loss: 80883.5653; train_edge_recon_loss: 26903487.2115; train_gene_expr_recon_loss: 19426902.7676; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46419761.5352; train_optim_loss: 46419761.5352; val_kl_reg_loss: 81432.3096; val_edge_recon_loss: 27833413.5814; val_gene_expr_recon_loss: 19548815.9070; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47472149.8605; val_optim_loss: 47472149.8605
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9575; val_auprc_score: 0.9524; val_best_acc_score: 0.8943; val_best_f1_score: 0.8966; train_kl_reg_loss: 80910.2228; train_edge_recon_loss: 26915584.1932; train_gene_expr_recon_loss: 19429323.9321; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46434306.3499; train_optim_loss: 46434306.3499; val_kl_reg_loss: 81299.4281; val_edge_recon_loss: 27796725.5349; val_gene_expr_recon_loss: 19470495.7209; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47357008.7442; val_optim_loss: 47357008.7442
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9567; val_auprc_score: 0.9516; val_best_acc_score: 0.8912; val_best_f1_score: 0.8938; train_kl_reg_loss: 80889.9744; train_edge_recon_loss: 26894362.6580; train_gene_expr_recon_loss: 19402975.9634; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46386716.6057; train_optim_loss: 46386716.6057; val_kl_reg_loss: 81113.5343; val_edge_recon_loss: 27858570.6512; val_gene_expr_recon_loss: 19474772.5116; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47422944.7442; val_optim_loss: 47422944.7442
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9572; val_auprc_score: 0.9515; val_best_acc_score: 0.8939; val_best_f1_score: 0.8965; train_kl_reg_loss: 80908.2038; train_edge_recon_loss: 26904708.8982; train_gene_expr_recon_loss: 19388923.7337; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46383028.8564; train_optim_loss: 46383028.8564; val_kl_reg_loss: 81334.0616; val_edge_recon_loss: 27795463.8605; val_gene_expr_recon_loss: 19472331.9535; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47357617.7674; val_optim_loss: 47357617.7674

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9567; val_auprc_score: 0.9507; val_best_acc_score: 0.8928; val_best_f1_score: 0.8956; train_kl_reg_loss: 80928.7129; train_edge_recon_loss: 26912881.1279; train_gene_expr_recon_loss: 19390471.9634; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46392769.7337; train_optim_loss: 46392769.7337; val_kl_reg_loss: 81298.8783; val_edge_recon_loss: 27849238.6047; val_gene_expr_recon_loss: 19467974.6977; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47407000.0930; val_optim_loss: 47407000.0930
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9569; val_auprc_score: 0.9517; val_best_acc_score: 0.8919; val_best_f1_score: 0.8952; train_kl_reg_loss: 80922.7368; train_edge_recon_loss: 26900800.2663; train_gene_expr_recon_loss: 19390470.1253; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46380681.2533; train_optim_loss: 46380681.2533; val_kl_reg_loss: 81280.7531; val_edge_recon_loss: 27809561.8605; val_gene_expr_recon_loss: 19468646.7907; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47367977.2093; val_optim_loss: 47367977.2093
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9590; val_auprc_score: 0.9540; val_best_acc_score: 0.8955; val_best_f1_score: 0.8980; train_kl_reg_loss: 80921.3471; train_edge_recon_loss: 26898340.9922; train_gene_expr_recon_loss: 19379793.8695; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46367544.1775; train_optim_loss: 46367544.1775; val_kl_reg_loss: 81340.8134; val_edge_recon_loss: 27781384.9767; val_gene_expr_recon_loss: 19450718.0465; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47321931.7209; val_optim_loss: 47321931.7209
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9575; val_auprc_score: 0.9522; val_best_acc_score: 0.8930; val_best_f1_score: 0.8961; train_kl_reg_loss: 80945.7464; train_edge_recon_loss: 26905964.8512; train_gene_expr_recon_loss: 19386162.8930; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46381561.3681; train_optim_loss: 46381561.3681; val_kl_reg_loss: 81212.6441; val_edge_recon_loss: 27813103.2093; val_gene_expr_recon_loss: 19471279.1163; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47374082.6977; val_optim_loss: 47374082.6977
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9574; val_auprc_score: 0.9517; val_best_acc_score: 0.8941; val_best_f1_score: 0.8965; train_kl_reg_loss: 80886.7877; train_edge_recon_loss: 26904777.5405; train_gene_expr_recon_loss: 19366609.0183; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46360761.2115; train_optim_loss: 46360761.2115; val_kl_reg_loss: 81344.6761; val_edge_recon_loss: 27805221.3023; val_gene_expr_recon_loss: 19486947.8605; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47382001.7674; val_optim_loss: 47382001.7674
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9575; val_auprc_score: 0.9517; val_best_acc_score: 0.8947; val_best_f1_score: 0.8980; train_kl_reg_loss: 80951.1473; train_edge_recon_loss: 26903881.6554; train_gene_expr_recon_loss: 19360256.5170; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46353577.2115; train_optim_loss: 46353577.2115; val_kl_reg_loss: 81235.6163; val_edge_recon_loss: 27737795.7674; val_gene_expr_recon_loss: 19371829.5349; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47199348.8372; val_optim_loss: 47199348.8372
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.9575; val_auprc_score: 0.9524; val_best_acc_score: 0.8933; val_best_f1_score: 0.8962; train_kl_reg_loss: 80915.4219; train_edge_recon_loss: 26923733.7963; train_gene_expr_recon_loss: 19379700.8616; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46392838.0052; train_optim_loss: 46392838.0052; val_kl_reg_loss: 81277.0643; val_edge_recon_loss: 27825807.4884; val_gene_expr_recon_loss: 19396589.4884; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47312162.2326; val_optim_loss: 47312162.2326
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.9570; val_auprc_score: 0.9517; val_best_acc_score: 0.8927; val_best_f1_score: 0.8954; train_kl_reg_loss: 80921.8941; train_edge_recon_loss: 26895101.5875; train_gene_expr_recon_loss: 19380435.2846; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46364946.8198; train_optim_loss: 46364946.8198; val_kl_reg_loss: 81357.0580; val_edge_recon_loss: 27843399.2558; val_gene_expr_recon_loss: 19421559.5349; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47354803.9070; val_optim_loss: 47354803.9070
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.9579; val_auprc_score: 0.9530; val_best_acc_score: 0.8948; val_best_f1_score: 0.8974; train_kl_reg_loss: 80905.5772; train_edge_recon_loss: 26885279.9687; train_gene_expr_recon_loss: 19358629.3368; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46333302.9556; train_optim_loss: 46333302.9556; val_kl_reg_loss: 81296.1007; val_edge_recon_loss: 27768050.0465; val_gene_expr_recon_loss: 19434604.4186; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47292438.3256; val_optim_loss: 47292438.3256
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.9552; val_auprc_score: 0.9490; val_best_acc_score: 0.8910; val_best_f1_score: 0.8941; train_kl_reg_loss: 80897.7583; train_edge_recon_loss: 26914132.5796; train_gene_expr_recon_loss: 19369754.1984; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46373272.4804; train_optim_loss: 46373272.4804; val_kl_reg_loss: 81252.2102; val_edge_recon_loss: 27851666.3256; val_gene_expr_recon_loss: 19445903.8140; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47387310.5116; val_optim_loss: 47387310.5116

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.9579; val_auprc_score: 0.9526; val_best_acc_score: 0.8941; val_best_f1_score: 0.8963; train_kl_reg_loss: 80876.5805; train_edge_recon_loss: 26904292.0366; train_gene_expr_recon_loss: 19361257.0653; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46354913.7128; train_optim_loss: 46354913.7128; val_kl_reg_loss: 81260.4949; val_edge_recon_loss: 27792054.2326; val_gene_expr_recon_loss: 19403757.1163; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47285560.1860; val_optim_loss: 47285560.1860
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.9586; val_auprc_score: 0.9533; val_best_acc_score: 0.8947; val_best_f1_score: 0.8979; train_kl_reg_loss: 80889.4605; train_edge_recon_loss: 26897226.9869; train_gene_expr_recon_loss: 19354327.0444; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46340931.5300; train_optim_loss: 46340931.5300; val_kl_reg_loss: 81393.0712; val_edge_recon_loss: 27709560.7907; val_gene_expr_recon_loss: 19436020.9767; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47235462.7907; val_optim_loss: 47235462.7907
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.9573; val_auprc_score: 0.9519; val_best_acc_score: 0.8936; val_best_f1_score: 0.8965; train_kl_reg_loss: 80916.7703; train_edge_recon_loss: 26912138.5796; train_gene_expr_recon_loss: 19361405.5039; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46362948.8251; train_optim_loss: 46362948.8251; val_kl_reg_loss: 81403.1348; val_edge_recon_loss: 27744533.3023; val_gene_expr_recon_loss: 19399072.2791; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47233496.7442; val_optim_loss: 47233496.7442
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.9565; val_auprc_score: 0.9506; val_best_acc_score: 0.8928; val_best_f1_score: 0.8956; train_kl_reg_loss: 80873.0538; train_edge_recon_loss: 26914887.0757; train_gene_expr_recon_loss: 19381120.1984; train_masked_gp_l1_reg_loss: 8486.1709; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46385368.3029; train_optim_loss: 46385368.3029; val_kl_reg_loss: 81321.6608; val_edge_recon_loss: 27796451.8140; val_gene_expr_recon_loss: 19467837.9070; val_masked_gp_l1_reg_loss: 8486.1709; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47354099.6279; val_optim_loss: 47354099.6279

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 16 min 58 sec.
Using best model state, which was in epoch 17.

--- MODEL EVALUATION ---
val AUROC score: 0.9577
val AUPRC score: 0.9520
val best accuracy score: 0.8944
val best F1 score: 0.8977
val target rna MSE score: 0.7680
val source rna MSE score: 0.2065
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0706
Val cat covariate2 mean sim diff: nan

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
