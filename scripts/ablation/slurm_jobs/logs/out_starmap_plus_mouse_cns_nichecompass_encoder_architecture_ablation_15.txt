None
Run timestamp: 05082023_035732_15.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'starmap_plus_mouse_cns', '--reference_batches', 'batch1', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'encoder_architecture_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_fc_layers_encoder', '2', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '500000.0', '--lambda_gene_expr_recon', '300.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '256', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_15']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 1022, n_cat_covariates_embed_input: 0, n_hidden: 1022, n_latent: 1423, n_addon_latent: 10, n_fc_layers: 2, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1423, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 1022
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1423, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 1022

--- INITIALIZING TRAINER ---
Number of training nodes: 82121
Number of validation nodes: 9125
Number of training edges: 556218
Number of validation edges: 61801
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9869; val_auprc_score: 0.9821; val_best_acc_score: 0.9581; val_best_f1_score: 0.9590; train_kl_reg_loss: 7507.3396; train_edge_recon_loss: 263342.6070; train_gene_expr_recon_loss: 196359.0660; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 467209.0125; train_optim_loss: 467209.0125; val_kl_reg_loss: 7486.0429; val_edge_recon_loss: 259679.3765; val_gene_expr_recon_loss: 180433.7253; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 447599.1451; val_optim_loss: 447599.1451
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9890; val_auprc_score: 0.9847; val_best_acc_score: 0.9635; val_best_f1_score: 0.9642; train_kl_reg_loss: 6475.8990; train_edge_recon_loss: 259046.7565; train_gene_expr_recon_loss: 170385.6043; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 435908.2595; train_optim_loss: 435908.2595; val_kl_reg_loss: 7123.0408; val_edge_recon_loss: 258855.9387; val_gene_expr_recon_loss: 175193.8514; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 441172.8306; val_optim_loss: 441172.8306
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9906; val_auprc_score: 0.9873; val_best_acc_score: 0.9679; val_best_f1_score: 0.9684; train_kl_reg_loss: 5896.7335; train_edge_recon_loss: 258019.3957; train_gene_expr_recon_loss: 162056.4735; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 425972.6026; train_optim_loss: 425972.6026; val_kl_reg_loss: 7133.0721; val_edge_recon_loss: 257705.9164; val_gene_expr_recon_loss: 178426.1214; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 443265.1105; val_optim_loss: 443265.1105
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9858; val_auprc_score: 0.9800; val_best_acc_score: 0.9597; val_best_f1_score: 0.9607; train_kl_reg_loss: 2572802.6519; train_edge_recon_loss: 260460.0509; train_gene_expr_recon_loss: 164614.3004; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2997877.0172; train_optim_loss: 2997877.0172; val_kl_reg_loss: 8940.6712; val_edge_recon_loss: 261734.6386; val_gene_expr_recon_loss: 164701.0775; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 435376.3866; val_optim_loss: 435376.3866
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9881; val_auprc_score: 0.9834; val_best_acc_score: 0.9640; val_best_f1_score: 0.9648; train_kl_reg_loss: 7942.0730; train_edge_recon_loss: 260652.0035; train_gene_expr_recon_loss: 164291.1611; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 432885.2381; train_optim_loss: 432885.2381; val_kl_reg_loss: 8365.0537; val_edge_recon_loss: 260558.4441; val_gene_expr_recon_loss: 163255.6909; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 432179.1889; val_optim_loss: 432179.1889
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9879; val_auprc_score: 0.9827; val_best_acc_score: 0.9633; val_best_f1_score: 0.9641; train_kl_reg_loss: 7996.0296; train_edge_recon_loss: 260085.5846; train_gene_expr_recon_loss: 162770.6052; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 430852.2192; train_optim_loss: 430852.2192; val_kl_reg_loss: 8109.0592; val_edge_recon_loss: 260211.5342; val_gene_expr_recon_loss: 162653.9338; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 430974.5278; val_optim_loss: 430974.5278
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9891; val_auprc_score: 0.9845; val_best_acc_score: 0.9657; val_best_f1_score: 0.9665; train_kl_reg_loss: 7557.4119; train_edge_recon_loss: 259651.7758; train_gene_expr_recon_loss: 161705.5617; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 428914.7493; train_optim_loss: 428914.7493; val_kl_reg_loss: 7787.5545; val_edge_recon_loss: 259367.9737; val_gene_expr_recon_loss: 163765.6924; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 430921.2203; val_optim_loss: 430921.2203
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9902; val_auprc_score: 0.9862; val_best_acc_score: 0.9677; val_best_f1_score: 0.9684; train_kl_reg_loss: 7627.9770; train_edge_recon_loss: 259437.8636; train_gene_expr_recon_loss: 160667.5751; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 427733.4155; train_optim_loss: 427733.4155; val_kl_reg_loss: 7863.2882; val_edge_recon_loss: 259252.6992; val_gene_expr_recon_loss: 161140.5924; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 428256.5803; val_optim_loss: 428256.5803
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9914; val_auprc_score: 0.9881; val_best_acc_score: 0.9697; val_best_f1_score: 0.9702; train_kl_reg_loss: 7240.6054; train_edge_recon_loss: 259083.1360; train_gene_expr_recon_loss: 159500.2302; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 425823.9715; train_optim_loss: 425823.9715; val_kl_reg_loss: 7732.1252; val_edge_recon_loss: 258849.4329; val_gene_expr_recon_loss: 161683.1205; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 428264.6792; val_optim_loss: 428264.6792
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9913; val_auprc_score: 0.9881; val_best_acc_score: 0.9691; val_best_f1_score: 0.9696; train_kl_reg_loss: 6944.1728; train_edge_recon_loss: 258698.9912; train_gene_expr_recon_loss: 157904.4884; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 423547.6522; train_optim_loss: 423547.6522; val_kl_reg_loss: 7845.5604; val_edge_recon_loss: 258383.0132; val_gene_expr_recon_loss: 160334.3144; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 426562.8874; val_optim_loss: 426562.8874
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9913; val_auprc_score: 0.9878; val_best_acc_score: 0.9698; val_best_f1_score: 0.9703; train_kl_reg_loss: 6655.8492; train_edge_recon_loss: 258376.0736; train_gene_expr_recon_loss: 155984.6463; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 421016.5691; train_optim_loss: 421016.5691; val_kl_reg_loss: 7659.0366; val_edge_recon_loss: 258312.3271; val_gene_expr_recon_loss: 159065.3782; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 425036.7411; val_optim_loss: 425036.7411
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9917; val_auprc_score: 0.9879; val_best_acc_score: 0.9718; val_best_f1_score: 0.9722; train_kl_reg_loss: 6405.7203; train_edge_recon_loss: 257958.9499; train_gene_expr_recon_loss: 154304.3700; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 418669.0405; train_optim_loss: 418669.0405; val_kl_reg_loss: 7860.9857; val_edge_recon_loss: 257458.4963; val_gene_expr_recon_loss: 161410.2402; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 426729.7221; val_optim_loss: 426729.7221
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9927; val_auprc_score: 0.9905; val_best_acc_score: 0.9705; val_best_f1_score: 0.9710; train_kl_reg_loss: 6140.0040; train_edge_recon_loss: 257632.5823; train_gene_expr_recon_loss: 152619.0903; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 416391.6770; train_optim_loss: 416391.6770; val_kl_reg_loss: 7629.7284; val_edge_recon_loss: 257307.9300; val_gene_expr_recon_loss: 168921.3351; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 433858.9930; val_optim_loss: 433858.9930
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9927; val_auprc_score: 0.9904; val_best_acc_score: 0.9707; val_best_f1_score: 0.9711; train_kl_reg_loss: 5928.7770; train_edge_recon_loss: 257194.5534; train_gene_expr_recon_loss: 150988.3408; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 414111.6715; train_optim_loss: 414111.6715; val_kl_reg_loss: 7196.7216; val_edge_recon_loss: 256995.0233; val_gene_expr_recon_loss: 172173.6892; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 436365.4358; val_optim_loss: 436365.4358
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9934; val_auprc_score: 0.9916; val_best_acc_score: 0.9725; val_best_f1_score: 0.9729; train_kl_reg_loss: 5994.2733; train_edge_recon_loss: 257253.4283; train_gene_expr_recon_loss: 150165.1474; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 413412.8495; train_optim_loss: 413412.8495; val_kl_reg_loss: 7338.8770; val_edge_recon_loss: 256581.8403; val_gene_expr_recon_loss: 183174.8969; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 447095.6130; val_optim_loss: 447095.6130

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9942; val_auprc_score: 0.9928; val_best_acc_score: 0.9743; val_best_f1_score: 0.9746; train_kl_reg_loss: 5555.5339; train_edge_recon_loss: 256320.6391; train_gene_expr_recon_loss: 146748.1639; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 408624.3369; train_optim_loss: 408624.3369; val_kl_reg_loss: 6905.3094; val_edge_recon_loss: 256354.9898; val_gene_expr_recon_loss: 177073.9204; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 440334.2209; val_optim_loss: 440334.2209
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9945; val_auprc_score: 0.9931; val_best_acc_score: 0.9745; val_best_f1_score: 0.9748; train_kl_reg_loss: 5469.5641; train_edge_recon_loss: 256184.1900; train_gene_expr_recon_loss: 145932.5448; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 407586.2987; train_optim_loss: 407586.2987; val_kl_reg_loss: 7182.7831; val_edge_recon_loss: 256146.3100; val_gene_expr_recon_loss: 182106.3545; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 445435.4474; val_optim_loss: 445435.4474
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9948; val_auprc_score: 0.9935; val_best_acc_score: 0.9753; val_best_f1_score: 0.9757; train_kl_reg_loss: 5417.2943; train_edge_recon_loss: 256056.8543; train_gene_expr_recon_loss: 145215.2120; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 406689.3606; train_optim_loss: 406689.3606; val_kl_reg_loss: 6984.8232; val_edge_recon_loss: 256094.7639; val_gene_expr_recon_loss: 179730.7565; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 442810.3447; val_optim_loss: 442810.3447
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9947; val_auprc_score: 0.9935; val_best_acc_score: 0.9747; val_best_f1_score: 0.9751; train_kl_reg_loss: 5387.2425; train_edge_recon_loss: 255999.8744; train_gene_expr_recon_loss: 144725.9582; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 406113.0755; train_optim_loss: 406113.0755; val_kl_reg_loss: 6837.2570; val_edge_recon_loss: 256219.1196; val_gene_expr_recon_loss: 184921.0495; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 447977.4267; val_optim_loss: 447977.4267

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 273 min 17 sec.
Using best model state, which was in epoch 11.

--- MODEL EVALUATION ---
val AUROC score: 0.9912
val AUPRC score: 0.9875
val best accuracy score: 0.9691
val best F1 score: 0.9696
val target rna MSE score: 0.3528
val source rna MSE score: 0.0726

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
