None
Run timestamp: 11082023_103538_100.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'xenium_human_breast_cancer', '--reference_batches', 'batch1', '--n_neighbors', '16', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '3000', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_100']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 313, n_cat_covariates_embed_input: 0, n_hidden: 313, n_latent: 1302, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1302, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 313
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1302, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 313

--- INITIALIZING TRAINER ---
Number of training nodes: 147600
Number of validation nodes: 16400
Number of training edges: 1319430
Number of validation edges: 146603
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9821; val_auprc_score: 0.9787; val_best_acc_score: 0.9370; val_best_f1_score: 0.9385; train_kl_reg_loss: 16827.9746; train_edge_recon_loss: 26435768.1458; train_gene_expr_recon_loss: 1303888.8951; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 27756485.0023; train_optim_loss: 27756485.0023; val_kl_reg_loss: 14313.0218; val_edge_recon_loss: 26190964.6829; val_gene_expr_recon_loss: 1192357.8467; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 27397635.4983; val_optim_loss: 27397635.4983
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9867; val_auprc_score: 0.9835; val_best_acc_score: 0.9498; val_best_f1_score: 0.9510; train_kl_reg_loss: 13960.1481; train_edge_recon_loss: 25983188.5764; train_gene_expr_recon_loss: 1156232.8061; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 27153381.5353; train_optim_loss: 27153381.5353; val_kl_reg_loss: 13955.5128; val_edge_recon_loss: 26112021.6585; val_gene_expr_recon_loss: 1129393.7234; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 27255370.8990; val_optim_loss: 27255370.8990
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9893; val_auprc_score: 0.9869; val_best_acc_score: 0.9564; val_best_f1_score: 0.9572; train_kl_reg_loss: 13741.4566; train_edge_recon_loss: 25877255.9488; train_gene_expr_recon_loss: 1121662.8952; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 27012660.2948; train_optim_loss: 27012660.2948; val_kl_reg_loss: 13704.1269; val_edge_recon_loss: 25967331.1220; val_gene_expr_recon_loss: 1113567.8258; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 27094603.1010; val_optim_loss: 27094603.1010
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9907; val_auprc_score: 0.9880; val_best_acc_score: 0.9619; val_best_f1_score: 0.9626; train_kl_reg_loss: 13955.7499; train_edge_recon_loss: 25824093.6804; train_gene_expr_recon_loss: 1106036.7327; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26944086.1722; train_optim_loss: 26944086.1722; val_kl_reg_loss: 13722.4569; val_edge_recon_loss: 25864093.3519; val_gene_expr_recon_loss: 1100989.6627; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26978805.4913; val_optim_loss: 26978805.4913
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9915; val_auprc_score: 0.9892; val_best_acc_score: 0.9636; val_best_f1_score: 0.9642; train_kl_reg_loss: 14019.2631; train_edge_recon_loss: 25790487.8945; train_gene_expr_recon_loss: 1097318.3475; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26901825.4818; train_optim_loss: 26901825.4818; val_kl_reg_loss: 13708.3748; val_edge_recon_loss: 25851594.7526; val_gene_expr_recon_loss: 1095571.8868; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26960875.0314; val_optim_loss: 26960875.0314
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9920; val_auprc_score: 0.9900; val_best_acc_score: 0.9652; val_best_f1_score: 0.9657; train_kl_reg_loss: 14126.5218; train_edge_recon_loss: 25760965.3732; train_gene_expr_recon_loss: 1092411.8798; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26867503.7735; train_optim_loss: 26867503.7735; val_kl_reg_loss: 14238.2584; val_edge_recon_loss: 25832573.4843; val_gene_expr_recon_loss: 1090231.2027; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26937042.9895; val_optim_loss: 26937042.9895
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9930; val_auprc_score: 0.9911; val_best_acc_score: 0.9673; val_best_f1_score: 0.9677; train_kl_reg_loss: 14092.7169; train_edge_recon_loss: 25741918.0745; train_gene_expr_recon_loss: 1088431.4758; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26844442.2777; train_optim_loss: 26844442.2777; val_kl_reg_loss: 14039.5552; val_edge_recon_loss: 25819032.5436; val_gene_expr_recon_loss: 1094167.2583; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26927239.4286; val_optim_loss: 26927239.4286
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9934; val_auprc_score: 0.9916; val_best_acc_score: 0.9694; val_best_f1_score: 0.9698; train_kl_reg_loss: 14044.4468; train_edge_recon_loss: 25718473.7735; train_gene_expr_recon_loss: 1085909.7631; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26818427.9465; train_optim_loss: 26818427.9465; val_kl_reg_loss: 13709.7320; val_edge_recon_loss: 25849722.6620; val_gene_expr_recon_loss: 1084069.6588; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26947502.0488; val_optim_loss: 26947502.0488
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9933; val_auprc_score: 0.9914; val_best_acc_score: 0.9703; val_best_f1_score: 0.9707; train_kl_reg_loss: 13981.2027; train_edge_recon_loss: 25712518.9915; train_gene_expr_recon_loss: 1084869.6907; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26811369.8898; train_optim_loss: 26811369.8898; val_kl_reg_loss: 14250.2582; val_edge_recon_loss: 25770891.4983; val_gene_expr_recon_loss: 1082224.9382; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26867366.7178; val_optim_loss: 26867366.7178
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9940; val_auprc_score: 0.9923; val_best_acc_score: 0.9722; val_best_f1_score: 0.9726; train_kl_reg_loss: 14025.4983; train_edge_recon_loss: 25695363.4577; train_gene_expr_recon_loss: 1082310.7576; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26791699.7401; train_optim_loss: 26791699.7401; val_kl_reg_loss: 13968.2983; val_edge_recon_loss: 25791854.8990; val_gene_expr_recon_loss: 1082249.1768; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26888072.4042; val_optim_loss: 26888072.4042
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9937; val_auprc_score: 0.9917; val_best_acc_score: 0.9714; val_best_f1_score: 0.9718; train_kl_reg_loss: 14018.3012; train_edge_recon_loss: 25682988.7207; train_gene_expr_recon_loss: 1080953.8790; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26777960.9286; train_optim_loss: 26777960.9286; val_kl_reg_loss: 13745.0762; val_edge_recon_loss: 25777130.6202; val_gene_expr_recon_loss: 1080636.5070; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26871512.1742; val_optim_loss: 26871512.1742
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9940; val_auprc_score: 0.9924; val_best_acc_score: 0.9727; val_best_f1_score: 0.9730; train_kl_reg_loss: 13948.3599; train_edge_recon_loss: 25673807.1086; train_gene_expr_recon_loss: 1080198.6597; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26767954.1156; train_optim_loss: 26767954.1156; val_kl_reg_loss: 13643.2324; val_edge_recon_loss: 25735905.6446; val_gene_expr_recon_loss: 1081673.6705; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26831222.5645; val_optim_loss: 26831222.5645
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9943; val_auprc_score: 0.9926; val_best_acc_score: 0.9736; val_best_f1_score: 0.9740; train_kl_reg_loss: 13916.5117; train_edge_recon_loss: 25659773.8092; train_gene_expr_recon_loss: 1078765.0401; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26752455.3545; train_optim_loss: 26752455.3545; val_kl_reg_loss: 13867.7815; val_edge_recon_loss: 25777022.2160; val_gene_expr_recon_loss: 1080000.9930; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26870891.0662; val_optim_loss: 26870891.0662
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9948; val_auprc_score: 0.9932; val_best_acc_score: 0.9752; val_best_f1_score: 0.9755; train_kl_reg_loss: 13908.4059; train_edge_recon_loss: 25655813.0745; train_gene_expr_recon_loss: 1078055.5960; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26747777.0636; train_optim_loss: 26747777.0636; val_kl_reg_loss: 13804.1067; val_edge_recon_loss: 25753655.3589; val_gene_expr_recon_loss: 1076980.1971; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26844439.5958; val_optim_loss: 26844439.5958
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9944; val_auprc_score: 0.9927; val_best_acc_score: 0.9749; val_best_f1_score: 0.9752; train_kl_reg_loss: 13866.8268; train_edge_recon_loss: 25646055.7370; train_gene_expr_recon_loss: 1077498.4491; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26737421.0551; train_optim_loss: 26737421.0551; val_kl_reg_loss: 13923.3349; val_edge_recon_loss: 25712924.7456; val_gene_expr_recon_loss: 1078513.9647; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26805362.1115; val_optim_loss: 26805362.1115
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9945; val_auprc_score: 0.9928; val_best_acc_score: 0.9752; val_best_f1_score: 0.9755; train_kl_reg_loss: 13816.5106; train_edge_recon_loss: 25631696.8650; train_gene_expr_recon_loss: 1077783.9423; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26723297.3103; train_optim_loss: 26723297.3103; val_kl_reg_loss: 13580.1965; val_edge_recon_loss: 25714315.6585; val_gene_expr_recon_loss: 1077601.7711; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26805497.6098; val_optim_loss: 26805497.6098
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9948; val_auprc_score: 0.9931; val_best_acc_score: 0.9765; val_best_f1_score: 0.9768; train_kl_reg_loss: 13847.9755; train_edge_recon_loss: 25628807.9403; train_gene_expr_recon_loss: 1076186.5094; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 26718842.4019; train_optim_loss: 26718842.4019; val_kl_reg_loss: 13941.1517; val_edge_recon_loss: 25705703.9582; val_gene_expr_recon_loss: 1076973.8177; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26796618.9408; val_optim_loss: 26796618.9408
