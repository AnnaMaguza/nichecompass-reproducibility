None
Run timestamp: 24072023_201414_14.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'starmap_plus_mouse_cns', '--reference_batches', 'batch1', '--n_neighbors', '20', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '0.1', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'neighbor_sampling_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_14']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 1022, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 1022, n_latent: 1423, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1423, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 2044
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 82121
Number of validation nodes: 9125
Number of training edges: 915209
Number of validation edges: 101689
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9857; val_auprc_score: 0.9818; val_best_acc_score: 0.9484; val_best_f1_score: 0.9496; train_kl_reg_loss: 96100.0307; train_edge_recon_loss: 26426783.0682; train_gene_expr_recon_loss: 11205582.9027; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 37728466.0313; train_optim_loss: 37728466.0313; val_kl_reg_loss: 90555.3348; val_edge_recon_loss: 25998471.6784; val_gene_expr_recon_loss: 10490416.4171; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 36579443.4171; val_optim_loss: 36579443.4171
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9885; val_auprc_score: 0.9854; val_best_acc_score: 0.9573; val_best_f1_score: 0.9583; train_kl_reg_loss: 84239.7690; train_edge_recon_loss: 25883908.0436; train_gene_expr_recon_loss: 10248478.4600; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 36216626.2550; train_optim_loss: 36216626.2550; val_kl_reg_loss: 77554.5562; val_edge_recon_loss: 25853579.4472; val_gene_expr_recon_loss: 10162830.7387; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 36093964.6633; val_optim_loss: 36093964.6633
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9905; val_auprc_score: 0.9877; val_best_acc_score: 0.9635; val_best_f1_score: 0.9642; train_kl_reg_loss: 72552.2860; train_edge_recon_loss: 25754168.6823; train_gene_expr_recon_loss: 10031553.8084; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35858274.7875; train_optim_loss: 35858274.7875; val_kl_reg_loss: 65559.0080; val_edge_recon_loss: 25745952.4623; val_gene_expr_recon_loss: 10026153.1809; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35837664.7035; val_optim_loss: 35837664.7035
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9919; val_auprc_score: 0.9895; val_best_acc_score: 0.9668; val_best_f1_score: 0.9674; train_kl_reg_loss: 65359.7440; train_edge_recon_loss: 25694588.6913; train_gene_expr_recon_loss: 9920302.8501; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35680251.2864; train_optim_loss: 35680251.2864; val_kl_reg_loss: 63586.3816; val_edge_recon_loss: 25722561.7789; val_gene_expr_recon_loss: 9947052.9799; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35733201.1658; val_optim_loss: 35733201.1658
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9923; val_auprc_score: 0.9897; val_best_acc_score: 0.9709; val_best_f1_score: 0.9714; train_kl_reg_loss: 60305.1413; train_edge_recon_loss: 25658271.8702; train_gene_expr_recon_loss: 9854807.5685; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35573384.6443; train_optim_loss: 35573384.6443; val_kl_reg_loss: 59124.4604; val_edge_recon_loss: 25670733.6583; val_gene_expr_recon_loss: 9888555.4950; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35618413.5477; val_optim_loss: 35618413.5477
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9935; val_auprc_score: 0.9916; val_best_acc_score: 0.9719; val_best_f1_score: 0.9723; train_kl_reg_loss: 57143.5974; train_edge_recon_loss: 25630377.5817; train_gene_expr_recon_loss: 9794541.4228; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35482062.5749; train_optim_loss: 35482062.5749; val_kl_reg_loss: 55603.6885; val_edge_recon_loss: 25655163.3166; val_gene_expr_recon_loss: 9843930.5427; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35554697.4874; val_optim_loss: 35554697.4874
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9938; val_auprc_score: 0.9920; val_best_acc_score: 0.9743; val_best_f1_score: 0.9747; train_kl_reg_loss: 54552.4090; train_edge_recon_loss: 25615279.7740; train_gene_expr_recon_loss: 9755080.1658; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35424912.3098; train_optim_loss: 35424912.3098; val_kl_reg_loss: 53886.2225; val_edge_recon_loss: 25611270.3116; val_gene_expr_recon_loss: 9937162.2111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35602318.7538; val_optim_loss: 35602318.7538
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9943; val_auprc_score: 0.9928; val_best_acc_score: 0.9751; val_best_f1_score: 0.9754; train_kl_reg_loss: 52532.7375; train_edge_recon_loss: 25602026.7125; train_gene_expr_recon_loss: 9697331.6390; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35351891.1286; train_optim_loss: 35351891.1286; val_kl_reg_loss: 52547.7037; val_edge_recon_loss: 25622254.2613; val_gene_expr_recon_loss: 9693969.8693; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35368771.9799; val_optim_loss: 35368771.9799
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9942; val_auprc_score: 0.9924; val_best_acc_score: 0.9758; val_best_f1_score: 0.9762; train_kl_reg_loss: 52134.9273; train_edge_recon_loss: 25581279.8937; train_gene_expr_recon_loss: 9543993.1102; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35177407.8814; train_optim_loss: 35177407.8814; val_kl_reg_loss: 49471.8667; val_edge_recon_loss: 25633480.8543; val_gene_expr_recon_loss: 9221658.3492; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 34904610.9146; val_optim_loss: 34904610.9146
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9945; val_auprc_score: 0.9927; val_best_acc_score: 0.9774; val_best_f1_score: 0.9777; train_kl_reg_loss: 50780.3359; train_edge_recon_loss: 25572868.0884; train_gene_expr_recon_loss: 9261062.4835; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 34884710.9027; train_optim_loss: 34884710.9027; val_kl_reg_loss: 49287.0488; val_edge_recon_loss: 25586062.7437; val_gene_expr_recon_loss: 9064834.6533; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 34700184.4925; val_optim_loss: 34700184.4925
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9951; val_auprc_score: 0.9939; val_best_acc_score: 0.9770; val_best_f1_score: 0.9774; train_kl_reg_loss: 50118.3325; train_edge_recon_loss: 25563067.8277; train_gene_expr_recon_loss: 8752949.1437; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 34366135.2662; train_optim_loss: 34366135.2662; val_kl_reg_loss: 49485.6625; val_edge_recon_loss: 25597854.0302; val_gene_expr_recon_loss: 9079830.2286; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 34727169.9899; val_optim_loss: 34727169.9899
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9951; val_auprc_score: 0.9937; val_best_acc_score: 0.9773; val_best_f1_score: 0.9776; train_kl_reg_loss: 49775.7604; train_edge_recon_loss: 25549422.2875; train_gene_expr_recon_loss: 8372283.9541; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33971481.9989; train_optim_loss: 33971481.9989; val_kl_reg_loss: 49328.6054; val_edge_recon_loss: 25598673.8090; val_gene_expr_recon_loss: 8465298.5955; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 34113301.0653; val_optim_loss: 34113301.0653
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9953; val_auprc_score: 0.9938; val_best_acc_score: 0.9790; val_best_f1_score: 0.9792; train_kl_reg_loss: 49126.0020; train_edge_recon_loss: 25554824.2942; train_gene_expr_recon_loss: 8177923.9368; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33781874.2047; train_optim_loss: 33781874.2047; val_kl_reg_loss: 49356.0897; val_edge_recon_loss: 25581241.0251; val_gene_expr_recon_loss: 8316012.6583; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33946609.7286; val_optim_loss: 33946609.7286
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9956; val_auprc_score: 0.9943; val_best_acc_score: 0.9789; val_best_f1_score: 0.9792; train_kl_reg_loss: 48973.0498; train_edge_recon_loss: 25533515.7875; train_gene_expr_recon_loss: 8041127.4877; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33623616.3412; train_optim_loss: 33623616.3412; val_kl_reg_loss: 48709.7136; val_edge_recon_loss: 25572769.6281; val_gene_expr_recon_loss: 8227632.6181; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33849112.0603; val_optim_loss: 33849112.0603
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9956; val_auprc_score: 0.9944; val_best_acc_score: 0.9798; val_best_f1_score: 0.9800; train_kl_reg_loss: 48396.7662; train_edge_recon_loss: 25532314.5940; train_gene_expr_recon_loss: 7990872.6552; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33571584.0112; train_optim_loss: 33571584.0112; val_kl_reg_loss: 47756.0213; val_edge_recon_loss: 25565591.8794; val_gene_expr_recon_loss: 8115347.1784; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33728695.0553; val_optim_loss: 33728695.0553
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9960; val_auprc_score: 0.9950; val_best_acc_score: 0.9800; val_best_f1_score: 0.9802; train_kl_reg_loss: 48065.5878; train_edge_recon_loss: 25531089.0380; train_gene_expr_recon_loss: 7958137.9245; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33537292.5481; train_optim_loss: 33537292.5481; val_kl_reg_loss: 47946.5708; val_edge_recon_loss: 25564721.3367; val_gene_expr_recon_loss: 8158977.1231; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33771644.9146; val_optim_loss: 33771644.9146
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9962; val_auprc_score: 0.9949; val_best_acc_score: 0.9810; val_best_f1_score: 0.9812; train_kl_reg_loss: 48362.4742; train_edge_recon_loss: 25520035.3579; train_gene_expr_recon_loss: 7956807.1809; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33525205.0224; train_optim_loss: 33525205.0224; val_kl_reg_loss: 48963.3285; val_edge_recon_loss: 25553699.6784; val_gene_expr_recon_loss: 7306434.2085; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32909097.2462; val_optim_loss: 32909097.2462
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9959; val_auprc_score: 0.9947; val_best_acc_score: 0.9807; val_best_f1_score: 0.9809; train_kl_reg_loss: 48158.2824; train_edge_recon_loss: 25512983.0134; train_gene_expr_recon_loss: 7943520.4936; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33504661.7740; train_optim_loss: 33504661.7740; val_kl_reg_loss: 47325.1332; val_edge_recon_loss: 25535945.5377; val_gene_expr_recon_loss: 8110156.4397; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33693427.3266; val_optim_loss: 33693427.3266
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9963; val_auprc_score: 0.9952; val_best_acc_score: 0.9811; val_best_f1_score: 0.9813; train_kl_reg_loss: 47813.3675; train_edge_recon_loss: 25514454.1957; train_gene_expr_recon_loss: 7922266.3112; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33484533.8680; train_optim_loss: 33484533.8680; val_kl_reg_loss: 47202.9805; val_edge_recon_loss: 25532083.5678; val_gene_expr_recon_loss: 8130909.5729; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33710196.1407; val_optim_loss: 33710196.1407
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9962; val_auprc_score: 0.9951; val_best_acc_score: 0.9813; val_best_f1_score: 0.9816; train_kl_reg_loss: 47796.3620; train_edge_recon_loss: 25516104.3143; train_gene_expr_recon_loss: 7913552.3750; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33477453.0794; train_optim_loss: 33477453.0794; val_kl_reg_loss: 46631.1020; val_edge_recon_loss: 25548116.8241; val_gene_expr_recon_loss: 8122558.9070; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33717306.9045; val_optim_loss: 33717306.9045
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9961; val_auprc_score: 0.9947; val_best_acc_score: 0.9812; val_best_f1_score: 0.9814; train_kl_reg_loss: 47397.9702; train_edge_recon_loss: 25508636.1152; train_gene_expr_recon_loss: 7912965.4740; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33468999.5257; train_optim_loss: 33468999.5257; val_kl_reg_loss: 47032.4687; val_edge_recon_loss: 25538935.4171; val_gene_expr_recon_loss: 8143990.6005; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33729958.5628; val_optim_loss: 33729958.5628

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9964; val_auprc_score: 0.9952; val_best_acc_score: 0.9810; val_best_f1_score: 0.9812; train_kl_reg_loss: 51192.6825; train_edge_recon_loss: 25495108.8680; train_gene_expr_recon_loss: 7825247.7315; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33371549.2752; train_optim_loss: 33371549.2752; val_kl_reg_loss: 52083.5647; val_edge_recon_loss: 25536794.4322; val_gene_expr_recon_loss: 8108197.8367; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33697075.9497; val_optim_loss: 33697075.9497
Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.9966; val_auprc_score: 0.9957; val_best_acc_score: 0.9821; val_best_f1_score: 0.9824; train_kl_reg_loss: 53409.1167; train_edge_recon_loss: 25489088.7327; train_gene_expr_recon_loss: 7809003.9074; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33351501.7584; train_optim_loss: 33351501.7584; val_kl_reg_loss: 52949.5092; val_edge_recon_loss: 25514687.7085; val_gene_expr_recon_loss: 8092623.1131; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33660260.4020; val_optim_loss: 33660260.4020
Epoch 24/100 |████----------------| 24.0% val_auroc_score: 0.9964; val_auprc_score: 0.9953; val_best_acc_score: 0.9819; val_best_f1_score: 0.9820; train_kl_reg_loss: 54317.3457; train_edge_recon_loss: 25486891.2226; train_gene_expr_recon_loss: 7802427.0906; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33343635.6488; train_optim_loss: 33343635.6488; val_kl_reg_loss: 54537.5874; val_edge_recon_loss: 25524897.3266; val_gene_expr_recon_loss: 8050714.7915; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33630149.7688; val_optim_loss: 33630149.7688
Epoch 25/100 |█████---------------| 25.0% val_auroc_score: 0.9967; val_auprc_score: 0.9957; val_best_acc_score: 0.9827; val_best_f1_score: 0.9829; train_kl_reg_loss: 54816.5085; train_edge_recon_loss: 25491871.1298; train_gene_expr_recon_loss: 7803736.7036; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33350424.3300; train_optim_loss: 33350424.3300; val_kl_reg_loss: 54292.8748; val_edge_recon_loss: 25510025.8593; val_gene_expr_recon_loss: 8116948.5653; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33681267.2965; val_optim_loss: 33681267.2965

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 165 min 51 sec.
Using best model state, which was in epoch 17.

--- MODEL EVALUATION ---
Val AUROC score: 0.9960
Val AUPRC score: 0.9949
Val best accuracy score: 0.9808
Val best F1 score: 0.9811
Val gene expr MSE score: 0.6135

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
