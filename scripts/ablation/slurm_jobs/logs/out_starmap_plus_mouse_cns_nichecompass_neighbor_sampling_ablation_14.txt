None
Run timestamp: 07082023_114532_14.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'starmap_plus_mouse_cns', '--reference_batches', 'batch1', '--n_neighbors', '20', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'neighbor_sampling_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '300', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_14']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 1022, n_cat_covariates_embed_input: 0, n_hidden: 1022, n_latent: 1423, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1423, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 1022
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1423, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 1022

--- INITIALIZING TRAINER ---
Number of training nodes: 82121
Number of validation nodes: 9125
Number of training edges: 915209
Number of validation edges: 101689
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9908; val_auprc_score: 0.9880; val_best_acc_score: 0.9642; val_best_f1_score: 0.9647; train_kl_reg_loss: 7246.4588; train_edge_recon_loss: 264172.8486; train_gene_expr_recon_loss: 201979.2548; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 473398.5623; train_optim_loss: 473398.5623; val_kl_reg_loss: 6940.1088; val_edge_recon_loss: 259872.2217; val_gene_expr_recon_loss: 185155.4882; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 451967.8180; val_optim_loss: 451967.8180
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9933; val_auprc_score: 0.9916; val_best_acc_score: 0.9718; val_best_f1_score: 0.9722; train_kl_reg_loss: 6839.9916; train_edge_recon_loss: 259759.7347; train_gene_expr_recon_loss: 181220.0803; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 447819.8065; train_optim_loss: 447819.8065; val_kl_reg_loss: 6548.8926; val_edge_recon_loss: 258571.4489; val_gene_expr_recon_loss: 177574.5090; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 442694.8508; val_optim_loss: 442694.8508
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9949; val_auprc_score: 0.9935; val_best_acc_score: 0.9747; val_best_f1_score: 0.9749; train_kl_reg_loss: 6650.5146; train_edge_recon_loss: 258779.2922; train_gene_expr_recon_loss: 176485.3333; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 441915.1393; train_optim_loss: 441915.1393; val_kl_reg_loss: 6286.2667; val_edge_recon_loss: 257854.6742; val_gene_expr_recon_loss: 174909.6173; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 439050.5583; val_optim_loss: 439050.5583
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9957; val_auprc_score: 0.9944; val_best_acc_score: 0.9793; val_best_f1_score: 0.9795; train_kl_reg_loss: 6572.6816; train_edge_recon_loss: 258146.5989; train_gene_expr_recon_loss: 174456.7803; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 439176.0609; train_optim_loss: 439176.0609; val_kl_reg_loss: 6487.1990; val_edge_recon_loss: 257193.0939; val_gene_expr_recon_loss: 173420.3552; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 437100.6486; val_optim_loss: 437100.6486
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9963; val_auprc_score: 0.9954; val_best_acc_score: 0.9811; val_best_f1_score: 0.9813; train_kl_reg_loss: 6533.3522; train_edge_recon_loss: 257806.6434; train_gene_expr_recon_loss: 173530.4591; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 437870.4547; train_optim_loss: 437870.4547; val_kl_reg_loss: 6473.7213; val_edge_recon_loss: 256710.6135; val_gene_expr_recon_loss: 172834.3774; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 436018.7123; val_optim_loss: 436018.7123
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9967; val_auprc_score: 0.9957; val_best_acc_score: 0.9823; val_best_f1_score: 0.9824; train_kl_reg_loss: 6524.5724; train_edge_recon_loss: 257445.2359; train_gene_expr_recon_loss: 172837.5180; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 436807.3264; train_optim_loss: 436807.3264; val_kl_reg_loss: 6509.2243; val_edge_recon_loss: 256777.1263; val_gene_expr_recon_loss: 172228.3290; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 435514.6803; val_optim_loss: 435514.6803
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9969; val_auprc_score: 0.9961; val_best_acc_score: 0.9831; val_best_f1_score: 0.9832; train_kl_reg_loss: 6516.2599; train_edge_recon_loss: 257243.7390; train_gene_expr_recon_loss: 172378.3097; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 436138.3088; train_optim_loss: 436138.3088; val_kl_reg_loss: 6367.4840; val_edge_recon_loss: 256539.5261; val_gene_expr_recon_loss: 171672.0612; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 434579.0704; val_optim_loss: 434579.0704
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9971; val_auprc_score: 0.9963; val_best_acc_score: 0.9842; val_best_f1_score: 0.9843; train_kl_reg_loss: 6515.1833; train_edge_recon_loss: 257028.8294; train_gene_expr_recon_loss: 171767.6216; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 435311.6343; train_optim_loss: 435311.6343; val_kl_reg_loss: 6524.3563; val_edge_recon_loss: 256101.3424; val_gene_expr_recon_loss: 171429.0151; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 434054.7151; val_optim_loss: 434054.7151
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9972; val_auprc_score: 0.9963; val_best_acc_score: 0.9839; val_best_f1_score: 0.9840; train_kl_reg_loss: 6514.4234; train_edge_recon_loss: 256870.4685; train_gene_expr_recon_loss: 171132.6934; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 434517.5851; train_optim_loss: 434517.5851; val_kl_reg_loss: 6437.0182; val_edge_recon_loss: 256376.1369; val_gene_expr_recon_loss: 167179.5952; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 429992.7524; val_optim_loss: 429992.7524
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9975; val_auprc_score: 0.9968; val_best_acc_score: 0.9852; val_best_f1_score: 0.9853; train_kl_reg_loss: 6517.3388; train_edge_recon_loss: 256812.2356; train_gene_expr_recon_loss: 169982.2306; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 433311.8050; train_optim_loss: 433311.8050; val_kl_reg_loss: 6433.1272; val_edge_recon_loss: 255867.6728; val_gene_expr_recon_loss: 170758.9629; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 433059.7641; val_optim_loss: 433059.7641
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9974; val_auprc_score: 0.9966; val_best_acc_score: 0.9851; val_best_f1_score: 0.9852; train_kl_reg_loss: 6520.7790; train_edge_recon_loss: 256692.6604; train_gene_expr_recon_loss: 167042.5238; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 430255.9632; train_optim_loss: 430255.9632; val_kl_reg_loss: 6538.2805; val_edge_recon_loss: 256010.3795; val_gene_expr_recon_loss: 170578.4323; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 433127.0939; val_optim_loss: 433127.0939
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9974; val_auprc_score: 0.9966; val_best_acc_score: 0.9853; val_best_f1_score: 0.9855; train_kl_reg_loss: 6523.8397; train_edge_recon_loss: 256637.5510; train_gene_expr_recon_loss: 159456.5342; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 422617.9244; train_optim_loss: 422617.9244; val_kl_reg_loss: 6499.4040; val_edge_recon_loss: 256008.7923; val_gene_expr_recon_loss: 154580.7284; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 417088.9246; val_optim_loss: 417088.9246
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9976; val_auprc_score: 0.9968; val_best_acc_score: 0.9861; val_best_f1_score: 0.9862; train_kl_reg_loss: 6533.9731; train_edge_recon_loss: 256460.1380; train_gene_expr_recon_loss: 143884.3465; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 406878.4575; train_optim_loss: 406878.4575; val_kl_reg_loss: 6509.7409; val_edge_recon_loss: 255629.9452; val_gene_expr_recon_loss: 140904.8889; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 403044.5733; val_optim_loss: 403044.5733
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9976; val_auprc_score: 0.9968; val_best_acc_score: 0.9867; val_best_f1_score: 0.9867; train_kl_reg_loss: 6538.6661; train_edge_recon_loss: 256411.7765; train_gene_expr_recon_loss: 119092.9695; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 382043.4119; train_optim_loss: 382043.4119; val_kl_reg_loss: 6486.3324; val_edge_recon_loss: 255501.1838; val_gene_expr_recon_loss: 86347.9369; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 348335.4521; val_optim_loss: 348335.4521
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9976; val_auprc_score: 0.9970; val_best_acc_score: 0.9862; val_best_f1_score: 0.9863; train_kl_reg_loss: 6540.8799; train_edge_recon_loss: 256363.4503; train_gene_expr_recon_loss: 102196.5366; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 365100.8666; train_optim_loss: 365100.8666; val_kl_reg_loss: 6541.6489; val_edge_recon_loss: 255695.9395; val_gene_expr_recon_loss: 104476.4009; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 366713.9893; val_optim_loss: 366713.9893
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9977; val_auprc_score: 0.9971; val_best_acc_score: 0.9866; val_best_f1_score: 0.9867; train_kl_reg_loss: 6549.8173; train_edge_recon_loss: 256333.0265; train_gene_expr_recon_loss: 97334.2470; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 360217.0911; train_optim_loss: 360217.0911; val_kl_reg_loss: 6501.7717; val_edge_recon_loss: 255693.3664; val_gene_expr_recon_loss: 92601.3871; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 354796.5251; val_optim_loss: 354796.5251
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9978; val_auprc_score: 0.9972; val_best_acc_score: 0.9867; val_best_f1_score: 0.9868; train_kl_reg_loss: 6554.2475; train_edge_recon_loss: 256214.1258; train_gene_expr_recon_loss: 95755.1690; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 358523.5425; train_optim_loss: 358523.5425; val_kl_reg_loss: 6587.8243; val_edge_recon_loss: 255559.0018; val_gene_expr_recon_loss: 96041.9530; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 358188.7792; val_optim_loss: 358188.7792
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9979; val_auprc_score: 0.9972; val_best_acc_score: 0.9870; val_best_f1_score: 0.9871; train_kl_reg_loss: 6558.6305; train_edge_recon_loss: 256155.8035; train_gene_expr_recon_loss: 95091.5277; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 357805.9618; train_optim_loss: 357805.9618; val_kl_reg_loss: 6550.5512; val_edge_recon_loss: 255443.9849; val_gene_expr_recon_loss: 94545.2212; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 356539.7582; val_optim_loss: 356539.7582

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9981; val_auprc_score: 0.9976; val_best_acc_score: 0.9873; val_best_f1_score: 0.9874; train_kl_reg_loss: 6594.1449; train_edge_recon_loss: 256031.8368; train_gene_expr_recon_loss: 94581.1336; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 357207.1156; train_optim_loss: 357207.1156; val_kl_reg_loss: 6553.9433; val_edge_recon_loss: 255492.2656; val_gene_expr_recon_loss: 92767.9099; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 354814.1190; val_optim_loss: 354814.1190
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9981; val_auprc_score: 0.9977; val_best_acc_score: 0.9876; val_best_f1_score: 0.9877; train_kl_reg_loss: 6582.6534; train_edge_recon_loss: 256072.1314; train_gene_expr_recon_loss: 94461.0317; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 357115.8169; train_optim_loss: 357115.8169; val_kl_reg_loss: 6533.7424; val_edge_recon_loss: 255296.5616; val_gene_expr_recon_loss: 93786.5615; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 355616.8657; val_optim_loss: 355616.8657
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9982; val_auprc_score: 0.9975; val_best_acc_score: 0.9877; val_best_f1_score: 0.9878; train_kl_reg_loss: 6583.1393; train_edge_recon_loss: 256012.3464; train_gene_expr_recon_loss: 94122.0399; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 356717.5252; train_optim_loss: 356717.5252; val_kl_reg_loss: 6556.4314; val_edge_recon_loss: 255305.6433; val_gene_expr_recon_loss: 93543.4397; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 355405.5138; val_optim_loss: 355405.5138
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9983; val_auprc_score: 0.9977; val_best_acc_score: 0.9879; val_best_f1_score: 0.9880; train_kl_reg_loss: 6587.0407; train_edge_recon_loss: 255979.0953; train_gene_expr_recon_loss: 94072.7072; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 356638.8429; train_optim_loss: 356638.8429; val_kl_reg_loss: 6543.5504; val_edge_recon_loss: 255222.7721; val_gene_expr_recon_loss: 96219.5554; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 357985.8800; val_optim_loss: 357985.8800

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 103 min 28 sec.
Using best model state, which was in epoch 14.

--- MODEL EVALUATION ---
val AUROC score: 0.9977
val AUPRC score: 0.9971
val best accuracy score: 0.9864
val best F1 score: 0.9865
val target rna MSE score: 0.5758
val source rna MSE score: 0.0706

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
