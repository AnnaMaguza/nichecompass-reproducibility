Epoch 33/100 |██████--------------| 33.0% val_auroc_score: 0.9962; val_auprc_score: 0.9952; val_best_acc_score: 0.9785; val_best_f1_score: 0.9787; train_kl_reg_loss: 5794.9811; train_edge_recon_loss: 257326.8174; train_gene_expr_recon_loss: 67215.7168; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 330337.5152; train_optim_loss: 330337.5152; val_kl_reg_loss: 5794.0443; val_edge_recon_loss: 256828.1842; val_gene_expr_recon_loss: 66917.2284; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329539.4570; val_optim_loss: 329539.4570
Epoch 34/100 |██████--------------| 34.0% val_auroc_score: 0.9965; val_auprc_score: 0.9957; val_best_acc_score: 0.9795; val_best_f1_score: 0.9798; train_kl_reg_loss: 5792.9840; train_edge_recon_loss: 257346.0129; train_gene_expr_recon_loss: 67205.7412; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 330344.7378; train_optim_loss: 330344.7378; val_kl_reg_loss: 5787.9282; val_edge_recon_loss: 256812.9625; val_gene_expr_recon_loss: 66789.9994; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329390.8903; val_optim_loss: 329390.8903
None
Run timestamp: 13072023_044637_6.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'xenium_human_breast_cancer', '--reference_batches', 'batch1', '--n_neighbors', '24', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '0.01', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'neighbor_sampling_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '300', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '8', '--timestamp_suffix', '_6']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1690.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 313, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 313, n_latent: 1254, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1254, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 626
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 147600
Number of validation nodes: 16400
Number of training edges: 1966960
Number of validation edges: 218551
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9918; val_auprc_score: 0.9905; val_best_acc_score: 0.9608; val_best_f1_score: 0.9614; train_kl_reg_loss: 6081.7234; train_edge_recon_loss: 265235.0049; train_gene_expr_recon_loss: 76200.4051; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 347517.1333; train_optim_loss: 347517.1333; val_kl_reg_loss: 5887.9538; val_edge_recon_loss: 261549.5767; val_gene_expr_recon_loss: 70229.2016; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 337666.7327; val_optim_loss: 337666.7327
Epoch 35/100 |███████-------------| 35.0% val_auroc_score: 0.9965; val_auprc_score: 0.9957; val_best_acc_score: 0.9794; val_best_f1_score: 0.9796; train_kl_reg_loss: 5795.5247; train_edge_recon_loss: 257268.6632; train_gene_expr_recon_loss: 67200.4340; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 330264.6221; train_optim_loss: 330264.6221; val_kl_reg_loss: 5788.0217; val_edge_recon_loss: 256803.8559; val_gene_expr_recon_loss: 66858.4374; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329450.3146; val_optim_loss: 329450.3146
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9934; val_auprc_score: 0.9920; val_best_acc_score: 0.9673; val_best_f1_score: 0.9678; train_kl_reg_loss: 5874.0389; train_edge_recon_loss: 261093.3527; train_gene_expr_recon_loss: 69644.7531; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 336612.1450; train_optim_loss: 336612.1450; val_kl_reg_loss: 5811.1304; val_edge_recon_loss: 260195.6036; val_gene_expr_recon_loss: 68535.0749; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 334541.8080; val_optim_loss: 334541.8080
Epoch 36/100 |███████-------------| 36.0% val_auroc_score: 0.9964; val_auprc_score: 0.9955; val_best_acc_score: 0.9793; val_best_f1_score: 0.9795; train_kl_reg_loss: 5797.5314; train_edge_recon_loss: 257248.9282; train_gene_expr_recon_loss: 67220.4368; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 330266.8964; train_optim_loss: 330266.8964; val_kl_reg_loss: 5779.5636; val_edge_recon_loss: 256759.2729; val_gene_expr_recon_loss: 66965.1868; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329504.0236; val_optim_loss: 329504.0236
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9944; val_auprc_score: 0.9932; val_best_acc_score: 0.9704; val_best_f1_score: 0.9707; train_kl_reg_loss: 5808.3605; train_edge_recon_loss: 260173.5793; train_gene_expr_recon_loss: 68623.6790; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 334605.6190; train_optim_loss: 334605.6190; val_kl_reg_loss: 5681.7512; val_edge_recon_loss: 259487.9865; val_gene_expr_recon_loss: 68135.3757; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 333305.1133; val_optim_loss: 333305.1133
Epoch 37/100 |███████-------------| 37.0% val_auroc_score: 0.9965; val_auprc_score: 0.9956; val_best_acc_score: 0.9793; val_best_f1_score: 0.9795; train_kl_reg_loss: 5796.8333; train_edge_recon_loss: 257260.2836; train_gene_expr_recon_loss: 67209.0087; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 330266.1256; train_optim_loss: 330266.1256; val_kl_reg_loss: 5783.2030; val_edge_recon_loss: 256768.3323; val_gene_expr_recon_loss: 66860.8200; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329412.3562; val_optim_loss: 329412.3562
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9955; val_auprc_score: 0.9946; val_best_acc_score: 0.9743; val_best_f1_score: 0.9746; train_kl_reg_loss: 5770.2076; train_edge_recon_loss: 259615.6870; train_gene_expr_recon_loss: 68218.2665; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 333604.1613; train_optim_loss: 333604.1613; val_kl_reg_loss: 5790.6218; val_edge_recon_loss: 258887.8540; val_gene_expr_recon_loss: 67904.4703; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 332582.9470; val_optim_loss: 332582.9470
Epoch 38/100 |███████-------------| 38.0% val_auroc_score: 0.9966; val_auprc_score: 0.9957; val_best_acc_score: 0.9795; val_best_f1_score: 0.9797; train_kl_reg_loss: 5796.9866; train_edge_recon_loss: 257211.0380; train_gene_expr_recon_loss: 67196.9382; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 330204.9628; train_optim_loss: 330204.9628; val_kl_reg_loss: 5796.3831; val_edge_recon_loss: 256674.6609; val_gene_expr_recon_loss: 66836.4491; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329307.4935; val_optim_loss: 329307.4935
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9957; val_auprc_score: 0.9948; val_best_acc_score: 0.9756; val_best_f1_score: 0.9759; train_kl_reg_loss: 5748.7893; train_edge_recon_loss: 259204.6138; train_gene_expr_recon_loss: 67985.6786; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 332939.0819; train_optim_loss: 332939.0819; val_kl_reg_loss: 5804.3359; val_edge_recon_loss: 258575.8267; val_gene_expr_recon_loss: 67630.0349; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 332010.1970; val_optim_loss: 332010.1970
Epoch 39/100 |███████-------------| 39.0% val_auroc_score: 0.9966; val_auprc_score: 0.9957; val_best_acc_score: 0.9794; val_best_f1_score: 0.9796; train_kl_reg_loss: 5795.8208; train_edge_recon_loss: 257212.4684; train_gene_expr_recon_loss: 67193.1600; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 330201.4490; train_optim_loss: 330201.4490; val_kl_reg_loss: 5789.5358; val_edge_recon_loss: 256703.2602; val_gene_expr_recon_loss: 66880.9287; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329373.7236; val_optim_loss: 329373.7236
Epoch 40/100 |████████------------| 40.0% val_auroc_score: 0.9963; val_auprc_score: 0.9953; val_best_acc_score: 0.9791; val_best_f1_score: 0.9793; train_kl_reg_loss: 5797.2318; train_edge_recon_loss: 257180.1838; train_gene_expr_recon_loss: 67195.7602; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 330173.1760; train_optim_loss: 330173.1760; val_kl_reg_loss: 5815.5941; val_edge_recon_loss: 256600.9284; val_gene_expr_recon_loss: 66841.9497; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329258.4715; val_optim_loss: 329258.4715
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9964; val_auprc_score: 0.9956; val_best_acc_score: 0.9779; val_best_f1_score: 0.9781; train_kl_reg_loss: 5732.5446; train_edge_recon_loss: 258921.3179; train_gene_expr_recon_loss: 67937.1907; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 332591.0531; train_optim_loss: 332591.0531; val_kl_reg_loss: 5688.6607; val_edge_recon_loss: 258155.8547; val_gene_expr_recon_loss: 60398.9767; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 324243.4913; val_optim_loss: 324243.4913
Epoch 41/100 |████████------------| 41.0% val_auroc_score: 0.9963; val_auprc_score: 0.9955; val_best_acc_score: 0.9788; val_best_f1_score: 0.9790; train_kl_reg_loss: 5801.5114; train_edge_recon_loss: 257149.7196; train_gene_expr_recon_loss: 67180.4304; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 330131.6615; train_optim_loss: 330131.6615; val_kl_reg_loss: 5796.5869; val_edge_recon_loss: 256697.3221; val_gene_expr_recon_loss: 66859.7057; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329353.6149; val_optim_loss: 329353.6149
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9961; val_auprc_score: 0.9950; val_best_acc_score: 0.9779; val_best_f1_score: 0.9781; train_kl_reg_loss: 5721.2084; train_edge_recon_loss: 258753.7026; train_gene_expr_recon_loss: 68093.2290; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 332568.1400; train_optim_loss: 332568.1400; val_kl_reg_loss: 5713.7539; val_edge_recon_loss: 258163.9421; val_gene_expr_recon_loss: 63114.3765; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 326992.0725; val_optim_loss: 326992.0725
