Epoch 35/100 |███████-------------| 35.0% val_auroc_score: 0.9963; val_auprc_score: 0.9954; val_best_acc_score: 0.9787; val_best_f1_score: 0.9789; train_kl_reg_loss: 5796.9253; train_edge_recon_loss: 257448.6000; train_gene_expr_recon_loss: 66886.6099; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 330132.1352; train_optim_loss: 330132.1352; val_kl_reg_loss: 5817.0573; val_edge_recon_loss: 256948.3531; val_gene_expr_recon_loss: 66855.7506; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329621.1611; val_optim_loss: 329621.1611
None
Run timestamp: 13072023_034847_5.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'xenium_human_breast_cancer', '--reference_batches', 'batch1', '--n_neighbors', '20', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '0.01', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'neighbor_sampling_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '300', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '8', '--timestamp_suffix', '_5']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1690.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 313, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 313, n_latent: 1254, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1254, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 626
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 147600
Number of validation nodes: 16400
Number of training edges: 1643088
Number of validation edges: 182565
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9891; val_auprc_score: 0.9870; val_best_acc_score: 0.9542; val_best_f1_score: 0.9550; train_kl_reg_loss: 6162.8261; train_edge_recon_loss: 265900.0258; train_gene_expr_recon_loss: 76599.3192; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 348662.1711; train_optim_loss: 348662.1711; val_kl_reg_loss: 5893.4317; val_edge_recon_loss: 262111.1329; val_gene_expr_recon_loss: 71394.1885; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 339398.7542; val_optim_loss: 339398.7542

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 36/100 |███████-------------| 36.0% val_auroc_score: 0.9966; val_auprc_score: 0.9957; val_best_acc_score: 0.9796; val_best_f1_score: 0.9798; train_kl_reg_loss: 5796.9338; train_edge_recon_loss: 257321.4580; train_gene_expr_recon_loss: 66407.3760; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 329525.7676; train_optim_loss: 329525.7676; val_kl_reg_loss: 5793.0118; val_edge_recon_loss: 256876.9869; val_gene_expr_recon_loss: 66389.1390; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329059.1374; val_optim_loss: 329059.1374
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9924; val_auprc_score: 0.9909; val_best_acc_score: 0.9645; val_best_f1_score: 0.9650; train_kl_reg_loss: 5894.8881; train_edge_recon_loss: 261590.5949; train_gene_expr_recon_loss: 69718.0827; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 337203.5659; train_optim_loss: 337203.5659; val_kl_reg_loss: 5876.2218; val_edge_recon_loss: 260681.2061; val_gene_expr_recon_loss: 69112.9935; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 335670.4209; val_optim_loss: 335670.4209
Epoch 37/100 |███████-------------| 37.0% val_auroc_score: 0.9967; val_auprc_score: 0.9960; val_best_acc_score: 0.9800; val_best_f1_score: 0.9802; train_kl_reg_loss: 5796.8105; train_edge_recon_loss: 257278.6743; train_gene_expr_recon_loss: 66327.2913; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 329402.7760; train_optim_loss: 329402.7760; val_kl_reg_loss: 5792.8264; val_edge_recon_loss: 256739.1479; val_gene_expr_recon_loss: 66288.8058; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 328820.7804; val_optim_loss: 328820.7804
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9938; val_auprc_score: 0.9926; val_best_acc_score: 0.9685; val_best_f1_score: 0.9690; train_kl_reg_loss: 5837.9364; train_edge_recon_loss: 260531.1128; train_gene_expr_recon_loss: 68435.6446; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 334804.6937; train_optim_loss: 334804.6937; val_kl_reg_loss: 5681.7293; val_edge_recon_loss: 260038.6286; val_gene_expr_recon_loss: 68552.3017; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 334272.6593; val_optim_loss: 334272.6593
Epoch 38/100 |███████-------------| 38.0% val_auroc_score: 0.9967; val_auprc_score: 0.9958; val_best_acc_score: 0.9798; val_best_f1_score: 0.9800; train_kl_reg_loss: 5796.0027; train_edge_recon_loss: 257187.1108; train_gene_expr_recon_loss: 66300.9022; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 329284.0160; train_optim_loss: 329284.0160; val_kl_reg_loss: 5785.3763; val_edge_recon_loss: 256769.8831; val_gene_expr_recon_loss: 66322.2826; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 328877.5415; val_optim_loss: 328877.5415
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9942; val_auprc_score: 0.9928; val_best_acc_score: 0.9703; val_best_f1_score: 0.9706; train_kl_reg_loss: 5802.5571; train_edge_recon_loss: 259991.4942; train_gene_expr_recon_loss: 67924.0804; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 333718.1321; train_optim_loss: 333718.1321; val_kl_reg_loss: 5845.5227; val_edge_recon_loss: 259531.5395; val_gene_expr_recon_loss: 68103.6718; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 333480.7342; val_optim_loss: 333480.7342
Epoch 39/100 |███████-------------| 39.0% val_auroc_score: 0.9967; val_auprc_score: 0.9960; val_best_acc_score: 0.9801; val_best_f1_score: 0.9803; train_kl_reg_loss: 5792.3941; train_edge_recon_loss: 257218.6573; train_gene_expr_recon_loss: 66252.3738; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 329263.4249; train_optim_loss: 329263.4249; val_kl_reg_loss: 5777.1951; val_edge_recon_loss: 256769.7533; val_gene_expr_recon_loss: 66282.1485; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 328829.0980; val_optim_loss: 328829.0980
Epoch 40/100 |████████------------| 40.0% val_auroc_score: 0.9967; val_auprc_score: 0.9959; val_best_acc_score: 0.9797; val_best_f1_score: 0.9798; train_kl_reg_loss: 5790.3683; train_edge_recon_loss: 257227.9017; train_gene_expr_recon_loss: 66285.7693; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 329304.0392; train_optim_loss: 329304.0392; val_kl_reg_loss: 5788.0906; val_edge_recon_loss: 256801.5537; val_gene_expr_recon_loss: 66265.4063; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 328855.0510; val_optim_loss: 328855.0510
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9946; val_auprc_score: 0.9933; val_best_acc_score: 0.9720; val_best_f1_score: 0.9724; train_kl_reg_loss: 5780.0991; train_edge_recon_loss: 259651.9227; train_gene_expr_recon_loss: 67642.5066; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 333074.5284; train_optim_loss: 333074.5284; val_kl_reg_loss: 5711.0115; val_edge_recon_loss: 258985.7819; val_gene_expr_recon_loss: 67839.6398; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 332536.4333; val_optim_loss: 332536.4333
Epoch 41/100 |████████------------| 41.0% val_auroc_score: 0.9968; val_auprc_score: 0.9960; val_best_acc_score: 0.9805; val_best_f1_score: 0.9807; train_kl_reg_loss: 5789.9537; train_edge_recon_loss: 257220.2677; train_gene_expr_recon_loss: 66267.6837; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 329277.9049; train_optim_loss: 329277.9049; val_kl_reg_loss: 5789.1855; val_edge_recon_loss: 256612.9452; val_gene_expr_recon_loss: 66292.0935; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 328694.2235; val_optim_loss: 328694.2235
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9951; val_auprc_score: 0.9939; val_best_acc_score: 0.9742; val_best_f1_score: 0.9745; train_kl_reg_loss: 5763.4949; train_edge_recon_loss: 259348.7642; train_gene_expr_recon_loss: 67485.3149; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 332597.5741; train_optim_loss: 332597.5741; val_kl_reg_loss: 5837.6757; val_edge_recon_loss: 258891.5681; val_gene_expr_recon_loss: 72121.9936; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 336851.2374; val_optim_loss: 336851.2374
Epoch 42/100 |████████------------| 42.0% val_auroc_score: 0.9968; val_auprc_score: 0.9961; val_best_acc_score: 0.9803; val_best_f1_score: 0.9804; train_kl_reg_loss: 5786.9426; train_edge_recon_loss: 257218.1029; train_gene_expr_recon_loss: 66213.8504; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 329218.8958; train_optim_loss: 329218.8958; val_kl_reg_loss: 5785.4784; val_edge_recon_loss: 256670.2303; val_gene_expr_recon_loss: 66221.3864; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 328677.0961; val_optim_loss: 328677.0961
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9954; val_auprc_score: 0.9943; val_best_acc_score: 0.9755; val_best_f1_score: 0.9758; train_kl_reg_loss: 5757.0869; train_edge_recon_loss: 259172.5250; train_gene_expr_recon_loss: 66853.4096; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 331783.0215; train_optim_loss: 331783.0215; val_kl_reg_loss: 5711.6902; val_edge_recon_loss: 258570.5544; val_gene_expr_recon_loss: 67204.5659; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 331486.8107; val_optim_loss: 331486.8107
Epoch 43/100 |████████------------| 43.0% val_auroc_score: 0.9968; val_auprc_score: 0.9959; val_best_acc_score: 0.9804; val_best_f1_score: 0.9805; train_kl_reg_loss: 5788.4111; train_edge_recon_loss: 257153.8690; train_gene_expr_recon_loss: 66219.5606; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 329161.8406; train_optim_loss: 329161.8406; val_kl_reg_loss: 5787.8071; val_edge_recon_loss: 256632.9825; val_gene_expr_recon_loss: 66228.2759; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 328649.0661; val_optim_loss: 328649.0661
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9956; val_auprc_score: 0.9945; val_best_acc_score: 0.9762; val_best_f1_score: 0.9765; train_kl_reg_loss: 5755.4338; train_edge_recon_loss: 258906.4483; train_gene_expr_recon_loss: 62596.4883; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 327258.3710; train_optim_loss: 327258.3710; val_kl_reg_loss: 5805.6309; val_edge_recon_loss: 258413.9747; val_gene_expr_recon_loss: 67396.6698; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 331616.2749; val_optim_loss: 331616.2749
Epoch 44/100 |████████------------| 44.0% val_auroc_score: 0.9969; val_auprc_score: 0.9962; val_best_acc_score: 0.9804; val_best_f1_score: 0.9806; train_kl_reg_loss: 5788.1760; train_edge_recon_loss: 257164.1868; train_gene_expr_recon_loss: 66204.7708; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 329157.1333; train_optim_loss: 329157.1333; val_kl_reg_loss: 5788.5336; val_edge_recon_loss: 256632.3402; val_gene_expr_recon_loss: 66255.1530; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 328676.0262; val_optim_loss: 328676.0262
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9961; val_auprc_score: 0.9952; val_best_acc_score: 0.9773; val_best_f1_score: 0.9775; train_kl_reg_loss: 5746.9724; train_edge_recon_loss: 258763.3004; train_gene_expr_recon_loss: 58714.6451; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 323224.9179; train_optim_loss: 323224.9179; val_kl_reg_loss: 5740.4262; val_edge_recon_loss: 258433.9944; val_gene_expr_recon_loss: 57451.8681; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 321626.2884; val_optim_loss: 321626.2884
Epoch 45/100 |█████████-----------| 45.0% val_auroc_score: 0.9968; val_auprc_score: 0.9960; val_best_acc_score: 0.9804; val_best_f1_score: 0.9806; train_kl_reg_loss: 5786.1470; train_edge_recon_loss: 257132.2207; train_gene_expr_recon_loss: 66217.0112; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 329135.3789; train_optim_loss: 329135.3789; val_kl_reg_loss: 5774.9394; val_edge_recon_loss: 256675.7332; val_gene_expr_recon_loss: 66200.9536; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 328651.6271; val_optim_loss: 328651.6271
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9956; val_auprc_score: 0.9944; val_best_acc_score: 0.9768; val_best_f1_score: 0.9770; train_kl_reg_loss: 5739.9671; train_edge_recon_loss: 258617.5053; train_gene_expr_recon_loss: 58092.8794; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 322450.3517; train_optim_loss: 322450.3517; val_kl_reg_loss: 5701.5058; val_edge_recon_loss: 258199.9328; val_gene_expr_recon_loss: 58091.2231; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 321992.6623; val_optim_loss: 321992.6623
Epoch 46/100 |█████████-----------| 46.0% val_auroc_score: 0.9968; val_auprc_score: 0.9960; val_best_acc_score: 0.9805; val_best_f1_score: 0.9807; train_kl_reg_loss: 5784.4840; train_edge_recon_loss: 257182.7580; train_gene_expr_recon_loss: 66191.9005; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 329159.1422; train_optim_loss: 329159.1422; val_kl_reg_loss: 5786.8759; val_edge_recon_loss: 256640.4874; val_gene_expr_recon_loss: 66251.2300; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 328678.5934; val_optim_loss: 328678.5934
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9958; val_auprc_score: 0.9946; val_best_acc_score: 0.9772; val_best_f1_score: 0.9774; train_kl_reg_loss: 5739.8729; train_edge_recon_loss: 258520.9726; train_gene_expr_recon_loss: 57885.8505; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 322146.6962; train_optim_loss: 322146.6962; val_kl_reg_loss: 5774.8956; val_edge_recon_loss: 258269.9126; val_gene_expr_recon_loss: 56356.5011; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 320401.3082; val_optim_loss: 320401.3082
