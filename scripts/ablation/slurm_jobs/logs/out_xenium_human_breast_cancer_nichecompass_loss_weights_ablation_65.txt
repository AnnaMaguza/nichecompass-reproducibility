None
Run timestamp: 28072023_155211_65.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'xenium_human_breast_cancer', '--reference_batches', 'batch1', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000', '--lambda_gene_expr_recon', '0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_65']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_pred_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 313, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 313, n_latent: 1302, n_addon_latent: 10, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1302, n_cat_covariates_embed_input: 0, n_addon_gp_input: 10, n_output: 313
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1302, n_cat_covariates_embed_input: 0, n_addon_gp_input: 10, n_output: 313

--- INITIALIZING TRAINER ---
Number of training nodes: 147600
Number of validation nodes: 16400
Number of training edges: 348099
Number of validation edges: 38677
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9435; val_auprc_score: 0.9259; val_best_acc_score: 0.8843; val_best_f1_score: 0.8912; train_kl_reg_loss: 1982.2141; train_edge_recon_loss: 28123.3058; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 30105.5199; train_optim_loss: 30105.5199; val_kl_reg_loss: 2128.0236; val_edge_recon_loss: 26732.0359; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28860.0595; val_optim_loss: 28860.0595
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9591; val_auprc_score: 0.9447; val_best_acc_score: 0.9057; val_best_f1_score: 0.9096; train_kl_reg_loss: 2128.6314; train_edge_recon_loss: 27479.9721; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29608.6035; train_optim_loss: 29608.6035; val_kl_reg_loss: 2128.0137; val_edge_recon_loss: 26573.1935; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28701.2073; val_optim_loss: 28701.2073
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9622; val_auprc_score: 0.9486; val_best_acc_score: 0.9124; val_best_f1_score: 0.9159; train_kl_reg_loss: 2159.2589; train_edge_recon_loss: 27370.9936; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29530.2524; train_optim_loss: 29530.2524; val_kl_reg_loss: 2040.4801; val_edge_recon_loss: 26548.6257; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28589.1058; val_optim_loss: 28589.1058
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9649; val_auprc_score: 0.9524; val_best_acc_score: 0.9168; val_best_f1_score: 0.9202; train_kl_reg_loss: 2166.2869; train_edge_recon_loss: 27338.1266; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29504.4134; train_optim_loss: 29504.4134; val_kl_reg_loss: 2126.4316; val_edge_recon_loss: 26488.1312; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28614.5630; val_optim_loss: 28614.5630
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9672; val_auprc_score: 0.9555; val_best_acc_score: 0.9200; val_best_f1_score: 0.9231; train_kl_reg_loss: 2174.6752; train_edge_recon_loss: 27293.5281; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29468.2032; train_optim_loss: 29468.2032; val_kl_reg_loss: 2112.2870; val_edge_recon_loss: 26472.0108; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28584.2979; val_optim_loss: 28584.2979
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9678; val_auprc_score: 0.9553; val_best_acc_score: 0.9213; val_best_f1_score: 0.9245; train_kl_reg_loss: 2180.5854; train_edge_recon_loss: 27268.2202; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29448.8056; train_optim_loss: 29448.8056; val_kl_reg_loss: 2222.1884; val_edge_recon_loss: 26453.6969; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28675.8852; val_optim_loss: 28675.8852
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9698; val_auprc_score: 0.9594; val_best_acc_score: 0.9243; val_best_f1_score: 0.9270; train_kl_reg_loss: 2182.6791; train_edge_recon_loss: 27255.3392; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29438.0184; train_optim_loss: 29438.0184; val_kl_reg_loss: 2203.1399; val_edge_recon_loss: 26442.3368; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28645.4768; val_optim_loss: 28645.4768
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9696; val_auprc_score: 0.9592; val_best_acc_score: 0.9230; val_best_f1_score: 0.9256; train_kl_reg_loss: 2189.0226; train_edge_recon_loss: 27232.2804; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29421.3030; train_optim_loss: 29421.3030; val_kl_reg_loss: 2067.0638; val_edge_recon_loss: 26469.5745; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28536.6382; val_optim_loss: 28536.6382
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9683; val_auprc_score: 0.9561; val_best_acc_score: 0.9249; val_best_f1_score: 0.9274; train_kl_reg_loss: 2192.1002; train_edge_recon_loss: 27211.2134; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29403.3136; train_optim_loss: 29403.3136; val_kl_reg_loss: 2170.2127; val_edge_recon_loss: 26431.4708; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28601.6834; val_optim_loss: 28601.6834
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9705; val_auprc_score: 0.9591; val_best_acc_score: 0.9275; val_best_f1_score: 0.9302; train_kl_reg_loss: 2190.2146; train_edge_recon_loss: 27220.7107; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29410.9254; train_optim_loss: 29410.9254; val_kl_reg_loss: 2135.8101; val_edge_recon_loss: 26396.6885; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28532.4987; val_optim_loss: 28532.4987
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9734; val_auprc_score: 0.9650; val_best_acc_score: 0.9288; val_best_f1_score: 0.9310; train_kl_reg_loss: 2194.7679; train_edge_recon_loss: 27201.5255; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29396.2934; train_optim_loss: 29396.2934; val_kl_reg_loss: 1982.1010; val_edge_recon_loss: 26384.7804; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28366.8813; val_optim_loss: 28366.8813
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9724; val_auprc_score: 0.9625; val_best_acc_score: 0.9285; val_best_f1_score: 0.9309; train_kl_reg_loss: 2196.6872; train_edge_recon_loss: 27191.4234; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29388.1106; train_optim_loss: 29388.1106; val_kl_reg_loss: 2209.3188; val_edge_recon_loss: 26395.3868; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28604.7056; val_optim_loss: 28604.7056
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9742; val_auprc_score: 0.9654; val_best_acc_score: 0.9307; val_best_f1_score: 0.9328; train_kl_reg_loss: 2198.6495; train_edge_recon_loss: 27179.1022; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29377.7516; train_optim_loss: 29377.7516; val_kl_reg_loss: 2042.0201; val_edge_recon_loss: 26394.6835; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28436.7037; val_optim_loss: 28436.7037
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9743; val_auprc_score: 0.9656; val_best_acc_score: 0.9312; val_best_f1_score: 0.9333; train_kl_reg_loss: 2199.6946; train_edge_recon_loss: 27180.5338; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29380.2284; train_optim_loss: 29380.2284; val_kl_reg_loss: 2058.3492; val_edge_recon_loss: 26356.4831; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28414.8322; val_optim_loss: 28414.8322
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9750; val_auprc_score: 0.9662; val_best_acc_score: 0.9326; val_best_f1_score: 0.9346; train_kl_reg_loss: 2197.3649; train_edge_recon_loss: 27174.4772; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29371.8421; train_optim_loss: 29371.8421; val_kl_reg_loss: 2070.9649; val_edge_recon_loss: 26379.1347; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28450.0996; val_optim_loss: 28450.0996

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9748; val_auprc_score: 0.9658; val_best_acc_score: 0.9325; val_best_f1_score: 0.9346; train_kl_reg_loss: 2195.1990; train_edge_recon_loss: 27143.6609; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29338.8599; train_optim_loss: 29338.8599; val_kl_reg_loss: 2151.9005; val_edge_recon_loss: 26371.1649; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28523.0655; val_optim_loss: 28523.0655
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9759; val_auprc_score: 0.9671; val_best_acc_score: 0.9343; val_best_f1_score: 0.9363; train_kl_reg_loss: 2191.9851; train_edge_recon_loss: 27151.9227; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29343.9078; train_optim_loss: 29343.9078; val_kl_reg_loss: 2141.7364; val_edge_recon_loss: 26334.5011; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28476.2374; val_optim_loss: 28476.2374
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9759; val_auprc_score: 0.9672; val_best_acc_score: 0.9348; val_best_f1_score: 0.9364; train_kl_reg_loss: 2192.9140; train_edge_recon_loss: 27145.1160; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29338.0300; train_optim_loss: 29338.0300; val_kl_reg_loss: 2146.3265; val_edge_recon_loss: 26329.6106; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28475.9371; val_optim_loss: 28475.9371
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9778; val_auprc_score: 0.9706; val_best_acc_score: 0.9360; val_best_f1_score: 0.9379; train_kl_reg_loss: 2193.4347; train_edge_recon_loss: 27138.7437; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29332.1785; train_optim_loss: 29332.1785; val_kl_reg_loss: 2120.7680; val_edge_recon_loss: 26295.2525; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28416.0203; val_optim_loss: 28416.0203

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 21 min 58 sec.
Using best model state, which was in epoch 11.

--- MODEL EVALUATION ---
val AUROC score: 0.9722
val AUPRC score: 0.9629
val best accuracy score: 0.9269
val best F1 score: 0.9296
val target rna MSE score: 5.2726
val source rna MSE score: 3.5957

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
