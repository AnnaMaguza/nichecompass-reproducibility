Run timestamp: 27062023_155235_3.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'seqfish_mouse_organogenesis', '--reference_batches', 'batch1', 'batch2', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '16384', '--node_batch_size', 'None', '--timestamp_suffix', '_3']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 351, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 351, n_latent: 1358, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1358, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 702
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 16025
Number of validation nodes: 1781
Number of training edges: 108147
Number of validation edges: 12016
Edge batch size: 16384
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9783; val_auprc_score: 0.9800; val_best_acc_score: 0.9342; val_best_f1_score: 0.9336; train_kl_reg_loss: 194.5773; train_edge_recon_loss: 344895.2232; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 345089.7991; train_optim_loss: 345089.7991; val_kl_reg_loss: 469.3550; val_edge_recon_loss: 328784.5000; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 329253.8438; val_optim_loss: 329253.8438
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9489; val_auprc_score: 0.9469; val_best_acc_score: 0.8802; val_best_f1_score: 0.8829; train_kl_reg_loss: 1585.1163; train_edge_recon_loss: 319077.7321; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 320662.8482; train_optim_loss: 320662.8482; val_kl_reg_loss: 4505.3457; val_edge_recon_loss: 274331.7500; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 278837.0938; val_optim_loss: 278837.0938
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9531; val_auprc_score: 0.9480; val_best_acc_score: 0.8896; val_best_f1_score: 0.8919; train_kl_reg_loss: 7908.8517; train_edge_recon_loss: 275219.4643; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 283128.3125; train_optim_loss: 283128.3125; val_kl_reg_loss: 11393.1816; val_edge_recon_loss: 270018.3125; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 281411.5000; val_optim_loss: 281411.5000
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9637; val_auprc_score: 0.9572; val_best_acc_score: 0.9057; val_best_f1_score: 0.9091; train_kl_reg_loss: 12090.0473; train_edge_recon_loss: 268774.8884; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 280864.9330; train_optim_loss: 280864.9330; val_kl_reg_loss: 11747.8809; val_edge_recon_loss: 268229.8125; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 279977.6875; val_optim_loss: 279977.6875
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9734; val_auprc_score: 0.9695; val_best_acc_score: 0.9188; val_best_f1_score: 0.9206; train_kl_reg_loss: 10602.4216; train_edge_recon_loss: 266633.1295; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 277235.5491; train_optim_loss: 277235.5491; val_kl_reg_loss: 8845.4346; val_edge_recon_loss: 266049.0938; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 274894.5312; val_optim_loss: 274894.5312
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9772; val_auprc_score: 0.9734; val_best_acc_score: 0.9267; val_best_f1_score: 0.9286; train_kl_reg_loss: 7861.4945; train_edge_recon_loss: 266627.7946; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 274489.2902; train_optim_loss: 274489.2902; val_kl_reg_loss: 6867.4194; val_edge_recon_loss: 264341.3438; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 271208.7500; val_optim_loss: 271208.7500
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9787; val_auprc_score: 0.9743; val_best_acc_score: 0.9290; val_best_f1_score: 0.9302; train_kl_reg_loss: 6702.9223; train_edge_recon_loss: 266507.6786; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 273210.5982; train_optim_loss: 273210.5982; val_kl_reg_loss: 6680.5156; val_edge_recon_loss: 264640.0000; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 271320.5000; val_optim_loss: 271320.5000
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9823; val_auprc_score: 0.9794; val_best_acc_score: 0.9360; val_best_f1_score: 0.9371; train_kl_reg_loss: 6879.3384; train_edge_recon_loss: 265129.9866; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 272009.3259; train_optim_loss: 272009.3259; val_kl_reg_loss: 7053.4453; val_edge_recon_loss: 261964.2969; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 269017.7500; val_optim_loss: 269017.7500
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9824; val_auprc_score: 0.9792; val_best_acc_score: 0.9363; val_best_f1_score: 0.9378; train_kl_reg_loss: 7105.8976; train_edge_recon_loss: 263681.6295; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 270787.5223; train_optim_loss: 270787.5223; val_kl_reg_loss: 6985.2285; val_edge_recon_loss: 263254.4688; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 270239.6875; val_optim_loss: 270239.6875
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9845; val_auprc_score: 0.9815; val_best_acc_score: 0.9421; val_best_f1_score: 0.9430; train_kl_reg_loss: 6874.7239; train_edge_recon_loss: 263203.3036; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 270078.0268; train_optim_loss: 270078.0268; val_kl_reg_loss: 6635.6514; val_edge_recon_loss: 261787.8281; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 268423.4688; val_optim_loss: 268423.4688
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9867; val_auprc_score: 0.9845; val_best_acc_score: 0.9480; val_best_f1_score: 0.9486; train_kl_reg_loss: 6592.2342; train_edge_recon_loss: 262866.3884; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 269458.6205; train_optim_loss: 269458.6205; val_kl_reg_loss: 6520.2163; val_edge_recon_loss: 260958.0781; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 267478.2812; val_optim_loss: 267478.2812
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9874; val_auprc_score: 0.9856; val_best_acc_score: 0.9483; val_best_f1_score: 0.9494; train_kl_reg_loss: 6587.3226; train_edge_recon_loss: 262287.3772; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 268874.7009; train_optim_loss: 268874.7009; val_kl_reg_loss: 6559.0332; val_edge_recon_loss: 260955.8438; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 267514.8750; val_optim_loss: 267514.8750
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9894; val_auprc_score: 0.9876; val_best_acc_score: 0.9537; val_best_f1_score: 0.9545; train_kl_reg_loss: 6585.2003; train_edge_recon_loss: 261898.0759; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 268483.2768; train_optim_loss: 268483.2768; val_kl_reg_loss: 6478.3652; val_edge_recon_loss: 260454.7188; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266933.0938; val_optim_loss: 266933.0938
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9894; val_auprc_score: 0.9877; val_best_acc_score: 0.9546; val_best_f1_score: 0.9556; train_kl_reg_loss: 6452.5455; train_edge_recon_loss: 261481.0357; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 267933.5804; train_optim_loss: 267933.5804; val_kl_reg_loss: 6329.2627; val_edge_recon_loss: 260452.8438; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266782.0938; val_optim_loss: 266782.0938
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9901; val_auprc_score: 0.9888; val_best_acc_score: 0.9562; val_best_f1_score: 0.9569; train_kl_reg_loss: 6346.8990; train_edge_recon_loss: 261051.5067; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 267398.4107; train_optim_loss: 267398.4107; val_kl_reg_loss: 6292.7656; val_edge_recon_loss: 259839.6562; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266132.4375; val_optim_loss: 266132.4375
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9898; val_auprc_score: 0.9881; val_best_acc_score: 0.9553; val_best_f1_score: 0.9561; train_kl_reg_loss: 6307.6973; train_edge_recon_loss: 260885.6496; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 267193.3438; train_optim_loss: 267193.3438; val_kl_reg_loss: 6215.2246; val_edge_recon_loss: 260219.5469; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 266434.7812; val_optim_loss: 266434.7812
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9917; val_auprc_score: 0.9906; val_best_acc_score: 0.9582; val_best_f1_score: 0.9589; train_kl_reg_loss: 6224.5195; train_edge_recon_loss: 260565.4777; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266790.0000; train_optim_loss: 266790.0000; val_kl_reg_loss: 6122.9385; val_edge_recon_loss: 259683.4062; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 265806.3438; val_optim_loss: 265806.3438
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9907; val_auprc_score: 0.9890; val_best_acc_score: 0.9593; val_best_f1_score: 0.9600; train_kl_reg_loss: 6134.8253; train_edge_recon_loss: 260858.8125; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266993.6384; train_optim_loss: 266993.6384; val_kl_reg_loss: 6031.8135; val_edge_recon_loss: 259675.3281; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 265707.1562; val_optim_loss: 265707.1562
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9914; val_auprc_score: 0.9882; val_best_acc_score: 0.9607; val_best_f1_score: 0.9615; train_kl_reg_loss: 6059.9605; train_edge_recon_loss: 260422.7589; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266482.7232; train_optim_loss: 266482.7232; val_kl_reg_loss: 5981.8389; val_edge_recon_loss: 258484.6562; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 264466.5000; val_optim_loss: 264466.5000
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9915; val_auprc_score: 0.9897; val_best_acc_score: 0.9607; val_best_f1_score: 0.9613; train_kl_reg_loss: 6033.0107; train_edge_recon_loss: 260616.1317; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266649.1384; train_optim_loss: 266649.1384; val_kl_reg_loss: 5954.6631; val_edge_recon_loss: 259088.5781; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 265043.2500; val_optim_loss: 265043.2500
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9919; val_auprc_score: 0.9904; val_best_acc_score: 0.9616; val_best_f1_score: 0.9622; train_kl_reg_loss: 5975.2250; train_edge_recon_loss: 260343.0848; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266318.3080; train_optim_loss: 266318.3080; val_kl_reg_loss: 5871.2979; val_edge_recon_loss: 258982.9844; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 264854.2812; val_optim_loss: 264854.2812
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9919; val_auprc_score: 0.9901; val_best_acc_score: 0.9608; val_best_f1_score: 0.9614; train_kl_reg_loss: 5928.4402; train_edge_recon_loss: 260278.7723; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266207.2098; train_optim_loss: 266207.2098; val_kl_reg_loss: 5865.7744; val_edge_recon_loss: 259987.0312; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 265852.8125; val_optim_loss: 265852.8125

Reducing learning rate: metric has not improved more than 0.0 in the last 3 epochs.
New learning rate is 0.0001.

Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.9919; val_auprc_score: 0.9895; val_best_acc_score: 0.9626; val_best_f1_score: 0.9632; train_kl_reg_loss: 5915.4483; train_edge_recon_loss: 260345.7098; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266261.1652; train_optim_loss: 266261.1652; val_kl_reg_loss: 5854.2988; val_edge_recon_loss: 258668.5781; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 264522.8750; val_optim_loss: 264522.8750
Epoch 24/100 |████----------------| 24.0% val_auroc_score: 0.9922; val_auprc_score: 0.9905; val_best_acc_score: 0.9625; val_best_f1_score: 0.9631; train_kl_reg_loss: 5902.7418; train_edge_recon_loss: 260280.0714; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 266182.8170; train_optim_loss: 266182.8170; val_kl_reg_loss: 5852.8560; val_edge_recon_loss: 259264.6719; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 265117.5312; val_optim_loss: 265117.5312
Epoch 25/100 |█████---------------| 25.0% val_auroc_score: 0.9915; val_auprc_score: 0.9893; val_best_acc_score: 0.9611; val_best_f1_score: 0.9618; train_kl_reg_loss: 5911.3487; train_edge_recon_loss: 259972.8661; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 265884.2143; train_optim_loss: 265884.2143; val_kl_reg_loss: 5850.4805; val_edge_recon_loss: 259780.2656; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 265630.7500; val_optim_loss: 265630.7500

Stopping early: metric has not improved more than 0.0 in the last 6 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 1 min 55 sec.
Using best model state, which was in epoch 19.

--- MODEL EVALUATION ---
Val AUROC score: 0.9905
Val AUPRC score: 0.9875
Val best accuracy score: 0.9596
Val best F1 score: 0.9603
Val gene expr MSE score: 2.0951

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
