None
Run timestamp: 04072023_153607_30.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'vizgen_merfish_human_ovarian_cancer', '--reference_batches', 'batch2', '--n_neighbors', '8', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--add_fc_gps_instead_of_gp_dict_gps', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '30', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--timestamp_suffix', '_30']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 500, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 500, n_latent: 1691, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1691, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 1000
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 210667
Number of validation nodes: 23407
Number of training edges: 978353
Number of validation edges: 108705
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9875; val_auprc_score: 0.9870; val_best_acc_score: 0.9446; val_best_f1_score: 0.9448; train_kl_reg_loss: 6478.2453; train_edge_recon_loss: 264849.3158; train_gene_expr_recon_loss: 21968.5816; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 293296.1423; train_optim_loss: 293296.1423; val_kl_reg_loss: 6364.2204; val_edge_recon_loss: 262609.2770; val_gene_expr_recon_loss: 20929.7846; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 289903.2823; val_optim_loss: 289903.2823
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9910; val_auprc_score: 0.9901; val_best_acc_score: 0.9551; val_best_f1_score: 0.9552; train_kl_reg_loss: 6521.7518; train_edge_recon_loss: 260968.0389; train_gene_expr_recon_loss: 20815.7118; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 288305.5023; train_optim_loss: 288305.5023; val_kl_reg_loss: 6447.0326; val_edge_recon_loss: 261086.1797; val_gene_expr_recon_loss: 20554.6078; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 288087.8203; val_optim_loss: 288087.8203
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9934; val_auprc_score: 0.9925; val_best_acc_score: 0.9629; val_best_f1_score: 0.9632; train_kl_reg_loss: 6510.9317; train_edge_recon_loss: 260351.4699; train_gene_expr_recon_loss: 20544.3917; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 287406.7933; train_optim_loss: 287406.7933; val_kl_reg_loss: 6440.4309; val_edge_recon_loss: 260308.5805; val_gene_expr_recon_loss: 20360.2302; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 287109.2413; val_optim_loss: 287109.2413
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9939; val_auprc_score: 0.9932; val_best_acc_score: 0.9644; val_best_f1_score: 0.9645; train_kl_reg_loss: 6497.4423; train_edge_recon_loss: 259937.1157; train_gene_expr_recon_loss: 20431.7131; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 286866.2711; train_optim_loss: 286866.2711; val_kl_reg_loss: 6388.9713; val_edge_recon_loss: 260073.2318; val_gene_expr_recon_loss: 20275.0606; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 286737.2623; val_optim_loss: 286737.2623
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9943; val_auprc_score: 0.9938; val_best_acc_score: 0.9654; val_best_f1_score: 0.9655; train_kl_reg_loss: 6487.9660; train_edge_recon_loss: 259623.6699; train_gene_expr_recon_loss: 20371.6538; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 286483.2895; train_optim_loss: 286483.2895; val_kl_reg_loss: 6610.1439; val_edge_recon_loss: 260161.7731; val_gene_expr_recon_loss: 20272.7204; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 287044.6381; val_optim_loss: 287044.6381
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9943; val_auprc_score: 0.9937; val_best_acc_score: 0.9658; val_best_f1_score: 0.9660; train_kl_reg_loss: 6484.1949; train_edge_recon_loss: 259481.5452; train_gene_expr_recon_loss: 20342.8655; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 286308.6058; train_optim_loss: 286308.6058; val_kl_reg_loss: 6490.1689; val_edge_recon_loss: 260273.9635; val_gene_expr_recon_loss: 20232.2432; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 286996.3749; val_optim_loss: 286996.3749
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9951; val_auprc_score: 0.9945; val_best_acc_score: 0.9688; val_best_f1_score: 0.9690; train_kl_reg_loss: 6476.9972; train_edge_recon_loss: 259436.1235; train_gene_expr_recon_loss: 20317.2379; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 286230.3589; train_optim_loss: 286230.3589; val_kl_reg_loss: 6269.7281; val_edge_recon_loss: 259772.4883; val_gene_expr_recon_loss: 20267.2350; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 286309.4514; val_optim_loss: 286309.4514
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9950; val_auprc_score: 0.9941; val_best_acc_score: 0.9683; val_best_f1_score: 0.9685; train_kl_reg_loss: 6475.5111; train_edge_recon_loss: 259263.0889; train_gene_expr_recon_loss: 20306.4545; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 286045.0546; train_optim_loss: 286045.0546; val_kl_reg_loss: 6294.6779; val_edge_recon_loss: 259566.2623; val_gene_expr_recon_loss: 20213.4098; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 286074.3505; val_optim_loss: 286074.3505
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9958; val_auprc_score: 0.9954; val_best_acc_score: 0.9713; val_best_f1_score: 0.9714; train_kl_reg_loss: 6474.8940; train_edge_recon_loss: 259139.4333; train_gene_expr_recon_loss: 20299.1442; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285913.4715; train_optim_loss: 285913.4715; val_kl_reg_loss: 6459.3367; val_edge_recon_loss: 259488.2325; val_gene_expr_recon_loss: 20197.8360; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 286145.4048; val_optim_loss: 286145.4048
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9955; val_auprc_score: 0.9948; val_best_acc_score: 0.9711; val_best_f1_score: 0.9713; train_kl_reg_loss: 6474.2391; train_edge_recon_loss: 259083.5809; train_gene_expr_recon_loss: 20292.1173; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285849.9372; train_optim_loss: 285849.9372; val_kl_reg_loss: 6399.1215; val_edge_recon_loss: 259130.0279; val_gene_expr_recon_loss: 20215.5884; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285744.7371; val_optim_loss: 285744.7371
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9960; val_auprc_score: 0.9954; val_best_acc_score: 0.9727; val_best_f1_score: 0.9729; train_kl_reg_loss: 6477.1079; train_edge_recon_loss: 258962.4926; train_gene_expr_recon_loss: 20283.8483; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285723.4487; train_optim_loss: 285723.4487; val_kl_reg_loss: 6367.8709; val_edge_recon_loss: 259185.5193; val_gene_expr_recon_loss: 20177.2675; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285730.6570; val_optim_loss: 285730.6570
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9957; val_auprc_score: 0.9951; val_best_acc_score: 0.9708; val_best_f1_score: 0.9709; train_kl_reg_loss: 6470.1799; train_edge_recon_loss: 258939.9778; train_gene_expr_recon_loss: 20282.7465; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285692.9044; train_optim_loss: 285692.9044; val_kl_reg_loss: 6332.6697; val_edge_recon_loss: 259333.7956; val_gene_expr_recon_loss: 20166.4065; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285832.8716; val_optim_loss: 285832.8716
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9960; val_auprc_score: 0.9954; val_best_acc_score: 0.9728; val_best_f1_score: 0.9730; train_kl_reg_loss: 6468.6310; train_edge_recon_loss: 258831.7789; train_gene_expr_recon_loss: 20270.4690; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285570.8792; train_optim_loss: 285570.8792; val_kl_reg_loss: 6503.1621; val_edge_recon_loss: 259126.1207; val_gene_expr_recon_loss: 20170.7781; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285800.0615; val_optim_loss: 285800.0615
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9963; val_auprc_score: 0.9958; val_best_acc_score: 0.9740; val_best_f1_score: 0.9741; train_kl_reg_loss: 6472.9203; train_edge_recon_loss: 258722.3599; train_gene_expr_recon_loss: 20261.2830; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285456.5634; train_optim_loss: 285456.5634; val_kl_reg_loss: 6306.6805; val_edge_recon_loss: 258964.1483; val_gene_expr_recon_loss: 20173.3587; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285444.1881; val_optim_loss: 285444.1881
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9964; val_auprc_score: 0.9959; val_best_acc_score: 0.9742; val_best_f1_score: 0.9744; train_kl_reg_loss: 6472.5362; train_edge_recon_loss: 258643.9329; train_gene_expr_recon_loss: 20263.0149; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285379.4837; train_optim_loss: 285379.4837; val_kl_reg_loss: 6330.5181; val_edge_recon_loss: 259003.2680; val_gene_expr_recon_loss: 20179.2330; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285513.0189; val_optim_loss: 285513.0189
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9963; val_auprc_score: 0.9958; val_best_acc_score: 0.9746; val_best_f1_score: 0.9748; train_kl_reg_loss: 6476.0227; train_edge_recon_loss: 258668.4849; train_gene_expr_recon_loss: 20261.2431; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285405.7505; train_optim_loss: 285405.7505; val_kl_reg_loss: 6407.1083; val_edge_recon_loss: 258865.8143; val_gene_expr_recon_loss: 20171.0304; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285443.9529; val_optim_loss: 285443.9529
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9969; val_auprc_score: 0.9965; val_best_acc_score: 0.9759; val_best_f1_score: 0.9759; train_kl_reg_loss: 6473.0063; train_edge_recon_loss: 258583.9112; train_gene_expr_recon_loss: 20251.1487; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285308.0665; train_optim_loss: 285308.0665; val_kl_reg_loss: 6305.9011; val_edge_recon_loss: 258637.3910; val_gene_expr_recon_loss: 20163.8716; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285107.1645; val_optim_loss: 285107.1645
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9966; val_auprc_score: 0.9959; val_best_acc_score: 0.9756; val_best_f1_score: 0.9757; train_kl_reg_loss: 6473.4371; train_edge_recon_loss: 258541.2203; train_gene_expr_recon_loss: 20246.0936; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285260.7511; train_optim_loss: 285260.7511; val_kl_reg_loss: 6368.4040; val_edge_recon_loss: 258674.6316; val_gene_expr_recon_loss: 20182.3130; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285225.3486; val_optim_loss: 285225.3486
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9965; val_auprc_score: 0.9959; val_best_acc_score: 0.9755; val_best_f1_score: 0.9756; train_kl_reg_loss: 6470.5814; train_edge_recon_loss: 258498.3966; train_gene_expr_recon_loss: 20248.8421; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285217.8201; train_optim_loss: 285217.8201; val_kl_reg_loss: 6307.3303; val_edge_recon_loss: 258572.6131; val_gene_expr_recon_loss: 20177.1898; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285057.1334; val_optim_loss: 285057.1334
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9967; val_auprc_score: 0.9962; val_best_acc_score: 0.9759; val_best_f1_score: 0.9760; train_kl_reg_loss: 6475.4407; train_edge_recon_loss: 258470.8935; train_gene_expr_recon_loss: 20249.8268; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285196.1609; train_optim_loss: 285196.1609; val_kl_reg_loss: 6538.5662; val_edge_recon_loss: 258678.3690; val_gene_expr_recon_loss: 20166.5639; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285383.5000; val_optim_loss: 285383.5000
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9969; val_auprc_score: 0.9964; val_best_acc_score: 0.9770; val_best_f1_score: 0.9772; train_kl_reg_loss: 6474.2556; train_edge_recon_loss: 258436.6053; train_gene_expr_recon_loss: 20246.0159; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285156.8762; train_optim_loss: 285156.8762; val_kl_reg_loss: 6691.8437; val_edge_recon_loss: 258457.4335; val_gene_expr_recon_loss: 20172.7349; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285322.0119; val_optim_loss: 285322.0119
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9969; val_auprc_score: 0.9963; val_best_acc_score: 0.9771; val_best_f1_score: 0.9772; train_kl_reg_loss: 6471.6189; train_edge_recon_loss: 258434.5923; train_gene_expr_recon_loss: 20247.7670; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285153.9778; train_optim_loss: 285153.9778; val_kl_reg_loss: 6384.2076; val_edge_recon_loss: 258753.7771; val_gene_expr_recon_loss: 20154.6387; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285292.6244; val_optim_loss: 285292.6244
Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.9968; val_auprc_score: 0.9961; val_best_acc_score: 0.9762; val_best_f1_score: 0.9763; train_kl_reg_loss: 6475.3497; train_edge_recon_loss: 258318.0612; train_gene_expr_recon_loss: 20242.5574; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 285035.9680; train_optim_loss: 285035.9680; val_kl_reg_loss: 6469.9970; val_edge_recon_loss: 258494.6376; val_gene_expr_recon_loss: 20186.8459; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 285151.4805; val_optim_loss: 285151.4805

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 24/100 |████----------------| 24.0% val_auroc_score: 0.9974; val_auprc_score: 0.9969; val_best_acc_score: 0.9787; val_best_f1_score: 0.9788; train_kl_reg_loss: 6453.0011; train_edge_recon_loss: 258004.3307; train_gene_expr_recon_loss: 20010.7247; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 284468.0566; train_optim_loss: 284468.0566; val_kl_reg_loss: 6435.8496; val_edge_recon_loss: 258024.2276; val_gene_expr_recon_loss: 19923.0070; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 284383.0836; val_optim_loss: 284383.0836
Epoch 25/100 |█████---------------| 25.0% val_auroc_score: 0.9972; val_auprc_score: 0.9968; val_best_acc_score: 0.9789; val_best_f1_score: 0.9790; train_kl_reg_loss: 6441.8374; train_edge_recon_loss: 257873.0601; train_gene_expr_recon_loss: 19995.6282; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 284310.5258; train_optim_loss: 284310.5258; val_kl_reg_loss: 6408.8118; val_edge_recon_loss: 258003.4555; val_gene_expr_recon_loss: 19929.2852; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 284341.5527; val_optim_loss: 284341.5527
