None
Run timestamp: 28072023_105933_65.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'starmap_plus_mouse_cns', '--reference_batches', 'batch1', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000', '--lambda_gene_expr_recon', '0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '1024', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_65']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_pred_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 1022, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 1022, n_latent: 1423, n_addon_latent: 10, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1423, n_cat_covariates_embed_input: 0, n_addon_gp_input: 10, n_output: 1022
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1423, n_cat_covariates_embed_input: 0, n_addon_gp_input: 10, n_output: 1022

--- INITIALIZING TRAINER ---
Number of training nodes: 82121
Number of validation nodes: 9125
Number of training edges: 195913
Number of validation edges: 21768
Edge batch size: 1024
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9659; val_auprc_score: 0.9495; val_best_acc_score: 0.9207; val_best_f1_score: 0.9234; train_kl_reg_loss: 1903.7253; train_edge_recon_loss: 28918.0286; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 30821.7540; train_optim_loss: 30821.7540; val_kl_reg_loss: 2113.9855; val_edge_recon_loss: 26384.4243; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28498.4098; val_optim_loss: 28498.4098
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9731; val_auprc_score: 0.9571; val_best_acc_score: 0.9375; val_best_f1_score: 0.9392; train_kl_reg_loss: 2271.4074; train_edge_recon_loss: 27410.8817; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29682.2891; train_optim_loss: 29682.2891; val_kl_reg_loss: 2153.5082; val_edge_recon_loss: 26176.7159; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28330.2241; val_optim_loss: 28330.2241
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9746; val_auprc_score: 0.9578; val_best_acc_score: 0.9420; val_best_f1_score: 0.9436; train_kl_reg_loss: 2296.6481; train_edge_recon_loss: 27263.4057; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29560.0538; train_optim_loss: 29560.0538; val_kl_reg_loss: 2184.6029; val_edge_recon_loss: 26061.9142; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28246.5171; val_optim_loss: 28246.5171
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9761; val_auprc_score: 0.9597; val_best_acc_score: 0.9471; val_best_f1_score: 0.9488; train_kl_reg_loss: 2324.9141; train_edge_recon_loss: 27145.8463; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29470.7605; train_optim_loss: 29470.7605; val_kl_reg_loss: 2250.9753; val_edge_recon_loss: 26007.7114; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28258.6866; val_optim_loss: 28258.6866
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9783; val_auprc_score: 0.9650; val_best_acc_score: 0.9510; val_best_f1_score: 0.9524; train_kl_reg_loss: 2331.3194; train_edge_recon_loss: 27099.3035; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29430.6229; train_optim_loss: 29430.6229; val_kl_reg_loss: 2348.5019; val_edge_recon_loss: 25922.2372; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28270.7391; val_optim_loss: 28270.7391
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9793; val_auprc_score: 0.9666; val_best_acc_score: 0.9514; val_best_f1_score: 0.9528; train_kl_reg_loss: 2329.1955; train_edge_recon_loss: 27094.2142; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29423.4098; train_optim_loss: 29423.4098; val_kl_reg_loss: 2220.7148; val_edge_recon_loss: 25959.7752; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28180.4901; val_optim_loss: 28180.4901
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9804; val_auprc_score: 0.9688; val_best_acc_score: 0.9548; val_best_f1_score: 0.9559; train_kl_reg_loss: 2336.2303; train_edge_recon_loss: 27048.8923; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29385.1227; train_optim_loss: 29385.1227; val_kl_reg_loss: 2335.1495; val_edge_recon_loss: 25919.3265; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28254.4759; val_optim_loss: 28254.4759
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9805; val_auprc_score: 0.9686; val_best_acc_score: 0.9556; val_best_f1_score: 0.9566; train_kl_reg_loss: 2335.9309; train_edge_recon_loss: 27042.0179; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29377.9487; train_optim_loss: 29377.9487; val_kl_reg_loss: 2246.6691; val_edge_recon_loss: 25870.6379; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28117.3072; val_optim_loss: 28117.3072
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9799; val_auprc_score: 0.9665; val_best_acc_score: 0.9571; val_best_f1_score: 0.9580; train_kl_reg_loss: 2338.1732; train_edge_recon_loss: 27019.6659; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29357.8392; train_optim_loss: 29357.8392; val_kl_reg_loss: 2276.6626; val_edge_recon_loss: 25872.7317; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28149.3944; val_optim_loss: 28149.3944
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9817; val_auprc_score: 0.9707; val_best_acc_score: 0.9572; val_best_f1_score: 0.9583; train_kl_reg_loss: 2334.1788; train_edge_recon_loss: 27028.4619; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29362.6408; train_optim_loss: 29362.6408; val_kl_reg_loss: 2276.0796; val_edge_recon_loss: 25892.6333; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28168.7129; val_optim_loss: 28168.7129
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9818; val_auprc_score: 0.9704; val_best_acc_score: 0.9580; val_best_f1_score: 0.9591; train_kl_reg_loss: 2335.6924; train_edge_recon_loss: 27005.3235; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29341.0159; train_optim_loss: 29341.0159; val_kl_reg_loss: 2249.4814; val_edge_recon_loss: 25832.5021; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28081.9838; val_optim_loss: 28081.9838
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9820; val_auprc_score: 0.9704; val_best_acc_score: 0.9591; val_best_f1_score: 0.9600; train_kl_reg_loss: 2333.3004; train_edge_recon_loss: 27001.8397; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29335.1402; train_optim_loss: 29335.1402; val_kl_reg_loss: 2324.5322; val_edge_recon_loss: 25835.5370; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28160.0693; val_optim_loss: 28160.0693
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9824; val_auprc_score: 0.9710; val_best_acc_score: 0.9590; val_best_f1_score: 0.9602; train_kl_reg_loss: 2338.0826; train_edge_recon_loss: 26979.4061; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29317.4887; train_optim_loss: 29317.4887; val_kl_reg_loss: 2267.4184; val_edge_recon_loss: 25825.9823; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28093.4007; val_optim_loss: 28093.4007
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9824; val_auprc_score: 0.9704; val_best_acc_score: 0.9595; val_best_f1_score: 0.9604; train_kl_reg_loss: 2336.8017; train_edge_recon_loss: 26968.0758; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29304.8775; train_optim_loss: 29304.8775; val_kl_reg_loss: 2330.1172; val_edge_recon_loss: 25825.7017; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28155.8191; val_optim_loss: 28155.8191
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9814; val_auprc_score: 0.9690; val_best_acc_score: 0.9599; val_best_f1_score: 0.9610; train_kl_reg_loss: 2338.5273; train_edge_recon_loss: 26956.0976; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29294.6248; train_optim_loss: 29294.6248; val_kl_reg_loss: 2349.7207; val_edge_recon_loss: 25851.0472; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28200.7680; val_optim_loss: 28200.7680

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9834; val_auprc_score: 0.9732; val_best_acc_score: 0.9607; val_best_f1_score: 0.9618; train_kl_reg_loss: 2333.3920; train_edge_recon_loss: 26921.8420; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29255.2340; train_optim_loss: 29255.2340; val_kl_reg_loss: 2310.3653; val_edge_recon_loss: 25792.0722; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28102.4373; val_optim_loss: 28102.4373
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9827; val_auprc_score: 0.9712; val_best_acc_score: 0.9603; val_best_f1_score: 0.9613; train_kl_reg_loss: 2329.5161; train_edge_recon_loss: 26932.2880; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29261.8040; train_optim_loss: 29261.8040; val_kl_reg_loss: 2309.5679; val_edge_recon_loss: 25785.6136; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28095.1814; val_optim_loss: 28095.1814
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9820; val_auprc_score: 0.9702; val_best_acc_score: 0.9600; val_best_f1_score: 0.9611; train_kl_reg_loss: 2326.1251; train_edge_recon_loss: 26942.4296; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29268.5547; train_optim_loss: 29268.5547; val_kl_reg_loss: 2288.9270; val_edge_recon_loss: 25868.5894; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28157.5163; val_optim_loss: 28157.5163
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9828; val_auprc_score: 0.9711; val_best_acc_score: 0.9614; val_best_f1_score: 0.9624; train_kl_reg_loss: 2326.4754; train_edge_recon_loss: 26931.3481; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 29257.8234; train_optim_loss: 29257.8234; val_kl_reg_loss: 2305.5915; val_edge_recon_loss: 25816.6096; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 28122.2012; val_optim_loss: 28122.2012

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 11 min 45 sec.
Using best model state, which was in epoch 11.

--- MODEL EVALUATION ---
Val AUROC score: 0.9812
Val AUPRC score: 0.9682
Val best accuracy score: 0.9578
Val best F1 score: 0.9589
Val target rna MSE score: 0.9334
Val source rna MSE score: 0.4130

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
