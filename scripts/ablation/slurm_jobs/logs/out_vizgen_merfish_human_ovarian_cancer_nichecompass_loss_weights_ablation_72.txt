None
Run timestamp: 29072023_024137_72.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'vizgen_merfish_human_ovarian_cancer', '--reference_batches', 'batch2', '--n_neighbors', '16', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000', '--lambda_gene_expr_recon', '30', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_72']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_pred_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 500, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 500, n_latent: 1385, n_addon_latent: 10, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1385, n_cat_covariates_embed_input: 0, n_addon_gp_input: 10, n_output: 500
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1385, n_cat_covariates_embed_input: 0, n_addon_gp_input: 10, n_output: 500

--- INITIALIZING TRAINER ---
Number of training nodes: 210667
Number of validation nodes: 23407
Number of training edges: 1931624
Number of validation edges: 214624
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9955; val_auprc_score: 0.9953; val_best_acc_score: 0.9676; val_best_f1_score: 0.9677; train_kl_reg_loss: 2526.7262; train_edge_recon_loss: 28036.7209; train_gene_expr_recon_loss: 20219.8131; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 50783.2602; train_optim_loss: 50783.2602; val_kl_reg_loss: 2674.7594; val_edge_recon_loss: 26568.3889; val_gene_expr_recon_loss: 18264.8538; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 47508.0023; val_optim_loss: 47508.0023
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9970; val_auprc_score: 0.9968; val_best_acc_score: 0.9745; val_best_f1_score: 0.9745; train_kl_reg_loss: 2703.0330; train_edge_recon_loss: 27406.9198; train_gene_expr_recon_loss: 18080.5169; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 48190.4698; train_optim_loss: 48190.4698; val_kl_reg_loss: 2713.0855; val_edge_recon_loss: 26324.5882; val_gene_expr_recon_loss: 17689.3472; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46727.0209; val_optim_loss: 46727.0209
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9976; val_auprc_score: 0.9974; val_best_acc_score: 0.9773; val_best_f1_score: 0.9774; train_kl_reg_loss: 2748.9703; train_edge_recon_loss: 27262.8863; train_gene_expr_recon_loss: 17779.2523; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 47791.1090; train_optim_loss: 47791.1090; val_kl_reg_loss: 2788.7806; val_edge_recon_loss: 26238.6341; val_gene_expr_recon_loss: 17519.7509; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 46547.1657; val_optim_loss: 46547.1657
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9979; val_auprc_score: 0.9978; val_best_acc_score: 0.9789; val_best_f1_score: 0.9790; train_kl_reg_loss: 2765.0994; train_edge_recon_loss: 27199.5475; train_gene_expr_recon_loss: 17609.1151; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 47573.7620; train_optim_loss: 47573.7620; val_kl_reg_loss: 2718.5155; val_edge_recon_loss: 26185.7519; val_gene_expr_recon_loss: 16801.0733; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45705.3407; val_optim_loss: 45705.3407
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9980; val_auprc_score: 0.9977; val_best_acc_score: 0.9798; val_best_f1_score: 0.9798; train_kl_reg_loss: 2767.2849; train_edge_recon_loss: 27161.5007; train_gene_expr_recon_loss: 16248.5010; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46177.2865; train_optim_loss: 46177.2865; val_kl_reg_loss: 2726.7870; val_edge_recon_loss: 26138.3883; val_gene_expr_recon_loss: 16520.0348; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45385.2101; val_optim_loss: 45385.2101
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9983; val_auprc_score: 0.9980; val_best_acc_score: 0.9818; val_best_f1_score: 0.9819; train_kl_reg_loss: 2764.9997; train_edge_recon_loss: 27142.4122; train_gene_expr_recon_loss: 13774.3039; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 43681.7157; train_optim_loss: 43681.7157; val_kl_reg_loss: 2693.5351; val_edge_recon_loss: 26131.8994; val_gene_expr_recon_loss: 16968.4876; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45793.9220; val_optim_loss: 45793.9220
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9982; val_auprc_score: 0.9980; val_best_acc_score: 0.9818; val_best_f1_score: 0.9818; train_kl_reg_loss: 2763.7490; train_edge_recon_loss: 27117.2886; train_gene_expr_recon_loss: 15496.4991; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 45377.5367; train_optim_loss: 45377.5367; val_kl_reg_loss: 2736.8138; val_edge_recon_loss: 26104.9963; val_gene_expr_recon_loss: 16648.3399; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45490.1501; val_optim_loss: 45490.1501
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9984; val_auprc_score: 0.9982; val_best_acc_score: 0.9825; val_best_f1_score: 0.9826; train_kl_reg_loss: 2756.9057; train_edge_recon_loss: 27103.3656; train_gene_expr_recon_loss: 16694.1553; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46554.4267; train_optim_loss: 46554.4267; val_kl_reg_loss: 2724.2785; val_edge_recon_loss: 26069.3319; val_gene_expr_recon_loss: 16628.1454; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45421.7557; val_optim_loss: 45421.7557
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9984; val_auprc_score: 0.9982; val_best_acc_score: 0.9830; val_best_f1_score: 0.9831; train_kl_reg_loss: 2752.8108; train_edge_recon_loss: 27088.3181; train_gene_expr_recon_loss: 16665.5787; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46506.7077; train_optim_loss: 46506.7077; val_kl_reg_loss: 2698.6622; val_edge_recon_loss: 26057.5136; val_gene_expr_recon_loss: 16586.0815; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45342.2573; val_optim_loss: 45342.2573
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9986; val_auprc_score: 0.9984; val_best_acc_score: 0.9840; val_best_f1_score: 0.9841; train_kl_reg_loss: 2752.5497; train_edge_recon_loss: 27072.6637; train_gene_expr_recon_loss: 16648.2352; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46473.4485; train_optim_loss: 46473.4485; val_kl_reg_loss: 2716.4604; val_edge_recon_loss: 26039.1671; val_gene_expr_recon_loss: 17120.8310; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45876.4586; val_optim_loss: 45876.4586
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9986; val_auprc_score: 0.9984; val_best_acc_score: 0.9845; val_best_f1_score: 0.9845; train_kl_reg_loss: 2752.3938; train_edge_recon_loss: 27064.3026; train_gene_expr_recon_loss: 16664.9309; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46481.6272; train_optim_loss: 46481.6272; val_kl_reg_loss: 2718.6619; val_edge_recon_loss: 26016.0719; val_gene_expr_recon_loss: 16620.4961; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45355.2300; val_optim_loss: 45355.2300
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9987; val_auprc_score: 0.9986; val_best_acc_score: 0.9849; val_best_f1_score: 0.9850; train_kl_reg_loss: 2752.9426; train_edge_recon_loss: 27055.5239; train_gene_expr_recon_loss: 16670.0920; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46478.5586; train_optim_loss: 46478.5586; val_kl_reg_loss: 2732.5199; val_edge_recon_loss: 26023.9609; val_gene_expr_recon_loss: 16635.0442; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45391.5249; val_optim_loss: 45391.5249
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9987; val_auprc_score: 0.9986; val_best_acc_score: 0.9850; val_best_f1_score: 0.9850; train_kl_reg_loss: 2756.2321; train_edge_recon_loss: 27042.0863; train_gene_expr_recon_loss: 16669.0289; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46467.3474; train_optim_loss: 46467.3474; val_kl_reg_loss: 2760.6393; val_edge_recon_loss: 26007.0693; val_gene_expr_recon_loss: 16462.2809; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45229.9897; val_optim_loss: 45229.9897
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9987; val_auprc_score: 0.9986; val_best_acc_score: 0.9849; val_best_f1_score: 0.9850; train_kl_reg_loss: 2758.1092; train_edge_recon_loss: 27031.3084; train_gene_expr_recon_loss: 16654.2375; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46443.6551; train_optim_loss: 46443.6551; val_kl_reg_loss: 2771.4157; val_edge_recon_loss: 26010.0046; val_gene_expr_recon_loss: 16615.3181; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45396.7384; val_optim_loss: 45396.7384
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9987; val_auprc_score: 0.9986; val_best_acc_score: 0.9851; val_best_f1_score: 0.9852; train_kl_reg_loss: 2759.6528; train_edge_recon_loss: 27026.1594; train_gene_expr_recon_loss: 16657.3662; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46443.1783; train_optim_loss: 46443.1783; val_kl_reg_loss: 2740.1644; val_edge_recon_loss: 25999.4798; val_gene_expr_recon_loss: 16617.3891; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45357.0332; val_optim_loss: 45357.0332
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9987; val_auprc_score: 0.9986; val_best_acc_score: 0.9852; val_best_f1_score: 0.9852; train_kl_reg_loss: 2759.7582; train_edge_recon_loss: 27026.7803; train_gene_expr_recon_loss: 16650.4106; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46436.9490; train_optim_loss: 46436.9490; val_kl_reg_loss: 2754.3973; val_edge_recon_loss: 25983.0944; val_gene_expr_recon_loss: 16602.4566; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45339.9484; val_optim_loss: 45339.9484
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9988; val_auprc_score: 0.9985; val_best_acc_score: 0.9855; val_best_f1_score: 0.9856; train_kl_reg_loss: 2763.8487; train_edge_recon_loss: 27009.4422; train_gene_expr_recon_loss: 16652.7509; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46426.0418; train_optim_loss: 46426.0418; val_kl_reg_loss: 2750.0306; val_edge_recon_loss: 25988.3817; val_gene_expr_recon_loss: 16605.5051; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45343.9175; val_optim_loss: 45343.9175

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9990; val_auprc_score: 0.9988; val_best_acc_score: 0.9868; val_best_f1_score: 0.9869; train_kl_reg_loss: 2759.3213; train_edge_recon_loss: 26978.8108; train_gene_expr_recon_loss: 16603.2601; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46341.3922; train_optim_loss: 46341.3922; val_kl_reg_loss: 2742.4191; val_edge_recon_loss: 25944.7835; val_gene_expr_recon_loss: 16569.5899; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45256.7924; val_optim_loss: 45256.7924
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9990; val_auprc_score: 0.9989; val_best_acc_score: 0.9872; val_best_f1_score: 0.9872; train_kl_reg_loss: 2755.2962; train_edge_recon_loss: 26978.7565; train_gene_expr_recon_loss: 16591.6104; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46325.6631; train_optim_loss: 46325.6631; val_kl_reg_loss: 2752.1289; val_edge_recon_loss: 25927.7166; val_gene_expr_recon_loss: 16565.7712; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45245.6168; val_optim_loss: 45245.6168
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9990; val_auprc_score: 0.9988; val_best_acc_score: 0.9869; val_best_f1_score: 0.9870; train_kl_reg_loss: 2754.3279; train_edge_recon_loss: 26979.4889; train_gene_expr_recon_loss: 16587.3429; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46321.1598; train_optim_loss: 46321.1598; val_kl_reg_loss: 2752.6021; val_edge_recon_loss: 25944.1242; val_gene_expr_recon_loss: 16571.4776; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45268.2039; val_optim_loss: 45268.2039
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9990; val_auprc_score: 0.9988; val_best_acc_score: 0.9870; val_best_f1_score: 0.9871; train_kl_reg_loss: 2753.8913; train_edge_recon_loss: 26977.2387; train_gene_expr_recon_loss: 16585.0657; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 46316.1958; train_optim_loss: 46316.1958; val_kl_reg_loss: 2743.3033; val_edge_recon_loss: 25942.6526; val_gene_expr_recon_loss: 16570.2013; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 45256.1571; val_optim_loss: 45256.1571

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 493 min 40 sec.
Using best model state, which was in epoch 13.

--- MODEL EVALUATION ---
val AUROC score: 0.9987
val AUPRC score: 0.9985
val best accuracy score: 0.9848
val best F1 score: 0.9849
val target rna MSE score: 4.3308
val source rna MSE score: 0.2869

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
