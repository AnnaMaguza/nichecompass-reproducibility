None
Run timestamp: 18072023_073134_100.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'vizgen_merfish_human_ovarian_cancer', '--reference_batches', 'batch2', '--n_neighbors', '16', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '3000', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_100']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 500, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 500, n_latent: 1385, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1385, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 1000
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 210667
Number of validation nodes: 23407
Number of training edges: 1931624
Number of validation edges: 214624
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9921; val_auprc_score: 0.9914; val_best_acc_score: 0.9564; val_best_f1_score: 0.9566; train_kl_reg_loss: 17389.0868; train_edge_recon_loss: 26273909.9920; train_gene_expr_recon_loss: 1592529.9358; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 27883829.0125; train_optim_loss: 27883829.0125; val_kl_reg_loss: 18605.9613; val_edge_recon_loss: 26097020.6048; val_gene_expr_recon_loss: 1452637.9435; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 27568264.5000; val_optim_loss: 27568264.5000
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9942; val_auprc_score: 0.9935; val_best_acc_score: 0.9657; val_best_f1_score: 0.9660; train_kl_reg_loss: 19216.6996; train_edge_recon_loss: 25916607.7567; train_gene_expr_recon_loss: 1406476.4372; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 27342300.8874; train_optim_loss: 27342300.8874; val_kl_reg_loss: 19213.7684; val_edge_recon_loss: 25945622.9571; val_gene_expr_recon_loss: 1378985.0717; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 27343821.8476; val_optim_loss: 27343821.8476
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9959; val_auprc_score: 0.9952; val_best_acc_score: 0.9720; val_best_f1_score: 0.9722; train_kl_reg_loss: 19031.1064; train_edge_recon_loss: 25828751.9931; train_gene_expr_recon_loss: 1369839.1283; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 27217622.2237; train_optim_loss: 27217622.2237; val_kl_reg_loss: 17875.6064; val_edge_recon_loss: 25879000.3524; val_gene_expr_recon_loss: 1359833.2193; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 27256709.1905; val_optim_loss: 27256709.1905
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9965; val_auprc_score: 0.9959; val_best_acc_score: 0.9742; val_best_f1_score: 0.9744; train_kl_reg_loss: 18646.3025; train_edge_recon_loss: 25781042.7570; train_gene_expr_recon_loss: 1353615.1570; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 27153304.2364; train_optim_loss: 27153304.2364; val_kl_reg_loss: 18079.0984; val_edge_recon_loss: 25835259.6190; val_gene_expr_recon_loss: 1349026.8164; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 27202365.4952; val_optim_loss: 27202365.4952
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9969; val_auprc_score: 0.9964; val_best_acc_score: 0.9760; val_best_f1_score: 0.9761; train_kl_reg_loss: 18045.2913; train_edge_recon_loss: 25755635.3120; train_gene_expr_recon_loss: 1346247.8105; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 27119928.4177; train_optim_loss: 27119928.4177; val_kl_reg_loss: 17731.3614; val_edge_recon_loss: 25802898.9095; val_gene_expr_recon_loss: 1341458.3107; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 27162088.5714; val_optim_loss: 27162088.5714
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9970; val_auprc_score: 0.9965; val_best_acc_score: 0.9773; val_best_f1_score: 0.9774; train_kl_reg_loss: 17737.8792; train_edge_recon_loss: 25719453.9173; train_gene_expr_recon_loss: 1340745.2128; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 27077937.0135; train_optim_loss: 27077937.0135; val_kl_reg_loss: 17415.1598; val_edge_recon_loss: 25815788.8048; val_gene_expr_recon_loss: 1348411.5301; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 27181615.5286; val_optim_loss: 27181615.5286
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9973; val_auprc_score: 0.9967; val_best_acc_score: 0.9791; val_best_f1_score: 0.9792; train_kl_reg_loss: 17366.8668; train_edge_recon_loss: 25704888.9981; train_gene_expr_recon_loss: 1344885.9364; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 27067141.8086; train_optim_loss: 27067141.8086; val_kl_reg_loss: 17563.8031; val_edge_recon_loss: 25754120.3762; val_gene_expr_recon_loss: 1179219.8074; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26950904.0714; val_optim_loss: 26950904.0714
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9976; val_auprc_score: 0.9972; val_best_acc_score: 0.9804; val_best_f1_score: 0.9804; train_kl_reg_loss: 17071.2245; train_edge_recon_loss: 25680942.9282; train_gene_expr_recon_loss: 1344650.2278; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 27042664.3795; train_optim_loss: 27042664.3795; val_kl_reg_loss: 17164.8554; val_edge_recon_loss: 25740943.6524; val_gene_expr_recon_loss: 1577223.9125; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 27335332.4381; val_optim_loss: 27335332.4381
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9977; val_auprc_score: 0.9972; val_best_acc_score: 0.9814; val_best_f1_score: 0.9815; train_kl_reg_loss: 16816.1780; train_edge_recon_loss: 25672004.7135; train_gene_expr_recon_loss: 1250790.2665; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26939611.1768; train_optim_loss: 26939611.1768; val_kl_reg_loss: 16806.9673; val_edge_recon_loss: 25721879.9619; val_gene_expr_recon_loss: 1049019.8443; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26787706.7619; val_optim_loss: 26787706.7619
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9979; val_auprc_score: 0.9975; val_best_acc_score: 0.9823; val_best_f1_score: 0.9823; train_kl_reg_loss: 16493.3185; train_edge_recon_loss: 25653439.4477; train_gene_expr_recon_loss: 1150066.0486; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26819998.8094; train_optim_loss: 26819998.8094; val_kl_reg_loss: 16342.3442; val_edge_recon_loss: 25703803.8190; val_gene_expr_recon_loss: 1105304.1796; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26825450.2714; val_optim_loss: 26825450.2714
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9981; val_auprc_score: 0.9976; val_best_acc_score: 0.9835; val_best_f1_score: 0.9836; train_kl_reg_loss: 16273.9814; train_edge_recon_loss: 25643735.5171; train_gene_expr_recon_loss: 1126808.6635; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26786818.1516; train_optim_loss: 26786818.1516; val_kl_reg_loss: 16229.7147; val_edge_recon_loss: 25718776.2143; val_gene_expr_recon_loss: 1122177.2128; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26857183.1667; val_optim_loss: 26857183.1667
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9980; val_auprc_score: 0.9976; val_best_acc_score: 0.9835; val_best_f1_score: 0.9836; train_kl_reg_loss: 16279.5492; train_edge_recon_loss: 25628529.5940; train_gene_expr_recon_loss: 1118470.2061; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26763279.4031; train_optim_loss: 26763279.4031; val_kl_reg_loss: 16117.2653; val_edge_recon_loss: 25682158.2810; val_gene_expr_recon_loss: 1112960.7711; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26811236.2762; val_optim_loss: 26811236.2762
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9982; val_auprc_score: 0.9978; val_best_acc_score: 0.9843; val_best_f1_score: 0.9844; train_kl_reg_loss: 16005.3612; train_edge_recon_loss: 25627233.1598; train_gene_expr_recon_loss: 1116275.4010; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26759513.9009; train_optim_loss: 26759513.9009; val_kl_reg_loss: 15906.5088; val_edge_recon_loss: 25678925.0238; val_gene_expr_recon_loss: 1113645.6146; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26808477.1524; val_optim_loss: 26808477.1524

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9984; val_auprc_score: 0.9980; val_best_acc_score: 0.9855; val_best_f1_score: 0.9855; train_kl_reg_loss: 16943.5954; train_edge_recon_loss: 25588147.9237; train_gene_expr_recon_loss: 1100702.7215; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26705794.2401; train_optim_loss: 26705794.2401; val_kl_reg_loss: 17073.6116; val_edge_recon_loss: 25645378.0810; val_gene_expr_recon_loss: 1100360.8621; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26762812.4333; val_optim_loss: 26762812.4333
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9984; val_auprc_score: 0.9979; val_best_acc_score: 0.9857; val_best_f1_score: 0.9857; train_kl_reg_loss: 17028.2074; train_edge_recon_loss: 25580258.9870; train_gene_expr_recon_loss: 1099111.0714; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26696398.2428; train_optim_loss: 26696398.2428; val_kl_reg_loss: 16806.1994; val_edge_recon_loss: 25643520.5429; val_gene_expr_recon_loss: 1100394.1878; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26760720.9476; val_optim_loss: 26760720.9476
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9984; val_auprc_score: 0.9979; val_best_acc_score: 0.9858; val_best_f1_score: 0.9858; train_kl_reg_loss: 16924.8665; train_edge_recon_loss: 25577220.8577; train_gene_expr_recon_loss: 1099377.3690; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26693523.0851; train_optim_loss: 26693523.0851; val_kl_reg_loss: 16831.6946; val_edge_recon_loss: 25633335.6810; val_gene_expr_recon_loss: 1098516.8616; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26748684.2476; val_optim_loss: 26748684.2476
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9985; val_auprc_score: 0.9981; val_best_acc_score: 0.9860; val_best_f1_score: 0.9860; train_kl_reg_loss: 16879.9193; train_edge_recon_loss: 25578112.2285; train_gene_expr_recon_loss: 1098447.0676; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26693439.2393; train_optim_loss: 26693439.2393; val_kl_reg_loss: 16682.5070; val_edge_recon_loss: 25638889.5524; val_gene_expr_recon_loss: 1098425.6814; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26753997.6714; val_optim_loss: 26753997.6714
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9984; val_auprc_score: 0.9979; val_best_acc_score: 0.9862; val_best_f1_score: 0.9862; train_kl_reg_loss: 16846.0417; train_edge_recon_loss: 25573900.6472; train_gene_expr_recon_loss: 1098296.9309; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26689043.6035; train_optim_loss: 26689043.6035; val_kl_reg_loss: 16691.7878; val_edge_recon_loss: 25635287.7667; val_gene_expr_recon_loss: 1097893.6647; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26749873.1857; val_optim_loss: 26749873.1857
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9984; val_auprc_score: 0.9979; val_best_acc_score: 0.9861; val_best_f1_score: 0.9862; train_kl_reg_loss: 16852.2033; train_edge_recon_loss: 25572873.0506; train_gene_expr_recon_loss: 1098126.1634; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26687851.4307; train_optim_loss: 26687851.4307; val_kl_reg_loss: 16769.3680; val_edge_recon_loss: 25640514.3381; val_gene_expr_recon_loss: 1099525.1454; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26756808.8810; val_optim_loss: 26756808.8810
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9985; val_auprc_score: 0.9981; val_best_acc_score: 0.9864; val_best_f1_score: 0.9864; train_kl_reg_loss: 16773.6992; train_edge_recon_loss: 25571852.1898; train_gene_expr_recon_loss: 1097656.2989; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26686282.1808; train_optim_loss: 26686282.1808; val_kl_reg_loss: 16567.3108; val_edge_recon_loss: 25631743.1524; val_gene_expr_recon_loss: 1097384.4488; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26745694.9238; val_optim_loss: 26745694.9238
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9985; val_auprc_score: 0.9983; val_best_acc_score: 0.9864; val_best_f1_score: 0.9865; train_kl_reg_loss: 16725.2681; train_edge_recon_loss: 25569814.5852; train_gene_expr_recon_loss: 1097845.1318; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26684384.9769; train_optim_loss: 26684384.9769; val_kl_reg_loss: 16694.6266; val_edge_recon_loss: 25641270.3381; val_gene_expr_recon_loss: 1099840.2690; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26757805.2381; val_optim_loss: 26757805.2381
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9986; val_auprc_score: 0.9982; val_best_acc_score: 0.9866; val_best_f1_score: 0.9867; train_kl_reg_loss: 16699.6027; train_edge_recon_loss: 25569491.0003; train_gene_expr_recon_loss: 1097149.2545; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 26683339.8521; train_optim_loss: 26683339.8521; val_kl_reg_loss: 16581.9044; val_edge_recon_loss: 25620435.4429; val_gene_expr_recon_loss: 1096084.2381; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 26733101.5857; val_optim_loss: 26733101.5857
