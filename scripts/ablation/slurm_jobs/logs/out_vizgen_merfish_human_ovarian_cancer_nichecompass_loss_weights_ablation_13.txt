None
Run timestamp: 30062023_211618_13.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'vizgen_merfish_human_ovarian_cancer', '--reference_batches', 'batch2', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000', '--lambda_gene_expr_recon', '0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '1024', '--node_batch_size', 'None', '--timestamp_suffix', '_13']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 500, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 500, n_latent: 1385, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1385, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 1000
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 210667
Number of validation nodes: 23407
Number of training edges: 502632
Number of validation edges: 55848
Edge batch size: 1024
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9671; val_auprc_score: 0.9644; val_best_acc_score: 0.9112; val_best_f1_score: 0.9123; train_kl_reg_loss: 1978.0289; train_edge_recon_loss: 28395.3555; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 30373.3844; train_optim_loss: 30373.3844; val_kl_reg_loss: 2102.9390; val_edge_recon_loss: 26666.6007; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28769.5397; val_optim_loss: 28769.5397
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9756; val_auprc_score: 0.9733; val_best_acc_score: 0.9228; val_best_f1_score: 0.9237; train_kl_reg_loss: 2229.9779; train_edge_recon_loss: 27424.9751; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29654.9530; train_optim_loss: 29654.9530; val_kl_reg_loss: 2192.6321; val_edge_recon_loss: 26518.8646; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28711.4967; val_optim_loss: 28711.4967
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9795; val_auprc_score: 0.9776; val_best_acc_score: 0.9304; val_best_f1_score: 0.9308; train_kl_reg_loss: 2241.8185; train_edge_recon_loss: 27353.9195; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29595.7380; train_optim_loss: 29595.7380; val_kl_reg_loss: 2190.8620; val_edge_recon_loss: 26480.9526; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28671.8147; val_optim_loss: 28671.8147
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9812; val_auprc_score: 0.9799; val_best_acc_score: 0.9332; val_best_f1_score: 0.9336; train_kl_reg_loss: 2246.0051; train_edge_recon_loss: 27315.4890; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29561.4941; train_optim_loss: 29561.4941; val_kl_reg_loss: 2174.5012; val_edge_recon_loss: 26465.0067; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28639.5077; val_optim_loss: 28639.5077
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9824; val_auprc_score: 0.9803; val_best_acc_score: 0.9362; val_best_f1_score: 0.9368; train_kl_reg_loss: 2253.8875; train_edge_recon_loss: 27283.5248; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29537.4124; train_optim_loss: 29537.4124; val_kl_reg_loss: 2254.3472; val_edge_recon_loss: 26395.4766; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28649.8238; val_optim_loss: 28649.8238
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9846; val_auprc_score: 0.9830; val_best_acc_score: 0.9402; val_best_f1_score: 0.9404; train_kl_reg_loss: 2263.9430; train_edge_recon_loss: 27246.8823; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29510.8253; train_optim_loss: 29510.8253; val_kl_reg_loss: 2249.3132; val_edge_recon_loss: 26391.6596; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28640.9728; val_optim_loss: 28640.9728
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9853; val_auprc_score: 0.9836; val_best_acc_score: 0.9421; val_best_f1_score: 0.9425; train_kl_reg_loss: 2266.6533; train_edge_recon_loss: 27230.1625; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29496.8158; train_optim_loss: 29496.8158; val_kl_reg_loss: 2201.3422; val_edge_recon_loss: 26368.6505; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28569.9927; val_optim_loss: 28569.9927
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9846; val_auprc_score: 0.9830; val_best_acc_score: 0.9409; val_best_f1_score: 0.9412; train_kl_reg_loss: 2268.0849; train_edge_recon_loss: 27220.0097; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29488.0946; train_optim_loss: 29488.0946; val_kl_reg_loss: 2245.7429; val_edge_recon_loss: 26357.4862; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28603.2290; val_optim_loss: 28603.2290
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9856; val_auprc_score: 0.9844; val_best_acc_score: 0.9420; val_best_f1_score: 0.9424; train_kl_reg_loss: 2268.7088; train_edge_recon_loss: 27212.0778; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29480.7865; train_optim_loss: 29480.7865; val_kl_reg_loss: 2253.2737; val_edge_recon_loss: 26397.7114; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28650.9850; val_optim_loss: 28650.9850
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9861; val_auprc_score: 0.9840; val_best_acc_score: 0.9445; val_best_f1_score: 0.9449; train_kl_reg_loss: 2272.0239; train_edge_recon_loss: 27196.3594; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29468.3833; train_optim_loss: 29468.3833; val_kl_reg_loss: 2296.9940; val_edge_recon_loss: 26334.6974; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28631.6914; val_optim_loss: 28631.6914
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9860; val_auprc_score: 0.9847; val_best_acc_score: 0.9442; val_best_f1_score: 0.9447; train_kl_reg_loss: 2271.0726; train_edge_recon_loss: 27202.2798; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29473.3523; train_optim_loss: 29473.3523; val_kl_reg_loss: 2125.3492; val_edge_recon_loss: 26345.0709; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28470.4202; val_optim_loss: 28470.4202
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9870; val_auprc_score: 0.9857; val_best_acc_score: 0.9449; val_best_f1_score: 0.9456; train_kl_reg_loss: 2273.6746; train_edge_recon_loss: 27175.2839; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29448.9585; train_optim_loss: 29448.9585; val_kl_reg_loss: 2259.3180; val_edge_recon_loss: 26352.1979; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28611.5158; val_optim_loss: 28611.5158
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9863; val_auprc_score: 0.9849; val_best_acc_score: 0.9448; val_best_f1_score: 0.9449; train_kl_reg_loss: 2272.4965; train_edge_recon_loss: 27186.9521; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29459.4486; train_optim_loss: 29459.4486; val_kl_reg_loss: 2192.4844; val_edge_recon_loss: 26330.9686; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28523.4529; val_optim_loss: 28523.4529
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9873; val_auprc_score: 0.9860; val_best_acc_score: 0.9466; val_best_f1_score: 0.9468; train_kl_reg_loss: 2274.5893; train_edge_recon_loss: 27176.3036; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29450.8929; train_optim_loss: 29450.8929; val_kl_reg_loss: 2085.4922; val_edge_recon_loss: 26312.1820; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28397.6741; val_optim_loss: 28397.6741
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9871; val_auprc_score: 0.9855; val_best_acc_score: 0.9463; val_best_f1_score: 0.9468; train_kl_reg_loss: 2272.6583; train_edge_recon_loss: 27175.9291; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29448.5873; train_optim_loss: 29448.5873; val_kl_reg_loss: 2267.1781; val_edge_recon_loss: 26361.8693; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28629.0474; val_optim_loss: 28629.0474
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9888; val_auprc_score: 0.9876; val_best_acc_score: 0.9500; val_best_f1_score: 0.9503; train_kl_reg_loss: 2276.3139; train_edge_recon_loss: 27161.5704; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29437.8843; train_optim_loss: 29437.8843; val_kl_reg_loss: 2258.4498; val_edge_recon_loss: 26307.5570; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28566.0070; val_optim_loss: 28566.0070
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9876; val_auprc_score: 0.9860; val_best_acc_score: 0.9484; val_best_f1_score: 0.9489; train_kl_reg_loss: 2278.6148; train_edge_recon_loss: 27147.1876; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29425.8024; train_optim_loss: 29425.8024; val_kl_reg_loss: 2249.0509; val_edge_recon_loss: 26308.8770; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28557.9280; val_optim_loss: 28557.9280
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9882; val_auprc_score: 0.9868; val_best_acc_score: 0.9495; val_best_f1_score: 0.9499; train_kl_reg_loss: 2276.7892; train_edge_recon_loss: 27151.9574; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29428.7466; train_optim_loss: 29428.7466; val_kl_reg_loss: 2305.9831; val_edge_recon_loss: 26281.8708; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28587.8538; val_optim_loss: 28587.8538

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9886; val_auprc_score: 0.9870; val_best_acc_score: 0.9507; val_best_f1_score: 0.9509; train_kl_reg_loss: 2274.2715; train_edge_recon_loss: 27110.7097; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29384.9813; train_optim_loss: 29384.9813; val_kl_reg_loss: 2243.5214; val_edge_recon_loss: 26255.5913; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28499.1127; val_optim_loss: 28499.1127
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9889; val_auprc_score: 0.9877; val_best_acc_score: 0.9513; val_best_f1_score: 0.9517; train_kl_reg_loss: 2273.2926; train_edge_recon_loss: 27106.8181; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29380.1108; train_optim_loss: 29380.1108; val_kl_reg_loss: 2226.5848; val_edge_recon_loss: 26265.1969; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28491.7817; val_optim_loss: 28491.7817
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9888; val_auprc_score: 0.9873; val_best_acc_score: 0.9506; val_best_f1_score: 0.9508; train_kl_reg_loss: 2273.3732; train_edge_recon_loss: 27106.9827; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29380.3559; train_optim_loss: 29380.3559; val_kl_reg_loss: 2220.6014; val_edge_recon_loss: 26245.6081; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28466.2095; val_optim_loss: 28466.2095
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9891; val_auprc_score: 0.9877; val_best_acc_score: 0.9520; val_best_f1_score: 0.9524; train_kl_reg_loss: 2272.4505; train_edge_recon_loss: 27101.8050; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29374.2555; train_optim_loss: 29374.2555; val_kl_reg_loss: 2214.6335; val_edge_recon_loss: 26245.7592; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28460.3928; val_optim_loss: 28460.3928

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 35 min 19 sec.
Using best model state, which was in epoch 14.

--- MODEL EVALUATION ---
Val AUROC score: 0.9874
Val AUPRC score: 0.9860
Val best accuracy score: 0.9474
Val best F1 score: 0.9475
Val gene expr MSE score: 14.5651

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
