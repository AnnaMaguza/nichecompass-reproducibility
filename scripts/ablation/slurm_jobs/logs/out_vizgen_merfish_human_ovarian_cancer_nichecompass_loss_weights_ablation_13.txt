None
Run timestamp: 04072023_092738_13.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'vizgen_merfish_human_ovarian_cancer', '--reference_batches', 'batch2', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--add_fc_gps_instead_of_gp_dict_gps', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000', '--lambda_gene_expr_recon', '0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--timestamp_suffix', '_13']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 500, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 500, n_latent: 1691, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1691, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 1000
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 210667
Number of validation nodes: 23407
Number of training edges: 502632
Number of validation edges: 55848
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9720; val_auprc_score: 0.9696; val_best_acc_score: 0.9186; val_best_f1_score: 0.9190; train_kl_reg_loss: 2187.3875; train_edge_recon_loss: 28448.5505; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 30635.9379; train_optim_loss: 30635.9379; val_kl_reg_loss: 2355.4740; val_edge_recon_loss: 26586.9721; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28942.4461; val_optim_loss: 28942.4461
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9782; val_auprc_score: 0.9765; val_best_acc_score: 0.9283; val_best_f1_score: 0.9290; train_kl_reg_loss: 2421.2298; train_edge_recon_loss: 27678.6892; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 30099.9190; train_optim_loss: 30099.9190; val_kl_reg_loss: 2430.0556; val_edge_recon_loss: 26511.7746; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28941.8303; val_optim_loss: 28941.8303
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9809; val_auprc_score: 0.9789; val_best_acc_score: 0.9334; val_best_f1_score: 0.9340; train_kl_reg_loss: 2438.2809; train_edge_recon_loss: 27606.7945; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 30045.0755; train_optim_loss: 30045.0755; val_kl_reg_loss: 2246.6519; val_edge_recon_loss: 26445.8164; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28692.4681; val_optim_loss: 28692.4681
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9817; val_auprc_score: 0.9801; val_best_acc_score: 0.9362; val_best_f1_score: 0.9367; train_kl_reg_loss: 2444.4533; train_edge_recon_loss: 27577.3741; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 30021.8274; train_optim_loss: 30021.8274; val_kl_reg_loss: 2393.3398; val_edge_recon_loss: 26426.1799; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28819.5196; val_optim_loss: 28819.5196
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9836; val_auprc_score: 0.9820; val_best_acc_score: 0.9382; val_best_f1_score: 0.9387; train_kl_reg_loss: 2455.2576; train_edge_recon_loss: 27537.7446; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29993.0021; train_optim_loss: 29993.0021; val_kl_reg_loss: 2493.8984; val_edge_recon_loss: 26433.0481; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28926.9465; val_optim_loss: 28926.9465
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9838; val_auprc_score: 0.9815; val_best_acc_score: 0.9390; val_best_f1_score: 0.9394; train_kl_reg_loss: 2460.6399; train_edge_recon_loss: 27516.0351; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29976.6751; train_optim_loss: 29976.6751; val_kl_reg_loss: 2477.3576; val_edge_recon_loss: 26386.9479; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28864.3054; val_optim_loss: 28864.3054
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9852; val_auprc_score: 0.9836; val_best_acc_score: 0.9418; val_best_f1_score: 0.9423; train_kl_reg_loss: 2463.6621; train_edge_recon_loss: 27512.5910; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29976.2531; train_optim_loss: 29976.2531; val_kl_reg_loss: 2481.9420; val_edge_recon_loss: 26340.3908; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28822.3328; val_optim_loss: 28822.3328
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9846; val_auprc_score: 0.9829; val_best_acc_score: 0.9414; val_best_f1_score: 0.9420; train_kl_reg_loss: 2466.1680; train_edge_recon_loss: 27494.6533; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29960.8213; train_optim_loss: 29960.8213; val_kl_reg_loss: 2479.4104; val_edge_recon_loss: 26352.0069; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28831.4173; val_optim_loss: 28831.4173

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9867; val_auprc_score: 0.9855; val_best_acc_score: 0.9456; val_best_f1_score: 0.9459; train_kl_reg_loss: 2465.6741; train_edge_recon_loss: 27435.0222; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29900.6962; train_optim_loss: 29900.6962; val_kl_reg_loss: 2425.9101; val_edge_recon_loss: 26320.6282; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28746.5383; val_optim_loss: 28746.5383
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9865; val_auprc_score: 0.9847; val_best_acc_score: 0.9460; val_best_f1_score: 0.9465; train_kl_reg_loss: 2466.4345; train_edge_recon_loss: 27432.0467; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29898.4812; train_optim_loss: 29898.4812; val_kl_reg_loss: 2423.5383; val_edge_recon_loss: 26291.7812; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28715.3194; val_optim_loss: 28715.3194
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9873; val_auprc_score: 0.9859; val_best_acc_score: 0.9473; val_best_f1_score: 0.9476; train_kl_reg_loss: 2466.5308; train_edge_recon_loss: 27425.5094; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29892.0401; train_optim_loss: 29892.0401; val_kl_reg_loss: 2404.9382; val_edge_recon_loss: 26301.4630; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28706.4010; val_optim_loss: 28706.4010

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 20 min 7 sec.
Using best model state, which was in epoch 3.

--- MODEL EVALUATION ---
Val AUROC score: 0.9809
Val AUPRC score: 0.9787
Val best accuracy score: 0.9338
Val best F1 score: 0.9342
Val gene expr MSE score: 11.0895

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
