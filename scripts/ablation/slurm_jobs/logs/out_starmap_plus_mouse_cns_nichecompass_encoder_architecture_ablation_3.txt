None
Run timestamp: 20072023_111648_3.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'starmap_plus_mouse_cns', '--reference_batches', 'batch1', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'encoder_architecture_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000000.0', '--lambda_gene_expr_recon', '30000.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '256', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_3']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 1022, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 1022, n_latent: 1423, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1423, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 2044
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 82121
Number of validation nodes: 9125
Number of training edges: 556218
Number of validation edges: 61801
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9826; val_auprc_score: 0.9771; val_best_acc_score: 0.9459; val_best_f1_score: 0.9473; train_kl_reg_loss: 87469.0726; train_edge_recon_loss: 26461964.5964; train_gene_expr_recon_loss: 11118874.2283; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 37668307.9061; train_optim_loss: 37668307.9061; val_kl_reg_loss: 87341.6942; val_edge_recon_loss: 26015728.2975; val_gene_expr_recon_loss: 10328467.6074; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 36431537.6529; val_optim_loss: 36431537.6529
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9849; val_auprc_score: 0.9804; val_best_acc_score: 0.9523; val_best_f1_score: 0.9536; train_kl_reg_loss: 78301.5555; train_edge_recon_loss: 25880783.9586; train_gene_expr_recon_loss: 10158114.2253; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 36117199.7165; train_optim_loss: 36117199.7165; val_kl_reg_loss: 67287.6734; val_edge_recon_loss: 25900337.8595; val_gene_expr_recon_loss: 9996013.5331; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35963638.9752; val_optim_loss: 35963638.9752
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9879; val_auprc_score: 0.9843; val_best_acc_score: 0.9592; val_best_f1_score: 0.9602; train_kl_reg_loss: 65413.5912; train_edge_recon_loss: 25761693.5122; train_gene_expr_recon_loss: 9947222.8224; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35774329.9301; train_optim_loss: 35774329.9301; val_kl_reg_loss: 61168.7076; val_edge_recon_loss: 25803104.1240; val_gene_expr_recon_loss: 9910161.9091; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35774434.8264; val_optim_loss: 35774434.8264
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9900; val_auprc_score: 0.9873; val_best_acc_score: 0.9649; val_best_f1_score: 0.9656; train_kl_reg_loss: 59750.3935; train_edge_recon_loss: 25711781.7331; train_gene_expr_recon_loss: 9843587.1622; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35615119.2655; train_optim_loss: 35615119.2655; val_kl_reg_loss: 57622.6158; val_edge_recon_loss: 25721445.2810; val_gene_expr_recon_loss: 9825208.7893; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35604276.6116; val_optim_loss: 35604276.6116
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9902; val_auprc_score: 0.9873; val_best_acc_score: 0.9652; val_best_f1_score: 0.9659; train_kl_reg_loss: 56250.7258; train_edge_recon_loss: 25663913.1624; train_gene_expr_recon_loss: 9774252.1312; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35494416.0212; train_optim_loss: 35494416.0212; val_kl_reg_loss: 53199.0699; val_edge_recon_loss: 25700601.3719; val_gene_expr_recon_loss: 9764275.5992; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35518075.9174; val_optim_loss: 35518075.9174
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9902; val_auprc_score: 0.9867; val_best_acc_score: 0.9679; val_best_f1_score: 0.9686; train_kl_reg_loss: 53705.7548; train_edge_recon_loss: 25638964.4022; train_gene_expr_recon_loss: 9737094.7977; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35429764.9544; train_optim_loss: 35429764.9544; val_kl_reg_loss: 53375.3193; val_edge_recon_loss: 25716224.4959; val_gene_expr_recon_loss: 9746406.0868; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35516005.7851; val_optim_loss: 35516005.7851
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9905; val_auprc_score: 0.9872; val_best_acc_score: 0.9688; val_best_f1_score: 0.9694; train_kl_reg_loss: 52472.1364; train_edge_recon_loss: 25627260.1261; train_gene_expr_recon_loss: 9680999.8914; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35360732.1463; train_optim_loss: 35360732.1463; val_kl_reg_loss: 52643.9571; val_edge_recon_loss: 25675660.9091; val_gene_expr_recon_loss: 9715288.3079; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35443593.1240; val_optim_loss: 35443593.1240
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9920; val_auprc_score: 0.9898; val_best_acc_score: 0.9697; val_best_f1_score: 0.9703; train_kl_reg_loss: 51284.2872; train_edge_recon_loss: 25597807.3622; train_gene_expr_recon_loss: 9641229.7434; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35290321.3962; train_optim_loss: 35290321.3962; val_kl_reg_loss: 50368.8427; val_edge_recon_loss: 25659959.0496; val_gene_expr_recon_loss: 9675297.4236; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35385625.2397; val_optim_loss: 35385625.2397
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9919; val_auprc_score: 0.9895; val_best_acc_score: 0.9703; val_best_f1_score: 0.9709; train_kl_reg_loss: 51263.5599; train_edge_recon_loss: 25594460.5311; train_gene_expr_recon_loss: 9589629.4024; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35235353.4496; train_optim_loss: 35235353.4496; val_kl_reg_loss: 51453.8935; val_edge_recon_loss: 25642544.1983; val_gene_expr_recon_loss: 9694917.3967; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35388915.5372; val_optim_loss: 35388915.5372
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9926; val_auprc_score: 0.9907; val_best_acc_score: 0.9720; val_best_f1_score: 0.9725; train_kl_reg_loss: 50475.8770; train_edge_recon_loss: 25594028.3967; train_gene_expr_recon_loss: 9565773.4416; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35210277.7423; train_optim_loss: 35210277.7423; val_kl_reg_loss: 49955.6859; val_edge_recon_loss: 25623141.3802; val_gene_expr_recon_loss: 9671317.4153; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35344414.6116; val_optim_loss: 35344414.6116
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9926; val_auprc_score: 0.9903; val_best_acc_score: 0.9723; val_best_f1_score: 0.9727; train_kl_reg_loss: 50246.4760; train_edge_recon_loss: 25584908.1951; train_gene_expr_recon_loss: 9550878.1139; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35186032.7823; train_optim_loss: 35186032.7823; val_kl_reg_loss: 49276.6945; val_edge_recon_loss: 25635105.7686; val_gene_expr_recon_loss: 9665360.0764; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35349742.5785; val_optim_loss: 35349742.5785
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9930; val_auprc_score: 0.9911; val_best_acc_score: 0.9721; val_best_f1_score: 0.9726; train_kl_reg_loss: 50028.9918; train_edge_recon_loss: 25583079.5242; train_gene_expr_recon_loss: 9518388.5124; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35151497.0511; train_optim_loss: 35151497.0511; val_kl_reg_loss: 49575.9082; val_edge_recon_loss: 25645426.3802; val_gene_expr_recon_loss: 9655889.3347; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35350891.4298; val_optim_loss: 35350891.4298
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9932; val_auprc_score: 0.9913; val_best_acc_score: 0.9729; val_best_f1_score: 0.9734; train_kl_reg_loss: 49569.9302; train_edge_recon_loss: 25574160.5762; train_gene_expr_recon_loss: 9506562.6091; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35130293.1173; train_optim_loss: 35130293.1173; val_kl_reg_loss: 50448.9194; val_edge_recon_loss: 25624991.6612; val_gene_expr_recon_loss: 9661288.0041; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35336728.6446; val_optim_loss: 35336728.6446
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9936; val_auprc_score: 0.9918; val_best_acc_score: 0.9744; val_best_f1_score: 0.9748; train_kl_reg_loss: 49957.0739; train_edge_recon_loss: 25565345.9080; train_gene_expr_recon_loss: 9486882.8711; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35102185.8132; train_optim_loss: 35102185.8132; val_kl_reg_loss: 50000.4387; val_edge_recon_loss: 25597747.6694; val_gene_expr_recon_loss: 9655016.3533; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35302764.3140; val_optim_loss: 35302764.3140
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9938; val_auprc_score: 0.9919; val_best_acc_score: 0.9756; val_best_f1_score: 0.9759; train_kl_reg_loss: 49719.9972; train_edge_recon_loss: 25564262.7851; train_gene_expr_recon_loss: 9470931.1399; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35084913.9503; train_optim_loss: 35084913.9503; val_kl_reg_loss: 49433.4897; val_edge_recon_loss: 25595524.4876; val_gene_expr_recon_loss: 9652214.6570; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35297172.4793; val_optim_loss: 35297172.4793
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9941; val_auprc_score: 0.9924; val_best_acc_score: 0.9754; val_best_f1_score: 0.9758; train_kl_reg_loss: 49592.4707; train_edge_recon_loss: 25552444.5246; train_gene_expr_recon_loss: 9457250.4452; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35059287.4726; train_optim_loss: 35059287.4726; val_kl_reg_loss: 49002.6659; val_edge_recon_loss: 25578805.1818; val_gene_expr_recon_loss: 9659466.7521; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35287274.6281; val_optim_loss: 35287274.6281
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9948; val_auprc_score: 0.9935; val_best_acc_score: 0.9763; val_best_f1_score: 0.9766; train_kl_reg_loss: 49629.0211; train_edge_recon_loss: 25545746.3636; train_gene_expr_recon_loss: 9444725.7161; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35040101.0943; train_optim_loss: 35040101.0943; val_kl_reg_loss: 49719.2123; val_edge_recon_loss: 25587003.6777; val_gene_expr_recon_loss: 9647461.3037; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35284184.4132; val_optim_loss: 35284184.4132
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9942; val_auprc_score: 0.9927; val_best_acc_score: 0.9759; val_best_f1_score: 0.9763; train_kl_reg_loss: 49595.7736; train_edge_recon_loss: 25548239.7478; train_gene_expr_recon_loss: 9437002.1855; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35034837.6852; train_optim_loss: 35034837.6852; val_kl_reg_loss: 50632.4890; val_edge_recon_loss: 25595209.3802; val_gene_expr_recon_loss: 9638102.4669; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35283944.2314; val_optim_loss: 35283944.2314
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9946; val_auprc_score: 0.9930; val_best_acc_score: 0.9775; val_best_f1_score: 0.9778; train_kl_reg_loss: 49732.4466; train_edge_recon_loss: 25548539.0410; train_gene_expr_recon_loss: 9420631.7927; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35018903.2508; train_optim_loss: 35018903.2508; val_kl_reg_loss: 49654.7326; val_edge_recon_loss: 25575975.6364; val_gene_expr_recon_loss: 9648594.1198; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 35274224.4050; val_optim_loss: 35274224.4050
