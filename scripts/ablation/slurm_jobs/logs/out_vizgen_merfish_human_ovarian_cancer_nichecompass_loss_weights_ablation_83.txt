None
Run timestamp: 29072023_065709_83.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'vizgen_merfish_human_ovarian_cancer', '--reference_batches', 'batch2', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '30', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_83']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_pred_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 500, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 500, n_latent: 1385, n_addon_latent: 10, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1385, n_cat_covariates_embed_input: 0, n_addon_gp_input: 10, n_output: 500
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1385, n_cat_covariates_embed_input: 0, n_addon_gp_input: 10, n_output: 500

--- INITIALIZING TRAINER ---
Number of training nodes: 210667
Number of validation nodes: 23407
Number of training edges: 1455707
Number of validation edges: 161745
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9929; val_auprc_score: 0.9924; val_best_acc_score: 0.9601; val_best_f1_score: 0.9604; train_kl_reg_loss: 5668.5973; train_edge_recon_loss: 263900.3244; train_gene_expr_recon_loss: 22320.8866; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 291889.8079; train_optim_loss: 291889.8079; val_kl_reg_loss: 5490.7486; val_edge_recon_loss: 260874.8440; val_gene_expr_recon_loss: 20043.1964; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 286408.7897; val_optim_loss: 286408.7897
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9948; val_auprc_score: 0.9943; val_best_acc_score: 0.9660; val_best_f1_score: 0.9663; train_kl_reg_loss: 5719.5033; train_edge_recon_loss: 260407.0826; train_gene_expr_recon_loss: 19438.5888; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 285565.1751; train_optim_loss: 285565.1751; val_kl_reg_loss: 5545.8135; val_edge_recon_loss: 259920.9182; val_gene_expr_recon_loss: 18844.2971; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 284311.0282; val_optim_loss: 284311.0282
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9957; val_auprc_score: 0.9953; val_best_acc_score: 0.9712; val_best_f1_score: 0.9713; train_kl_reg_loss: 5753.9109; train_edge_recon_loss: 259767.0731; train_gene_expr_recon_loss: 18741.4281; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 284262.4122; train_optim_loss: 284262.4122; val_kl_reg_loss: 5682.6890; val_edge_recon_loss: 259424.1757; val_gene_expr_recon_loss: 18462.0195; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 283568.8842; val_optim_loss: 283568.8842
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9964; val_auprc_score: 0.9960; val_best_acc_score: 0.9735; val_best_f1_score: 0.9736; train_kl_reg_loss: 5793.1297; train_edge_recon_loss: 259331.0977; train_gene_expr_recon_loss: 18429.4412; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 283553.6686; train_optim_loss: 283553.6686; val_kl_reg_loss: 5759.3560; val_edge_recon_loss: 258972.0117; val_gene_expr_recon_loss: 18193.9970; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 282925.3658; val_optim_loss: 282925.3658
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9969; val_auprc_score: 0.9965; val_best_acc_score: 0.9762; val_best_f1_score: 0.9763; train_kl_reg_loss: 5812.8798; train_edge_recon_loss: 258990.9205; train_gene_expr_recon_loss: 18266.6594; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 283070.4597; train_optim_loss: 283070.4597; val_kl_reg_loss: 5791.6349; val_edge_recon_loss: 258788.8355; val_gene_expr_recon_loss: 18090.5446; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 282671.0145; val_optim_loss: 282671.0145
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9968; val_auprc_score: 0.9963; val_best_acc_score: 0.9766; val_best_f1_score: 0.9767; train_kl_reg_loss: 5829.0792; train_edge_recon_loss: 258804.9084; train_gene_expr_recon_loss: 18157.2063; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 282791.1938; train_optim_loss: 282791.1938; val_kl_reg_loss: 5774.4031; val_edge_recon_loss: 258702.6795; val_gene_expr_recon_loss: 18047.5129; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 282524.5955; val_optim_loss: 282524.5955
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9971; val_auprc_score: 0.9967; val_best_acc_score: 0.9763; val_best_f1_score: 0.9764; train_kl_reg_loss: 5842.0523; train_edge_recon_loss: 258673.3927; train_gene_expr_recon_loss: 18091.9698; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 282607.4151; train_optim_loss: 282607.4151; val_kl_reg_loss: 6034.7934; val_edge_recon_loss: 258595.4781; val_gene_expr_recon_loss: 18111.3270; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 282741.5985; val_optim_loss: 282741.5985
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9975; val_auprc_score: 0.9971; val_best_acc_score: 0.9796; val_best_f1_score: 0.9797; train_kl_reg_loss: 5851.1524; train_edge_recon_loss: 258540.9089; train_gene_expr_recon_loss: 18042.5175; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 282434.5788; train_optim_loss: 282434.5788; val_kl_reg_loss: 5784.3361; val_edge_recon_loss: 258292.2143; val_gene_expr_recon_loss: 17990.2933; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 282066.8436; val_optim_loss: 282066.8436
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9973; val_auprc_score: 0.9968; val_best_acc_score: 0.9787; val_best_f1_score: 0.9788; train_kl_reg_loss: 5856.8619; train_edge_recon_loss: 258385.0791; train_gene_expr_recon_loss: 17984.9291; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 282226.8702; train_optim_loss: 282226.8702; val_kl_reg_loss: 5910.7476; val_edge_recon_loss: 258255.8449; val_gene_expr_recon_loss: 16424.3991; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 280590.9918; val_optim_loss: 280590.9918
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9976; val_auprc_score: 0.9972; val_best_acc_score: 0.9805; val_best_f1_score: 0.9806; train_kl_reg_loss: 5863.3500; train_edge_recon_loss: 258281.2172; train_gene_expr_recon_loss: 17472.6659; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 281617.2328; train_optim_loss: 281617.2328; val_kl_reg_loss: 5808.9083; val_edge_recon_loss: 258135.7389; val_gene_expr_recon_loss: 13037.4548; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 276982.1025; val_optim_loss: 276982.1025
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9976; val_auprc_score: 0.9971; val_best_acc_score: 0.9802; val_best_f1_score: 0.9803; train_kl_reg_loss: 5868.2801; train_edge_recon_loss: 258158.1247; train_gene_expr_recon_loss: 15452.1828; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 279478.5878; train_optim_loss: 279478.5878; val_kl_reg_loss: 5839.1904; val_edge_recon_loss: 257994.4480; val_gene_expr_recon_loss: 15272.1363; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 279105.7738; val_optim_loss: 279105.7738
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9978; val_auprc_score: 0.9974; val_best_acc_score: 0.9814; val_best_f1_score: 0.9815; train_kl_reg_loss: 5870.5003; train_edge_recon_loss: 258135.8822; train_gene_expr_recon_loss: 13017.8050; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 277024.1874; train_optim_loss: 277024.1874; val_kl_reg_loss: 5729.9247; val_edge_recon_loss: 257950.3152; val_gene_expr_recon_loss: 981.0004; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 264661.2403; val_optim_loss: 264661.2403
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9979; val_auprc_score: 0.9975; val_best_acc_score: 0.9818; val_best_f1_score: 0.9819; train_kl_reg_loss: 5871.9542; train_edge_recon_loss: 258056.7149; train_gene_expr_recon_loss: 13051.8118; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 276980.4808; train_optim_loss: 276980.4808; val_kl_reg_loss: 5587.5528; val_edge_recon_loss: 257833.2041; val_gene_expr_recon_loss: 12875.1560; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 276295.9127; val_optim_loss: 276295.9127
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9981; val_auprc_score: 0.9978; val_best_acc_score: 0.9825; val_best_f1_score: 0.9826; train_kl_reg_loss: 5875.9159; train_edge_recon_loss: 257921.4854; train_gene_expr_recon_loss: 13790.1942; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 277587.5957; train_optim_loss: 277587.5957; val_kl_reg_loss: 5975.9215; val_edge_recon_loss: 257632.7159; val_gene_expr_recon_loss: 10799.8072; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 274408.4428; val_optim_loss: 274408.4428
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9981; val_auprc_score: 0.9978; val_best_acc_score: 0.9829; val_best_f1_score: 0.9830; train_kl_reg_loss: 5875.5147; train_edge_recon_loss: 257835.9445; train_gene_expr_recon_loss: 14235.1193; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 277946.5785; train_optim_loss: 277946.5785; val_kl_reg_loss: 6045.5473; val_edge_recon_loss: 257389.8783; val_gene_expr_recon_loss: 14795.0512; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 278230.4777; val_optim_loss: 278230.4777
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9980; val_auprc_score: 0.9975; val_best_acc_score: 0.9824; val_best_f1_score: 0.9825; train_kl_reg_loss: 5876.3206; train_edge_recon_loss: 257843.4326; train_gene_expr_recon_loss: 14334.9167; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 278054.6698; train_optim_loss: 278054.6698; val_kl_reg_loss: 5810.6047; val_edge_recon_loss: 257504.4724; val_gene_expr_recon_loss: 14407.9480; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 277723.0254; val_optim_loss: 277723.0254

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9984; val_auprc_score: 0.9982; val_best_acc_score: 0.9849; val_best_f1_score: 0.9849; train_kl_reg_loss: 5869.3827; train_edge_recon_loss: 257405.3778; train_gene_expr_recon_loss: 14398.3907; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 277673.1514; train_optim_loss: 277673.1514; val_kl_reg_loss: 5829.6609; val_edge_recon_loss: 257270.9923; val_gene_expr_recon_loss: 14284.8873; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 277385.5404; val_optim_loss: 277385.5404
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9984; val_auprc_score: 0.9982; val_best_acc_score: 0.9848; val_best_f1_score: 0.9849; train_kl_reg_loss: 5861.0786; train_edge_recon_loss: 257429.3940; train_gene_expr_recon_loss: 14340.1241; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 277630.5968; train_optim_loss: 277630.5968; val_kl_reg_loss: 5819.8663; val_edge_recon_loss: 257091.5535; val_gene_expr_recon_loss: 14326.2724; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 277237.6930; val_optim_loss: 277237.6930
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9985; val_auprc_score: 0.9981; val_best_acc_score: 0.9851; val_best_f1_score: 0.9852; train_kl_reg_loss: 5856.8028; train_edge_recon_loss: 257373.2756; train_gene_expr_recon_loss: 14389.1321; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 277619.2104; train_optim_loss: 277619.2104; val_kl_reg_loss: 5842.4606; val_edge_recon_loss: 257042.4910; val_gene_expr_recon_loss: 14104.5451; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 276989.4963; val_optim_loss: 276989.4963
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9985; val_auprc_score: 0.9981; val_best_acc_score: 0.9856; val_best_f1_score: 0.9857; train_kl_reg_loss: 5853.8011; train_edge_recon_loss: 257349.3544; train_gene_expr_recon_loss: 14320.7655; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 277523.9211; train_optim_loss: 277523.9211; val_kl_reg_loss: 5852.3744; val_edge_recon_loss: 257004.5968; val_gene_expr_recon_loss: 14096.3823; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 276953.3554; val_optim_loss: 276953.3554

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 314 min 35 sec.
Using best model state, which was in epoch 12.

--- MODEL EVALUATION ---
val AUROC score: 0.9979
val AUPRC score: 0.9975
val best accuracy score: 0.9818
val best F1 score: 0.9819
val target rna MSE score: 5.1984
val source rna MSE score: 0.4985

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
