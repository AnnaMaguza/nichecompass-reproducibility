None
Run timestamp: 14072023_092303_7.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'starmap_plus_mouse_cns', '--reference_batches', 'batch1', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '0.01', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '5000000', '--lambda_gene_expr_recon', '30000', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '1024', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_7']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1813.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 1022, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 1022, n_latent: 1361, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1361, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 2044
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 82121
Number of validation nodes: 9125
Number of training edges: 556218
Number of validation edges: 61801
Edge batch size: 1024
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9531; val_auprc_score: 0.9471; val_best_acc_score: 0.8833; val_best_f1_score: 0.8850; train_kl_reg_loss: 77265.5565; train_edge_recon_loss: 3136977.1576; train_gene_expr_recon_loss: 11346749.3309; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 14560992.0478; train_optim_loss: 14560992.0478; val_kl_reg_loss: 88253.3808; val_edge_recon_loss: 2829593.9959; val_gene_expr_recon_loss: 10469695.3443; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 13387542.6721; val_optim_loss: 13387542.6721
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9821; val_auprc_score: 0.9763; val_best_acc_score: 0.9446; val_best_f1_score: 0.9461; train_kl_reg_loss: 81984.8797; train_edge_recon_loss: 2738409.6926; train_gene_expr_recon_loss: 10199491.1654; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 13019885.7279; train_optim_loss: 13019885.7279; val_kl_reg_loss: 77505.1556; val_edge_recon_loss: 2700891.7090; val_gene_expr_recon_loss: 10069076.3115; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12847473.1967; val_optim_loss: 12847473.1967
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9851; val_auprc_score: 0.9805; val_best_acc_score: 0.9510; val_best_f1_score: 0.9520; train_kl_reg_loss: 73784.9799; train_edge_recon_loss: 2678294.6834; train_gene_expr_recon_loss: 9924138.0754; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12676217.7224; train_optim_loss: 12676217.7224; val_kl_reg_loss: 69697.5375; val_edge_recon_loss: 2673120.7541; val_gene_expr_recon_loss: 9886973.8852; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12629792.1967; val_optim_loss: 12629792.1967
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9864; val_auprc_score: 0.9825; val_best_acc_score: 0.9533; val_best_f1_score: 0.9543; train_kl_reg_loss: 66252.5808; train_edge_recon_loss: 2662193.2390; train_gene_expr_recon_loss: 9753211.4798; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12481657.2923; train_optim_loss: 12481657.2923; val_kl_reg_loss: 62336.6722; val_edge_recon_loss: 2662060.0779; val_gene_expr_recon_loss: 9723343.9672; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12447740.6885; val_optim_loss: 12447740.6885
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9878; val_auprc_score: 0.9842; val_best_acc_score: 0.9561; val_best_f1_score: 0.9570; train_kl_reg_loss: 60383.4064; train_edge_recon_loss: 2651648.6227; train_gene_expr_recon_loss: 9622891.0827; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12334923.1048; train_optim_loss: 12334923.1048; val_kl_reg_loss: 57134.2673; val_edge_recon_loss: 2651614.0861; val_gene_expr_recon_loss: 9633997.8689; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12342746.2459; val_optim_loss: 12342746.2459
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9884; val_auprc_score: 0.9853; val_best_acc_score: 0.9566; val_best_f1_score: 0.9574; train_kl_reg_loss: 55833.8501; train_edge_recon_loss: 2644903.2178; train_gene_expr_recon_loss: 9540195.5809; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12240932.6636; train_optim_loss: 12240932.6636; val_kl_reg_loss: 53683.5578; val_edge_recon_loss: 2644920.1393; val_gene_expr_recon_loss: 9596874.2951; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12295477.9836; val_optim_loss: 12295477.9836
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9895; val_auprc_score: 0.9871; val_best_acc_score: 0.9586; val_best_f1_score: 0.9594; train_kl_reg_loss: 52498.5538; train_edge_recon_loss: 2636889.7583; train_gene_expr_recon_loss: 9477846.8346; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12167235.1324; train_optim_loss: 12167235.1324; val_kl_reg_loss: 50483.5110; val_edge_recon_loss: 2634493.5943; val_gene_expr_recon_loss: 9543001.9016; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12227978.9672; val_optim_loss: 12227978.9672
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9899; val_auprc_score: 0.9874; val_best_acc_score: 0.9588; val_best_f1_score: 0.9597; train_kl_reg_loss: 49885.7239; train_edge_recon_loss: 2632271.1489; train_gene_expr_recon_loss: 9425085.4789; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12107242.3254; train_optim_loss: 12107242.3254; val_kl_reg_loss: 48657.5192; val_edge_recon_loss: 2636276.5164; val_gene_expr_recon_loss: 9483768.6885; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12168702.7213; val_optim_loss: 12168702.7213
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9905; val_auprc_score: 0.9884; val_best_acc_score: 0.9597; val_best_f1_score: 0.9606; train_kl_reg_loss: 48170.4000; train_edge_recon_loss: 2625684.8603; train_gene_expr_recon_loss: 9361253.1599; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12035108.4191; train_optim_loss: 12035108.4191; val_kl_reg_loss: 46712.4814; val_edge_recon_loss: 2628598.3525; val_gene_expr_recon_loss: 9427488.2459; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12102799.0328; val_optim_loss: 12102799.0328
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9901; val_auprc_score: 0.9880; val_best_acc_score: 0.9597; val_best_f1_score: 0.9605; train_kl_reg_loss: 46623.5681; train_edge_recon_loss: 2623112.1301; train_gene_expr_recon_loss: 9318186.7702; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11987922.4430; train_optim_loss: 11987922.4430; val_kl_reg_loss: 45622.4025; val_edge_recon_loss: 2630789.5287; val_gene_expr_recon_loss: 9445474.6721; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12121886.5574; val_optim_loss: 12121886.5574
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9905; val_auprc_score: 0.9880; val_best_acc_score: 0.9605; val_best_f1_score: 0.9613; train_kl_reg_loss: 45368.3575; train_edge_recon_loss: 2620252.9596; train_gene_expr_recon_loss: 9286445.4044; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11952066.7243; train_optim_loss: 11952066.7243; val_kl_reg_loss: 44579.3854; val_edge_recon_loss: 2625816.6475; val_gene_expr_recon_loss: 9385649.4426; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12056045.4754; val_optim_loss: 12056045.4754
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9905; val_auprc_score: 0.9882; val_best_acc_score: 0.9610; val_best_f1_score: 0.9618; train_kl_reg_loss: 44286.2427; train_edge_recon_loss: 2618021.3805; train_gene_expr_recon_loss: 9243821.1103; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11906128.7445; train_optim_loss: 11906128.7445; val_kl_reg_loss: 43801.9919; val_edge_recon_loss: 2620095.0820; val_gene_expr_recon_loss: 9383016.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12046913.0984; val_optim_loss: 12046913.0984
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9909; val_auprc_score: 0.9890; val_best_acc_score: 0.9610; val_best_f1_score: 0.9619; train_kl_reg_loss: 43360.5082; train_edge_recon_loss: 2615668.5556; train_gene_expr_recon_loss: 9228238.8107; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11887267.9099; train_optim_loss: 11887267.9099; val_kl_reg_loss: 43191.1452; val_edge_recon_loss: 2621008.3525; val_gene_expr_recon_loss: 9390380.3607; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12054579.8361; val_optim_loss: 12054579.8361
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9915; val_auprc_score: 0.9896; val_best_acc_score: 0.9634; val_best_f1_score: 0.9641; train_kl_reg_loss: 42638.7873; train_edge_recon_loss: 2612845.6985; train_gene_expr_recon_loss: 9182394.2206; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11837878.7132; train_optim_loss: 11837878.7132; val_kl_reg_loss: 42342.5272; val_edge_recon_loss: 2618552.6762; val_gene_expr_recon_loss: 9368201.7213; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12029096.9344; val_optim_loss: 12029096.9344
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9919; val_auprc_score: 0.9902; val_best_acc_score: 0.9641; val_best_f1_score: 0.9647; train_kl_reg_loss: 41838.1680; train_edge_recon_loss: 2613493.8727; train_gene_expr_recon_loss: 9166920.8079; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11822252.8585; train_optim_loss: 11822252.8585; val_kl_reg_loss: 41347.5092; val_edge_recon_loss: 2614388.3443; val_gene_expr_recon_loss: 9399822.5902; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12055558.4754; val_optim_loss: 12055558.4754
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9918; val_auprc_score: 0.9899; val_best_acc_score: 0.9638; val_best_f1_score: 0.9644; train_kl_reg_loss: 41300.1990; train_edge_recon_loss: 2611629.4246; train_gene_expr_recon_loss: 9140802.9899; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11793732.6305; train_optim_loss: 11793732.6305; val_kl_reg_loss: 41035.7367; val_edge_recon_loss: 2619652.0410; val_gene_expr_recon_loss: 9385681.4754; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12046369.2459; val_optim_loss: 12046369.2459
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9916; val_auprc_score: 0.9897; val_best_acc_score: 0.9639; val_best_f1_score: 0.9647; train_kl_reg_loss: 40834.6538; train_edge_recon_loss: 2608690.8608; train_gene_expr_recon_loss: 9121935.1461; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11771460.6562; train_optim_loss: 11771460.6562; val_kl_reg_loss: 40405.2620; val_edge_recon_loss: 2616911.9795; val_gene_expr_recon_loss: 9352513.7869; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12009831.0328; val_optim_loss: 12009831.0328
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9921; val_auprc_score: 0.9903; val_best_acc_score: 0.9648; val_best_f1_score: 0.9655; train_kl_reg_loss: 40384.3400; train_edge_recon_loss: 2608323.8709; train_gene_expr_recon_loss: 9102537.0257; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11751245.2279; train_optim_loss: 11751245.2279; val_kl_reg_loss: 40395.4862; val_edge_recon_loss: 2613560.5410; val_gene_expr_recon_loss: 9403602.6557; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12057558.7377; val_optim_loss: 12057558.7377
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9919; val_auprc_score: 0.9899; val_best_acc_score: 0.9655; val_best_f1_score: 0.9662; train_kl_reg_loss: 39974.1494; train_edge_recon_loss: 2606707.0478; train_gene_expr_recon_loss: 9072623.0083; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11719304.1967; train_optim_loss: 11719304.1967; val_kl_reg_loss: 39457.8846; val_edge_recon_loss: 2613287.9139; val_gene_expr_recon_loss: 9388134.0820; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12040879.8689; val_optim_loss: 12040879.8689
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9920; val_auprc_score: 0.9899; val_best_acc_score: 0.9657; val_best_f1_score: 0.9663; train_kl_reg_loss: 39589.3317; train_edge_recon_loss: 2606832.9793; train_gene_expr_recon_loss: 9061206.0303; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11707628.3529; train_optim_loss: 11707628.3529; val_kl_reg_loss: 39230.1304; val_edge_recon_loss: 2613942.7131; val_gene_expr_recon_loss: 9394824.6721; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12047997.4754; val_optim_loss: 12047997.4754
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9923; val_auprc_score: 0.9907; val_best_acc_score: 0.9658; val_best_f1_score: 0.9664; train_kl_reg_loss: 39228.4029; train_edge_recon_loss: 2604721.5326; train_gene_expr_recon_loss: 9046433.7362; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11690383.6691; train_optim_loss: 11690383.6691; val_kl_reg_loss: 39639.0518; val_edge_recon_loss: 2608573.0164; val_gene_expr_recon_loss: 9388276.8689; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12036488.9672; val_optim_loss: 12036488.9672

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9923; val_auprc_score: 0.9906; val_best_acc_score: 0.9660; val_best_f1_score: 0.9666; train_kl_reg_loss: 40302.5890; train_edge_recon_loss: 2603020.7132; train_gene_expr_recon_loss: 8977893.4807; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11621216.7849; train_optim_loss: 11621216.7849; val_kl_reg_loss: 39795.6885; val_edge_recon_loss: 2610662.4877; val_gene_expr_recon_loss: 9367652.7377; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12018110.8852; val_optim_loss: 12018110.8852
Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.9925; val_auprc_score: 0.9908; val_best_acc_score: 0.9668; val_best_f1_score: 0.9674; train_kl_reg_loss: 40340.4694; train_edge_recon_loss: 2601889.3304; train_gene_expr_recon_loss: 8975618.4724; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11617848.2812; train_optim_loss: 11617848.2812; val_kl_reg_loss: 39780.0503; val_edge_recon_loss: 2607573.8525; val_gene_expr_recon_loss: 9370528.6066; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12017882.5246; val_optim_loss: 12017882.5246
Epoch 24/100 |████----------------| 24.0% val_auroc_score: 0.9919; val_auprc_score: 0.9899; val_best_acc_score: 0.9657; val_best_f1_score: 0.9663; train_kl_reg_loss: 40355.1094; train_edge_recon_loss: 2601173.0317; train_gene_expr_recon_loss: 8965401.9301; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11606930.0901; train_optim_loss: 11606930.0901; val_kl_reg_loss: 39796.6707; val_edge_recon_loss: 2609621.2664; val_gene_expr_recon_loss: 9387720.6557; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12037138.5410; val_optim_loss: 12037138.5410
