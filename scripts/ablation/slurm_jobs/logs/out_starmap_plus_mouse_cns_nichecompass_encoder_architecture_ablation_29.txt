None
Run timestamp: 05082023_065647_29.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'starmap_plus_mouse_cns', '--reference_batches', 'batch1', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'encoder_architecture_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_fc_layers_encoder', '2', '--n_layers_encoder', '2', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '500000.0', '--lambda_gene_expr_recon', '300.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '256', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_29']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 1022, n_cat_covariates_embed_input: 0, n_hidden: 1022, n_latent: 1423, n_addon_latent: 10, n_fc_layers: 2, n_layers: 2, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1423, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 1022
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1423, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 1022

--- INITIALIZING TRAINER ---
Number of training nodes: 82121
Number of validation nodes: 9125
Number of training edges: 195913
Number of validation edges: 21768
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9805; val_auprc_score: 0.9746; val_best_acc_score: 0.9459; val_best_f1_score: 0.9474; train_kl_reg_loss: 7695.8034; train_edge_recon_loss: 268599.7639; train_gene_expr_recon_loss: 210126.5277; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 486422.0937; train_optim_loss: 486422.0937; val_kl_reg_loss: 7354.7439; val_edge_recon_loss: 262098.0371; val_gene_expr_recon_loss: 194586.5854; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 464039.3659; val_optim_loss: 464039.3659
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9860; val_auprc_score: 0.9820; val_best_acc_score: 0.9551; val_best_f1_score: 0.9560; train_kl_reg_loss: 7217.0278; train_edge_recon_loss: 260010.0452; train_gene_expr_recon_loss: 187486.0247; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 454713.0978; train_optim_loss: 454713.0978; val_kl_reg_loss: 7238.1925; val_edge_recon_loss: 261181.3912; val_gene_expr_recon_loss: 184743.4889; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 453163.0705; val_optim_loss: 453163.0705
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9882; val_auprc_score: 0.9851; val_best_acc_score: 0.9582; val_best_f1_score: 0.9591; train_kl_reg_loss: 6897.9999; train_edge_recon_loss: 259004.4130; train_gene_expr_recon_loss: 181007.6231; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 446910.0366; train_optim_loss: 446910.0366; val_kl_reg_loss: 6772.1267; val_edge_recon_loss: 260116.8917; val_gene_expr_recon_loss: 179816.3975; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 446705.4168; val_optim_loss: 446705.4168
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9896; val_auprc_score: 0.9870; val_best_acc_score: 0.9614; val_best_f1_score: 0.9623; train_kl_reg_loss: 6721.9220; train_edge_recon_loss: 258280.8580; train_gene_expr_recon_loss: 177246.6120; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 442249.3918; train_optim_loss: 442249.3918; val_kl_reg_loss: 6595.5989; val_edge_recon_loss: 259458.1624; val_gene_expr_recon_loss: 177075.3497; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 443129.1134; val_optim_loss: 443129.1134
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9904; val_auprc_score: 0.9874; val_best_acc_score: 0.9653; val_best_f1_score: 0.9661; train_kl_reg_loss: 6581.2203; train_edge_recon_loss: 257785.3587; train_gene_expr_recon_loss: 174985.4030; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 439351.9817; train_optim_loss: 439351.9817; val_kl_reg_loss: 6492.4920; val_edge_recon_loss: 259270.3005; val_gene_expr_recon_loss: 175627.1355; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 441389.9291; val_optim_loss: 441389.9291
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9915; val_auprc_score: 0.9895; val_best_acc_score: 0.9646; val_best_f1_score: 0.9653; train_kl_reg_loss: 6502.2028; train_edge_recon_loss: 257479.9185; train_gene_expr_recon_loss: 173427.2033; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 437409.3242; train_optim_loss: 437409.3242; val_kl_reg_loss: 6455.9511; val_edge_recon_loss: 259051.7422; val_gene_expr_recon_loss: 174945.3910; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 440453.0865; val_optim_loss: 440453.0865
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9902; val_auprc_score: 0.9870; val_best_acc_score: 0.9653; val_best_f1_score: 0.9660; train_kl_reg_loss: 6467.8830; train_edge_recon_loss: 257362.5970; train_gene_expr_recon_loss: 172075.4199; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 435905.8997; train_optim_loss: 435905.8997; val_kl_reg_loss: 6526.9541; val_edge_recon_loss: 258754.4355; val_gene_expr_recon_loss: 178113.2100; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 443394.6010; val_optim_loss: 443394.6010
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9909; val_auprc_score: 0.9880; val_best_acc_score: 0.9669; val_best_f1_score: 0.9675; train_kl_reg_loss: 6445.8954; train_edge_recon_loss: 257165.5476; train_gene_expr_recon_loss: 170670.8122; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 434282.2546; train_optim_loss: 434282.2546; val_kl_reg_loss: 6659.8761; val_edge_recon_loss: 258393.6094; val_gene_expr_recon_loss: 174421.4261; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 439474.9117; val_optim_loss: 439474.9117
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9918; val_auprc_score: 0.9891; val_best_acc_score: 0.9681; val_best_f1_score: 0.9687; train_kl_reg_loss: 6443.0019; train_edge_recon_loss: 256964.6661; train_gene_expr_recon_loss: 169293.9648; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 432701.6328; train_optim_loss: 432701.6328; val_kl_reg_loss: 6715.8790; val_edge_recon_loss: 258181.8270; val_gene_expr_recon_loss: 173774.7251; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 438672.4313; val_optim_loss: 438672.4313
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9926; val_auprc_score: 0.9901; val_best_acc_score: 0.9707; val_best_f1_score: 0.9711; train_kl_reg_loss: 6439.5133; train_edge_recon_loss: 256937.4691; train_gene_expr_recon_loss: 168019.3269; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 431396.3096; train_optim_loss: 431396.3096; val_kl_reg_loss: 13779.0146; val_edge_recon_loss: 257832.3943; val_gene_expr_recon_loss: 170548.3530; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 442159.7605; val_optim_loss: 442159.7605
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9924; val_auprc_score: 0.9899; val_best_acc_score: 0.9703; val_best_f1_score: 0.9707; train_kl_reg_loss: 6440.1961; train_edge_recon_loss: 256827.6828; train_gene_expr_recon_loss: 166827.4057; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 430095.2852; train_optim_loss: 430095.2852; val_kl_reg_loss: 6772.5018; val_edge_recon_loss: 257915.4911; val_gene_expr_recon_loss: 171116.8412; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 435804.8343; val_optim_loss: 435804.8343
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9919; val_auprc_score: 0.9890; val_best_acc_score: 0.9707; val_best_f1_score: 0.9711; train_kl_reg_loss: 6442.8435; train_edge_recon_loss: 256760.8998; train_gene_expr_recon_loss: 165772.9817; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 428976.7246; train_optim_loss: 428976.7246; val_kl_reg_loss: 7468.3869; val_edge_recon_loss: 258063.0516; val_gene_expr_recon_loss: 172373.3944; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 437904.8347; val_optim_loss: 437904.8347
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9920; val_auprc_score: 0.9894; val_best_acc_score: 0.9704; val_best_f1_score: 0.9710; train_kl_reg_loss: 6428.7892; train_edge_recon_loss: 256580.7157; train_gene_expr_recon_loss: 164993.2197; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 428002.7252; train_optim_loss: 428002.7252; val_kl_reg_loss: 7562.0821; val_edge_recon_loss: 257713.6757; val_gene_expr_recon_loss: 170953.1010; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 436228.8576; val_optim_loss: 436228.8576
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9929; val_auprc_score: 0.9907; val_best_acc_score: 0.9727; val_best_f1_score: 0.9731; train_kl_reg_loss: 6342.8865; train_edge_recon_loss: 256547.9463; train_gene_expr_recon_loss: 163877.8601; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 426768.6933; train_optim_loss: 426768.6933; val_kl_reg_loss: 695265.0073; val_edge_recon_loss: 257706.9618; val_gene_expr_recon_loss: 173449.2791; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 1126421.2533; val_optim_loss: 1126421.2533
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9928; val_auprc_score: 0.9905; val_best_acc_score: 0.9717; val_best_f1_score: 0.9720; train_kl_reg_loss: 6107.3046; train_edge_recon_loss: 256339.6557; train_gene_expr_recon_loss: 163349.1507; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 425796.1110; train_optim_loss: 425796.1110; val_kl_reg_loss: 8128.6718; val_edge_recon_loss: 257473.0727; val_gene_expr_recon_loss: 172149.3948; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 437751.1399; val_optim_loss: 437751.1399

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9931; val_auprc_score: 0.9908; val_best_acc_score: 0.9740; val_best_f1_score: 0.9743; train_kl_reg_loss: 5848.2498; train_edge_recon_loss: 255805.2563; train_gene_expr_recon_loss: 162089.5481; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 423743.0541; train_optim_loss: 423743.0541; val_kl_reg_loss: 367855.3418; val_edge_recon_loss: 257020.8463; val_gene_expr_recon_loss: 169877.8067; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 794753.9833; val_optim_loss: 794753.9833
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9935; val_auprc_score: 0.9913; val_best_acc_score: 0.9732; val_best_f1_score: 0.9735; train_kl_reg_loss: 5752.3583; train_edge_recon_loss: 255699.4310; train_gene_expr_recon_loss: 161947.1307; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 423398.9200; train_optim_loss: 423398.9200; val_kl_reg_loss: 8033716962.1788; val_edge_recon_loss: 257037.3327; val_gene_expr_recon_loss: 174437.7177; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 8034148788.6461; val_optim_loss: 8034148788.6461
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9935; val_auprc_score: 0.9912; val_best_acc_score: 0.9748; val_best_f1_score: 0.9751; train_kl_reg_loss: 5674.5349; train_edge_recon_loss: 255812.1879; train_gene_expr_recon_loss: 161610.4882; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 423097.2106; train_optim_loss: 423097.2106; val_kl_reg_loss: 1208302.6446; val_edge_recon_loss: 256980.8143; val_gene_expr_recon_loss: 175316.9061; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 1640600.3456; val_optim_loss: 1640600.3456
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9937; val_auprc_score: 0.9915; val_best_acc_score: 0.9747; val_best_f1_score: 0.9751; train_kl_reg_loss: 5627.1617; train_edge_recon_loss: 255608.2890; train_gene_expr_recon_loss: 161391.2530; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 422626.7035; train_optim_loss: 422626.7035; val_kl_reg_loss: 31118.2742; val_edge_recon_loss: 256601.6704; val_gene_expr_recon_loss: 175710.0325; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 463429.9764; val_optim_loss: 463429.9764

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 68 min 28 sec.
Using best model state, which was in epoch 11.

--- MODEL EVALUATION ---
val AUROC score: 0.9919
val AUPRC score: 0.9881
val best accuracy score: 0.9709
val best F1 score: 0.9714
val target rna MSE score: 0.3413
val source rna MSE score: 0.1061

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
