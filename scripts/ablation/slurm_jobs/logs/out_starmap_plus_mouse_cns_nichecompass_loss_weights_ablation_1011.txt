None
Run timestamp: 03072023_171838_1011.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'starmap_plus_mouse_cns', '--reference_batches', 'batch1', '--n_neighbors', '16', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '0.1', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000', '--lambda_gene_expr_recon', '300', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '1024', '--node_batch_size', 'None', '--timestamp_suffix', '_1011']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 1022, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 1022, n_latent: 1423, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1423, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 2044
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 82121
Number of validation nodes: 9125
Number of training edges: 735626
Number of validation edges: 81736
Edge batch size: 1024
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9888; val_auprc_score: 0.9859; val_best_acc_score: 0.9566; val_best_f1_score: 0.9575; train_kl_reg_loss: 4753.7471; train_edge_recon_loss: 30773.2900; train_gene_expr_recon_loss: 113581.3137; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 149108.3507; train_optim_loss: 149108.3507; val_kl_reg_loss: 4233.5521; val_edge_recon_loss: 29311.2107; val_gene_expr_recon_loss: 105179.0104; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 138723.7737; val_optim_loss: 138723.7737
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9915; val_auprc_score: 0.9896; val_best_acc_score: 0.9626; val_best_f1_score: 0.9633; train_kl_reg_loss: 3957.0580; train_edge_recon_loss: 29199.2594; train_gene_expr_recon_loss: 103824.2102; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 136980.5279; train_optim_loss: 136980.5279; val_kl_reg_loss: 3808.9889; val_edge_recon_loss: 28426.5436; val_gene_expr_recon_loss: 101451.8295; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 133687.3611; val_optim_loss: 133687.3611
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9928; val_auprc_score: 0.9912; val_best_acc_score: 0.9653; val_best_f1_score: 0.9659; train_kl_reg_loss: 3709.4074; train_edge_recon_loss: 28676.5379; train_gene_expr_recon_loss: 100984.2219; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 133370.1671; train_optim_loss: 133370.1671; val_kl_reg_loss: 3745.3884; val_edge_recon_loss: 28002.4507; val_gene_expr_recon_loss: 99746.3235; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 131494.1630; val_optim_loss: 131494.1630
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9938; val_auprc_score: 0.9924; val_best_acc_score: 0.9682; val_best_f1_score: 0.9686; train_kl_reg_loss: 3589.4118; train_edge_recon_loss: 28371.0377; train_gene_expr_recon_loss: 99315.0224; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 131275.4721; train_optim_loss: 131275.4721; val_kl_reg_loss: 3590.4756; val_edge_recon_loss: 27669.3653; val_gene_expr_recon_loss: 98390.7864; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 129650.6271; val_optim_loss: 129650.6271
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9946; val_auprc_score: 0.9936; val_best_acc_score: 0.9696; val_best_f1_score: 0.9701; train_kl_reg_loss: 3522.6311; train_edge_recon_loss: 28151.6667; train_gene_expr_recon_loss: 98184.3521; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 129858.6499; train_optim_loss: 129858.6499; val_kl_reg_loss: 3456.0671; val_edge_recon_loss: 27433.3906; val_gene_expr_recon_loss: 97613.3812; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 128502.8389; val_optim_loss: 128502.8389
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9952; val_auprc_score: 0.9943; val_best_acc_score: 0.9713; val_best_f1_score: 0.9716; train_kl_reg_loss: 3485.3338; train_edge_recon_loss: 28003.2413; train_gene_expr_recon_loss: 97391.5724; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 128880.1475; train_optim_loss: 128880.1475; val_kl_reg_loss: 3458.0890; val_edge_recon_loss: 27315.8828; val_gene_expr_recon_loss: 97173.6212; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 127947.5931; val_optim_loss: 127947.5931
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9956; val_auprc_score: 0.9949; val_best_acc_score: 0.9717; val_best_f1_score: 0.9721; train_kl_reg_loss: 3471.7168; train_edge_recon_loss: 27878.5600; train_gene_expr_recon_loss: 96803.5071; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 128153.7839; train_optim_loss: 128153.7839; val_kl_reg_loss: 3430.3610; val_edge_recon_loss: 27176.4671; val_gene_expr_recon_loss: 96800.5794; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 127407.4074; val_optim_loss: 127407.4074
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9959; val_auprc_score: 0.9949; val_best_acc_score: 0.9733; val_best_f1_score: 0.9736; train_kl_reg_loss: 3468.9578; train_edge_recon_loss: 27775.2576; train_gene_expr_recon_loss: 96324.3717; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 127568.5872; train_optim_loss: 127568.5872; val_kl_reg_loss: 3388.1099; val_edge_recon_loss: 27086.3226; val_gene_expr_recon_loss: 96634.9706; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 127109.4033; val_optim_loss: 127109.4033
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9964; val_auprc_score: 0.9957; val_best_acc_score: 0.9746; val_best_f1_score: 0.9749; train_kl_reg_loss: 3478.3950; train_edge_recon_loss: 27693.7668; train_gene_expr_recon_loss: 95912.4356; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 127084.5974; train_optim_loss: 127084.5974; val_kl_reg_loss: 3464.3910; val_edge_recon_loss: 27072.5471; val_gene_expr_recon_loss: 96461.9849; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 126998.9229; val_optim_loss: 126998.9229
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9962; val_auprc_score: 0.9956; val_best_acc_score: 0.9742; val_best_f1_score: 0.9744; train_kl_reg_loss: 3491.6452; train_edge_recon_loss: 27631.0502; train_gene_expr_recon_loss: 95565.9630; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 126688.6583; train_optim_loss: 126688.6583; val_kl_reg_loss: 3498.1315; val_edge_recon_loss: 26961.2382; val_gene_expr_recon_loss: 96437.2357; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 126896.6058; val_optim_loss: 126896.6058
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9968; val_auprc_score: 0.9963; val_best_acc_score: 0.9758; val_best_f1_score: 0.9760; train_kl_reg_loss: 3510.5158; train_edge_recon_loss: 27577.9074; train_gene_expr_recon_loss: 95273.3749; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 126361.7979; train_optim_loss: 126361.7979; val_kl_reg_loss: 3495.2001; val_edge_recon_loss: 26951.6160; val_gene_expr_recon_loss: 96155.1142; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 126601.9300; val_optim_loss: 126601.9300
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9968; val_auprc_score: 0.9961; val_best_acc_score: 0.9756; val_best_f1_score: 0.9760; train_kl_reg_loss: 3528.5741; train_edge_recon_loss: 27535.3025; train_gene_expr_recon_loss: 95035.4069; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 126099.2836; train_optim_loss: 126099.2836; val_kl_reg_loss: 3511.2238; val_edge_recon_loss: 26953.2321; val_gene_expr_recon_loss: 96285.3474; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 126749.8033; val_optim_loss: 126749.8033
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9970; val_auprc_score: 0.9966; val_best_acc_score: 0.9768; val_best_f1_score: 0.9770; train_kl_reg_loss: 3549.3145; train_edge_recon_loss: 27499.9679; train_gene_expr_recon_loss: 94737.5235; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 125786.8059; train_optim_loss: 125786.8059; val_kl_reg_loss: 3495.4770; val_edge_recon_loss: 26866.4175; val_gene_expr_recon_loss: 96287.6353; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 126649.5302; val_optim_loss: 126649.5302
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9969; val_auprc_score: 0.9963; val_best_acc_score: 0.9764; val_best_f1_score: 0.9767; train_kl_reg_loss: 3568.7401; train_edge_recon_loss: 27466.4708; train_gene_expr_recon_loss: 94522.5930; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 125557.8039; train_optim_loss: 125557.8039; val_kl_reg_loss: 3541.2052; val_edge_recon_loss: 26864.0269; val_gene_expr_recon_loss: 96310.0082; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 126715.2400; val_optim_loss: 126715.2400
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9973; val_auprc_score: 0.9969; val_best_acc_score: 0.9767; val_best_f1_score: 0.9769; train_kl_reg_loss: 3590.5806; train_edge_recon_loss: 27435.5420; train_gene_expr_recon_loss: 94338.1700; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 125364.2925; train_optim_loss: 125364.2925; val_kl_reg_loss: 3600.4889; val_edge_recon_loss: 26858.3535; val_gene_expr_recon_loss: 96354.7024; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 126813.5447; val_optim_loss: 126813.5447

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9974; val_auprc_score: 0.9969; val_best_acc_score: 0.9778; val_best_f1_score: 0.9780; train_kl_reg_loss: 3603.6843; train_edge_recon_loss: 27365.2633; train_gene_expr_recon_loss: 93644.3331; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 124613.2805; train_optim_loss: 124613.2805; val_kl_reg_loss: 3562.2171; val_edge_recon_loss: 26794.5978; val_gene_expr_recon_loss: 96176.7421; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 126533.5574; val_optim_loss: 126533.5574
