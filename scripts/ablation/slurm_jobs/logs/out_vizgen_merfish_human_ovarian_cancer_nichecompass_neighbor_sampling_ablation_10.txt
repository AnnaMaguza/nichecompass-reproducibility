None
Run timestamp: 04082023_235225_10.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'vizgen_merfish_human_ovarian_cancer', '--reference_batches', 'batch2', '--n_neighbors', '16', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'neighbor_sampling_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '300', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '2', '--timestamp_suffix', '_10']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 500, n_cat_covariates_embed_input: 0, n_hidden: 500, n_latent: 1385, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1385, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 500
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1385, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 500

--- INITIALIZING TRAINER ---
Number of training nodes: 210667
Number of validation nodes: 23407
Number of training edges: 1931624
Number of validation edges: 214624
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9870; val_auprc_score: 0.9871; val_best_acc_score: 0.9424; val_best_f1_score: 0.9424; train_kl_reg_loss: 7675.6628; train_edge_recon_loss: 268147.2536; train_gene_expr_recon_loss: 195761.4314; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 471584.3481; train_optim_loss: 471584.3481; val_kl_reg_loss: 7305.7492; val_edge_recon_loss: 266439.7418; val_gene_expr_recon_loss: 180054.9086; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 453800.3996; val_optim_loss: 453800.3996
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9903; val_auprc_score: 0.9904; val_best_acc_score: 0.9506; val_best_f1_score: 0.9507; train_kl_reg_loss: 7195.6999; train_edge_recon_loss: 263086.3146; train_gene_expr_recon_loss: 176384.4597; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 446666.4744; train_optim_loss: 446666.4744; val_kl_reg_loss: 7088.3742; val_edge_recon_loss: 265604.6417; val_gene_expr_recon_loss: 174159.7517; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 446852.7667; val_optim_loss: 446852.7667
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9915; val_auprc_score: 0.9916; val_best_acc_score: 0.9547; val_best_f1_score: 0.9549; train_kl_reg_loss: 7102.7082; train_edge_recon_loss: 262160.1158; train_gene_expr_recon_loss: 173160.7210; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 442423.5451; train_optim_loss: 442423.5451; val_kl_reg_loss: 6694.8334; val_edge_recon_loss: 264940.7254; val_gene_expr_recon_loss: 172188.0132; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 443823.5723; val_optim_loss: 443823.5723
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9922; val_auprc_score: 0.9921; val_best_acc_score: 0.9562; val_best_f1_score: 0.9564; train_kl_reg_loss: 7075.3511; train_edge_recon_loss: 261736.6572; train_gene_expr_recon_loss: 171526.7637; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 440338.7721; train_optim_loss: 440338.7721; val_kl_reg_loss: 6938.0400; val_edge_recon_loss: 264420.9184; val_gene_expr_recon_loss: 178906.1033; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 450265.0616; val_optim_loss: 450265.0616
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9923; val_auprc_score: 0.9923; val_best_acc_score: 0.9570; val_best_f1_score: 0.9571; train_kl_reg_loss: 7056.0712; train_edge_recon_loss: 261448.9113; train_gene_expr_recon_loss: 164577.5745; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 433082.5569; train_optim_loss: 433082.5569; val_kl_reg_loss: 7029.5951; val_edge_recon_loss: 264361.0430; val_gene_expr_recon_loss: 161904.7736; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 433295.4121; val_optim_loss: 433295.4121
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9925; val_auprc_score: 0.9924; val_best_acc_score: 0.9569; val_best_f1_score: 0.9570; train_kl_reg_loss: 7044.3413; train_edge_recon_loss: 261242.5480; train_gene_expr_recon_loss: 144020.8414; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 412307.7308; train_optim_loss: 412307.7308; val_kl_reg_loss: 6961.7043; val_edge_recon_loss: 264137.1389; val_gene_expr_recon_loss: 189108.8660; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 460207.7100; val_optim_loss: 460207.7100
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9928; val_auprc_score: 0.9927; val_best_acc_score: 0.9585; val_best_f1_score: 0.9586; train_kl_reg_loss: 7036.3827; train_edge_recon_loss: 261127.0056; train_gene_expr_recon_loss: 144560.8965; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 412724.2844; train_optim_loss: 412724.2844; val_kl_reg_loss: 6756.1541; val_edge_recon_loss: 264287.6869; val_gene_expr_recon_loss: 153399.4597; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 424443.3010; val_optim_loss: 424443.3010
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9929; val_auprc_score: 0.9927; val_best_acc_score: 0.9585; val_best_f1_score: 0.9587; train_kl_reg_loss: 7036.0761; train_edge_recon_loss: 260903.0147; train_gene_expr_recon_loss: 148395.4449; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 416334.5355; train_optim_loss: 416334.5355; val_kl_reg_loss: 6728.0539; val_edge_recon_loss: 264325.9730; val_gene_expr_recon_loss: 148836.0466; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 419890.0741; val_optim_loss: 419890.0741
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9928; val_auprc_score: 0.9926; val_best_acc_score: 0.9586; val_best_f1_score: 0.9587; train_kl_reg_loss: 7033.1861; train_edge_recon_loss: 260781.4657; train_gene_expr_recon_loss: 147352.2701; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 415166.9222; train_optim_loss: 415166.9222; val_kl_reg_loss: 6997.2335; val_edge_recon_loss: 264031.4798; val_gene_expr_recon_loss: 146711.4475; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 417740.1603; val_optim_loss: 417740.1603
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9930; val_auprc_score: 0.9929; val_best_acc_score: 0.9597; val_best_f1_score: 0.9597; train_kl_reg_loss: 7026.2654; train_edge_recon_loss: 260766.1022; train_gene_expr_recon_loss: 145811.0304; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 413603.3978; train_optim_loss: 413603.3978; val_kl_reg_loss: 7019.2208; val_edge_recon_loss: 263550.6415; val_gene_expr_recon_loss: 146146.5999; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 416716.4618; val_optim_loss: 416716.4618
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9934; val_auprc_score: 0.9934; val_best_acc_score: 0.9603; val_best_f1_score: 0.9605; train_kl_reg_loss: 7028.4978; train_edge_recon_loss: 260669.8622; train_gene_expr_recon_loss: 144596.6216; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 412294.9817; train_optim_loss: 412294.9817; val_kl_reg_loss: 6922.1437; val_edge_recon_loss: 263612.3523; val_gene_expr_recon_loss: 144528.9307; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 415063.4268; val_optim_loss: 415063.4268
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9934; val_auprc_score: 0.9930; val_best_acc_score: 0.9613; val_best_f1_score: 0.9616; train_kl_reg_loss: 7019.8129; train_edge_recon_loss: 260607.7865; train_gene_expr_recon_loss: 143184.7407; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 410812.3398; train_optim_loss: 410812.3398; val_kl_reg_loss: 7097.0083; val_edge_recon_loss: 263554.8845; val_gene_expr_recon_loss: 144154.5835; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 414806.4761; val_optim_loss: 414806.4761
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9930; val_auprc_score: 0.9929; val_best_acc_score: 0.9592; val_best_f1_score: 0.9593; train_kl_reg_loss: 7019.7137; train_edge_recon_loss: 260535.9699; train_gene_expr_recon_loss: 144554.6996; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 412110.3830; train_optim_loss: 412110.3830; val_kl_reg_loss: 6696.3929; val_edge_recon_loss: 263833.8871; val_gene_expr_recon_loss: 162475.7141; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 433005.9946; val_optim_loss: 433005.9946
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9936; val_auprc_score: 0.9934; val_best_acc_score: 0.9608; val_best_f1_score: 0.9610; train_kl_reg_loss: 7025.0148; train_edge_recon_loss: 260484.9250; train_gene_expr_recon_loss: 160872.2503; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 428382.1900; train_optim_loss: 428382.1900; val_kl_reg_loss: 7130.4678; val_edge_recon_loss: 263619.4254; val_gene_expr_recon_loss: 161271.8827; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 432021.7766; val_optim_loss: 432021.7766
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9938; val_auprc_score: 0.9935; val_best_acc_score: 0.9627; val_best_f1_score: 0.9628; train_kl_reg_loss: 7024.9618; train_edge_recon_loss: 260368.1145; train_gene_expr_recon_loss: 160896.3506; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 428289.4272; train_optim_loss: 428289.4272; val_kl_reg_loss: 7107.9724; val_edge_recon_loss: 263286.0672; val_gene_expr_recon_loss: 162550.1449; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 432944.1841; val_optim_loss: 432944.1841
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9934; val_auprc_score: 0.9931; val_best_acc_score: 0.9608; val_best_f1_score: 0.9609; train_kl_reg_loss: 7020.4180; train_edge_recon_loss: 260394.7023; train_gene_expr_recon_loss: 161129.0610; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 428544.1812; train_optim_loss: 428544.1812; val_kl_reg_loss: 6969.9276; val_edge_recon_loss: 263342.4394; val_gene_expr_recon_loss: 166651.0190; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 436963.3856; val_optim_loss: 436963.3856

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9940; val_auprc_score: 0.9939; val_best_acc_score: 0.9631; val_best_f1_score: 0.9633; train_kl_reg_loss: 7007.2562; train_edge_recon_loss: 259946.9688; train_gene_expr_recon_loss: 160712.9720; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 427667.1972; train_optim_loss: 427667.1972; val_kl_reg_loss: 6951.2341; val_edge_recon_loss: 262922.2298; val_gene_expr_recon_loss: 162907.4685; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 432780.9314; val_optim_loss: 432780.9314
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9942; val_auprc_score: 0.9940; val_best_acc_score: 0.9636; val_best_f1_score: 0.9638; train_kl_reg_loss: 6994.0174; train_edge_recon_loss: 259884.5660; train_gene_expr_recon_loss: 159773.6680; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 426652.2514; train_optim_loss: 426652.2514; val_kl_reg_loss: 6886.0533; val_edge_recon_loss: 263119.0773; val_gene_expr_recon_loss: 147225.9426; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 417231.0725; val_optim_loss: 417231.0725
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9944; val_auprc_score: 0.9942; val_best_acc_score: 0.9641; val_best_f1_score: 0.9643; train_kl_reg_loss: 6982.0592; train_edge_recon_loss: 259928.8902; train_gene_expr_recon_loss: 157287.4374; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 424198.3869; train_optim_loss: 424198.3869; val_kl_reg_loss: 6906.6914; val_edge_recon_loss: 263415.1727; val_gene_expr_recon_loss: 159534.9740; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 429856.8384; val_optim_loss: 429856.8384
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9944; val_auprc_score: 0.9943; val_best_acc_score: 0.9644; val_best_f1_score: 0.9645; train_kl_reg_loss: 6977.2256; train_edge_recon_loss: 259884.5261; train_gene_expr_recon_loss: 158588.3274; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 425450.0790; train_optim_loss: 425450.0790; val_kl_reg_loss: 6860.0063; val_edge_recon_loss: 263161.0301; val_gene_expr_recon_loss: 159925.2812; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 429946.3177; val_optim_loss: 429946.3177

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 110 min 59 sec.
Using best model state, which was in epoch 12.

--- MODEL EVALUATION ---
val AUROC score: 0.9935
val AUPRC score: 0.9933
val best accuracy score: 0.9610
val best F1 score: 0.9612
val target rna MSE score: 4.6209
val source rna MSE score: 1.0866

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
