None
Run timestamp: 04072023_105443_23.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'vizgen_merfish_human_ovarian_cancer', '--reference_batches', 'batch2', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--add_fc_gps_instead_of_gp_dict_gps', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000', '--lambda_gene_expr_recon', '300', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--timestamp_suffix', '_23']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 500, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 500, n_latent: 1691, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1691, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 1000
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 210667
Number of validation nodes: 23407
Number of training edges: 1455707
Number of validation edges: 161745
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9827; val_auprc_score: 0.9837; val_best_acc_score: 0.9302; val_best_f1_score: 0.9300; train_kl_reg_loss: 4267.5849; train_edge_recon_loss: 28224.5876; train_gene_expr_recon_loss: 214947.1415; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 247439.3140; train_optim_loss: 247439.3140; val_kl_reg_loss: 4523.4228; val_edge_recon_loss: 26783.8013; val_gene_expr_recon_loss: 204688.5686; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 235995.7936; val_optim_loss: 235995.7936
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9875; val_auprc_score: 0.9880; val_best_acc_score: 0.9420; val_best_f1_score: 0.9420; train_kl_reg_loss: 4806.9186; train_edge_recon_loss: 27207.4606; train_gene_expr_recon_loss: 203477.3475; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 235491.7268; train_optim_loss: 235491.7268; val_kl_reg_loss: 4887.1102; val_edge_recon_loss: 26608.5548; val_gene_expr_recon_loss: 200783.3232; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 232278.9888; val_optim_loss: 232278.9888
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9902; val_auprc_score: 0.9904; val_best_acc_score: 0.9489; val_best_f1_score: 0.9490; train_kl_reg_loss: 4944.9762; train_edge_recon_loss: 27034.6563; train_gene_expr_recon_loss: 201186.3469; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 233165.9794; train_optim_loss: 233165.9794; val_kl_reg_loss: 4942.5343; val_edge_recon_loss: 26512.3640; val_gene_expr_recon_loss: 199593.8607; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 231048.7592; val_optim_loss: 231048.7592
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9911; val_auprc_score: 0.9914; val_best_acc_score: 0.9520; val_best_f1_score: 0.9519; train_kl_reg_loss: 4982.5757; train_edge_recon_loss: 26976.4932; train_gene_expr_recon_loss: 200264.7136; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 232223.7824; train_optim_loss: 232223.7824; val_kl_reg_loss: 5004.6552; val_edge_recon_loss: 26516.9180; val_gene_expr_recon_loss: 198825.6226; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 230347.1957; val_optim_loss: 230347.1957
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9922; val_auprc_score: 0.9923; val_best_acc_score: 0.9549; val_best_f1_score: 0.9550; train_kl_reg_loss: 4983.4807; train_edge_recon_loss: 26945.3767; train_gene_expr_recon_loss: 199801.5505; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 231730.4079; train_optim_loss: 231730.4079; val_kl_reg_loss: 4870.3537; val_edge_recon_loss: 26490.1044; val_gene_expr_recon_loss: 198568.2057; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 229928.6641; val_optim_loss: 229928.6641
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9924; val_auprc_score: 0.9925; val_best_acc_score: 0.9555; val_best_f1_score: 0.9556; train_kl_reg_loss: 4973.8809; train_edge_recon_loss: 26926.9180; train_gene_expr_recon_loss: 199418.2443; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 231319.0431; train_optim_loss: 231319.0431; val_kl_reg_loss: 4824.5805; val_edge_recon_loss: 26477.1122; val_gene_expr_recon_loss: 198359.5559; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 229661.2483; val_optim_loss: 229661.2483
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9927; val_auprc_score: 0.9928; val_best_acc_score: 0.9561; val_best_f1_score: 0.9563; train_kl_reg_loss: 4959.9047; train_edge_recon_loss: 26922.4719; train_gene_expr_recon_loss: 199188.7300; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 231071.1066; train_optim_loss: 231071.1066; val_kl_reg_loss: 4921.9165; val_edge_recon_loss: 26476.3605; val_gene_expr_recon_loss: 198274.7222; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 229672.9991; val_optim_loss: 229672.9991
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9931; val_auprc_score: 0.9932; val_best_acc_score: 0.9575; val_best_f1_score: 0.9576; train_kl_reg_loss: 4945.0766; train_edge_recon_loss: 26915.8059; train_gene_expr_recon_loss: 199076.3338; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 230937.2163; train_optim_loss: 230937.2163; val_kl_reg_loss: 4871.1420; val_edge_recon_loss: 26481.9131; val_gene_expr_recon_loss: 198722.6575; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 230075.7121; val_optim_loss: 230075.7121
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9933; val_auprc_score: 0.9933; val_best_acc_score: 0.9589; val_best_f1_score: 0.9590; train_kl_reg_loss: 4933.3478; train_edge_recon_loss: 26919.5212; train_gene_expr_recon_loss: 198880.1722; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 230733.0412; train_optim_loss: 230733.0412; val_kl_reg_loss: 4787.0179; val_edge_recon_loss: 26460.5877; val_gene_expr_recon_loss: 197820.6776; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 229068.2833; val_optim_loss: 229068.2833
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9940; val_auprc_score: 0.9939; val_best_acc_score: 0.9611; val_best_f1_score: 0.9612; train_kl_reg_loss: 4922.6527; train_edge_recon_loss: 26908.8929; train_gene_expr_recon_loss: 198791.5286; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 230623.0742; train_optim_loss: 230623.0742; val_kl_reg_loss: 4853.1472; val_edge_recon_loss: 26444.8998; val_gene_expr_recon_loss: 198163.5048; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 229461.5516; val_optim_loss: 229461.5516
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9937; val_auprc_score: 0.9937; val_best_acc_score: 0.9600; val_best_f1_score: 0.9600; train_kl_reg_loss: 4915.0192; train_edge_recon_loss: 26899.3711; train_gene_expr_recon_loss: 198684.8199; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 230499.2103; train_optim_loss: 230499.2103; val_kl_reg_loss: 4877.7601; val_edge_recon_loss: 26440.8338; val_gene_expr_recon_loss: 197963.5452; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 229282.1388; val_optim_loss: 229282.1388
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9938; val_auprc_score: 0.9937; val_best_acc_score: 0.9605; val_best_f1_score: 0.9605; train_kl_reg_loss: 4906.6781; train_edge_recon_loss: 26904.8234; train_gene_expr_recon_loss: 198662.0729; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 230473.5742; train_optim_loss: 230473.5742; val_kl_reg_loss: 4813.3668; val_edge_recon_loss: 26431.9808; val_gene_expr_recon_loss: 197842.6783; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 229088.0261; val_optim_loss: 229088.0261
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9933; val_auprc_score: 0.9933; val_best_acc_score: 0.9588; val_best_f1_score: 0.9588; train_kl_reg_loss: 4900.8144; train_edge_recon_loss: 26896.9809; train_gene_expr_recon_loss: 198535.1684; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 230332.9637; train_optim_loss: 230332.9637; val_kl_reg_loss: 4920.6726; val_edge_recon_loss: 26449.8696; val_gene_expr_recon_loss: 197850.4272; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 229220.9697; val_optim_loss: 229220.9697

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9944; val_auprc_score: 0.9944; val_best_acc_score: 0.9628; val_best_f1_score: 0.9628; train_kl_reg_loss: 4663.5007; train_edge_recon_loss: 26814.3179; train_gene_expr_recon_loss: 196899.9717; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 228377.7902; train_optim_loss: 228377.7902; val_kl_reg_loss: 4359.7926; val_edge_recon_loss: 26325.3237; val_gene_expr_recon_loss: 196292.2247; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 226977.3412; val_optim_loss: 226977.3412
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9947; val_auprc_score: 0.9945; val_best_acc_score: 0.9640; val_best_f1_score: 0.9639; train_kl_reg_loss: 4290.6852; train_edge_recon_loss: 26930.0384; train_gene_expr_recon_loss: 196467.8131; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 227688.5367; train_optim_loss: 227688.5367; val_kl_reg_loss: 4144.4566; val_edge_recon_loss: 26321.0932; val_gene_expr_recon_loss: 196128.7697; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 226594.3194; val_optim_loss: 226594.3194
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9946; val_auprc_score: 0.9946; val_best_acc_score: 0.9639; val_best_f1_score: 0.9638; train_kl_reg_loss: 4096.9100; train_edge_recon_loss: 26999.6955; train_gene_expr_recon_loss: 196239.0645; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 227335.6700; train_optim_loss: 227335.6700; val_kl_reg_loss: 4015.8061; val_edge_recon_loss: 26343.2725; val_gene_expr_recon_loss: 196262.3549; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 226621.4335; val_optim_loss: 226621.4335
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9947; val_auprc_score: 0.9948; val_best_acc_score: 0.9641; val_best_f1_score: 0.9641; train_kl_reg_loss: 3978.1229; train_edge_recon_loss: 27053.2638; train_gene_expr_recon_loss: 196127.1733; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 227158.5601; train_optim_loss: 227158.5601; val_kl_reg_loss: 3894.1038; val_edge_recon_loss: 26347.6921; val_gene_expr_recon_loss: 196129.8150; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 226371.6109; val_optim_loss: 226371.6109
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9949; val_auprc_score: 0.9949; val_best_acc_score: 0.9650; val_best_f1_score: 0.9651; train_kl_reg_loss: 3903.5745; train_edge_recon_loss: 27083.3174; train_gene_expr_recon_loss: 196085.2371; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 227072.1290; train_optim_loss: 227072.1290; val_kl_reg_loss: 3840.5026; val_edge_recon_loss: 26339.9854; val_gene_expr_recon_loss: 196027.9175; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 226208.4055; val_optim_loss: 226208.4055
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9950; val_auprc_score: 0.9948; val_best_acc_score: 0.9649; val_best_f1_score: 0.9650; train_kl_reg_loss: 3851.3440; train_edge_recon_loss: 27116.1763; train_gene_expr_recon_loss: 195982.2429; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 226949.7632; train_optim_loss: 226949.7632; val_kl_reg_loss: 3836.8597; val_edge_recon_loss: 26339.1705; val_gene_expr_recon_loss: 196091.3377; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 226267.3681; val_optim_loss: 226267.3681
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9951; val_auprc_score: 0.9951; val_best_acc_score: 0.9656; val_best_f1_score: 0.9657; train_kl_reg_loss: 3810.4863; train_edge_recon_loss: 27138.6004; train_gene_expr_recon_loss: 195908.0548; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 226857.1415; train_optim_loss: 226857.1415; val_kl_reg_loss: 3737.3860; val_edge_recon_loss: 26343.4835; val_gene_expr_recon_loss: 196042.3944; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 226123.2641; val_optim_loss: 226123.2641
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9950; val_auprc_score: 0.9950; val_best_acc_score: 0.9655; val_best_f1_score: 0.9656; train_kl_reg_loss: 3785.0616; train_edge_recon_loss: 27138.7780; train_gene_expr_recon_loss: 195902.4727; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 226826.3125; train_optim_loss: 226826.3125; val_kl_reg_loss: 3722.0628; val_edge_recon_loss: 26345.3518; val_gene_expr_recon_loss: 195667.3112; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 225734.7257; val_optim_loss: 225734.7257
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9951; val_auprc_score: 0.9950; val_best_acc_score: 0.9656; val_best_f1_score: 0.9656; train_kl_reg_loss: 3766.4337; train_edge_recon_loss: 27149.4412; train_gene_expr_recon_loss: 195814.3642; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 226730.2391; train_optim_loss: 226730.2391; val_kl_reg_loss: 3720.4208; val_edge_recon_loss: 26355.2828; val_gene_expr_recon_loss: 195886.6361; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 225962.3395; val_optim_loss: 225962.3395
Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.9951; val_auprc_score: 0.9952; val_best_acc_score: 0.9658; val_best_f1_score: 0.9658; train_kl_reg_loss: 3750.5230; train_edge_recon_loss: 27157.2190; train_gene_expr_recon_loss: 195802.6705; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 226710.4124; train_optim_loss: 226710.4124; val_kl_reg_loss: 3704.7931; val_edge_recon_loss: 26352.0927; val_gene_expr_recon_loss: 195884.2594; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 225941.1455; val_optim_loss: 225941.1455
Epoch 24/100 |████----------------| 24.0% val_auroc_score: 0.9951; val_auprc_score: 0.9951; val_best_acc_score: 0.9654; val_best_f1_score: 0.9654; train_kl_reg_loss: 3735.7266; train_edge_recon_loss: 27174.9246; train_gene_expr_recon_loss: 195751.5710; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 226662.2222; train_optim_loss: 226662.2222; val_kl_reg_loss: 3711.5794; val_edge_recon_loss: 26370.5804; val_gene_expr_recon_loss: 195829.8808; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 225912.0404; val_optim_loss: 225912.0404
Epoch 25/100 |█████---------------| 25.0% val_auroc_score: 0.9954; val_auprc_score: 0.9954; val_best_acc_score: 0.9664; val_best_f1_score: 0.9664; train_kl_reg_loss: 3726.8176; train_edge_recon_loss: 27166.8307; train_gene_expr_recon_loss: 195763.9514; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 226657.5997; train_optim_loss: 226657.5997; val_kl_reg_loss: 3701.8864; val_edge_recon_loss: 26375.2167; val_gene_expr_recon_loss: 195692.1219; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 225769.2250; val_optim_loss: 225769.2250
