None
Run timestamp: 04082023_203053_28.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'xenium_human_breast_cancer', '--reference_batches', 'batch1', '--n_neighbors', '16', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'encoder_architecture_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_fc_layers_encoder', '2', '--n_layers_encoder', '2', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '500000.0', '--lambda_gene_expr_recon', '300.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '128', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_28']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 313, n_cat_covariates_embed_input: 0, n_hidden: 313, n_latent: 1302, n_addon_latent: 10, n_fc_layers: 2, n_layers: 2, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1302, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 313
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1302, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 313

--- INITIALIZING TRAINER ---
Number of training nodes: 147600
Number of validation nodes: 16400
Number of training edges: 1319430
Number of validation edges: 146603
Edge batch size: 128
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9962; val_auprc_score: 0.9957; val_best_acc_score: 0.9742; val_best_f1_score: 0.9744; train_kl_reg_loss: 5100.2714; train_edge_recon_loss: 259704.5348; train_gene_expr_recon_loss: 115848.0006; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 380652.8068; train_optim_loss: 380652.8068; val_kl_reg_loss: 7217.4790; val_edge_recon_loss: 257549.4471; val_gene_expr_recon_loss: 183336.9120; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 448103.8377; val_optim_loss: 448103.8377
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9964; val_auprc_score: 0.9957; val_best_acc_score: 0.9762; val_best_f1_score: 0.9764; train_kl_reg_loss: 4156.8921; train_edge_recon_loss: 256680.4090; train_gene_expr_recon_loss: 109013.4664; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 369850.7674; train_optim_loss: 369850.7674; val_kl_reg_loss: 6526.0222; val_edge_recon_loss: 256698.0022; val_gene_expr_recon_loss: 173612.5284; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 436836.5532; val_optim_loss: 436836.5532
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9968; val_auprc_score: 0.9963; val_best_acc_score: 0.9784; val_best_f1_score: 0.9785; train_kl_reg_loss: 4057.0368; train_edge_recon_loss: 256215.7266; train_gene_expr_recon_loss: 108532.0272; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 368804.7907; train_optim_loss: 368804.7907; val_kl_reg_loss: 6312.2646; val_edge_recon_loss: 256346.6153; val_gene_expr_recon_loss: 193175.9312; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 455834.8110; val_optim_loss: 455834.8110
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9977; val_auprc_score: 0.9972; val_best_acc_score: 0.9818; val_best_f1_score: 0.9819; train_kl_reg_loss: 4021.0713; train_edge_recon_loss: 256035.2193; train_gene_expr_recon_loss: 108284.1194; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 368340.4100; train_optim_loss: 368340.4100; val_kl_reg_loss: 6421.5155; val_edge_recon_loss: 256098.3165; val_gene_expr_recon_loss: 226008.3319; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 488528.1638; val_optim_loss: 488528.1638
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9977; val_auprc_score: 0.9973; val_best_acc_score: 0.9820; val_best_f1_score: 0.9821; train_kl_reg_loss: 3986.9178; train_edge_recon_loss: 255748.3070; train_gene_expr_recon_loss: 108119.1633; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 367854.3881; train_optim_loss: 367854.3881; val_kl_reg_loss: 11585.4955; val_edge_recon_loss: 255795.0296; val_gene_expr_recon_loss: 174744.1975; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 442124.7225; val_optim_loss: 442124.7225
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9977; val_auprc_score: 0.9972; val_best_acc_score: 0.9827; val_best_f1_score: 0.9829; train_kl_reg_loss: 3977.3446; train_edge_recon_loss: 255621.8163; train_gene_expr_recon_loss: 107995.3886; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 367594.5496; train_optim_loss: 367594.5496; val_kl_reg_loss: 14230.0879; val_edge_recon_loss: 255687.4502; val_gene_expr_recon_loss: 204766.3467; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 474683.8848; val_optim_loss: 474683.8848
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9979; val_auprc_score: 0.9975; val_best_acc_score: 0.9833; val_best_f1_score: 0.9834; train_kl_reg_loss: 3966.5456; train_edge_recon_loss: 255449.2655; train_gene_expr_recon_loss: 107841.4031; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 367257.2142; train_optim_loss: 367257.2142; val_kl_reg_loss: 6502.6803; val_edge_recon_loss: 255563.4975; val_gene_expr_recon_loss: 223328.7114; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 485394.8891; val_optim_loss: 485394.8891
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9980; val_auprc_score: 0.9976; val_best_acc_score: 0.9839; val_best_f1_score: 0.9840; train_kl_reg_loss: 3972.3547; train_edge_recon_loss: 255376.7577; train_gene_expr_recon_loss: 107809.1794; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 367158.2917; train_optim_loss: 367158.2917; val_kl_reg_loss: 6320.3677; val_edge_recon_loss: 255511.5379; val_gene_expr_recon_loss: 190328.9345; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 452160.8403; val_optim_loss: 452160.8403

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9983; val_auprc_score: 0.9980; val_best_acc_score: 0.9858; val_best_f1_score: 0.9859; train_kl_reg_loss: 3856.3523; train_edge_recon_loss: 254988.6366; train_gene_expr_recon_loss: 107236.3402; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 366081.3293; train_optim_loss: 366081.3293; val_kl_reg_loss: 6271.5745; val_edge_recon_loss: 254964.2937; val_gene_expr_recon_loss: 185363.2819; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 446599.1503; val_optim_loss: 446599.1503
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9982; val_auprc_score: 0.9979; val_best_acc_score: 0.9857; val_best_f1_score: 0.9857; train_kl_reg_loss: 3822.9353; train_edge_recon_loss: 254831.4781; train_gene_expr_recon_loss: 107116.8926; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 365771.3062; train_optim_loss: 365771.3062; val_kl_reg_loss: 6208.1448; val_edge_recon_loss: 254917.6603; val_gene_expr_recon_loss: 165852.3768; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 426978.1821; val_optim_loss: 426978.1821
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9983; val_auprc_score: 0.9979; val_best_acc_score: 0.9857; val_best_f1_score: 0.9858; train_kl_reg_loss: 3813.6935; train_edge_recon_loss: 254846.5000; train_gene_expr_recon_loss: 107065.1716; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 365725.3652; train_optim_loss: 365725.3652; val_kl_reg_loss: 6243.0186; val_edge_recon_loss: 254889.9310; val_gene_expr_recon_loss: 183142.5319; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 444275.4821; val_optim_loss: 444275.4821
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9985; val_auprc_score: 0.9982; val_best_acc_score: 0.9868; val_best_f1_score: 0.9869; train_kl_reg_loss: 3811.7707; train_edge_recon_loss: 254795.9275; train_gene_expr_recon_loss: 106986.7057; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 365594.4039; train_optim_loss: 365594.4039; val_kl_reg_loss: 6266.1226; val_edge_recon_loss: 254738.3241; val_gene_expr_recon_loss: 193263.1650; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 454267.6113; val_optim_loss: 454267.6113
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9985; val_auprc_score: 0.9980; val_best_acc_score: 0.9864; val_best_f1_score: 0.9865; train_kl_reg_loss: 3808.8181; train_edge_recon_loss: 254768.8247; train_gene_expr_recon_loss: 107017.6010; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 365595.2437; train_optim_loss: 365595.2437; val_kl_reg_loss: 6206.1604; val_edge_recon_loss: 254854.2218; val_gene_expr_recon_loss: 196150.7004; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 457211.0822; val_optim_loss: 457211.0822
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9985; val_auprc_score: 0.9983; val_best_acc_score: 0.9867; val_best_f1_score: 0.9868; train_kl_reg_loss: 3807.4905; train_edge_recon_loss: 254801.9898; train_gene_expr_recon_loss: 106956.2005; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 365565.6810; train_optim_loss: 365565.6810; val_kl_reg_loss: 6267.0098; val_edge_recon_loss: 254827.6133; val_gene_expr_recon_loss: 194925.3031; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 456019.9260; val_optim_loss: 456019.9260

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9984; val_auprc_score: 0.9979; val_best_acc_score: 0.9866; val_best_f1_score: 0.9867; train_kl_reg_loss: 3802.0697; train_edge_recon_loss: 254709.4239; train_gene_expr_recon_loss: 106927.9019; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 365439.3955; train_optim_loss: 365439.3955; val_kl_reg_loss: 6176.0233; val_edge_recon_loss: 254884.1454; val_gene_expr_recon_loss: 197098.5449; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 458158.7134; val_optim_loss: 458158.7134
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9985; val_auprc_score: 0.9981; val_best_acc_score: 0.9867; val_best_f1_score: 0.9868; train_kl_reg_loss: 3797.8268; train_edge_recon_loss: 254708.0391; train_gene_expr_recon_loss: 106880.0275; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 365385.8936; train_optim_loss: 365385.8936; val_kl_reg_loss: 6181.5254; val_edge_recon_loss: 254730.2872; val_gene_expr_recon_loss: 201901.1549; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 462812.9669; val_optim_loss: 462812.9669
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9985; val_auprc_score: 0.9980; val_best_acc_score: 0.9869; val_best_f1_score: 0.9869; train_kl_reg_loss: 3796.2017; train_edge_recon_loss: 254678.7893; train_gene_expr_recon_loss: 106862.9496; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 365337.9405; train_optim_loss: 365337.9405; val_kl_reg_loss: 6163.1814; val_edge_recon_loss: 254761.9401; val_gene_expr_recon_loss: 198096.7066; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 459021.8282; val_optim_loss: 459021.8282
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9984; val_auprc_score: 0.9981; val_best_acc_score: 0.9869; val_best_f1_score: 0.9870; train_kl_reg_loss: 3798.2814; train_edge_recon_loss: 254695.8285; train_gene_expr_recon_loss: 106871.4658; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 365365.5756; train_optim_loss: 365365.5756; val_kl_reg_loss: 6129.4072; val_edge_recon_loss: 254673.6300; val_gene_expr_recon_loss: 193379.5708; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 454182.6086; val_optim_loss: 454182.6086

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 194 min 31 sec.
Using best model state, which was in epoch 10.

--- MODEL EVALUATION ---
val AUROC score: 0.9983
val AUPRC score: 0.9979
val best accuracy score: 0.9858
val best F1 score: 0.9859
val target rna MSE score: 3.8808
val source rna MSE score: 2.1047

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
