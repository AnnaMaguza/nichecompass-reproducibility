None
Run timestamp: 28072023_183805_83.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'xenium_human_breast_cancer', '--reference_batches', 'batch1', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '30', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_83']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_pred_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 313, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 313, n_latent: 1302, n_addon_latent: 10, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1302, n_cat_covariates_embed_input: 0, n_addon_gp_input: 10, n_output: 313
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1302, n_cat_covariates_embed_input: 0, n_addon_gp_input: 10, n_output: 313

--- INITIALIZING TRAINER ---
Number of training nodes: 147600
Number of validation nodes: 16400
Number of training edges: 995239
Number of validation edges: 110582
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9819; val_auprc_score: 0.9780; val_best_acc_score: 0.9391; val_best_f1_score: 0.9407; train_kl_reg_loss: 5267.1995; train_edge_recon_loss: 265163.5008; train_gene_expr_recon_loss: 13694.4330; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 284125.1334; train_optim_loss: 284125.1334; val_kl_reg_loss: 5139.4940; val_edge_recon_loss: 261589.7878; val_gene_expr_recon_loss: 12348.1404; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 279077.4209; val_optim_loss: 279077.4209
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9865; val_auprc_score: 0.9834; val_best_acc_score: 0.9492; val_best_f1_score: 0.9503; train_kl_reg_loss: 5326.3323; train_edge_recon_loss: 261180.4230; train_gene_expr_recon_loss: 11926.9464; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 278433.7014; train_optim_loss: 278433.7014; val_kl_reg_loss: 5207.1486; val_edge_recon_loss: 260759.2663; val_gene_expr_recon_loss: 11631.9941; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 277598.4083; val_optim_loss: 277598.4083
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9891; val_auprc_score: 0.9866; val_best_acc_score: 0.9569; val_best_f1_score: 0.9577; train_kl_reg_loss: 5356.3476; train_edge_recon_loss: 260232.2108; train_gene_expr_recon_loss: 11452.8836; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 277041.4425; train_optim_loss: 277041.4425; val_kl_reg_loss: 5385.5494; val_edge_recon_loss: 259845.4470; val_gene_expr_recon_loss: 11323.2046; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 276554.2005; val_optim_loss: 276554.2005
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9903; val_auprc_score: 0.9880; val_best_acc_score: 0.9603; val_best_f1_score: 0.9611; train_kl_reg_loss: 5369.2711; train_edge_recon_loss: 259795.8172; train_gene_expr_recon_loss: 11264.7024; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 276429.7906; train_optim_loss: 276429.7906; val_kl_reg_loss: 5385.9680; val_edge_recon_loss: 259757.9054; val_gene_expr_recon_loss: 11198.9551; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 276342.8283; val_optim_loss: 276342.8283
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9910; val_auprc_score: 0.9888; val_best_acc_score: 0.9621; val_best_f1_score: 0.9627; train_kl_reg_loss: 5382.5686; train_edge_recon_loss: 259495.9352; train_gene_expr_recon_loss: 11161.1834; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 276039.6868; train_optim_loss: 276039.6868; val_kl_reg_loss: 5354.5761; val_edge_recon_loss: 259190.2237; val_gene_expr_recon_loss: 11094.7362; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 275639.5354; val_optim_loss: 275639.5354
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9919; val_auprc_score: 0.9899; val_best_acc_score: 0.9644; val_best_f1_score: 0.9648; train_kl_reg_loss: 5398.2626; train_edge_recon_loss: 259250.8746; train_gene_expr_recon_loss: 11102.6812; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 275751.8184; train_optim_loss: 275751.8184; val_kl_reg_loss: 5288.0520; val_edge_recon_loss: 259171.0223; val_gene_expr_recon_loss: 11050.7279; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 275509.8021; val_optim_loss: 275509.8021
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9921; val_auprc_score: 0.9902; val_best_acc_score: 0.9653; val_best_f1_score: 0.9658; train_kl_reg_loss: 5406.2007; train_edge_recon_loss: 259078.0075; train_gene_expr_recon_loss: 11050.6640; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 275534.8722; train_optim_loss: 275534.8722; val_kl_reg_loss: 5116.8600; val_edge_recon_loss: 259043.9515; val_gene_expr_recon_loss: 11139.6703; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 275300.4835; val_optim_loss: 275300.4835
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9925; val_auprc_score: 0.9905; val_best_acc_score: 0.9668; val_best_f1_score: 0.9673; train_kl_reg_loss: 5411.1219; train_edge_recon_loss: 259047.6323; train_gene_expr_recon_loss: 11006.3679; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 275465.1216; train_optim_loss: 275465.1216; val_kl_reg_loss: 5482.7858; val_edge_recon_loss: 258895.5022; val_gene_expr_recon_loss: 11065.5037; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 275443.7909; val_optim_loss: 275443.7909
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9931; val_auprc_score: 0.9913; val_best_acc_score: 0.9691; val_best_f1_score: 0.9695; train_kl_reg_loss: 5426.5168; train_edge_recon_loss: 258713.8906; train_gene_expr_recon_loss: 10929.7445; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 275070.1518; train_optim_loss: 275070.1518; val_kl_reg_loss: 5307.4485; val_edge_recon_loss: 258539.5630; val_gene_expr_recon_loss: 8721.1810; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 272568.1929; val_optim_loss: 272568.1929
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9934; val_auprc_score: 0.9918; val_best_acc_score: 0.9689; val_best_f1_score: 0.9693; train_kl_reg_loss: 5433.6046; train_edge_recon_loss: 258603.2621; train_gene_expr_recon_loss: 10833.5818; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 274870.4488; train_optim_loss: 274870.4488; val_kl_reg_loss: 5477.6804; val_edge_recon_loss: 258735.8702; val_gene_expr_recon_loss: 11775.0145; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 275988.5645; val_optim_loss: 275988.5645
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9935; val_auprc_score: 0.9918; val_best_acc_score: 0.9702; val_best_f1_score: 0.9706; train_kl_reg_loss: 5439.8031; train_edge_recon_loss: 258516.9136; train_gene_expr_recon_loss: 10538.1564; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 274494.8730; train_optim_loss: 274494.8730; val_kl_reg_loss: 5432.2124; val_edge_recon_loss: 258382.6274; val_gene_expr_recon_loss: 7163.4196; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 270978.2597; val_optim_loss: 270978.2597
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9938; val_auprc_score: 0.9918; val_best_acc_score: 0.9721; val_best_f1_score: 0.9725; train_kl_reg_loss: 5445.0151; train_edge_recon_loss: 258412.1800; train_gene_expr_recon_loss: 9681.4044; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 273538.5999; train_optim_loss: 273538.5999; val_kl_reg_loss: 5411.7133; val_edge_recon_loss: 258271.6123; val_gene_expr_recon_loss: 7529.9844; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 271213.3102; val_optim_loss: 271213.3102
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9940; val_auprc_score: 0.9923; val_best_acc_score: 0.9724; val_best_f1_score: 0.9727; train_kl_reg_loss: 5445.7027; train_edge_recon_loss: 258268.9896; train_gene_expr_recon_loss: 8024.3910; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 271739.0842; train_optim_loss: 271739.0842; val_kl_reg_loss: 5425.7732; val_edge_recon_loss: 258258.7517; val_gene_expr_recon_loss: 5981.9658; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 269666.4913; val_optim_loss: 269666.4913
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9938; val_auprc_score: 0.9919; val_best_acc_score: 0.9724; val_best_f1_score: 0.9727; train_kl_reg_loss: 5451.9041; train_edge_recon_loss: 258289.4870; train_gene_expr_recon_loss: 8757.8617; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 272499.2529; train_optim_loss: 272499.2529; val_kl_reg_loss: 5528.5830; val_edge_recon_loss: 258392.6664; val_gene_expr_recon_loss: 9166.2904; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 273087.5389; val_optim_loss: 273087.5389
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9941; val_auprc_score: 0.9923; val_best_acc_score: 0.9729; val_best_f1_score: 0.9733; train_kl_reg_loss: 5454.7512; train_edge_recon_loss: 258176.2611; train_gene_expr_recon_loss: 9633.7834; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 273264.7960; train_optim_loss: 273264.7960; val_kl_reg_loss: 5461.9595; val_edge_recon_loss: 257823.3496; val_gene_expr_recon_loss: 9822.9153; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 273108.2251; val_optim_loss: 273108.2251
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9946; val_auprc_score: 0.9929; val_best_acc_score: 0.9737; val_best_f1_score: 0.9740; train_kl_reg_loss: 5459.8917; train_edge_recon_loss: 258170.7474; train_gene_expr_recon_loss: 9706.2456; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 273336.8847; train_optim_loss: 273336.8847; val_kl_reg_loss: 5434.9896; val_edge_recon_loss: 258073.7823; val_gene_expr_recon_loss: 9266.4500; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 272775.2209; val_optim_loss: 272775.2209
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9941; val_auprc_score: 0.9923; val_best_acc_score: 0.9735; val_best_f1_score: 0.9739; train_kl_reg_loss: 5465.1451; train_edge_recon_loss: 258071.9414; train_gene_expr_recon_loss: 9908.0978; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 273445.1843; train_optim_loss: 273445.1843; val_kl_reg_loss: 5403.9908; val_edge_recon_loss: 257940.8759; val_gene_expr_recon_loss: 9917.4193; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 273262.2873; val_optim_loss: 273262.2873

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9947; val_auprc_score: 0.9930; val_best_acc_score: 0.9753; val_best_f1_score: 0.9755; train_kl_reg_loss: 5452.2703; train_edge_recon_loss: 257730.9845; train_gene_expr_recon_loss: 9911.5179; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 273094.7724; train_optim_loss: 273094.7724; val_kl_reg_loss: 5421.5139; val_edge_recon_loss: 257743.7065; val_gene_expr_recon_loss: 9915.0447; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 273080.2632; val_optim_loss: 273080.2632
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9950; val_auprc_score: 0.9934; val_best_acc_score: 0.9760; val_best_f1_score: 0.9763; train_kl_reg_loss: 5448.3531; train_edge_recon_loss: 257784.7965; train_gene_expr_recon_loss: 9903.4522; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 273136.6016; train_optim_loss: 273136.6016; val_kl_reg_loss: 5401.8775; val_edge_recon_loss: 257643.6810; val_gene_expr_recon_loss: 9915.4359; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 272960.9935; val_optim_loss: 272960.9935
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9952; val_auprc_score: 0.9937; val_best_acc_score: 0.9763; val_best_f1_score: 0.9765; train_kl_reg_loss: 5444.1262; train_edge_recon_loss: 257715.6248; train_gene_expr_recon_loss: 9897.7622; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 273057.5136; train_optim_loss: 273057.5136; val_kl_reg_loss: 5417.2943; val_edge_recon_loss: 257483.5687; val_gene_expr_recon_loss: 9881.7049; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 272782.5673; val_optim_loss: 272782.5673
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9951; val_auprc_score: 0.9936; val_best_acc_score: 0.9761; val_best_f1_score: 0.9763; train_kl_reg_loss: 5441.7016; train_edge_recon_loss: 257659.2534; train_gene_expr_recon_loss: 9891.9523; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 272992.9072; train_optim_loss: 272992.9072; val_kl_reg_loss: 5408.8323; val_edge_recon_loss: 257544.7690; val_gene_expr_recon_loss: 9903.7133; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 272857.3151; val_optim_loss: 272857.3151

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 158 min 36 sec.
Using best model state, which was in epoch 13.

--- MODEL EVALUATION ---
val AUROC score: 0.9941
val AUPRC score: 0.9923
val best accuracy score: 0.9728
val best F1 score: 0.9732
val target rna MSE score: 1.5959
val source rna MSE score: 0.1808

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
