None
Run timestamp: 19072023_130108_1.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'xenium_human_breast_cancer', '--reference_batches', 'batch1', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'neighbor_sampling_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000000', '--lambda_gene_expr_recon', '30000', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '2', '--timestamp_suffix', '_1']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 313, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 313, n_latent: 1302, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1302, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 626
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 147600
Number of validation nodes: 16400
Number of training edges: 348099
Number of validation edges: 38677
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9172; val_auprc_score: 0.8949; val_best_acc_score: 0.8505; val_best_f1_score: 0.8604; train_kl_reg_loss: 46833.4457; train_edge_recon_loss: 27290103.1206; train_gene_expr_recon_loss: 7720052.6125; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 35056989.2647; train_optim_loss: 35056989.2647; val_kl_reg_loss: 50291.9380; val_edge_recon_loss: 27243709.5000; val_gene_expr_recon_loss: 7000030.0789; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 34294031.4737; val_optim_loss: 34294031.4737
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9306; val_auprc_score: 0.9105; val_best_acc_score: 0.8675; val_best_f1_score: 0.8766; train_kl_reg_loss: 49113.9923; train_edge_recon_loss: 26383442.5235; train_gene_expr_recon_loss: 6787022.1316; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 33219578.6676; train_optim_loss: 33219578.6676; val_kl_reg_loss: 46101.2808; val_edge_recon_loss: 27117689.6316; val_gene_expr_recon_loss: 6600037.8553; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33763828.9211; val_optim_loss: 33763828.9211
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9397; val_auprc_score: 0.9252; val_best_acc_score: 0.8762; val_best_f1_score: 0.8834; train_kl_reg_loss: 43968.7736; train_edge_recon_loss: 26287493.0882; train_gene_expr_recon_loss: 6476080.0779; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 32807542.0294; train_optim_loss: 32807542.0294; val_kl_reg_loss: 39885.7572; val_edge_recon_loss: 27100074.3421; val_gene_expr_recon_loss: 6323473.3684; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33463433.2895; val_optim_loss: 33463433.2895
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9450; val_auprc_score: 0.9334; val_best_acc_score: 0.8801; val_best_f1_score: 0.8858; train_kl_reg_loss: 40495.3216; train_edge_recon_loss: 26220418.6500; train_gene_expr_recon_loss: 6259485.9456; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 32520399.9206; train_optim_loss: 32520399.9206; val_kl_reg_loss: 38541.9534; val_edge_recon_loss: 27049554.7895; val_gene_expr_recon_loss: 6181295.2039; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33269391.8947; val_optim_loss: 33269391.8947
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9515; val_auprc_score: 0.9405; val_best_acc_score: 0.8888; val_best_f1_score: 0.8941; train_kl_reg_loss: 38985.1627; train_edge_recon_loss: 26167855.5235; train_gene_expr_recon_loss: 6103052.1029; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 32309892.8000; train_optim_loss: 32309892.8000; val_kl_reg_loss: 37258.7419; val_edge_recon_loss: 26959009.8158; val_gene_expr_recon_loss: 6060879.2829; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33057147.9737; val_optim_loss: 33057147.9737
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9525; val_auprc_score: 0.9422; val_best_acc_score: 0.8896; val_best_f1_score: 0.8942; train_kl_reg_loss: 38151.3046; train_edge_recon_loss: 26144495.4971; train_gene_expr_recon_loss: 5997464.5103; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 32180111.2853; train_optim_loss: 32180111.2853; val_kl_reg_loss: 37739.2209; val_edge_recon_loss: 27136381.3158; val_gene_expr_recon_loss: 6088584.8158; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 33262705.0526; val_optim_loss: 33262705.0526
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9574; val_auprc_score: 0.9498; val_best_acc_score: 0.8949; val_best_f1_score: 0.8991; train_kl_reg_loss: 36571.1150; train_edge_recon_loss: 26106139.3118; train_gene_expr_recon_loss: 5927046.2721; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 32069756.6471; train_optim_loss: 32069756.6471; val_kl_reg_loss: 34848.0162; val_edge_recon_loss: 26972796.5526; val_gene_expr_recon_loss: 5903712.1513; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32911356.6053; val_optim_loss: 32911356.6053
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9587; val_auprc_score: 0.9505; val_best_acc_score: 0.8989; val_best_f1_score: 0.9026; train_kl_reg_loss: 35999.1328; train_edge_recon_loss: 26075719.3353; train_gene_expr_recon_loss: 5874162.9176; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31985881.3471; train_optim_loss: 31985881.3471; val_kl_reg_loss: 35076.3133; val_edge_recon_loss: 26964657.6316; val_gene_expr_recon_loss: 5842833.7961; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32842567.6579; val_optim_loss: 32842567.6579
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9601; val_auprc_score: 0.9517; val_best_acc_score: 0.9023; val_best_f1_score: 0.9060; train_kl_reg_loss: 36372.1402; train_edge_recon_loss: 26084367.3824; train_gene_expr_recon_loss: 5830079.7257; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31950819.2324; train_optim_loss: 31950819.2324; val_kl_reg_loss: 35062.7019; val_edge_recon_loss: 26932851.0263; val_gene_expr_recon_loss: 5815915.7039; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32783829.4474; val_optim_loss: 32783829.4474
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9621; val_auprc_score: 0.9551; val_best_acc_score: 0.9029; val_best_f1_score: 0.9068; train_kl_reg_loss: 36060.3879; train_edge_recon_loss: 26059056.1794; train_gene_expr_recon_loss: 5799519.6500; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31894636.1618; train_optim_loss: 31894636.1618; val_kl_reg_loss: 34914.4496; val_edge_recon_loss: 26918911.2895; val_gene_expr_recon_loss: 5800300.7237; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32754126.5000; val_optim_loss: 32754126.5000
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9613; val_auprc_score: 0.9537; val_best_acc_score: 0.9017; val_best_f1_score: 0.9051; train_kl_reg_loss: 36409.7743; train_edge_recon_loss: 26048879.3353; train_gene_expr_recon_loss: 5772872.8934; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31858161.9618; train_optim_loss: 31858161.9618; val_kl_reg_loss: 35491.8757; val_edge_recon_loss: 26922257.5000; val_gene_expr_recon_loss: 5762630.1842; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32720379.5789; val_optim_loss: 32720379.5789
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9619; val_auprc_score: 0.9544; val_best_acc_score: 0.9012; val_best_f1_score: 0.9057; train_kl_reg_loss: 36138.7228; train_edge_recon_loss: 26024945.3471; train_gene_expr_recon_loss: 5758904.2404; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31819988.3147; train_optim_loss: 31819988.3147; val_kl_reg_loss: 34793.0644; val_edge_recon_loss: 26942813.1842; val_gene_expr_recon_loss: 5752895.8355; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32730502.0000; val_optim_loss: 32730502.0000
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9626; val_auprc_score: 0.9542; val_best_acc_score: 0.9055; val_best_f1_score: 0.9092; train_kl_reg_loss: 35682.1487; train_edge_recon_loss: 26039003.0647; train_gene_expr_recon_loss: 5736891.6441; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31811576.8324; train_optim_loss: 31811576.8324; val_kl_reg_loss: 35144.2577; val_edge_recon_loss: 26881386.7105; val_gene_expr_recon_loss: 5748462.4868; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32664993.5263; val_optim_loss: 32664993.5263
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9648; val_auprc_score: 0.9581; val_best_acc_score: 0.9076; val_best_f1_score: 0.9112; train_kl_reg_loss: 35383.4531; train_edge_recon_loss: 26031298.9559; train_gene_expr_recon_loss: 5730752.5221; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31797434.9000; train_optim_loss: 31797434.9000; val_kl_reg_loss: 34065.9223; val_edge_recon_loss: 26817800.7632; val_gene_expr_recon_loss: 5720423.0855; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32572289.8158; val_optim_loss: 32572289.8158
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9648; val_auprc_score: 0.9574; val_best_acc_score: 0.9087; val_best_f1_score: 0.9116; train_kl_reg_loss: 35161.3206; train_edge_recon_loss: 26003373.3382; train_gene_expr_recon_loss: 5714935.0632; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31753469.6412; train_optim_loss: 31753469.6412; val_kl_reg_loss: 33656.0799; val_edge_recon_loss: 26853638.0789; val_gene_expr_recon_loss: 5709119.2763; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32596413.4737; val_optim_loss: 32596413.4737
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9643; val_auprc_score: 0.9568; val_best_acc_score: 0.9081; val_best_f1_score: 0.9115; train_kl_reg_loss: 34864.5879; train_edge_recon_loss: 25992176.1441; train_gene_expr_recon_loss: 5704546.7522; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31731587.4824; train_optim_loss: 31731587.4824; val_kl_reg_loss: 33930.0354; val_edge_recon_loss: 26859841.2895; val_gene_expr_recon_loss: 5710959.4408; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32604730.8158; val_optim_loss: 32604730.8158
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9654; val_auprc_score: 0.9585; val_best_acc_score: 0.9095; val_best_f1_score: 0.9130; train_kl_reg_loss: 34533.1564; train_edge_recon_loss: 25976709.5912; train_gene_expr_recon_loss: 5699994.1647; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31711236.9235; train_optim_loss: 31711236.9235; val_kl_reg_loss: 33276.3720; val_edge_recon_loss: 26833585.2105; val_gene_expr_recon_loss: 5690785.9079; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32557647.5000; val_optim_loss: 32557647.5000
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9661; val_auprc_score: 0.9585; val_best_acc_score: 0.9111; val_best_f1_score: 0.9146; train_kl_reg_loss: 34576.7331; train_edge_recon_loss: 25982098.2500; train_gene_expr_recon_loss: 5691226.1507; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31707901.1500; train_optim_loss: 31707901.1500; val_kl_reg_loss: 33101.5667; val_edge_recon_loss: 26766665.1842; val_gene_expr_recon_loss: 5701966.3355; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32501733.0526; val_optim_loss: 32501733.0526
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9668; val_auprc_score: 0.9596; val_best_acc_score: 0.9120; val_best_f1_score: 0.9151; train_kl_reg_loss: 33775.7018; train_edge_recon_loss: 25976601.0412; train_gene_expr_recon_loss: 5682358.7426; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31692735.5353; train_optim_loss: 31692735.5353; val_kl_reg_loss: 33631.7909; val_edge_recon_loss: 26804108.0000; val_gene_expr_recon_loss: 5678289.5329; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32516029.3158; val_optim_loss: 32516029.3158
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9651; val_auprc_score: 0.9577; val_best_acc_score: 0.9105; val_best_f1_score: 0.9130; train_kl_reg_loss: 33910.5872; train_edge_recon_loss: 25965834.3412; train_gene_expr_recon_loss: 5675986.7654; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31675731.7088; train_optim_loss: 31675731.7088; val_kl_reg_loss: 33113.2402; val_edge_recon_loss: 26897240.3947; val_gene_expr_recon_loss: 5694539.9079; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32624893.5000; val_optim_loss: 32624893.5000
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9667; val_auprc_score: 0.9596; val_best_acc_score: 0.9114; val_best_f1_score: 0.9144; train_kl_reg_loss: 34018.2014; train_edge_recon_loss: 25960256.1353; train_gene_expr_recon_loss: 5669813.0743; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31664087.4294; train_optim_loss: 31664087.4294; val_kl_reg_loss: 33216.7918; val_edge_recon_loss: 26848140.4474; val_gene_expr_recon_loss: 5688174.3816; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32569531.6316; val_optim_loss: 32569531.6316
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9677; val_auprc_score: 0.9594; val_best_acc_score: 0.9149; val_best_f1_score: 0.9179; train_kl_reg_loss: 33589.2286; train_edge_recon_loss: 25949577.5824; train_gene_expr_recon_loss: 5668448.4404; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31651615.2559; train_optim_loss: 31651615.2559; val_kl_reg_loss: 33165.9661; val_edge_recon_loss: 26808159.2895; val_gene_expr_recon_loss: 5686893.8750; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32528219.1053; val_optim_loss: 32528219.1053

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.9676; val_auprc_score: 0.9606; val_best_acc_score: 0.9136; val_best_f1_score: 0.9166; train_kl_reg_loss: 33756.2564; train_edge_recon_loss: 25939458.2706; train_gene_expr_recon_loss: 5610711.8794; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31583926.4029; train_optim_loss: 31583926.4029; val_kl_reg_loss: 33025.0815; val_edge_recon_loss: 26844441.7632; val_gene_expr_recon_loss: 5612955.0526; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32490421.6842; val_optim_loss: 32490421.6842
Epoch 24/100 |████----------------| 24.0% val_auroc_score: 0.9677; val_auprc_score: 0.9605; val_best_acc_score: 0.9143; val_best_f1_score: 0.9171; train_kl_reg_loss: 33957.7598; train_edge_recon_loss: 25950720.5529; train_gene_expr_recon_loss: 5605218.5096; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31589896.8206; train_optim_loss: 31589896.8206; val_kl_reg_loss: 33345.8941; val_edge_recon_loss: 26811129.6053; val_gene_expr_recon_loss: 5621974.3158; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32466449.6842; val_optim_loss: 32466449.6842
Epoch 25/100 |█████---------------| 25.0% val_auroc_score: 0.9668; val_auprc_score: 0.9596; val_best_acc_score: 0.9122; val_best_f1_score: 0.9153; train_kl_reg_loss: 34181.0079; train_edge_recon_loss: 25938752.3676; train_gene_expr_recon_loss: 5605108.9897; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 31578042.4000; train_optim_loss: 31578042.4000; val_kl_reg_loss: 33196.5006; val_edge_recon_loss: 26876263.5526; val_gene_expr_recon_loss: 5640316.7961; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 32549776.8421; val_optim_loss: 32549776.8421
