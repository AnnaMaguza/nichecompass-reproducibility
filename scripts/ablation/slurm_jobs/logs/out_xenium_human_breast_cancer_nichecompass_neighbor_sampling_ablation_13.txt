None
Run timestamp: 25072023_022848_13.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'xenium_human_breast_cancer', '--reference_batches', 'batch1', '--n_neighbors', '20', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'neighbor_sampling_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '5000000', '--lambda_gene_expr_recon', '3000', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '256', '--node_batch_size', 'None', '--n_sampled_neighbors', '2', '--timestamp_suffix', '_13']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 313, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 313, n_latent: 1302, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1302, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 626
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 147600
Number of validation nodes: 16400
Number of training edges: 1643088
Number of validation edges: 182565
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9797; val_auprc_score: 0.9776; val_best_acc_score: 0.9288; val_best_f1_score: 0.9304; train_kl_reg_loss: 14710.4759; train_edge_recon_loss: 2640558.7197; train_gene_expr_recon_loss: 709027.7137; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3364296.9114; train_optim_loss: 3364296.9114; val_kl_reg_loss: 13406.4506; val_edge_recon_loss: 2642642.4118; val_gene_expr_recon_loss: 666311.7927; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3322360.6548; val_optim_loss: 3322360.6548
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9839; val_auprc_score: 0.9819; val_best_acc_score: 0.9384; val_best_f1_score: 0.9396; train_kl_reg_loss: 12872.3036; train_edge_recon_loss: 2605386.3541; train_gene_expr_recon_loss: 657373.4057; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3275632.0634; train_optim_loss: 3275632.0634; val_kl_reg_loss: 12549.8207; val_edge_recon_loss: 2638030.4727; val_gene_expr_recon_loss: 651963.3989; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3302543.6929; val_optim_loss: 3302543.6929
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9862; val_auprc_score: 0.9843; val_best_acc_score: 0.9441; val_best_f1_score: 0.9451; train_kl_reg_loss: 12710.6216; train_edge_recon_loss: 2599774.5065; train_gene_expr_recon_loss: 647640.1204; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3260125.2488; train_optim_loss: 3260125.2488; val_kl_reg_loss: 12073.4907; val_edge_recon_loss: 2634536.2195; val_gene_expr_recon_loss: 645676.3443; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3292286.0553; val_optim_loss: 3292286.0553
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9865; val_auprc_score: 0.9847; val_best_acc_score: 0.9450; val_best_f1_score: 0.9459; train_kl_reg_loss: 12724.9617; train_edge_recon_loss: 2595448.5969; train_gene_expr_recon_loss: 643048.3638; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3251221.9212; train_optim_loss: 3251221.9212; val_kl_reg_loss: 12536.2286; val_edge_recon_loss: 2631415.5431; val_gene_expr_recon_loss: 642505.5522; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3286457.3249; val_optim_loss: 3286457.3249
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9876; val_auprc_score: 0.9857; val_best_acc_score: 0.9486; val_best_f1_score: 0.9494; train_kl_reg_loss: 12694.0374; train_edge_recon_loss: 2593830.7433; train_gene_expr_recon_loss: 640783.8040; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3247308.5855; train_optim_loss: 3247308.5855; val_kl_reg_loss: 12407.6432; val_edge_recon_loss: 2627118.9755; val_gene_expr_recon_loss: 639654.7846; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3279181.3992; val_optim_loss: 3279181.3992
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9879; val_auprc_score: 0.9863; val_best_acc_score: 0.9494; val_best_f1_score: 0.9502; train_kl_reg_loss: 12666.4846; train_edge_recon_loss: 2591956.4935; train_gene_expr_recon_loss: 638839.9708; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3243462.9493; train_optim_loss: 3243462.9493; val_kl_reg_loss: 12380.9003; val_edge_recon_loss: 2625028.7276; val_gene_expr_recon_loss: 638266.5748; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3275676.2055; val_optim_loss: 3275676.2055
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9884; val_auprc_score: 0.9869; val_best_acc_score: 0.9501; val_best_f1_score: 0.9507; train_kl_reg_loss: 12634.1442; train_edge_recon_loss: 2591072.4131; train_gene_expr_recon_loss: 636162.9739; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3239869.5296; train_optim_loss: 3239869.5296; val_kl_reg_loss: 12218.0516; val_edge_recon_loss: 2623861.0137; val_gene_expr_recon_loss: 625814.0167; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3261893.0872; val_optim_loss: 3261893.0872
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9885; val_auprc_score: 0.9870; val_best_acc_score: 0.9502; val_best_f1_score: 0.9509; train_kl_reg_loss: 12614.6443; train_edge_recon_loss: 2589233.6783; train_gene_expr_recon_loss: 638497.0653; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3240345.3872; train_optim_loss: 3240345.3872; val_kl_reg_loss: 12435.6745; val_edge_recon_loss: 2621890.9758; val_gene_expr_recon_loss: 707498.0975; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3341824.7511; val_optim_loss: 3341824.7511
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9883; val_auprc_score: 0.9865; val_best_acc_score: 0.9508; val_best_f1_score: 0.9515; train_kl_reg_loss: 12594.1070; train_edge_recon_loss: 2588171.8531; train_gene_expr_recon_loss: 647140.3746; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3247906.3342; train_optim_loss: 3247906.3342; val_kl_reg_loss: 12744.9278; val_edge_recon_loss: 2619500.5931; val_gene_expr_recon_loss: 573392.7002; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3205638.2199; val_optim_loss: 3205638.2199
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9889; val_auprc_score: 0.9873; val_best_acc_score: 0.9516; val_best_f1_score: 0.9522; train_kl_reg_loss: 12557.9639; train_edge_recon_loss: 2587803.6601; train_gene_expr_recon_loss: 645791.7612; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3246153.3840; train_optim_loss: 3246153.3840; val_kl_reg_loss: 12278.9601; val_edge_recon_loss: 2620755.4398; val_gene_expr_recon_loss: 612369.6615; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3245404.0641; val_optim_loss: 3245404.0641
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9889; val_auprc_score: 0.9871; val_best_acc_score: 0.9513; val_best_f1_score: 0.9521; train_kl_reg_loss: 12585.0995; train_edge_recon_loss: 2587055.9063; train_gene_expr_recon_loss: 598154.0856; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3197795.0903; train_optim_loss: 3197795.0903; val_kl_reg_loss: 12290.4864; val_edge_recon_loss: 2631877.3032; val_gene_expr_recon_loss: 541382.3593; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3185550.1453; val_optim_loss: 3185550.1453
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9892; val_auprc_score: 0.9875; val_best_acc_score: 0.9526; val_best_f1_score: 0.9533; train_kl_reg_loss: 12532.6446; train_edge_recon_loss: 2586127.6372; train_gene_expr_recon_loss: 582413.7644; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3181074.0480; train_optim_loss: 3181074.0480; val_kl_reg_loss: 12287.6258; val_edge_recon_loss: 2618286.6257; val_gene_expr_recon_loss: 589085.2391; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3219659.4916; val_optim_loss: 3219659.4916
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9889; val_auprc_score: 0.9870; val_best_acc_score: 0.9520; val_best_f1_score: 0.9528; train_kl_reg_loss: 12524.4457; train_edge_recon_loss: 2585905.6704; train_gene_expr_recon_loss: 577283.5641; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3175713.6785; train_optim_loss: 3175713.6785; val_kl_reg_loss: 12262.6101; val_edge_recon_loss: 2618642.4884; val_gene_expr_recon_loss: 582149.2371; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3213054.3319; val_optim_loss: 3213054.3319
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9896; val_auprc_score: 0.9879; val_best_acc_score: 0.9539; val_best_f1_score: 0.9545; train_kl_reg_loss: 12524.2617; train_edge_recon_loss: 2585238.2149; train_gene_expr_recon_loss: 575727.1483; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3173489.6254; train_optim_loss: 3173489.6254; val_kl_reg_loss: 12379.3132; val_edge_recon_loss: 2617846.1968; val_gene_expr_recon_loss: 578744.4473; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3208969.9611; val_optim_loss: 3208969.9611
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9891; val_auprc_score: 0.9872; val_best_acc_score: 0.9534; val_best_f1_score: 0.9541; train_kl_reg_loss: 12528.9153; train_edge_recon_loss: 2585303.5355; train_gene_expr_recon_loss: 576903.3327; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3174735.7846; train_optim_loss: 3174735.7846; val_kl_reg_loss: 12312.1039; val_edge_recon_loss: 2619525.5098; val_gene_expr_recon_loss: 579033.6693; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3210871.2791; val_optim_loss: 3210871.2791

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9903; val_auprc_score: 0.9889; val_best_acc_score: 0.9555; val_best_f1_score: 0.9559; train_kl_reg_loss: 12973.8615; train_edge_recon_loss: 2582266.2825; train_gene_expr_recon_loss: 565979.2601; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3161219.4031; train_optim_loss: 3161219.4031; val_kl_reg_loss: 12850.0254; val_edge_recon_loss: 2615233.7948; val_gene_expr_recon_loss: 566376.2140; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3194460.0347; val_optim_loss: 3194460.0347
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9908; val_auprc_score: 0.9894; val_best_acc_score: 0.9568; val_best_f1_score: 0.9574; train_kl_reg_loss: 13046.1655; train_edge_recon_loss: 2581244.8682; train_gene_expr_recon_loss: 565893.7304; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3160184.7643; train_optim_loss: 3160184.7643; val_kl_reg_loss: 12823.5983; val_edge_recon_loss: 2610484.4793; val_gene_expr_recon_loss: 583735.6178; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3207043.6964; val_optim_loss: 3207043.6964
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9907; val_auprc_score: 0.9894; val_best_acc_score: 0.9571; val_best_f1_score: 0.9577; train_kl_reg_loss: 13031.0267; train_edge_recon_loss: 2581943.2813; train_gene_expr_recon_loss: 562003.8688; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3156978.1764; train_optim_loss: 3156978.1764; val_kl_reg_loss: 12773.9934; val_edge_recon_loss: 2610768.3372; val_gene_expr_recon_loss: 592837.5461; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3216379.8750; val_optim_loss: 3216379.8750
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9909; val_auprc_score: 0.9895; val_best_acc_score: 0.9573; val_best_f1_score: 0.9579; train_kl_reg_loss: 12999.3391; train_edge_recon_loss: 2580511.9107; train_gene_expr_recon_loss: 564378.7532; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3157890.0035; train_optim_loss: 3157890.0035; val_kl_reg_loss: 12655.9462; val_edge_recon_loss: 2611506.9597; val_gene_expr_recon_loss: 579836.5519; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3203999.4576; val_optim_loss: 3203999.4576

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 90 min 12 sec.
Using best model state, which was in epoch 11.

--- MODEL EVALUATION ---
Val AUROC score: 0.9888
Val AUPRC score: 0.9873
Val best accuracy score: 0.9509
Val best F1 score: 0.9516
Val gene expr MSE score: 1.7766

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
