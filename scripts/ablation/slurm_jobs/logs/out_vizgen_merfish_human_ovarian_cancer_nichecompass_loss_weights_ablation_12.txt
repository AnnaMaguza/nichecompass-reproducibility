None
Run timestamp: 05072023_224052_12.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'vizgen_merfish_human_ovarian_cancer', '--reference_batches', 'batch2', '--n_neighbors', '16', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '0.01', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '0', '--lambda_gene_expr_recon', '300', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--timestamp_suffix', '_12']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1690.

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 500, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 500, n_latent: 1370, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1370, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 1000
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 210667
Number of validation nodes: 23407
Number of training edges: 1931624
Number of validation edges: 214624
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9660; val_auprc_score: 0.9705; val_best_acc_score: 0.8990; val_best_f1_score: 0.8991; train_kl_reg_loss: 3270.0035; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 136758.2469; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 140028.2504; train_optim_loss: 140028.2504; val_kl_reg_loss: 2197.6216; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 129756.1637; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 131953.7852; val_optim_loss: 131953.7852
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9708; val_auprc_score: 0.9750; val_best_acc_score: 0.9101; val_best_f1_score: 0.9073; train_kl_reg_loss: 2109.9576; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 128863.6123; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 130973.5697; train_optim_loss: 130973.5697; val_kl_reg_loss: 2008.8690; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 127936.3600; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 129945.2288; val_optim_loss: 129945.2288
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9714; val_auprc_score: 0.9757; val_best_acc_score: 0.9101; val_best_f1_score: 0.9094; train_kl_reg_loss: 1960.1759; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 127782.6256; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 129742.8015; train_optim_loss: 129742.8015; val_kl_reg_loss: 1869.5005; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 127386.5162; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 129256.0164; val_optim_loss: 129256.0164
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9748; val_auprc_score: 0.9786; val_best_acc_score: 0.9188; val_best_f1_score: 0.9161; train_kl_reg_loss: 1900.1647; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 126987.8681; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 128888.0327; train_optim_loss: 128888.0327; val_kl_reg_loss: 1863.4912; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 126559.3600; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 128422.8509; val_optim_loss: 128422.8509
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9772; val_auprc_score: 0.9805; val_best_acc_score: 0.9230; val_best_f1_score: 0.9218; train_kl_reg_loss: 1866.4746; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 122812.0394; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 124678.5139; train_optim_loss: 124678.5139; val_kl_reg_loss: 1753.1693; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 124226.4627; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 125979.6321; val_optim_loss: 125979.6321
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9790; val_auprc_score: 0.9822; val_best_acc_score: 0.9272; val_best_f1_score: 0.9245; train_kl_reg_loss: 1844.4273; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 113974.2293; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 115818.6566; train_optim_loss: 115818.6566; val_kl_reg_loss: 1756.9757; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 107882.7725; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 109639.7482; val_optim_loss: 109639.7482
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9809; val_auprc_score: 0.9837; val_best_acc_score: 0.9305; val_best_f1_score: 0.9300; train_kl_reg_loss: 1830.3369; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 107747.1698; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 109577.5068; train_optim_loss: 109577.5068; val_kl_reg_loss: 1794.1829; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 107287.3813; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 109081.5640; val_optim_loss: 109081.5640
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9828; val_auprc_score: 0.9853; val_best_acc_score: 0.9363; val_best_f1_score: 0.9350; train_kl_reg_loss: 1821.5779; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 106692.8613; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 108514.4392; train_optim_loss: 108514.4392; val_kl_reg_loss: 1863.0950; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 106971.2335; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 108834.3285; val_optim_loss: 108834.3285
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9838; val_auprc_score: 0.9864; val_best_acc_score: 0.9373; val_best_f1_score: 0.9369; train_kl_reg_loss: 1814.5161; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 106534.1229; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 108348.6390; train_optim_loss: 108348.6390; val_kl_reg_loss: 1728.8520; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 106880.6465; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 108609.4985; val_optim_loss: 108609.4985
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9845; val_auprc_score: 0.9868; val_best_acc_score: 0.9404; val_best_f1_score: 0.9394; train_kl_reg_loss: 1808.5165; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 106392.8238; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 108201.3403; train_optim_loss: 108201.3403; val_kl_reg_loss: 1836.7191; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 106671.9870; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 108508.7060; val_optim_loss: 108508.7060
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9841; val_auprc_score: 0.9866; val_best_acc_score: 0.9389; val_best_f1_score: 0.9370; train_kl_reg_loss: 1802.6280; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 106299.1038; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 108101.7318; train_optim_loss: 108101.7318; val_kl_reg_loss: 1787.9813; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 106668.9844; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 108456.9658; val_optim_loss: 108456.9658
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9855; val_auprc_score: 0.9877; val_best_acc_score: 0.9421; val_best_f1_score: 0.9402; train_kl_reg_loss: 1798.4942; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 106100.9097; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 107899.4040; train_optim_loss: 107899.4040; val_kl_reg_loss: 1829.1309; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 103925.5725; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 105754.7035; val_optim_loss: 105754.7035
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9858; val_auprc_score: 0.9879; val_best_acc_score: 0.9433; val_best_f1_score: 0.9427; train_kl_reg_loss: 1796.2717; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 105796.8202; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 107593.0919; train_optim_loss: 107593.0919; val_kl_reg_loss: 1779.0209; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 106015.3358; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 107794.3566; val_optim_loss: 107794.3566
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9859; val_auprc_score: 0.9881; val_best_acc_score: 0.9439; val_best_f1_score: 0.9430; train_kl_reg_loss: 1794.1450; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 105852.1792; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 107646.3242; train_optim_loss: 107646.3242; val_kl_reg_loss: 1804.6360; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 106875.9086; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 108680.5446; val_optim_loss: 108680.5446
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9867; val_auprc_score: 0.9887; val_best_acc_score: 0.9453; val_best_f1_score: 0.9437; train_kl_reg_loss: 1793.4763; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 105175.7288; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 106969.2050; train_optim_loss: 106969.2050; val_kl_reg_loss: 1799.9934; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 105668.3003; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 107468.2935; val_optim_loss: 107468.2935
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9874; val_auprc_score: 0.9893; val_best_acc_score: 0.9478; val_best_f1_score: 0.9469; train_kl_reg_loss: 1792.4064; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 105086.3369; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 106878.7434; train_optim_loss: 106878.7434; val_kl_reg_loss: 1696.4456; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 105582.3656; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 107278.8113; val_optim_loss: 107278.8113

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9890; val_auprc_score: 0.9907; val_best_acc_score: 0.9511; val_best_f1_score: 0.9506; train_kl_reg_loss: 1790.9506; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 104387.2005; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 106178.1511; train_optim_loss: 106178.1511; val_kl_reg_loss: 1783.4148; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 104965.1784; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 106748.5932; val_optim_loss: 106748.5932
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9894; val_auprc_score: 0.9910; val_best_acc_score: 0.9529; val_best_f1_score: 0.9523; train_kl_reg_loss: 1787.6524; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 104269.1885; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 106056.8410; train_optim_loss: 106056.8410; val_kl_reg_loss: 1760.9585; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 105414.9158; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 107175.8742; val_optim_loss: 107175.8742
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9897; val_auprc_score: 0.9912; val_best_acc_score: 0.9545; val_best_f1_score: 0.9538; train_kl_reg_loss: 1787.1241; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 104249.4605; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 106036.5847; train_optim_loss: 106036.5847; val_kl_reg_loss: 1774.2613; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 105397.5701; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 107171.8316; val_optim_loss: 107171.8316
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9903; val_auprc_score: 0.9918; val_best_acc_score: 0.9561; val_best_f1_score: 0.9553; train_kl_reg_loss: 1787.0108; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 104197.6480; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 105984.6588; train_optim_loss: 105984.6588; val_kl_reg_loss: 1783.1797; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 105372.0360; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 107155.2157; val_optim_loss: 107155.2157

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 397 min 47 sec.
Using best model state, which was in epoch 12.

--- MODEL EVALUATION ---
Val AUROC score: 0.9855
Val AUPRC score: 0.9877
Val best accuracy score: 0.9421
Val best F1 score: 0.9402
Val gene expr MSE score: 8.3862

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
