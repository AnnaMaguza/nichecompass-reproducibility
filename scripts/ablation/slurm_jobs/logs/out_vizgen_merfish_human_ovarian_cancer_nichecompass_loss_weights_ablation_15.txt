None
Run timestamp: 03072023_205857_15.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'vizgen_merfish_human_ovarian_cancer', '--reference_batches', 'batch2', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '0.1', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '50000', '--lambda_gene_expr_recon', '0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '1024', '--node_batch_size', 'None', '--timestamp_suffix', '_15']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1692.

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 500, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 500, n_latent: 1386, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1386, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 1000
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 210667
Number of validation nodes: 23407
Number of training edges: 1455707
Number of validation edges: 161745
Edge batch size: 1024
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9922; val_auprc_score: 0.9919; val_best_acc_score: 0.9577; val_best_f1_score: 0.9579; train_kl_reg_loss: 2140.0187; train_edge_recon_loss: 27782.8870; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29922.9057; train_optim_loss: 29922.9057; val_kl_reg_loss: 2203.6610; val_edge_recon_loss: 26120.0467; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28323.7077; val_optim_loss: 28323.7077
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9945; val_auprc_score: 0.9939; val_best_acc_score: 0.9657; val_best_f1_score: 0.9659; train_kl_reg_loss: 2254.1931; train_edge_recon_loss: 27266.2778; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29520.4709; train_optim_loss: 29520.4709; val_kl_reg_loss: 2227.0203; val_edge_recon_loss: 26026.3356; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28253.3559; val_optim_loss: 28253.3559
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9954; val_auprc_score: 0.9949; val_best_acc_score: 0.9690; val_best_f1_score: 0.9691; train_kl_reg_loss: 2267.8302; train_edge_recon_loss: 27197.0219; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29464.8521; train_optim_loss: 29464.8521; val_kl_reg_loss: 2140.0234; val_edge_recon_loss: 25966.7857; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28106.8091; val_optim_loss: 28106.8091
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9959; val_auprc_score: 0.9956; val_best_acc_score: 0.9709; val_best_f1_score: 0.9710; train_kl_reg_loss: 2275.4502; train_edge_recon_loss: 27156.9195; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29432.3697; train_optim_loss: 29432.3697; val_kl_reg_loss: 2281.4094; val_edge_recon_loss: 25971.9334; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28253.3428; val_optim_loss: 28253.3428
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9964; val_auprc_score: 0.9959; val_best_acc_score: 0.9735; val_best_f1_score: 0.9735; train_kl_reg_loss: 2280.9538; train_edge_recon_loss: 27128.5931; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29409.5468; train_optim_loss: 29409.5468; val_kl_reg_loss: 2251.5541; val_edge_recon_loss: 25913.7226; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28165.2767; val_optim_loss: 28165.2767
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9967; val_auprc_score: 0.9963; val_best_acc_score: 0.9744; val_best_f1_score: 0.9745; train_kl_reg_loss: 2286.2447; train_edge_recon_loss: 27100.8444; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29387.0891; train_optim_loss: 29387.0891; val_kl_reg_loss: 2285.2041; val_edge_recon_loss: 25920.1461; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28205.3502; val_optim_loss: 28205.3502
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9969; val_auprc_score: 0.9965; val_best_acc_score: 0.9758; val_best_f1_score: 0.9759; train_kl_reg_loss: 2287.7568; train_edge_recon_loss: 27085.3677; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29373.1245; train_optim_loss: 29373.1245; val_kl_reg_loss: 2318.2004; val_edge_recon_loss: 25878.7229; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28196.9232; val_optim_loss: 28196.9232
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9972; val_auprc_score: 0.9968; val_best_acc_score: 0.9770; val_best_f1_score: 0.9771; train_kl_reg_loss: 2290.0411; train_edge_recon_loss: 27066.1810; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29356.2221; train_optim_loss: 29356.2221; val_kl_reg_loss: 2278.5402; val_edge_recon_loss: 25884.0203; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28162.5606; val_optim_loss: 28162.5606

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9975; val_auprc_score: 0.9970; val_best_acc_score: 0.9792; val_best_f1_score: 0.9793; train_kl_reg_loss: 2287.9963; train_edge_recon_loss: 27026.4584; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29314.4547; train_optim_loss: 29314.4547; val_kl_reg_loss: 2279.4177; val_edge_recon_loss: 25836.8375; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28116.2552; val_optim_loss: 28116.2552
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9976; val_auprc_score: 0.9972; val_best_acc_score: 0.9795; val_best_f1_score: 0.9796; train_kl_reg_loss: 2285.7256; train_edge_recon_loss: 27025.3295; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29311.0550; train_optim_loss: 29311.0550; val_kl_reg_loss: 2276.1349; val_edge_recon_loss: 25819.7694; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28095.9043; val_optim_loss: 28095.9043
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9975; val_auprc_score: 0.9970; val_best_acc_score: 0.9795; val_best_f1_score: 0.9796; train_kl_reg_loss: 2286.0529; train_edge_recon_loss: 27020.5665; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29306.6193; train_optim_loss: 29306.6193; val_kl_reg_loss: 2280.1639; val_edge_recon_loss: 25831.4625; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28111.6264; val_optim_loss: 28111.6264
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9975; val_auprc_score: 0.9971; val_best_acc_score: 0.9797; val_best_f1_score: 0.9798; train_kl_reg_loss: 2285.7706; train_edge_recon_loss: 27016.5695; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29302.3401; train_optim_loss: 29302.3401; val_kl_reg_loss: 2272.9683; val_edge_recon_loss: 25827.0021; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28099.9704; val_optim_loss: 28099.9704
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9975; val_auprc_score: 0.9971; val_best_acc_score: 0.9796; val_best_f1_score: 0.9797; train_kl_reg_loss: 2285.7505; train_edge_recon_loss: 27009.7007; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29295.4512; train_optim_loss: 29295.4512; val_kl_reg_loss: 2254.4287; val_edge_recon_loss: 25830.5287; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28084.9574; val_optim_loss: 28084.9574
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9977; val_auprc_score: 0.9973; val_best_acc_score: 0.9799; val_best_f1_score: 0.9799; train_kl_reg_loss: 2284.8444; train_edge_recon_loss: 27012.3367; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29297.1811; train_optim_loss: 29297.1811; val_kl_reg_loss: 2279.2324; val_edge_recon_loss: 25825.0527; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28104.2851; val_optim_loss: 28104.2851
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9976; val_auprc_score: 0.9970; val_best_acc_score: 0.9800; val_best_f1_score: 0.9800; train_kl_reg_loss: 2284.1010; train_edge_recon_loss: 27014.6564; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29298.7575; train_optim_loss: 29298.7575; val_kl_reg_loss: 2248.0435; val_edge_recon_loss: 25810.0153; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28058.0588; val_optim_loss: 28058.0588
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9976; val_auprc_score: 0.9972; val_best_acc_score: 0.9797; val_best_f1_score: 0.9798; train_kl_reg_loss: 2284.8735; train_edge_recon_loss: 27007.2064; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29292.0799; train_optim_loss: 29292.0799; val_kl_reg_loss: 2276.7125; val_edge_recon_loss: 25828.3424; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28105.0549; val_optim_loss: 28105.0549
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9977; val_auprc_score: 0.9974; val_best_acc_score: 0.9801; val_best_f1_score: 0.9801; train_kl_reg_loss: 2284.6474; train_edge_recon_loss: 27006.2769; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29290.9243; train_optim_loss: 29290.9243; val_kl_reg_loss: 2255.7679; val_edge_recon_loss: 25808.7772; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28064.5452; val_optim_loss: 28064.5452
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9975; val_auprc_score: 0.9971; val_best_acc_score: 0.9803; val_best_f1_score: 0.9804; train_kl_reg_loss: 2284.1202; train_edge_recon_loss: 27007.4721; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29291.5924; train_optim_loss: 29291.5924; val_kl_reg_loss: 2252.9906; val_edge_recon_loss: 25814.4392; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28067.4298; val_optim_loss: 28067.4298
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9977; val_auprc_score: 0.9972; val_best_acc_score: 0.9800; val_best_f1_score: 0.9801; train_kl_reg_loss: 2284.2411; train_edge_recon_loss: 27003.4297; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29287.6708; train_optim_loss: 29287.6708; val_kl_reg_loss: 2273.4600; val_edge_recon_loss: 25819.9297; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28093.3896; val_optim_loss: 28093.3896

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9978; val_auprc_score: 0.9975; val_best_acc_score: 0.9809; val_best_f1_score: 0.9809; train_kl_reg_loss: 2283.7221; train_edge_recon_loss: 26998.5358; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29282.2578; train_optim_loss: 29282.2578; val_kl_reg_loss: 2273.4116; val_edge_recon_loss: 25812.7041; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28086.1157; val_optim_loss: 28086.1157
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9977; val_auprc_score: 0.9973; val_best_acc_score: 0.9809; val_best_f1_score: 0.9810; train_kl_reg_loss: 2283.4191; train_edge_recon_loss: 26996.1425; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29279.5616; train_optim_loss: 29279.5616; val_kl_reg_loss: 2270.6301; val_edge_recon_loss: 25807.2087; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28077.8387; val_optim_loss: 28077.8387
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9979; val_auprc_score: 0.9975; val_best_acc_score: 0.9813; val_best_f1_score: 0.9813; train_kl_reg_loss: 2283.1676; train_edge_recon_loss: 27000.1742; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29283.3419; train_optim_loss: 29283.3419; val_kl_reg_loss: 2272.3759; val_edge_recon_loss: 25804.9150; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28077.2909; val_optim_loss: 28077.2909
Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.9978; val_auprc_score: 0.9974; val_best_acc_score: 0.9809; val_best_f1_score: 0.9810; train_kl_reg_loss: 2284.0301; train_edge_recon_loss: 26996.5814; train_gene_expr_recon_loss: 0.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 29280.6116; train_optim_loss: 29280.6116; val_kl_reg_loss: 2272.4723; val_edge_recon_loss: 25804.8055; val_gene_expr_recon_loss: 0.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 28077.2778; val_optim_loss: 28077.2778

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 219 min 7 sec.
Using best model state, which was in epoch 15.

--- MODEL EVALUATION ---
Val AUROC score: 0.9977
Val AUPRC score: 0.9973
Val best accuracy score: 0.9801
Val best F1 score: 0.9801
Val gene expr MSE score: 14.2316

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
