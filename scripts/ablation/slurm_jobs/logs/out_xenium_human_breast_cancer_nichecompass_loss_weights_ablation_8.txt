None
Run timestamp: 28062023_164601_8.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'xenium_human_breast_cancer', '--reference_batches', 'batch1', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--add_fc_gps_instead_of_gp_dict_gps', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'loss_weights_ablation', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '0', '--lambda_gene_expr_recon', '30', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--timestamp_suffix', '_8']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ENCODER -> n_input: 313, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 313, n_latent: 1691, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1691, n_cat_covariates_embed_input: 0, n_addon_input: 0, n_output: 626
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 147600
Number of validation nodes: 16400
Number of training edges: 995239
Number of validation edges: 110582
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
heaps
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9770; val_auprc_score: 0.9738; val_best_acc_score: 0.9264; val_best_f1_score: 0.9279; train_kl_reg_loss: 209.0082; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 13576.7926; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 13785.8008; train_optim_loss: 13785.8008; val_kl_reg_loss: 206.9277; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 12647.2981; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12854.2258; val_optim_loss: 12854.2258
heaps
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9871; val_auprc_score: 0.9858; val_best_acc_score: 0.9460; val_best_f1_score: 0.9467; train_kl_reg_loss: 189.9171; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 12834.0565; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 13023.9736; train_optim_loss: 13023.9736; val_kl_reg_loss: 168.8460; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 12360.1571; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12529.0031; val_optim_loss: 12529.0031
heaps
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9904; val_auprc_score: 0.9897; val_best_acc_score: 0.9534; val_best_f1_score: 0.9536; train_kl_reg_loss: 163.6716; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 12628.3744; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12792.0460; train_optim_loss: 12792.0460; val_kl_reg_loss: 156.0946; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 12245.1233; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12401.2179; val_optim_loss: 12401.2179
heaps
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9915; val_auprc_score: 0.9909; val_best_acc_score: 0.9553; val_best_f1_score: 0.9558; train_kl_reg_loss: 154.4148; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 12546.1627; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12700.5775; train_optim_loss: 12700.5775; val_kl_reg_loss: 149.9261; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 12197.1996; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12347.1257; val_optim_loss: 12347.1257
heaps
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9920; val_auprc_score: 0.9915; val_best_acc_score: 0.9575; val_best_f1_score: 0.9578; train_kl_reg_loss: 152.2057; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 12508.5916; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12660.7973; train_optim_loss: 12660.7973; val_kl_reg_loss: 156.5254; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 12181.1337; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12337.6592; val_optim_loss: 12337.6592
heaps
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9933; val_auprc_score: 0.9929; val_best_acc_score: 0.9612; val_best_f1_score: 0.9612; train_kl_reg_loss: 152.5404; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 12490.8878; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12643.4282; train_optim_loss: 12643.4282; val_kl_reg_loss: 149.4682; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 12173.7456; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12323.2138; val_optim_loss: 12323.2138
heaps
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9937; val_auprc_score: 0.9933; val_best_acc_score: 0.9629; val_best_f1_score: 0.9632; train_kl_reg_loss: 152.9529; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 12471.9395; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12624.8924; train_optim_loss: 12624.8924; val_kl_reg_loss: 153.9746; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 12198.8287; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12352.8033; val_optim_loss: 12352.8033
heaps
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9940; val_auprc_score: 0.9939; val_best_acc_score: 0.9631; val_best_f1_score: 0.9633; train_kl_reg_loss: 153.9218; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 12447.1604; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12601.0822; train_optim_loss: 12601.0822; val_kl_reg_loss: 155.8808; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 11916.6890; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12072.5698; val_optim_loss: 12072.5698
heaps
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9938; val_auprc_score: 0.9935; val_best_acc_score: 0.9637; val_best_f1_score: 0.9638; train_kl_reg_loss: 154.3800; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 12479.8939; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12634.2740; train_optim_loss: 12634.2740; val_kl_reg_loss: 153.8110; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 11785.2887; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 11939.0997; val_optim_loss: 11939.0997
heaps
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9942; val_auprc_score: 0.9938; val_best_acc_score: 0.9653; val_best_f1_score: 0.9654; train_kl_reg_loss: 154.9550; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 12520.3645; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12675.3196; train_optim_loss: 12675.3196; val_kl_reg_loss: 150.9880; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 12536.8454; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12687.8334; val_optim_loss: 12687.8334
heaps
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9945; val_auprc_score: 0.9942; val_best_acc_score: 0.9663; val_best_f1_score: 0.9663; train_kl_reg_loss: 155.1869; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 12277.9242; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 12433.1111; train_optim_loss: 12433.1111; val_kl_reg_loss: 157.7631; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 12376.6846; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 12534.4477; val_optim_loss: 12534.4477
heaps
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9943; val_auprc_score: 0.9941; val_best_acc_score: 0.9653; val_best_f1_score: 0.9656; train_kl_reg_loss: 155.7334; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 11395.8211; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11551.5545; train_optim_loss: 11551.5545; val_kl_reg_loss: 154.2129; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 10432.8883; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 10587.1012; val_optim_loss: 10587.1012
heaps
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9945; val_auprc_score: 0.9943; val_best_acc_score: 0.9660; val_best_f1_score: 0.9661; train_kl_reg_loss: 156.2242; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 9969.2286; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 10125.4527; train_optim_loss: 10125.4527; val_kl_reg_loss: 153.8069; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 8289.9527; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8443.7595; val_optim_loss: 8443.7595
heaps
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9946; val_auprc_score: 0.9944; val_best_acc_score: 0.9663; val_best_f1_score: 0.9664; train_kl_reg_loss: 156.9312; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 9077.2760; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 9234.2072; train_optim_loss: 9234.2072; val_kl_reg_loss: 155.9016; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 7097.7553; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7253.6569; val_optim_loss: 7253.6569
heaps
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9949; val_auprc_score: 0.9948; val_best_acc_score: 0.9670; val_best_f1_score: 0.9671; train_kl_reg_loss: 157.3980; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 8705.5072; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8862.9051; train_optim_loss: 8862.9051; val_kl_reg_loss: 157.5901; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 8420.4757; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8578.0657; val_optim_loss: 8578.0657
heaps
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9952; val_auprc_score: 0.9952; val_best_acc_score: 0.9685; val_best_f1_score: 0.9685; train_kl_reg_loss: 157.6096; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 8612.4843; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8770.0939; train_optim_loss: 8770.0939; val_kl_reg_loss: 157.0025; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 8326.0510; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8483.0536; val_optim_loss: 8483.0536
heaps
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9951; val_auprc_score: 0.9949; val_best_acc_score: 0.9677; val_best_f1_score: 0.9678; train_kl_reg_loss: 157.8121; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 8636.2560; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8794.0681; train_optim_loss: 8794.0681; val_kl_reg_loss: 156.5498; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 7957.5417; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8114.0915; val_optim_loss: 8114.0915
heaps
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9955; val_auprc_score: 0.9953; val_best_acc_score: 0.9696; val_best_f1_score: 0.9697; train_kl_reg_loss: 157.9795; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 8612.4162; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8770.3957; train_optim_loss: 8770.3957; val_kl_reg_loss: 160.6153; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 8726.7170; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8887.3323; val_optim_loss: 8887.3323

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

heaps
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9960; val_auprc_score: 0.9960; val_best_acc_score: 0.9720; val_best_f1_score: 0.9720; train_kl_reg_loss: 134.4729; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 8406.3805; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8540.8535; train_optim_loss: 8540.8535; val_kl_reg_loss: 124.7605; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 7994.4637; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8119.2243; val_optim_loss: 8119.2243
heaps
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9962; val_auprc_score: 0.9962; val_best_acc_score: 0.9724; val_best_f1_score: 0.9725; train_kl_reg_loss: 125.6689; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 8377.6049; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8503.2738; train_optim_loss: 8503.2738; val_kl_reg_loss: 124.7812; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 8362.5003; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8487.2815; val_optim_loss: 8487.2815
heaps
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9961; val_auprc_score: 0.9962; val_best_acc_score: 0.9723; val_best_f1_score: 0.9723; train_kl_reg_loss: 125.5459; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 8398.1701; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8523.7160; train_optim_loss: 8523.7160; val_kl_reg_loss: 124.0926; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 8377.1157; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8501.2083; val_optim_loss: 8501.2083
heaps
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9962; val_auprc_score: 0.9961; val_best_acc_score: 0.9730; val_best_f1_score: 0.9730; train_kl_reg_loss: 125.6092; train_edge_recon_loss: 0.0000; train_gene_expr_recon_loss: 8349.4282; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8475.0375; train_optim_loss: 8475.0375; val_kl_reg_loss: 124.9637; val_edge_recon_loss: 0.0000; val_gene_expr_recon_loss: 8434.1800; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8559.1437; val_optim_loss: 8559.1437

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 177 min 51 sec.
Using best model state, which was in epoch 14.

--- MODEL EVALUATION ---
Val AUROC score: 0.9949
Val AUPRC score: 0.9948
Val best accuracy score: 0.9674
Val best F1 score: 0.9675
Val gene expr MSE score: 2.6260

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
