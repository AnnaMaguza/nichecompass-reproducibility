[True]
Run timestamp: 25072023_180900_5.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'seqfish_mouse_organogenesis_imputed', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', '--n_neighbors', '4', '--filter_genes', '--n_hvg', '4000', '--nichenet_keep_target_genes_ratio', '0.1', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.0', '--lambda_gene_expr_recon', '3000.0', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '5.0', '--edge_batch_size', '256', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_5']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Filtering genes...
Starting with 29452 genes.
Keeping 29452 genes after filtering genes with expression in 0 cells.
Keeping 4032 highly variable or gene program relevant genes.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.05
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ENCODER -> n_input: 4032, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 1540, n_latent: 1540, n_addon_latent: 0, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1540, n_cat_covariates_embed_input: 3, n_addon_input: 0, n_output: 8064
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 47311
Number of validation nodes: 5257
Number of training edges: 109836
Number of validation edges: 12204
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.8122; val_auprc_score: 0.9606; val_best_acc_score: 0.8634; val_best_f1_score: 0.9259; train_kl_reg_loss: 174197.0892; train_edge_recon_loss: 1132889.8769; train_gene_expr_recon_loss: 13008572.8977; train_masked_gp_l1_reg_loss: 7812.4419; train_group_lasso_reg_loss: 0.0000; train_global_loss: 14323472.2767; train_optim_loss: 14323472.2767; val_kl_reg_loss: 134176.0404; val_edge_recon_loss: 1173157.4362; val_gene_expr_recon_loss: 10399884.4792; val_masked_gp_l1_reg_loss: 8064.9551; val_group_lasso_reg_loss: 0.0000; val_global_loss: 11715283.0208; val_optim_loss: 11715283.0208
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.8052; val_auprc_score: 0.9572; val_best_acc_score: 0.8645; val_best_f1_score: 0.9259; train_kl_reg_loss: 129151.4728; train_edge_recon_loss: 1094549.3551; train_gene_expr_recon_loss: 9992131.9140; train_masked_gp_l1_reg_loss: 8272.1312; train_group_lasso_reg_loss: 0.0000; train_global_loss: 11224104.8837; train_optim_loss: 11224104.8837; val_kl_reg_loss: 112940.1699; val_edge_recon_loss: 1183240.7513; val_gene_expr_recon_loss: 9660858.2083; val_masked_gp_l1_reg_loss: 8785.4600; val_group_lasso_reg_loss: 0.0000; val_global_loss: 10965824.1667; val_optim_loss: 10965824.1667
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.8312; val_auprc_score: 0.9626; val_best_acc_score: 0.8658; val_best_f1_score: 0.9262; train_kl_reg_loss: 87995.1761; train_edge_recon_loss: 1076142.0254; train_gene_expr_recon_loss: 8921929.5442; train_masked_gp_l1_reg_loss: 9536.2188; train_group_lasso_reg_loss: 0.0000; train_global_loss: 10095602.9535; train_optim_loss: 10095602.9535; val_kl_reg_loss: 86985.1562; val_edge_recon_loss: 1159482.8346; val_gene_expr_recon_loss: 8579615.1458; val_masked_gp_l1_reg_loss: 9884.8662; val_group_lasso_reg_loss: 0.0000; val_global_loss: 9835968.1250; val_optim_loss: 9835968.1250
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.8447; val_auprc_score: 0.9637; val_best_acc_score: 0.8711; val_best_f1_score: 0.9281; train_kl_reg_loss: 87865.3977; train_edge_recon_loss: 1040806.1882; train_gene_expr_recon_loss: 8383712.8512; train_masked_gp_l1_reg_loss: 10246.8269; train_group_lasso_reg_loss: 0.0000; train_global_loss: 9522631.2581; train_optim_loss: 9522631.2581; val_kl_reg_loss: 84580.4992; val_edge_recon_loss: 1071543.8307; val_gene_expr_recon_loss: 8212560.2500; val_masked_gp_l1_reg_loss: 10619.7793; val_group_lasso_reg_loss: 0.0000; val_global_loss: 9379304.5625; val_optim_loss: 9379304.5625
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.8663; val_auprc_score: 0.9716; val_best_acc_score: 0.8846; val_best_f1_score: 0.9346; train_kl_reg_loss: 86481.1582; train_edge_recon_loss: 985517.3004; train_gene_expr_recon_loss: 8058009.9674; train_masked_gp_l1_reg_loss: 11034.7945; train_group_lasso_reg_loss: 0.0000; train_global_loss: 9141043.2209; train_optim_loss: 9141043.2209; val_kl_reg_loss: 85214.2441; val_edge_recon_loss: 966763.0742; val_gene_expr_recon_loss: 7916323.2083; val_masked_gp_l1_reg_loss: 11467.7910; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8979768.5417; val_optim_loss: 8979768.5417
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.8712; val_auprc_score: 0.9707; val_best_acc_score: 0.8860; val_best_f1_score: 0.9354; train_kl_reg_loss: 84446.1436; train_edge_recon_loss: 956657.5119; train_gene_expr_recon_loss: 7800200.6988; train_masked_gp_l1_reg_loss: 11922.3245; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8853226.6849; train_optim_loss: 8853226.6849; val_kl_reg_loss: 80510.3835; val_edge_recon_loss: 963871.5000; val_gene_expr_recon_loss: 7690292.1354; val_masked_gp_l1_reg_loss: 12381.9258; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8747056.0625; val_optim_loss: 8747056.0625
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.8846; val_auprc_score: 0.9746; val_best_acc_score: 0.8962; val_best_f1_score: 0.9415; train_kl_reg_loss: 77700.7611; train_edge_recon_loss: 929493.8342; train_gene_expr_recon_loss: 7578172.0791; train_masked_gp_l1_reg_loss: 12820.5968; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8598187.2605; train_optim_loss: 8598187.2605; val_kl_reg_loss: 74278.4292; val_edge_recon_loss: 890651.8398; val_gene_expr_recon_loss: 7478503.0833; val_masked_gp_l1_reg_loss: 13249.1133; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8456682.3958; val_optim_loss: 8456682.3958
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.8971; val_auprc_score: 0.9783; val_best_acc_score: 0.9063; val_best_f1_score: 0.9471; train_kl_reg_loss: 72558.7338; train_edge_recon_loss: 907397.1616; train_gene_expr_recon_loss: 7393713.0767; train_masked_gp_l1_reg_loss: 13662.6800; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8387331.6395; train_optim_loss: 8387331.6395; val_kl_reg_loss: 69307.5614; val_edge_recon_loss: 881128.1341; val_gene_expr_recon_loss: 7312163.9792; val_masked_gp_l1_reg_loss: 14051.4395; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8276651.0833; val_optim_loss: 8276651.0833
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.8986; val_auprc_score: 0.9781; val_best_acc_score: 0.9048; val_best_f1_score: 0.9456; train_kl_reg_loss: 67442.4021; train_edge_recon_loss: 882697.8881; train_gene_expr_recon_loss: 7238581.5791; train_masked_gp_l1_reg_loss: 14441.9767; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8203163.8547; train_optim_loss: 8203163.8547; val_kl_reg_loss: 64374.3170; val_edge_recon_loss: 890644.1667; val_gene_expr_recon_loss: 7172351.5625; val_masked_gp_l1_reg_loss: 14825.1416; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8142195.0521; val_optim_loss: 8142195.0521
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9116; val_auprc_score: 0.9811; val_best_acc_score: 0.9159; val_best_f1_score: 0.9518; train_kl_reg_loss: 62756.1460; train_edge_recon_loss: 874119.4612; train_gene_expr_recon_loss: 7107233.9756; train_masked_gp_l1_reg_loss: 15164.7060; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8059274.2837; train_optim_loss: 8059274.2837; val_kl_reg_loss: 59701.4833; val_edge_recon_loss: 849106.4544; val_gene_expr_recon_loss: 7062296.5729; val_masked_gp_l1_reg_loss: 15493.5254; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7986598.0104; val_optim_loss: 7986598.0104
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9076; val_auprc_score: 0.9799; val_best_acc_score: 0.9150; val_best_f1_score: 0.9513; train_kl_reg_loss: 57609.4334; train_edge_recon_loss: 859235.5241; train_gene_expr_recon_loss: 6997380.1942; train_masked_gp_l1_reg_loss: 15798.4368; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7930023.5895; train_optim_loss: 7930023.5895; val_kl_reg_loss: 54521.3143; val_edge_recon_loss: 857606.2656; val_gene_expr_recon_loss: 6949533.2292; val_masked_gp_l1_reg_loss: 16080.9219; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7877741.8125; val_optim_loss: 7877741.8125
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9217; val_auprc_score: 0.9836; val_best_acc_score: 0.9207; val_best_f1_score: 0.9547; train_kl_reg_loss: 52838.6227; train_edge_recon_loss: 845387.6326; train_gene_expr_recon_loss: 6900984.9814; train_masked_gp_l1_reg_loss: 16322.1438; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7815533.3988; train_optim_loss: 7815533.3988; val_kl_reg_loss: 50025.4743; val_edge_recon_loss: 831237.3880; val_gene_expr_recon_loss: 6868669.8854; val_masked_gp_l1_reg_loss: 16547.2598; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7766480.2708; val_optim_loss: 7766480.2708
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9186; val_auprc_score: 0.9815; val_best_acc_score: 0.9199; val_best_f1_score: 0.9544; train_kl_reg_loss: 48010.8235; train_edge_recon_loss: 838148.6765; train_gene_expr_recon_loss: 6821602.4244; train_masked_gp_l1_reg_loss: 16735.1375; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7724497.0488; train_optim_loss: 7724497.0488; val_kl_reg_loss: 45653.7722; val_edge_recon_loss: 840017.7122; val_gene_expr_recon_loss: 6795940.2917; val_masked_gp_l1_reg_loss: 16904.5430; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7698516.2812; val_optim_loss: 7698516.2812
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9235; val_auprc_score: 0.9837; val_best_acc_score: 0.9216; val_best_f1_score: 0.9551; train_kl_reg_loss: 43765.6246; train_edge_recon_loss: 829383.8394; train_gene_expr_recon_loss: 6754889.0651; train_masked_gp_l1_reg_loss: 17022.5995; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7645061.1105; train_optim_loss: 7645061.1105; val_kl_reg_loss: 42189.6311; val_edge_recon_loss: 818581.7240; val_gene_expr_recon_loss: 6732309.1042; val_masked_gp_l1_reg_loss: 17111.1172; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7610191.5000; val_optim_loss: 7610191.5000
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9219; val_auprc_score: 0.9827; val_best_acc_score: 0.9207; val_best_f1_score: 0.9542; train_kl_reg_loss: 40720.4849; train_edge_recon_loss: 829123.5971; train_gene_expr_recon_loss: 6693235.0826; train_masked_gp_l1_reg_loss: 17170.7309; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7580249.8779; train_optim_loss: 7580249.8779; val_kl_reg_loss: 39321.9426; val_edge_recon_loss: 855893.3184; val_gene_expr_recon_loss: 6665853.4167; val_masked_gp_l1_reg_loss: 17205.4844; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7578274.1771; val_optim_loss: 7578274.1771
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9304; val_auprc_score: 0.9848; val_best_acc_score: 0.9291; val_best_f1_score: 0.9593; train_kl_reg_loss: 37557.1687; train_edge_recon_loss: 824255.8328; train_gene_expr_recon_loss: 6643512.9221; train_masked_gp_l1_reg_loss: 17198.6719; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7522524.6221; train_optim_loss: 7522524.6221; val_kl_reg_loss: 36479.4509; val_edge_recon_loss: 816118.2357; val_gene_expr_recon_loss: 6629173.2500; val_masked_gp_l1_reg_loss: 17166.6523; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7498937.4479; val_optim_loss: 7498937.4479
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9321; val_auprc_score: 0.9849; val_best_acc_score: 0.9289; val_best_f1_score: 0.9591; train_kl_reg_loss: 35080.5681; train_edge_recon_loss: 814817.6637; train_gene_expr_recon_loss: 6598634.6616; train_masked_gp_l1_reg_loss: 17099.7286; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7465632.6081; train_optim_loss: 7465632.6081; val_kl_reg_loss: 33729.8660; val_edge_recon_loss: 822700.8346; val_gene_expr_recon_loss: 6605221.6979; val_masked_gp_l1_reg_loss: 17016.9316; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7478669.4271; val_optim_loss: 7478669.4271
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9391; val_auprc_score: 0.9854; val_best_acc_score: 0.9288; val_best_f1_score: 0.9591; train_kl_reg_loss: 32817.2363; train_edge_recon_loss: 813757.9474; train_gene_expr_recon_loss: 6560347.9930; train_masked_gp_l1_reg_loss: 16898.9835; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7423822.1826; train_optim_loss: 7423822.1826; val_kl_reg_loss: 31748.1927; val_edge_recon_loss: 822512.4492; val_gene_expr_recon_loss: 6549209.0625; val_masked_gp_l1_reg_loss: 16751.4492; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7420221.2083; val_optim_loss: 7420221.2083
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9500; val_auprc_score: 0.9893; val_best_acc_score: 0.9347; val_best_f1_score: 0.9622; train_kl_reg_loss: 31002.3105; train_edge_recon_loss: 806523.5029; train_gene_expr_recon_loss: 6527369.9128; train_masked_gp_l1_reg_loss: 16611.6694; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7381507.3860; train_optim_loss: 7381507.3860; val_kl_reg_loss: 30191.4613; val_edge_recon_loss: 799885.7370; val_gene_expr_recon_loss: 6511684.5312; val_masked_gp_l1_reg_loss: 16471.4473; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7358233.2292; val_optim_loss: 7358233.2292
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9508; val_auprc_score: 0.9893; val_best_acc_score: 0.9385; val_best_f1_score: 0.9645; train_kl_reg_loss: 29581.6221; train_edge_recon_loss: 802013.9270; train_gene_expr_recon_loss: 6500119.3349; train_masked_gp_l1_reg_loss: 16268.2773; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7347983.1593; train_optim_loss: 7347983.1593; val_kl_reg_loss: 28795.9821; val_edge_recon_loss: 795796.4948; val_gene_expr_recon_loss: 6485583.6250; val_masked_gp_l1_reg_loss: 16077.1631; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7326253.0833; val_optim_loss: 7326253.0833
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9469; val_auprc_score: 0.9871; val_best_acc_score: 0.9375; val_best_f1_score: 0.9637; train_kl_reg_loss: 28315.8886; train_edge_recon_loss: 793703.3550; train_gene_expr_recon_loss: 6476305.4081; train_masked_gp_l1_reg_loss: 15905.3667; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7314230.0209; train_optim_loss: 7314230.0209; val_kl_reg_loss: 27657.5523; val_edge_recon_loss: 818196.0951; val_gene_expr_recon_loss: 6461715.5104; val_masked_gp_l1_reg_loss: 15717.8613; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7323287.1562; val_optim_loss: 7323287.1562
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9523; val_auprc_score: 0.9895; val_best_acc_score: 0.9404; val_best_f1_score: 0.9655; train_kl_reg_loss: 27276.3997; train_edge_recon_loss: 793739.0081; train_gene_expr_recon_loss: 6454664.6453; train_masked_gp_l1_reg_loss: 15550.8829; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7291230.9395; train_optim_loss: 7291230.9395; val_kl_reg_loss: 26617.7568; val_edge_recon_loss: 814958.9596; val_gene_expr_recon_loss: 6447633.4167; val_masked_gp_l1_reg_loss: 15378.2539; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7304588.6354; val_optim_loss: 7304588.6354
Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.9539; val_auprc_score: 0.9899; val_best_acc_score: 0.9448; val_best_f1_score: 0.9681; train_kl_reg_loss: 26284.4716; train_edge_recon_loss: 798668.2717; train_gene_expr_recon_loss: 6438232.4988; train_masked_gp_l1_reg_loss: 15207.9728; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7278393.2174; train_optim_loss: 7278393.2174; val_kl_reg_loss: 25932.9305; val_edge_recon_loss: 778675.4714; val_gene_expr_recon_loss: 6431909.6146; val_masked_gp_l1_reg_loss: 15037.2998; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7251555.5104; val_optim_loss: 7251555.5104
