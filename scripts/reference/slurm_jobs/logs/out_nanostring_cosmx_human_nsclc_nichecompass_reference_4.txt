[True, False, True]
Run timestamp: 03092023_001459_4.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', 'batch7', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', 'patient', '--cat_covariates_no_edges', 'True', 'False', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '100', '--active_gp_thresh_ratio', '0.03', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '5', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '1000000.0', '--contrastive_logits_pos_ratio', '0.03125', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--lambda_l1_addon', '1000.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_4']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch7...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 563097
Number of validation nodes: 62566
Number of training edges: 1330101
Number of validation edges: 147789
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8961; val_auprc_score: 0.9803; val_best_acc_score: 0.9166; val_best_f1_score: 0.9535; train_kl_reg_loss: 17770.4086; train_edge_recon_loss: 736990.3218; train_cat_covariates_contrastive_loss: 950467.8737; train_gene_expr_recon_loss: 2593322.8713; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 58341.7932; train_global_loss: 4356893.2631; train_optim_loss: 4356893.2631; val_kl_reg_loss: 18437.0056; val_edge_recon_loss: 731189.3516; val_cat_covariates_contrastive_loss: 954169.7545; val_gene_expr_recon_loss: 2261748.9567; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 13910.9775; val_global_loss: 3979456.0727; val_optim_loss: 3979456.0727
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9077; val_auprc_score: 0.9819; val_best_acc_score: 0.9222; val_best_f1_score: 0.9565; train_kl_reg_loss: 21689.5668; train_edge_recon_loss: 700826.9656; train_cat_covariates_contrastive_loss: 951419.0348; train_gene_expr_recon_loss: 2120675.4219; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 14447.7542; train_global_loss: 3809058.7409; train_optim_loss: 3809058.7409; val_kl_reg_loss: 23267.2200; val_edge_recon_loss: 725857.2656; val_cat_covariates_contrastive_loss: 951571.3062; val_gene_expr_recon_loss: 2029855.3317; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15003.1230; val_global_loss: 3745554.1315; val_optim_loss: 3745554.1315
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9178; val_auprc_score: 0.9846; val_best_acc_score: 0.9250; val_best_f1_score: 0.9581; train_kl_reg_loss: 23679.4308; train_edge_recon_loss: 696708.3446; train_cat_covariates_contrastive_loss: 952146.0532; train_gene_expr_recon_loss: 1992873.3582; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15313.0236; train_global_loss: 3680720.2153; train_optim_loss: 3680720.2153; val_kl_reg_loss: 23857.7918; val_edge_recon_loss: 708794.7202; val_cat_covariates_contrastive_loss: 953301.2764; val_gene_expr_recon_loss: 1966604.1535; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15555.6064; val_global_loss: 3668113.4394; val_optim_loss: 3668113.4394
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9107; val_auprc_score: 0.9826; val_best_acc_score: 0.9257; val_best_f1_score: 0.9584; train_kl_reg_loss: 24400.7765; train_edge_recon_loss: 695070.7887; train_cat_covariates_contrastive_loss: 952666.6344; train_gene_expr_recon_loss: 1945294.8573; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15654.3369; train_global_loss: 3633087.3913; train_optim_loss: 3633087.3913; val_kl_reg_loss: 23940.3794; val_edge_recon_loss: 714671.8545; val_cat_covariates_contrastive_loss: 953721.1176; val_gene_expr_recon_loss: 1933910.0619; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15756.8389; val_global_loss: 3642000.1626; val_optim_loss: 3642000.1626
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9219; val_auprc_score: 0.9845; val_best_acc_score: 0.9324; val_best_f1_score: 0.9621; train_kl_reg_loss: 24846.2763; train_edge_recon_loss: 692607.7612; train_cat_covariates_contrastive_loss: 953068.3560; train_gene_expr_recon_loss: 1921006.1729; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16066.8050; train_global_loss: 3607595.3745; train_optim_loss: 3607595.3745; val_kl_reg_loss: 24879.8059; val_edge_recon_loss: 714456.6593; val_cat_covariates_contrastive_loss: 953258.7096; val_gene_expr_recon_loss: 1912551.0571; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16275.0645; val_global_loss: 3621421.2206; val_optim_loss: 3621421.2206
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9200; val_auprc_score: 0.9845; val_best_acc_score: 0.9269; val_best_f1_score: 0.9588; train_kl_reg_loss: 25196.5172; train_edge_recon_loss: 691437.1502; train_cat_covariates_contrastive_loss: 952754.8499; train_gene_expr_recon_loss: 1899866.9438; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16583.1515; train_global_loss: 3585838.6136; train_optim_loss: 3585838.6136; val_kl_reg_loss: 25349.5789; val_edge_recon_loss: 715540.7405; val_cat_covariates_contrastive_loss: 953375.3977; val_gene_expr_recon_loss: 1891729.4347; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16577.5078; val_global_loss: 3602572.6505; val_optim_loss: 3602572.6505
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9204; val_auprc_score: 0.9839; val_best_acc_score: 0.9326; val_best_f1_score: 0.9622; train_kl_reg_loss: 25740.2558; train_edge_recon_loss: 691797.7514; train_cat_covariates_contrastive_loss: 952700.1424; train_gene_expr_recon_loss: 1883713.3769; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16708.5117; train_global_loss: 3570660.0441; train_optim_loss: 3570660.0441; val_kl_reg_loss: 26368.5065; val_edge_recon_loss: 713738.8416; val_cat_covariates_contrastive_loss: 951041.0913; val_gene_expr_recon_loss: 1886485.7444; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16790.8770; val_global_loss: 3594425.1817; val_optim_loss: 3594425.1817
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9253; val_auprc_score: 0.9853; val_best_acc_score: 0.9332; val_best_f1_score: 0.9625; train_kl_reg_loss: 26202.4301; train_edge_recon_loss: 691784.9396; train_cat_covariates_contrastive_loss: 952710.5001; train_gene_expr_recon_loss: 1871539.4921; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16794.2839; train_global_loss: 3559031.6448; train_optim_loss: 3559031.6448; val_kl_reg_loss: 26252.8452; val_edge_recon_loss: 710487.4155; val_cat_covariates_contrastive_loss: 951934.4937; val_gene_expr_recon_loss: 1868440.3439; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16984.0547; val_global_loss: 3574099.1021; val_optim_loss: 3574099.1021
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9180; val_auprc_score: 0.9840; val_best_acc_score: 0.9245; val_best_f1_score: 0.9577; train_kl_reg_loss: 26497.8904; train_edge_recon_loss: 691597.6937; train_cat_covariates_contrastive_loss: 952773.8815; train_gene_expr_recon_loss: 1861848.1872; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16859.3726; train_global_loss: 3549577.0268; train_optim_loss: 3549577.0268; val_kl_reg_loss: 26806.8173; val_edge_recon_loss: 708713.0244; val_cat_covariates_contrastive_loss: 952855.3447; val_gene_expr_recon_loss: 1862768.1886; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16748.6641; val_global_loss: 3567892.1263; val_optim_loss: 3567892.1263
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9255; val_auprc_score: 0.9850; val_best_acc_score: 0.9331; val_best_f1_score: 0.9624; train_kl_reg_loss: 27044.8765; train_edge_recon_loss: 691841.6067; train_cat_covariates_contrastive_loss: 952863.9248; train_gene_expr_recon_loss: 1852825.6148; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16981.5443; train_global_loss: 3541557.5651; train_optim_loss: 3541557.5651; val_kl_reg_loss: 27431.0800; val_edge_recon_loss: 713731.5517; val_cat_covariates_contrastive_loss: 951161.7487; val_gene_expr_recon_loss: 1853931.9092; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16930.2168; val_global_loss: 3563186.5346; val_optim_loss: 3563186.5346
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9270; val_auprc_score: 0.9850; val_best_acc_score: 0.9353; val_best_f1_score: 0.9636; train_kl_reg_loss: 27056.0252; train_edge_recon_loss: 690810.3528; train_cat_covariates_contrastive_loss: 953063.1602; train_gene_expr_recon_loss: 1847238.7038; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17124.0964; train_global_loss: 3535292.3401; train_optim_loss: 3535292.3401; val_kl_reg_loss: 27904.7155; val_edge_recon_loss: 719896.2163; val_cat_covariates_contrastive_loss: 951785.4738; val_gene_expr_recon_loss: 1849035.2249; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17105.1973; val_global_loss: 3565726.8720; val_optim_loss: 3565726.8720
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9225; val_auprc_score: 0.9849; val_best_acc_score: 0.9269; val_best_f1_score: 0.9589; train_kl_reg_loss: 27401.4542; train_edge_recon_loss: 689533.3112; train_cat_covariates_contrastive_loss: 953071.8589; train_gene_expr_recon_loss: 1839695.0447; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17277.1140; train_global_loss: 3526978.7851; train_optim_loss: 3526978.7851; val_kl_reg_loss: 26754.2453; val_edge_recon_loss: 710344.9582; val_cat_covariates_contrastive_loss: 953789.4410; val_gene_expr_recon_loss: 1836975.1060; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17287.9082; val_global_loss: 3545151.7465; val_optim_loss: 3545151.7465
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9205; val_auprc_score: 0.9838; val_best_acc_score: 0.9327; val_best_f1_score: 0.9622; train_kl_reg_loss: 27972.6541; train_edge_recon_loss: 692402.1424; train_cat_covariates_contrastive_loss: 953151.6377; train_gene_expr_recon_loss: 1836998.8730; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17449.9521; train_global_loss: 3527975.2564; train_optim_loss: 3527975.2564; val_kl_reg_loss: 29261.2414; val_edge_recon_loss: 710779.9016; val_cat_covariates_contrastive_loss: 951096.3979; val_gene_expr_recon_loss: 1836209.0779; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17502.0547; val_global_loss: 3544848.6211; val_optim_loss: 3544848.6211
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9311; val_auprc_score: 0.9863; val_best_acc_score: 0.9352; val_best_f1_score: 0.9634; train_kl_reg_loss: 27916.3841; train_edge_recon_loss: 691192.4440; train_cat_covariates_contrastive_loss: 953146.6339; train_gene_expr_recon_loss: 1829518.8177; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17508.2018; train_global_loss: 3519282.4831; train_optim_loss: 3519282.4831; val_kl_reg_loss: 27326.0234; val_edge_recon_loss: 712043.2708; val_cat_covariates_contrastive_loss: 954131.4671; val_gene_expr_recon_loss: 1829759.2920; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17462.4082; val_global_loss: 3540722.5562; val_optim_loss: 3540722.5562
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9271; val_auprc_score: 0.9848; val_best_acc_score: 0.9342; val_best_f1_score: 0.9628; train_kl_reg_loss: 28029.4706; train_edge_recon_loss: 690222.2076; train_cat_covariates_contrastive_loss: 953220.2935; train_gene_expr_recon_loss: 1825449.1093; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17511.4665; train_global_loss: 3514432.5484; train_optim_loss: 3514432.5484; val_kl_reg_loss: 28737.2351; val_edge_recon_loss: 714337.6021; val_cat_covariates_contrastive_loss: 951331.3090; val_gene_expr_recon_loss: 1826612.9788; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17609.9355; val_global_loss: 3538629.1194; val_optim_loss: 3538629.1194
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9253; val_auprc_score: 0.9848; val_best_acc_score: 0.9370; val_best_f1_score: 0.9646; train_kl_reg_loss: 28033.0076; train_edge_recon_loss: 689360.8839; train_cat_covariates_contrastive_loss: 953205.6570; train_gene_expr_recon_loss: 1822581.7735; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17554.9323; train_global_loss: 3510736.2523; train_optim_loss: 3510736.2523; val_kl_reg_loss: 28719.1538; val_edge_recon_loss: 711105.7628; val_cat_covariates_contrastive_loss: 951684.1371; val_gene_expr_recon_loss: 1840890.9507; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17643.8711; val_global_loss: 3550043.7569; val_optim_loss: 3550043.7569
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9283; val_auprc_score: 0.9856; val_best_acc_score: 0.9353; val_best_f1_score: 0.9637; train_kl_reg_loss: 28156.9028; train_edge_recon_loss: 688487.3055; train_cat_covariates_contrastive_loss: 953133.0591; train_gene_expr_recon_loss: 1820888.8806; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17618.6687; train_global_loss: 3508284.8140; train_optim_loss: 3508284.8140; val_kl_reg_loss: 29283.9817; val_edge_recon_loss: 709071.9557; val_cat_covariates_contrastive_loss: 952337.7050; val_gene_expr_recon_loss: 1823405.7024; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17554.5840; val_global_loss: 3531653.8478; val_optim_loss: 3531653.8478
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.9278; val_auprc_score: 0.9859; val_best_acc_score: 0.9307; val_best_f1_score: 0.9610; train_kl_reg_loss: 28246.3358; train_edge_recon_loss: 688195.2438; train_cat_covariates_contrastive_loss: 953370.0079; train_gene_expr_recon_loss: 1818044.3615; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17623.8478; train_global_loss: 3505479.7968; train_optim_loss: 3505479.7968; val_kl_reg_loss: 29079.4045; val_edge_recon_loss: 707756.4918; val_cat_covariates_contrastive_loss: 953157.8224; val_gene_expr_recon_loss: 1820000.5437; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17539.9844; val_global_loss: 3527534.2612; val_optim_loss: 3527534.2612
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.9014; val_auprc_score: 0.9839; val_best_acc_score: 0.9083; val_best_f1_score: 0.9493; train_kl_reg_loss: 659043.3641; train_edge_recon_loss: 765475.1779; train_cat_covariates_contrastive_loss: 952992.4218; train_gene_expr_recon_loss: 5607418.7571; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 20743.6745; train_global_loss: 8005673.3981; train_optim_loss: 8005673.3981; val_kl_reg_loss: 123698.2038; val_edge_recon_loss: 950173.3322; val_cat_covariates_contrastive_loss: 951686.3798; val_gene_expr_recon_loss: 16896283.0311; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 22252.1895; val_global_loss: 18944092.9412; val_optim_loss: 18944092.9412
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.9264; val_auprc_score: 0.9856; val_best_acc_score: 0.9356; val_best_f1_score: 0.9638; train_kl_reg_loss: 91176.9438; train_edge_recon_loss: 760028.4351; train_cat_covariates_contrastive_loss: 953818.7069; train_gene_expr_recon_loss: 5902681.9433; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18758.1576; train_global_loss: 7726464.1717; train_optim_loss: 7726464.1717; val_kl_reg_loss: 36427.5985; val_edge_recon_loss: 708776.3581; val_cat_covariates_contrastive_loss: 954286.3663; val_gene_expr_recon_loss: 2039160.2963; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17211.1133; val_global_loss: 3755861.6194; val_optim_loss: 3755861.6194
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.9323; val_auprc_score: 0.9869; val_best_acc_score: 0.9364; val_best_f1_score: 0.9642; train_kl_reg_loss: 41496.0439; train_edge_recon_loss: 690807.2787; train_cat_covariates_contrastive_loss: 955186.1634; train_gene_expr_recon_loss: 1978161.7526; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17448.9307; train_global_loss: 3683100.1701; train_optim_loss: 3683100.1701; val_kl_reg_loss: 36405.0213; val_edge_recon_loss: 707248.1457; val_cat_covariates_contrastive_loss: 957893.6505; val_gene_expr_recon_loss: 1901175.1786; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17621.9551; val_global_loss: 3620343.9948; val_optim_loss: 3620343.9948
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.8546; val_auprc_score: 0.9748; val_best_acc_score: 0.8955; val_best_f1_score: 0.9428; train_kl_reg_loss: 14873032351.9006; train_edge_recon_loss: 860781.0385; train_cat_covariates_contrastive_loss: 952087.6640; train_gene_expr_recon_loss: 11877819.1653; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 22574.9557; train_global_loss: 14886745776.6892; train_optim_loss: 14886745776.6892; val_kl_reg_loss: 761693.8825; val_edge_recon_loss: 965919.2920; val_cat_covariates_contrastive_loss: 947271.0770; val_gene_expr_recon_loss: 14442172.7301; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 19178.4570; val_global_loss: 17136235.0104; val_optim_loss: 17136235.0104

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.8747; val_auprc_score: 0.9781; val_best_acc_score: 0.9031; val_best_f1_score: 0.9467; train_kl_reg_loss: 1267332.3766; train_edge_recon_loss: 902059.7713; train_cat_covariates_contrastive_loss: 950726.9964; train_gene_expr_recon_loss: 14029833.3661; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9871.1586; train_global_loss: 17159823.7429; train_optim_loss: 17159823.7429; val_kl_reg_loss: 153344.5554; val_edge_recon_loss: 856054.3908; val_cat_covariates_contrastive_loss: 954453.4356; val_gene_expr_recon_loss: 10692669.5433; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9583.5391; val_global_loss: 12666105.9343; val_optim_loss: 12666105.9343
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.8885; val_auprc_score: 0.9803; val_best_acc_score: 0.9044; val_best_f1_score: 0.9468; train_kl_reg_loss: 85799.6116; train_edge_recon_loss: 749989.1024; train_cat_covariates_contrastive_loss: 960635.6097; train_gene_expr_recon_loss: 3837894.9792; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 14162.6654; train_global_loss: 5648481.9750; train_optim_loss: 5648481.9750; val_kl_reg_loss: 60129.3928; val_edge_recon_loss: 736786.8914; val_cat_covariates_contrastive_loss: 962054.9358; val_gene_expr_recon_loss: 2805683.2976; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 11141.1553; val_global_loss: 4575795.5208; val_optim_loss: 4575795.5208
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.9011; val_auprc_score: 0.9823; val_best_acc_score: 0.9139; val_best_f1_score: 0.9519; train_kl_reg_loss: 52792.2235; train_edge_recon_loss: 707584.6315; train_cat_covariates_contrastive_loss: 960249.0659; train_gene_expr_recon_loss: 2728899.7664; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 10012.8058; train_global_loss: 4459538.4997; train_optim_loss: 4459538.4997; val_kl_reg_loss: 48588.3109; val_edge_recon_loss: 726384.3508; val_cat_covariates_contrastive_loss: 959738.7571; val_gene_expr_recon_loss: 2658754.0363; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9243.0830; val_global_loss: 4402708.4464; val_optim_loss: 4402708.4464
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.8958; val_auprc_score: 0.9808; val_best_acc_score: 0.9152; val_best_f1_score: 0.9526; train_kl_reg_loss: 90561858.5329; train_edge_recon_loss: 702874.6787; train_cat_covariates_contrastive_loss: 958089.2155; train_gene_expr_recon_loss: 2518907.3184; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 7427.2990; train_global_loss: 94749166.4683; train_optim_loss: 94749166.4683; val_kl_reg_loss: 33658.5291; val_edge_recon_loss: 725480.7729; val_cat_covariates_contrastive_loss: 956832.1391; val_gene_expr_recon_loss: 2462451.9438; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 6679.3369; val_global_loss: 4185102.7439; val_optim_loss: 4185102.7439

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 532 min 32 sec.
Using best model state, which was in epoch 18.

--- MODEL EVALUATION ---
val AUROC score: 0.8988
val AUPRC score: 0.9752
val best accuracy score: 0.9265
val best F1 score: 0.9587
val target rna MSE score: 0.4825
val source rna MSE score: 0.3007
Val cat covariate0 mean sim diff: -0.0011
Val cat covariate1 mean sim diff: -0.0554
Val cat covariate2 mean sim diff: -0.0012

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
