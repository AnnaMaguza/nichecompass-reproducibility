[True, False, True]
Run timestamp: 05092023_101353_4.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', 'batch7', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', 'patient', '--cat_covariates_no_edges', 'True', 'False', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '100', '--active_gp_thresh_ratio', '0.03', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '5', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '100000.0', '--contrastive_logits_pos_ratio', '0.015625', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--lambda_l1_addon', '1000.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_4']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch7...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 563097
Number of validation nodes: 62566
Number of training edges: 1330101
Number of validation edges: 147789
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9211; val_auprc_score: 0.9862; val_best_acc_score: 0.9247; val_best_f1_score: 0.9580; train_kl_reg_loss: 16039.1558; train_edge_recon_loss: 719001.5995; train_cat_covariates_contrastive_loss: 101500.8373; train_gene_expr_recon_loss: 2531627.4744; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 59594.0269; train_global_loss: 3427763.0932; train_optim_loss: 3427763.0932; val_kl_reg_loss: 17086.6838; val_edge_recon_loss: 719258.1538; val_cat_covariates_contrastive_loss: 101422.3475; val_gene_expr_recon_loss: 2169661.4879; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15541.3691; val_global_loss: 3022969.9152; val_optim_loss: 3022969.9152
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9314; val_auprc_score: 0.9877; val_best_acc_score: 0.9307; val_best_f1_score: 0.9611; train_kl_reg_loss: 18089.6544; train_edge_recon_loss: 693701.7271; train_cat_covariates_contrastive_loss: 101116.4459; train_gene_expr_recon_loss: 2048980.1781; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15852.7282; train_global_loss: 2877740.7337; train_optim_loss: 2877740.7337; val_kl_reg_loss: 19283.4765; val_edge_recon_loss: 718034.8867; val_cat_covariates_contrastive_loss: 99989.9423; val_gene_expr_recon_loss: 1971747.6479; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15961.5459; val_global_loss: 2825017.4533; val_optim_loss: 2825017.4533
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9381; val_auprc_score: 0.9889; val_best_acc_score: 0.9356; val_best_f1_score: 0.9638; train_kl_reg_loss: 19480.6562; train_edge_recon_loss: 690773.6763; train_cat_covariates_contrastive_loss: 100647.0033; train_gene_expr_recon_loss: 1938861.9618; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16193.5221; train_global_loss: 2765956.8183; train_optim_loss: 2765956.8183; val_kl_reg_loss: 20046.7073; val_edge_recon_loss: 709282.8420; val_cat_covariates_contrastive_loss: 100888.5703; val_gene_expr_recon_loss: 1913457.7755; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16265.4951; val_global_loss: 2759941.3875; val_optim_loss: 2759941.3875
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9391; val_auprc_score: 0.9892; val_best_acc_score: 0.9351; val_best_f1_score: 0.9637; train_kl_reg_loss: 20191.4604; train_edge_recon_loss: 688685.9195; train_cat_covariates_contrastive_loss: 100601.8608; train_gene_expr_recon_loss: 1898384.6068; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16313.9946; train_global_loss: 2724177.8387; train_optim_loss: 2724177.8387; val_kl_reg_loss: 20563.8617; val_edge_recon_loss: 706437.7677; val_cat_covariates_contrastive_loss: 100763.1388; val_gene_expr_recon_loss: 1884345.8971; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16474.5312; val_global_loss: 2728585.1721; val_optim_loss: 2728585.1721
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9433; val_auprc_score: 0.9898; val_best_acc_score: 0.9377; val_best_f1_score: 0.9649; train_kl_reg_loss: 20804.4312; train_edge_recon_loss: 689181.4017; train_cat_covariates_contrastive_loss: 100621.0455; train_gene_expr_recon_loss: 1874168.4719; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16603.3040; train_global_loss: 2701378.6526; train_optim_loss: 2701378.6526; val_kl_reg_loss: 21128.5103; val_edge_recon_loss: 720289.2191; val_cat_covariates_contrastive_loss: 100908.1941; val_gene_expr_recon_loss: 1865122.9810; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16753.4004; val_global_loss: 2724202.4031; val_optim_loss: 2724202.4031
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9407; val_auprc_score: 0.9893; val_best_acc_score: 0.9381; val_best_f1_score: 0.9652; train_kl_reg_loss: 21177.5933; train_edge_recon_loss: 688054.8392; train_cat_covariates_contrastive_loss: 100797.9744; train_gene_expr_recon_loss: 1857714.2139; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16762.7230; train_global_loss: 2684507.3437; train_optim_loss: 2684507.3437; val_kl_reg_loss: 21960.1501; val_edge_recon_loss: 707183.1127; val_cat_covariates_contrastive_loss: 100269.3405; val_gene_expr_recon_loss: 1853229.9715; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16742.6621; val_global_loss: 2699385.3261; val_optim_loss: 2699385.3261
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9434; val_auprc_score: 0.9901; val_best_acc_score: 0.9381; val_best_f1_score: 0.9652; train_kl_reg_loss: 21809.8567; train_edge_recon_loss: 685727.3483; train_cat_covariates_contrastive_loss: 100785.1708; train_gene_expr_recon_loss: 1846780.8193; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16869.6384; train_global_loss: 2671972.8365; train_optim_loss: 2671972.8365; val_kl_reg_loss: 21434.6969; val_edge_recon_loss: 709829.7477; val_cat_covariates_contrastive_loss: 101652.5696; val_gene_expr_recon_loss: 1845816.8910; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17060.1270; val_global_loss: 2695794.1557; val_optim_loss: 2695794.1557
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9451; val_auprc_score: 0.9902; val_best_acc_score: 0.9403; val_best_f1_score: 0.9664; train_kl_reg_loss: 22055.0479; train_edge_recon_loss: 688442.0345; train_cat_covariates_contrastive_loss: 100670.4997; train_gene_expr_recon_loss: 1835723.8333; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17019.0953; train_global_loss: 2663910.5102; train_optim_loss: 2663910.5102; val_kl_reg_loss: 21834.4189; val_edge_recon_loss: 705860.5703; val_cat_covariates_contrastive_loss: 101534.5330; val_gene_expr_recon_loss: 1835275.6064; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17047.6426; val_global_loss: 2681552.8728; val_optim_loss: 2681552.8728
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9445; val_auprc_score: 0.9901; val_best_acc_score: 0.9393; val_best_f1_score: 0.9659; train_kl_reg_loss: 22231.3437; train_edge_recon_loss: 686321.4047; train_cat_covariates_contrastive_loss: 100809.1886; train_gene_expr_recon_loss: 1828868.3605; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17135.2697; train_global_loss: 2655365.5666; train_optim_loss: 2655365.5666; val_kl_reg_loss: 22118.0073; val_edge_recon_loss: 711800.3865; val_cat_covariates_contrastive_loss: 101502.0964; val_gene_expr_recon_loss: 1830903.7811; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17184.3262; val_global_loss: 2683508.5182; val_optim_loss: 2683508.5182
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9459; val_auprc_score: 0.9903; val_best_acc_score: 0.9399; val_best_f1_score: 0.9661; train_kl_reg_loss: 22356.0537; train_edge_recon_loss: 687915.2898; train_cat_covariates_contrastive_loss: 100727.6662; train_gene_expr_recon_loss: 1821688.2560; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17241.4419; train_global_loss: 2649928.7076; train_optim_loss: 2649928.7076; val_kl_reg_loss: 22283.9985; val_edge_recon_loss: 717534.1436; val_cat_covariates_contrastive_loss: 101623.0991; val_gene_expr_recon_loss: 1826183.3413; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17249.0898; val_global_loss: 2684873.5839; val_optim_loss: 2684873.5839
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9481; val_auprc_score: 0.9907; val_best_acc_score: 0.9429; val_best_f1_score: 0.9678; train_kl_reg_loss: 22660.8548; train_edge_recon_loss: 687122.6761; train_cat_covariates_contrastive_loss: 100743.7759; train_gene_expr_recon_loss: 1817293.5349; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17358.6085; train_global_loss: 2645179.4488; train_optim_loss: 2645179.4488; val_kl_reg_loss: 22643.2988; val_edge_recon_loss: 710591.4001; val_cat_covariates_contrastive_loss: 101505.3743; val_gene_expr_recon_loss: 1818336.1860; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17573.4277; val_global_loss: 2670649.7682; val_optim_loss: 2670649.7682
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9460; val_auprc_score: 0.9901; val_best_acc_score: 0.9400; val_best_f1_score: 0.9662; train_kl_reg_loss: 22851.3913; train_edge_recon_loss: 687007.8224; train_cat_covariates_contrastive_loss: 100840.5022; train_gene_expr_recon_loss: 1812040.9506; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17519.3893; train_global_loss: 2640260.0553; train_optim_loss: 2640260.0553; val_kl_reg_loss: 23159.1311; val_edge_recon_loss: 706237.5331; val_cat_covariates_contrastive_loss: 101087.0637; val_gene_expr_recon_loss: 1814532.3534; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17801.3535; val_global_loss: 2662817.3330; val_optim_loss: 2662817.3330
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9440; val_auprc_score: 0.9896; val_best_acc_score: 0.9414; val_best_f1_score: 0.9670; train_kl_reg_loss: 22908.1037; train_edge_recon_loss: 686368.0902; train_cat_covariates_contrastive_loss: 100688.7584; train_gene_expr_recon_loss: 1807769.0344; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17671.6900; train_global_loss: 2635405.6753; train_optim_loss: 2635405.6753; val_kl_reg_loss: 23511.5064; val_edge_recon_loss: 713658.1556; val_cat_covariates_contrastive_loss: 100263.4093; val_gene_expr_recon_loss: 1823195.5087; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17731.1992; val_global_loss: 2678359.8296; val_optim_loss: 2678359.8296
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9465; val_auprc_score: 0.9902; val_best_acc_score: 0.9414; val_best_f1_score: 0.9669; train_kl_reg_loss: 23122.2795; train_edge_recon_loss: 686743.4615; train_cat_covariates_contrastive_loss: 100716.2307; train_gene_expr_recon_loss: 1805345.7716; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17830.4053; train_global_loss: 2633758.1479; train_optim_loss: 2633758.1479; val_kl_reg_loss: 23367.4058; val_edge_recon_loss: 710112.4588; val_cat_covariates_contrastive_loss: 100784.8423; val_gene_expr_recon_loss: 1803944.0666; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17963.5645; val_global_loss: 2656172.2716; val_optim_loss: 2656172.2716
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9488; val_auprc_score: 0.9909; val_best_acc_score: 0.9422; val_best_f1_score: 0.9675; train_kl_reg_loss: 23392.2830; train_edge_recon_loss: 686214.3713; train_cat_covariates_contrastive_loss: 100743.9552; train_gene_expr_recon_loss: 1801461.1683; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17977.0012; train_global_loss: 2629788.7781; train_optim_loss: 2629788.7781; val_kl_reg_loss: 23436.3174; val_edge_recon_loss: 703718.8524; val_cat_covariates_contrastive_loss: 101496.5120; val_gene_expr_recon_loss: 1802349.4922; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18077.6250; val_global_loss: 2649078.7578; val_optim_loss: 2649078.7578
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9349; val_auprc_score: 0.9879; val_best_acc_score: 0.9343; val_best_f1_score: 0.9632; train_kl_reg_loss: 23596.5995; train_edge_recon_loss: 686798.8972; train_cat_covariates_contrastive_loss: 100574.7542; train_gene_expr_recon_loss: 1823043.6565; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18180.5718; train_global_loss: 2652194.4784; train_optim_loss: 2652194.4784; val_kl_reg_loss: 23468.1353; val_edge_recon_loss: 723194.1631; val_cat_covariates_contrastive_loss: 99249.2891; val_gene_expr_recon_loss: 2236189.9740; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18063.8281; val_global_loss: 3100165.3114; val_optim_loss: 3100165.3114
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9486; val_auprc_score: 0.9908; val_best_acc_score: 0.9419; val_best_f1_score: 0.9674; train_kl_reg_loss: 24554.4767; train_edge_recon_loss: 684785.4515; train_cat_covariates_contrastive_loss: 100750.4315; train_gene_expr_recon_loss: 1834231.0160; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18170.3252; train_global_loss: 2662491.7009; train_optim_loss: 2662491.7009; val_kl_reg_loss: 23930.5600; val_edge_recon_loss: 710018.0428; val_cat_covariates_contrastive_loss: 102032.4596; val_gene_expr_recon_loss: 1800519.4775; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18247.3594; val_global_loss: 2654747.7837; val_optim_loss: 2654747.7837
