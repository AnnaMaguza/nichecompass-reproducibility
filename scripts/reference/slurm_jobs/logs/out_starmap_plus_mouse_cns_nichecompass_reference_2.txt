[True]
Run timestamp: 16082023_134422_2.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'starmap_plus_mouse_cns', '--reference_batches', 'batch1', 'batch2', 'batch3', '--n_neighbors', '8', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_2']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 1022, n_cat_covariates_embed_input: 0, n_hidden: 1022, n_latent: 1423, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1423, n_addon_gp_input: 10, n_cat_covariates_embed_input: 3, n_output: 1022
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1423, n_addon_gp_input: 10, n_cat_covariates_embed_input: 3, n_output: 1022

--- INITIALIZING TRAINER ---
Number of training nodes: 380406
Number of validation nodes: 42267
Number of training edges: 1759331
Number of validation edges: 195481
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9754; val_auprc_score: 0.9865; val_best_acc_score: 0.9608; val_best_f1_score: 0.9735; train_kl_reg_loss: 15259.8659; train_edge_recon_loss: 1445561.8338; train_gene_expr_recon_loss: 1663582.8126; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 3124404.5119; train_optim_loss: 3124404.5119; val_kl_reg_loss: 14350.4080; val_edge_recon_loss: 1425536.5638; val_gene_expr_recon_loss: 1441456.7569; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2881343.7395; val_optim_loss: 2881343.7395
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9787; val_auprc_score: 0.9882; val_best_acc_score: 0.9663; val_best_f1_score: 0.9772; train_kl_reg_loss: 15261.7192; train_edge_recon_loss: 1415079.8695; train_gene_expr_recon_loss: 1365222.8600; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2795564.4479; train_optim_loss: 2795564.4479; val_kl_reg_loss: 15816.5277; val_edge_recon_loss: 1419688.5949; val_gene_expr_recon_loss: 1322036.2369; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2757541.3632; val_optim_loss: 2757541.3632
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9787; val_auprc_score: 0.9880; val_best_acc_score: 0.9671; val_best_f1_score: 0.9778; train_kl_reg_loss: 16565.9668; train_edge_recon_loss: 1412792.9652; train_gene_expr_recon_loss: 1295408.4373; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2724767.3710; train_optim_loss: 2724767.3710; val_kl_reg_loss: 16927.4491; val_edge_recon_loss: 1420919.2448; val_gene_expr_recon_loss: 1289430.8619; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2727277.5530; val_optim_loss: 2727277.5530
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9818; val_auprc_score: 0.9905; val_best_acc_score: 0.9670; val_best_f1_score: 0.9776; train_kl_reg_loss: 17231.2834; train_edge_recon_loss: 1413570.1965; train_gene_expr_recon_loss: 1266289.8888; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2697091.3664; train_optim_loss: 2697091.3664; val_kl_reg_loss: 17934.5710; val_edge_recon_loss: 1421562.5497; val_gene_expr_recon_loss: 1263260.9300; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2702758.0471; val_optim_loss: 2702758.0471
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9825; val_auprc_score: 0.9908; val_best_acc_score: 0.9692; val_best_f1_score: 0.9792; train_kl_reg_loss: 17669.2299; train_edge_recon_loss: 1410363.5290; train_gene_expr_recon_loss: 1250298.0753; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2678330.8381; train_optim_loss: 2678330.8381; val_kl_reg_loss: 18004.9852; val_edge_recon_loss: 1416482.7703; val_gene_expr_recon_loss: 1251860.9509; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2686348.7016; val_optim_loss: 2686348.7016
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9824; val_auprc_score: 0.9908; val_best_acc_score: 0.9699; val_best_f1_score: 0.9796; train_kl_reg_loss: 18002.5734; train_edge_recon_loss: 1411186.1732; train_gene_expr_recon_loss: 1236941.0446; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2666129.7923; train_optim_loss: 2666129.7923; val_kl_reg_loss: 18379.1047; val_edge_recon_loss: 1416882.0713; val_gene_expr_recon_loss: 1240829.4172; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2676090.5884; val_optim_loss: 2676090.5884
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9829; val_auprc_score: 0.9910; val_best_acc_score: 0.9697; val_best_f1_score: 0.9794; train_kl_reg_loss: 18306.6334; train_edge_recon_loss: 1410114.5729; train_gene_expr_recon_loss: 1227581.6451; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2656002.8531; train_optim_loss: 2656002.8531; val_kl_reg_loss: 18618.0795; val_edge_recon_loss: 1416233.5193; val_gene_expr_recon_loss: 1230697.1361; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2665548.7356; val_optim_loss: 2665548.7356
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9830; val_auprc_score: 0.9909; val_best_acc_score: 0.9708; val_best_f1_score: 0.9802; train_kl_reg_loss: 18543.2369; train_edge_recon_loss: 1409272.1464; train_gene_expr_recon_loss: 1218768.9430; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2646584.3287; train_optim_loss: 2646584.3287; val_kl_reg_loss: 18747.0930; val_edge_recon_loss: 1421681.2428; val_gene_expr_recon_loss: 1228360.7219; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2668789.0635; val_optim_loss: 2668789.0635
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9841; val_auprc_score: 0.9919; val_best_acc_score: 0.9704; val_best_f1_score: 0.9800; train_kl_reg_loss: 18810.4811; train_edge_recon_loss: 1409508.7619; train_gene_expr_recon_loss: 1214022.0853; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2642341.3280; train_optim_loss: 2642341.3280; val_kl_reg_loss: 19318.8971; val_edge_recon_loss: 1414042.0592; val_gene_expr_recon_loss: 1216846.9741; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2650207.9247; val_optim_loss: 2650207.9247
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9823; val_auprc_score: 0.9904; val_best_acc_score: 0.9713; val_best_f1_score: 0.9806; train_kl_reg_loss: 18952.4090; train_edge_recon_loss: 1411560.9027; train_gene_expr_recon_loss: 1206664.9656; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2637178.2753; train_optim_loss: 2637178.2753; val_kl_reg_loss: 19291.8645; val_edge_recon_loss: 1412736.7415; val_gene_expr_recon_loss: 1228408.9257; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2660437.5373; val_optim_loss: 2660437.5373
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9833; val_auprc_score: 0.9908; val_best_acc_score: 0.9721; val_best_f1_score: 0.9811; train_kl_reg_loss: 19043.4818; train_edge_recon_loss: 1409577.9638; train_gene_expr_recon_loss: 1200897.8961; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2629519.3437; train_optim_loss: 2629519.3437; val_kl_reg_loss: 19196.1089; val_edge_recon_loss: 1419388.9418; val_gene_expr_recon_loss: 1206606.1633; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2645191.2147; val_optim_loss: 2645191.2147
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9833; val_auprc_score: 0.9908; val_best_acc_score: 0.9728; val_best_f1_score: 0.9815; train_kl_reg_loss: 19188.9549; train_edge_recon_loss: 1409153.5598; train_gene_expr_recon_loss: 1196905.4260; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2625247.9421; train_optim_loss: 2625247.9421; val_kl_reg_loss: 19316.1783; val_edge_recon_loss: 1411110.3040; val_gene_expr_recon_loss: 1210536.0900; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2640962.5694; val_optim_loss: 2640962.5694
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9844; val_auprc_score: 0.9914; val_best_acc_score: 0.9733; val_best_f1_score: 0.9819; train_kl_reg_loss: 19307.4253; train_edge_recon_loss: 1408360.5973; train_gene_expr_recon_loss: 1193248.6083; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2620916.6311; train_optim_loss: 2620916.6311; val_kl_reg_loss: 19181.7726; val_edge_recon_loss: 1416985.0010; val_gene_expr_recon_loss: 1195467.8171; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2631634.5825; val_optim_loss: 2631634.5825
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9839; val_auprc_score: 0.9913; val_best_acc_score: 0.9731; val_best_f1_score: 0.9818; train_kl_reg_loss: 19450.8168; train_edge_recon_loss: 1409017.1897; train_gene_expr_recon_loss: 1192185.7888; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2620653.7933; train_optim_loss: 2620653.7933; val_kl_reg_loss: 19357.7169; val_edge_recon_loss: 1413885.0560; val_gene_expr_recon_loss: 1192232.4925; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2625475.2677; val_optim_loss: 2625475.2677
