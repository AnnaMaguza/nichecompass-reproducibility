Run timestamp: 21062023_081058_1.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'xenium_human_breast_cancer', '--reference_batches', 'batch1', 'batch2', '--n_neighbors', '8', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cond_embed_injection', 'encoder', 'gene_expr_decoder', '--n_cond_embed', '2', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cond_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000.', '--lambda_gene_expr_recon', '300.', '--lambda_cond_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '10.0', '--edge_batch_size', '4096', '--node_batch_size', 'None', '--timestamp_suffix', '_1']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.05
LOG VARIATIONAL -> True
CONDITIONAL EMBEDDING INJECTION -> ['encoder', 'gene_expr_decoder']
ENCODER -> n_input: 313, n_cond_embed_input: 2, n_layers: 1, n_hidden: 313, n_latent: 1302, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> n_cond_embed_input: 0, n_cond_embed_output: 1302, dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1302, n_cond_embed_input: 2, n_addon_input: 0, n_output: 626
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 254127
Number of validation nodes: 28236
Number of training edges: 1155480
Number of validation edges: 128386
Edge batch size: 4096
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9542; val_auprc_score: 0.9685; val_best_acc_score: 0.9173; val_best_f1_score: 0.9395; train_kl_reg_loss: 6287.8519; train_edge_recon_loss: 191014.1868; train_gene_expr_recon_loss: 94526.1725; train_masked_gp_l1_reg_loss: 2019.2152; train_group_lasso_reg_loss: 0.0000; train_global_loss: 293847.4265; train_optim_loss: 293847.4265; val_kl_reg_loss: 6316.7522; val_edge_recon_loss: 183047.6880; val_gene_expr_recon_loss: 79947.8306; val_masked_gp_l1_reg_loss: 1889.1840; val_group_lasso_reg_loss: 0.0000; val_global_loss: 271201.4580; val_optim_loss: 271201.4580
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9697; val_auprc_score: 0.9801; val_best_acc_score: 0.9328; val_best_f1_score: 0.9505; train_kl_reg_loss: 5957.3236; train_edge_recon_loss: 181201.9222; train_gene_expr_recon_loss: 76833.9442; train_masked_gp_l1_reg_loss: 1878.2449; train_group_lasso_reg_loss: 0.0000; train_global_loss: 265871.4351; train_optim_loss: 265871.4351; val_kl_reg_loss: 5431.7565; val_edge_recon_loss: 180842.8877; val_gene_expr_recon_loss: 74232.1895; val_masked_gp_l1_reg_loss: 1838.1163; val_group_lasso_reg_loss: 0.0000; val_global_loss: 262344.9517; val_optim_loss: 262344.9517
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9776; val_auprc_score: 0.9853; val_best_acc_score: 0.9438; val_best_f1_score: 0.9582; train_kl_reg_loss: 5368.4436; train_edge_recon_loss: 179536.3670; train_gene_expr_recon_loss: 72855.0035; train_masked_gp_l1_reg_loss: 1757.0879; train_group_lasso_reg_loss: 0.0000; train_global_loss: 259516.9017; train_optim_loss: 259516.9017; val_kl_reg_loss: 5105.3985; val_edge_recon_loss: 180072.8291; val_gene_expr_recon_loss: 71308.4077; val_masked_gp_l1_reg_loss: 1671.0741; val_group_lasso_reg_loss: 0.0000; val_global_loss: 258157.7114; val_optim_loss: 258157.7114
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9812; val_auprc_score: 0.9880; val_best_acc_score: 0.9483; val_best_f1_score: 0.9616; train_kl_reg_loss: 5086.7497; train_edge_recon_loss: 178666.6204; train_gene_expr_recon_loss: 70462.8768; train_masked_gp_l1_reg_loss: 1573.1595; train_group_lasso_reg_loss: 0.0000; train_global_loss: 255789.4072; train_optim_loss: 255789.4072; val_kl_reg_loss: 4810.0607; val_edge_recon_loss: 179301.9146; val_gene_expr_recon_loss: 69413.8271; val_masked_gp_l1_reg_loss: 1477.9141; val_group_lasso_reg_loss: 0.0000; val_global_loss: 255003.7129; val_optim_loss: 255003.7129
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9823; val_auprc_score: 0.9887; val_best_acc_score: 0.9513; val_best_f1_score: 0.9638; train_kl_reg_loss: 4954.4108; train_edge_recon_loss: 178028.3609; train_gene_expr_recon_loss: 68869.6753; train_masked_gp_l1_reg_loss: 1399.0304; train_group_lasso_reg_loss: 0.0000; train_global_loss: 253251.4774; train_optim_loss: 253251.4774; val_kl_reg_loss: 4845.2583; val_edge_recon_loss: 178478.1177; val_gene_expr_recon_loss: 68172.8357; val_masked_gp_l1_reg_loss: 1324.7483; val_group_lasso_reg_loss: 0.0000; val_global_loss: 252820.9639; val_optim_loss: 252820.9639
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9844; val_auprc_score: 0.9900; val_best_acc_score: 0.9546; val_best_f1_score: 0.9661; train_kl_reg_loss: 4896.4089; train_edge_recon_loss: 177664.4870; train_gene_expr_recon_loss: 67811.0285; train_masked_gp_l1_reg_loss: 1262.6638; train_group_lasso_reg_loss: 0.0000; train_global_loss: 251634.5880; train_optim_loss: 251634.5880; val_kl_reg_loss: 4779.2971; val_edge_recon_loss: 178205.5107; val_gene_expr_recon_loss: 67279.6809; val_masked_gp_l1_reg_loss: 1204.8220; val_group_lasso_reg_loss: 0.0000; val_global_loss: 251469.3169; val_optim_loss: 251469.3169
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9860; val_auprc_score: 0.9912; val_best_acc_score: 0.9561; val_best_f1_score: 0.9673; train_kl_reg_loss: 4874.2063; train_edge_recon_loss: 177630.7168; train_gene_expr_recon_loss: 67074.3398; train_masked_gp_l1_reg_loss: 1160.6020; train_group_lasso_reg_loss: 0.0000; train_global_loss: 250739.8658; train_optim_loss: 250739.8658; val_kl_reg_loss: 4754.6228; val_edge_recon_loss: 178455.0542; val_gene_expr_recon_loss: 66645.5881; val_masked_gp_l1_reg_loss: 1119.2295; val_group_lasso_reg_loss: 0.0000; val_global_loss: 250974.4971; val_optim_loss: 250974.4971
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9858; val_auprc_score: 0.9911; val_best_acc_score: 0.9561; val_best_f1_score: 0.9674; train_kl_reg_loss: 4864.0818; train_edge_recon_loss: 177251.6165; train_gene_expr_recon_loss: 66560.4210; train_masked_gp_l1_reg_loss: 1089.9863; train_group_lasso_reg_loss: 0.0000; train_global_loss: 249766.1063; train_optim_loss: 249766.1063; val_kl_reg_loss: 4806.5011; val_edge_recon_loss: 177953.5049; val_gene_expr_recon_loss: 66118.4741; val_masked_gp_l1_reg_loss: 1060.2711; val_group_lasso_reg_loss: 0.0000; val_global_loss: 249938.7456; val_optim_loss: 249938.7456
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9863; val_auprc_score: 0.9914; val_best_acc_score: 0.9573; val_best_f1_score: 0.9682; train_kl_reg_loss: 4859.2414; train_edge_recon_loss: 177412.2451; train_gene_expr_recon_loss: 66114.2551; train_masked_gp_l1_reg_loss: 1039.6923; train_group_lasso_reg_loss: 0.0000; train_global_loss: 249425.4335; train_optim_loss: 249425.4335; val_kl_reg_loss: 4757.6741; val_edge_recon_loss: 177929.0171; val_gene_expr_recon_loss: 65853.8864; val_masked_gp_l1_reg_loss: 1020.9543; val_group_lasso_reg_loss: 0.0000; val_global_loss: 249561.5308; val_optim_loss: 249561.5308
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9878; val_auprc_score: 0.9924; val_best_acc_score: 0.9598; val_best_f1_score: 0.9699; train_kl_reg_loss: 4864.2300; train_edge_recon_loss: 177193.3854; train_gene_expr_recon_loss: 65742.2387; train_masked_gp_l1_reg_loss: 999.7156; train_group_lasso_reg_loss: 0.0000; train_global_loss: 248799.5693; train_optim_loss: 248799.5693; val_kl_reg_loss: 4831.5811; val_edge_recon_loss: 177432.0205; val_gene_expr_recon_loss: 65447.9716; val_masked_gp_l1_reg_loss: 981.5936; val_group_lasso_reg_loss: 0.0000; val_global_loss: 248693.1646; val_optim_loss: 248693.1646
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9876; val_auprc_score: 0.9922; val_best_acc_score: 0.9587; val_best_f1_score: 0.9692; train_kl_reg_loss: 4864.7766; train_edge_recon_loss: 177144.0824; train_gene_expr_recon_loss: 65467.7333; train_masked_gp_l1_reg_loss: 970.4440; train_group_lasso_reg_loss: 0.0000; train_global_loss: 248447.0363; train_optim_loss: 248447.0363; val_kl_reg_loss: 4791.4814; val_edge_recon_loss: 178109.0464; val_gene_expr_recon_loss: 65181.2692; val_masked_gp_l1_reg_loss: 960.3224; val_group_lasso_reg_loss: 0.0000; val_global_loss: 249042.1230; val_optim_loss: 249042.1230
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9881; val_auprc_score: 0.9926; val_best_acc_score: 0.9600; val_best_f1_score: 0.9702; train_kl_reg_loss: 4875.5186; train_edge_recon_loss: 176960.6867; train_gene_expr_recon_loss: 65193.3958; train_masked_gp_l1_reg_loss: 948.3168; train_group_lasso_reg_loss: 0.0000; train_global_loss: 247977.9173; train_optim_loss: 247977.9173; val_kl_reg_loss: 4842.3410; val_edge_recon_loss: 177514.6196; val_gene_expr_recon_loss: 64943.3003; val_masked_gp_l1_reg_loss: 937.5878; val_group_lasso_reg_loss: 0.0000; val_global_loss: 248237.8545; val_optim_loss: 248237.8545
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9888; val_auprc_score: 0.9931; val_best_acc_score: 0.9613; val_best_f1_score: 0.9710; train_kl_reg_loss: 4880.7194; train_edge_recon_loss: 176997.9426; train_gene_expr_recon_loss: 64987.5181; train_masked_gp_l1_reg_loss: 930.1374; train_group_lasso_reg_loss: 0.0000; train_global_loss: 247796.3176; train_optim_loss: 247796.3176; val_kl_reg_loss: 4779.8987; val_edge_recon_loss: 177904.4492; val_gene_expr_recon_loss: 64826.5743; val_masked_gp_l1_reg_loss: 923.9003; val_group_lasso_reg_loss: 0.0000; val_global_loss: 248434.8291; val_optim_loss: 248434.8291
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9892; val_auprc_score: 0.9933; val_best_acc_score: 0.9626; val_best_f1_score: 0.9722; train_kl_reg_loss: 4886.1634; train_edge_recon_loss: 177027.5051; train_gene_expr_recon_loss: 64838.7060; train_masked_gp_l1_reg_loss: 917.6211; train_group_lasso_reg_loss: 0.0000; train_global_loss: 247669.9964; train_optim_loss: 247669.9964; val_kl_reg_loss: 4812.6564; val_edge_recon_loss: 177521.4673; val_gene_expr_recon_loss: 64611.9160; val_masked_gp_l1_reg_loss: 914.5320; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247860.5723; val_optim_loss: 247860.5723
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9892; val_auprc_score: 0.9932; val_best_acc_score: 0.9625; val_best_f1_score: 0.9720; train_kl_reg_loss: 4886.5868; train_edge_recon_loss: 176885.3297; train_gene_expr_recon_loss: 64676.7476; train_masked_gp_l1_reg_loss: 910.0995; train_group_lasso_reg_loss: 0.0000; train_global_loss: 247358.7639; train_optim_loss: 247358.7639; val_kl_reg_loss: 4829.9248; val_edge_recon_loss: 177988.4116; val_gene_expr_recon_loss: 64485.0251; val_masked_gp_l1_reg_loss: 906.5461; val_group_lasso_reg_loss: 0.0000; val_global_loss: 248209.9082; val_optim_loss: 248209.9082
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9895; val_auprc_score: 0.9933; val_best_acc_score: 0.9633; val_best_f1_score: 0.9726; train_kl_reg_loss: 4899.2240; train_edge_recon_loss: 176852.8128; train_gene_expr_recon_loss: 64560.7661; train_masked_gp_l1_reg_loss: 902.8162; train_group_lasso_reg_loss: 0.0000; train_global_loss: 247215.6193; train_optim_loss: 247215.6193; val_kl_reg_loss: 4836.2464; val_edge_recon_loss: 177344.6562; val_gene_expr_recon_loss: 64292.0244; val_masked_gp_l1_reg_loss: 897.8260; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247370.7554; val_optim_loss: 247370.7554
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9903; val_auprc_score: 0.9940; val_best_acc_score: 0.9645; val_best_f1_score: 0.9734; train_kl_reg_loss: 4902.4102; train_edge_recon_loss: 176994.6726; train_gene_expr_recon_loss: 64404.5576; train_masked_gp_l1_reg_loss: 899.3157; train_group_lasso_reg_loss: 0.0000; train_global_loss: 247200.9570; train_optim_loss: 247200.9570; val_kl_reg_loss: 4809.0203; val_edge_recon_loss: 178191.2925; val_gene_expr_recon_loss: 64221.2549; val_masked_gp_l1_reg_loss: 896.3315; val_group_lasso_reg_loss: 0.0000; val_global_loss: 248117.8960; val_optim_loss: 248117.8960
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9902; val_auprc_score: 0.9940; val_best_acc_score: 0.9643; val_best_f1_score: 0.9734; train_kl_reg_loss: 4905.3710; train_edge_recon_loss: 177096.4884; train_gene_expr_recon_loss: 64320.1503; train_masked_gp_l1_reg_loss: 891.6344; train_group_lasso_reg_loss: 0.0000; train_global_loss: 247213.6444; train_optim_loss: 247213.6444; val_kl_reg_loss: 4829.9357; val_edge_recon_loss: 177039.2178; val_gene_expr_recon_loss: 64160.1083; val_masked_gp_l1_reg_loss: 889.1299; val_group_lasso_reg_loss: 0.0000; val_global_loss: 246918.3862; val_optim_loss: 246918.3862
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9906; val_auprc_score: 0.9941; val_best_acc_score: 0.9648; val_best_f1_score: 0.9737; train_kl_reg_loss: 4909.0233; train_edge_recon_loss: 176731.5732; train_gene_expr_recon_loss: 64244.0753; train_masked_gp_l1_reg_loss: 885.9565; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246770.6281; train_optim_loss: 246770.6281; val_kl_reg_loss: 4757.8249; val_edge_recon_loss: 177338.4507; val_gene_expr_recon_loss: 64100.1439; val_masked_gp_l1_reg_loss: 887.2021; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247083.6216; val_optim_loss: 247083.6216
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9903; val_auprc_score: 0.9939; val_best_acc_score: 0.9644; val_best_f1_score: 0.9733; train_kl_reg_loss: 4915.4068; train_edge_recon_loss: 176512.2507; train_gene_expr_recon_loss: 64172.9581; train_masked_gp_l1_reg_loss: 887.5055; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246488.1201; train_optim_loss: 246488.1201; val_kl_reg_loss: 4762.2559; val_edge_recon_loss: 177729.4736; val_gene_expr_recon_loss: 64035.1936; val_masked_gp_l1_reg_loss: 885.6658; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247412.5947; val_optim_loss: 247412.5947
