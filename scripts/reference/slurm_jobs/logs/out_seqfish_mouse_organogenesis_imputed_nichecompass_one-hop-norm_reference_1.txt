[True]
Run timestamp: 02082023_185832_1.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'seqfish_mouse_organogenesis_imputed', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', '--n_neighbors', '8', '--filter_genes', '--n_hvg', '4000', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '300', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '10', '--lambda_l1_addon', '20', '--edge_batch_size', '256', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_1']

Preparing the gene program mask...
Epoch 30/100 |██████--------------| 30.0% val_auroc_score: 0.9764; val_auprc_score: 0.9938; val_best_acc_score: 0.9725; val_best_f1_score: 0.9840; train_kl_reg_loss: 10539.5268; train_edge_recon_loss: 765884.4206; train_gene_expr_recon_loss: 1431210.7412; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2207634.6879; train_optim_loss: 2207634.6879; val_kl_reg_loss: 10510.1362; val_edge_recon_loss: 774643.8134; val_gene_expr_recon_loss: 1432861.0387; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2218014.9919; val_optim_loss: 2218014.9919
Epoch 31/100 |██████--------------| 31.0% val_auroc_score: 0.9783; val_auprc_score: 0.9946; val_best_acc_score: 0.9725; val_best_f1_score: 0.9841; train_kl_reg_loss: 10518.8571; train_edge_recon_loss: 761493.6260; train_gene_expr_recon_loss: 1431058.2045; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2203070.6864; train_optim_loss: 2203070.6864; val_kl_reg_loss: 10548.1942; val_edge_recon_loss: 757529.5416; val_gene_expr_recon_loss: 1433061.6106; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2201139.3552; val_optim_loss: 2201139.3552
Epoch 32/100 |██████--------------| 32.0% val_auroc_score: 0.9773; val_auprc_score: 0.9939; val_best_acc_score: 0.9721; val_best_f1_score: 0.9838; train_kl_reg_loss: 10537.1078; train_edge_recon_loss: 768732.3402; train_gene_expr_recon_loss: 1431127.6523; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2210397.1014; train_optim_loss: 2210397.1014; val_kl_reg_loss: 10574.0710; val_edge_recon_loss: 766545.7424; val_gene_expr_recon_loss: 1432247.7365; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2209367.5468; val_optim_loss: 2209367.5468
Epoch 33/100 |██████--------------| 33.0% val_auroc_score: 0.9779; val_auprc_score: 0.9945; val_best_acc_score: 0.9726; val_best_f1_score: 0.9841; train_kl_reg_loss: 10508.4775; train_edge_recon_loss: 761156.7497; train_gene_expr_recon_loss: 1430982.2069; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2202647.4315; train_optim_loss: 2202647.4315; val_kl_reg_loss: 10522.2466; val_edge_recon_loss: 768977.3752; val_gene_expr_recon_loss: 1432685.0980; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2212184.7266; val_optim_loss: 2212184.7266

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1.0000000000000002e-06.

Epoch 34/100 |██████--------------| 34.0% val_auroc_score: 0.9777; val_auprc_score: 0.9940; val_best_acc_score: 0.9730; val_best_f1_score: 0.9843; train_kl_reg_loss: 10510.4954; train_edge_recon_loss: 767547.8355; train_gene_expr_recon_loss: 1430830.9803; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2208889.3158; train_optim_loss: 2208889.3158; val_kl_reg_loss: 10508.8607; val_edge_recon_loss: 774253.3161; val_gene_expr_recon_loss: 1432859.7977; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2217621.9685; val_optim_loss: 2217621.9685
Epoch 35/100 |███████-------------| 35.0% val_auroc_score: 0.9766; val_auprc_score: 0.9942; val_best_acc_score: 0.9729; val_best_f1_score: 0.9843; train_kl_reg_loss: 10509.7982; train_edge_recon_loss: 761875.3278; train_gene_expr_recon_loss: 1430775.3465; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2203160.4742; train_optim_loss: 2203160.4742; val_kl_reg_loss: 10497.4499; val_edge_recon_loss: 764479.7001; val_gene_expr_recon_loss: 1432044.5405; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2207021.6799; val_optim_loss: 2207021.6799
Epoch 36/100 |███████-------------| 36.0% val_auroc_score: 0.9773; val_auprc_score: 0.9944; val_best_acc_score: 0.9719; val_best_f1_score: 0.9837; train_kl_reg_loss: 10508.5400; train_edge_recon_loss: 760063.3423; train_gene_expr_recon_loss: 1431030.7038; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2201602.5883; train_optim_loss: 2201602.5883; val_kl_reg_loss: 10510.9786; val_edge_recon_loss: 776336.2761; val_gene_expr_recon_loss: 1432961.0917; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2219808.3561; val_optim_loss: 2219808.3561
Epoch 37/100 |███████-------------| 37.0% val_auroc_score: 0.9752; val_auprc_score: 0.9939; val_best_acc_score: 0.9724; val_best_f1_score: 0.9840; train_kl_reg_loss: 10510.6973; train_edge_recon_loss: 766830.6477; train_gene_expr_recon_loss: 1430993.9043; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 2208335.2533; train_optim_loss: 2208335.2533; val_kl_reg_loss: 10503.6781; val_edge_recon_loss: 762099.9573; val_gene_expr_recon_loss: 1432795.0450; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 2205398.6853; val_optim_loss: 2205398.6853

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 476 min 48 sec.
Using best model state, which was in epoch 29.

--- MODEL EVALUATION ---
val AUROC score: 0.9771
val AUPRC score: 0.9942
val best accuracy score: 0.9716
val best F1 score: 0.9835
val target rna MSE score: 1.0977
val source rna MSE score: 0.4778
Val cat covariate0 mean sim diff: -0.0005

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
