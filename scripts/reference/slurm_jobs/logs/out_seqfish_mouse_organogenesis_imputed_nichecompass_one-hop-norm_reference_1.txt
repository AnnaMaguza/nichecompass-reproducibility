[True]
Run timestamp: 26072023_185754_1.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'seqfish_mouse_organogenesis_imputed', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', '--n_neighbors', '4', '--filter_genes', '--n_hvg', '4000', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.0', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '300', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_1']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Filtering genes...
Starting with 29452 genes.
Keeping 29452 genes after filtering genes with expression in 0 cells.
Keeping 4032 highly variable or gene program relevant genes.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ENCODER -> n_input: 4032, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 1540, n_latent: 1540, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1540, n_cat_covariates_embed_input: 3, n_addon_input: 0, n_output: 8064
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 47311
Number of validation nodes: 5257
Number of training edges: 109836
Number of validation edges: 12204
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.8430; val_auprc_score: 0.9680; val_best_acc_score: 0.8691; val_best_f1_score: 0.9278; train_kl_reg_loss: 83878.5893; train_edge_recon_loss: 116625.5059; train_gene_expr_recon_loss: 1705369.5070; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 1905873.5953; train_optim_loss: 1905873.5953; val_kl_reg_loss: 68887.9961; val_edge_recon_loss: 118555.7412; val_gene_expr_recon_loss: 1074930.1979; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 1262373.9323; val_optim_loss: 1262373.9323
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.8607; val_auprc_score: 0.9702; val_best_acc_score: 0.8781; val_best_f1_score: 0.9324; train_kl_reg_loss: 59492.9283; train_edge_recon_loss: 116572.5765; train_gene_expr_recon_loss: 1020384.6401; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 1196450.1477; train_optim_loss: 1196450.1477; val_kl_reg_loss: 48688.7778; val_edge_recon_loss: 117179.1270; val_gene_expr_recon_loss: 988601.1198; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 1154469.0260; val_optim_loss: 1154469.0260
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.8785; val_auprc_score: 0.9732; val_best_acc_score: 0.8889; val_best_f1_score: 0.9377; train_kl_reg_loss: 44573.9574; train_edge_recon_loss: 115468.5141; train_gene_expr_recon_loss: 965564.0782; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 1125606.5500; train_optim_loss: 1125606.5500; val_kl_reg_loss: 38487.5908; val_edge_recon_loss: 114818.5199; val_gene_expr_recon_loss: 949091.7396; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 1102397.8542; val_optim_loss: 1102397.8542
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.8996; val_auprc_score: 0.9787; val_best_acc_score: 0.8965; val_best_f1_score: 0.9414; train_kl_reg_loss: 37003.4187; train_edge_recon_loss: 113450.0148; train_gene_expr_recon_loss: 932289.7125; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 1082743.1430; train_optim_loss: 1082743.1430; val_kl_reg_loss: 33401.3784; val_edge_recon_loss: 112777.4163; val_gene_expr_recon_loss: 921168.0182; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 1067346.8125; val_optim_loss: 1067346.8125
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9072; val_auprc_score: 0.9798; val_best_acc_score: 0.9078; val_best_f1_score: 0.9469; train_kl_reg_loss: 32824.2289; train_edge_recon_loss: 109987.9475; train_gene_expr_recon_loss: 907340.9320; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 1050153.1073; train_optim_loss: 1050153.1073; val_kl_reg_loss: 29871.4297; val_edge_recon_loss: 109543.5762; val_gene_expr_recon_loss: 900411.8490; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 1039826.8542; val_optim_loss: 1039826.8542
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9174; val_auprc_score: 0.9821; val_best_acc_score: 0.9186; val_best_f1_score: 0.9534; train_kl_reg_loss: 30195.2949; train_edge_recon_loss: 106701.4885; train_gene_expr_recon_loss: 886168.8538; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 1023065.6369; train_optim_loss: 1023065.6369; val_kl_reg_loss: 27814.6445; val_edge_recon_loss: 105700.4150; val_gene_expr_recon_loss: 878436.2292; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 1011951.2865; val_optim_loss: 1011951.2865
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9235; val_auprc_score: 0.9837; val_best_acc_score: 0.9233; val_best_f1_score: 0.9562; train_kl_reg_loss: 27937.8065; train_edge_recon_loss: 103202.5871; train_gene_expr_recon_loss: 867579.2401; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 998719.6363; train_optim_loss: 998719.6363; val_kl_reg_loss: 26219.2010; val_edge_recon_loss: 100722.1641; val_gene_expr_recon_loss: 860781.6615; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 987723.0312; val_optim_loss: 987723.0312
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9310; val_auprc_score: 0.9855; val_best_acc_score: 0.9233; val_best_f1_score: 0.9560; train_kl_reg_loss: 25848.6137; train_edge_recon_loss: 100695.2264; train_gene_expr_recon_loss: 850604.7262; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 977148.5642; train_optim_loss: 977148.5642; val_kl_reg_loss: 23949.1269; val_edge_recon_loss: 101409.4941; val_gene_expr_recon_loss: 844824.3854; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 970183.0052; val_optim_loss: 970183.0052
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9323; val_auprc_score: 0.9851; val_best_acc_score: 0.9254; val_best_f1_score: 0.9570; train_kl_reg_loss: 24089.5049; train_edge_recon_loss: 100567.2782; train_gene_expr_recon_loss: 834938.8337; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 959595.6140; train_optim_loss: 959595.6140; val_kl_reg_loss: 22461.3260; val_edge_recon_loss: 100659.6071; val_gene_expr_recon_loss: 829751.6901; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 952872.6198; val_optim_loss: 952872.6198
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9418; val_auprc_score: 0.9874; val_best_acc_score: 0.9346; val_best_f1_score: 0.9623; train_kl_reg_loss: 22168.6922; train_edge_recon_loss: 95956.6816; train_gene_expr_recon_loss: 820128.7090; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 938254.0823; train_optim_loss: 938254.0823; val_kl_reg_loss: 20553.8998; val_edge_recon_loss: 96744.6647; val_gene_expr_recon_loss: 815335.7083; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 932634.2812; val_optim_loss: 932634.2812
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9236; val_auprc_score: 0.9834; val_best_acc_score: 0.9215; val_best_f1_score: 0.9546; train_kl_reg_loss: 21149.3095; train_edge_recon_loss: 97388.9089; train_gene_expr_recon_loss: 829489.5267; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 948027.7451; train_optim_loss: 948027.7451; val_kl_reg_loss: 19005.9484; val_edge_recon_loss: 97699.6012; val_gene_expr_recon_loss: 815787.5599; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 932493.1120; val_optim_loss: 932493.1120
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9389; val_auprc_score: 0.9868; val_best_acc_score: 0.9326; val_best_f1_score: 0.9611; train_kl_reg_loss: 19085.1135; train_edge_recon_loss: 95279.3776; train_gene_expr_recon_loss: 801880.9860; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 916245.4779; train_optim_loss: 916245.4779; val_kl_reg_loss: 17848.3456; val_edge_recon_loss: 92827.9199; val_gene_expr_recon_loss: 797898.8698; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 908575.1302; val_optim_loss: 908575.1302
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.8892; val_auprc_score: 0.9763; val_best_acc_score: 0.8941; val_best_f1_score: 0.9402; train_kl_reg_loss: 18839.1812; train_edge_recon_loss: 96450.3495; train_gene_expr_recon_loss: 848472.9427; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 963762.4727; train_optim_loss: 963762.4727; val_kl_reg_loss: 14166.8112; val_edge_recon_loss: 106632.4785; val_gene_expr_recon_loss: 822918.8542; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 943718.1380; val_optim_loss: 943718.1380
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9166; val_auprc_score: 0.9827; val_best_acc_score: 0.9112; val_best_f1_score: 0.9493; train_kl_reg_loss: 14967.1529; train_edge_recon_loss: 97940.2572; train_gene_expr_recon_loss: 797672.7808; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 910580.1901; train_optim_loss: 910580.1901; val_kl_reg_loss: 14881.7455; val_edge_recon_loss: 94951.8210; val_gene_expr_recon_loss: 790045.7917; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 899879.3594; val_optim_loss: 899879.3594
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9310; val_auprc_score: 0.9841; val_best_acc_score: 0.9270; val_best_f1_score: 0.9582; train_kl_reg_loss: 15011.9664; train_edge_recon_loss: 92227.5322; train_gene_expr_recon_loss: 781276.0381; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 888515.5355; train_optim_loss: 888515.5355; val_kl_reg_loss: 14240.8347; val_edge_recon_loss: 91529.8604; val_gene_expr_recon_loss: 779504.2995; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 885274.9948; val_optim_loss: 885274.9948
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9307; val_auprc_score: 0.9844; val_best_acc_score: 0.9297; val_best_f1_score: 0.9596; train_kl_reg_loss: 14320.9770; train_edge_recon_loss: 90467.0665; train_gene_expr_recon_loss: 771942.0427; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 876730.0858; train_optim_loss: 876730.0858; val_kl_reg_loss: 13588.4051; val_edge_recon_loss: 91550.4023; val_gene_expr_recon_loss: 770727.4714; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 875866.2812; val_optim_loss: 875866.2812
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9393; val_auprc_score: 0.9864; val_best_acc_score: 0.9332; val_best_f1_score: 0.9618; train_kl_reg_loss: 13436.6189; train_edge_recon_loss: 88043.6459; train_gene_expr_recon_loss: 764186.0590; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 865666.3230; train_optim_loss: 865666.3230; val_kl_reg_loss: 12667.1892; val_edge_recon_loss: 88217.3532; val_gene_expr_recon_loss: 763204.7839; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 864089.3333; val_optim_loss: 864089.3333
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9435; val_auprc_score: 0.9863; val_best_acc_score: 0.9387; val_best_f1_score: 0.9647; train_kl_reg_loss: 12563.7052; train_edge_recon_loss: 87445.8681; train_gene_expr_recon_loss: 757423.7462; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 857433.3189; train_optim_loss: 857433.3189; val_kl_reg_loss: 11649.3516; val_edge_recon_loss: 88107.0785; val_gene_expr_recon_loss: 757505.5833; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 857262.0156; val_optim_loss: 857262.0156
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9429; val_auprc_score: 0.9873; val_best_acc_score: 0.9356; val_best_f1_score: 0.9629; train_kl_reg_loss: 11663.6118; train_edge_recon_loss: 86307.1775; train_gene_expr_recon_loss: 751244.0282; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 849214.8186; train_optim_loss: 849214.8186; val_kl_reg_loss: 10976.2780; val_edge_recon_loss: 87064.8685; val_gene_expr_recon_loss: 751795.9922; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 849837.1328; val_optim_loss: 849837.1328
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9445; val_auprc_score: 0.9875; val_best_acc_score: 0.9395; val_best_f1_score: 0.9653; train_kl_reg_loss: 10877.0515; train_edge_recon_loss: 84734.4363; train_gene_expr_recon_loss: 745888.3666; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 841499.8538; train_optim_loss: 841499.8538; val_kl_reg_loss: 10208.6616; val_edge_recon_loss: 84203.7816; val_gene_expr_recon_loss: 746249.1536; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 840661.5964; val_optim_loss: 840661.5964
