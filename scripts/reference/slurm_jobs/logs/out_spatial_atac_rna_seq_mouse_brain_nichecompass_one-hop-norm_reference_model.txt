First script finished. Launching follow up script.
Run timestamp: 01062023_175403.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'spatial_atac_rna_seq_mouse_brain_batch2', '--reference_batches', 'None', '--n_neighbors', '8', '--filter_genes', '--n_hvg', '3000', '--nichenet_keep_target_genes_ratio', '0.01', '--nichenet_max_n_target_genes_per_gp', '1000', '--include_mebocost_gps', '--mebocost_species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--include_atac_modality', '--filter_peaks', '--min_cell_peak_thresh_ratio', '0.0005', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cond_embed_injection', 'gene_expr_decoder', 'chrom_access_decoder', '--n_cond_embed', 'None', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cond_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000.', '--lambda_gene_expr_recon', '300.', '--lambda_chrom_access_recon', '100.', '--lambda_cond_contrastive', '0.', '--contrastive_logits_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '5.', '--edge_batch_size', '4096', '--node_batch_size', 'None']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 1725.
Number of gene programs after filtering and combining: 1583.

Filtering genes...
Starting with 22914 genes.
Keeping 22914 genes after filtering genes with expression in 0 cells.
Keeping 4962 highly variable or gene program relevant genes.
Keeping 3715 genes after filtering genes not in gp dict.

Filtering peaks...
Starting with 121068 peaks.
Keeping 121068 peaks after filtering  peaks with counts in less than 4 cells.
Keeping 17078 peaks after filtering peaks with no matching genes in gp mask.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb, include_chrom_access_recon_loss: True, chrom_access_recon_dist: nb 
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.05
LOG VARIATIONAL -> True
CONDITIONAL EMBEDDING INJECTION -> ['gene_expr_decoder', 'chrom_access_decoder']
ENCODER -> n_input: 20755, n_cond_embed_input: 0, n_layers: 1, n_hidden: 1486, n_latent: 1486, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> n_cond_embed_input: 0, n_cond_embed_output: 1486, dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1486, n_cond_embed_input: 1486, n_addon_input: 0, n_output: 7354
MASKED CHROMATIN ACCESSIBILITY DECODER -> n_input: 1486, n_cond_embed_input: 1486, n_addon_input: 0, n_output: 34156
ONE HOP GCN NORM NODE LABEL AGGREGATOR -> self_loops: True

--- INITIALIZING TRAINER ---
Number of training nodes: 8293
Number of validation nodes: 922
Number of training edges: 33399
Number of validation edges: 3711
Edge batch size: 4096
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9032; val_auprc_score: 0.9193; val_best_acc_score: 0.6019; val_best_f1_score: 0.7121; train_kl_reg_loss: 3067.3697; train_edge_recon_loss: 347569.4549; train_gene_expr_recon_loss: 437703.8542; train_masked_gp_l1_reg_loss: 2846.0202; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 520322.0243; train_global_loss: 1311508.7222; train_optim_loss: 1311508.7222; val_kl_reg_loss: 1305.0789; val_edge_recon_loss: 405883.9688; val_gene_expr_recon_loss: 389264.5625; val_masked_gp_l1_reg_loss: 2093.3718; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 497390.6875; val_global_loss: 1295937.7500; val_optim_loss: 1295937.7500
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9050; val_auprc_score: 0.9145; val_best_acc_score: 0.8193; val_best_f1_score: 0.8054; train_kl_reg_loss: 1189.7984; train_edge_recon_loss: 346836.5521; train_gene_expr_recon_loss: 382079.1424; train_masked_gp_l1_reg_loss: 1637.8032; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 495779.5104; train_global_loss: 1227522.8194; train_optim_loss: 1227522.8194; val_kl_reg_loss: 862.4034; val_edge_recon_loss: 402827.2812; val_gene_expr_recon_loss: 376532.4375; val_masked_gp_l1_reg_loss: 1160.5986; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 489332.7500; val_global_loss: 1270715.5000; val_optim_loss: 1270715.5000
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.8981; val_auprc_score: 0.8990; val_best_acc_score: 0.8069; val_best_f1_score: 0.8205; train_kl_reg_loss: 737.9814; train_edge_recon_loss: 345906.6076; train_gene_expr_recon_loss: 371764.5278; train_masked_gp_l1_reg_loss: 925.0087; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 490378.0833; train_global_loss: 1209712.2361; train_optim_loss: 1209712.2361; val_kl_reg_loss: 492.1569; val_edge_recon_loss: 385556.5312; val_gene_expr_recon_loss: 370336.5938; val_masked_gp_l1_reg_loss: 725.0870; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 485975.3750; val_global_loss: 1243085.7500; val_optim_loss: 1243085.7500
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.8722; val_auprc_score: 0.8693; val_best_acc_score: 0.7820; val_best_f1_score: 0.7913; train_kl_reg_loss: 773.7621; train_edge_recon_loss: 337788.5278; train_gene_expr_recon_loss: 370271.5521; train_masked_gp_l1_reg_loss: 622.7377; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 488672.8715; train_global_loss: 1198129.4444; train_optim_loss: 1198129.4444; val_kl_reg_loss: 1813.9202; val_edge_recon_loss: 295708.3125; val_gene_expr_recon_loss: 367222.5938; val_masked_gp_l1_reg_loss: 492.7605; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 484687.7812; val_global_loss: 1149925.3750; val_optim_loss: 1149925.3750
Epoch 5/100 |â–ˆ-------------------| 5.0% val_auroc_score: 0.8615; val_auprc_score: 0.8409; val_best_acc_score: 0.7812; val_best_f1_score: 0.8037; train_kl_reg_loss: 6146.7636; train_edge_recon_loss: 292679.9792; train_gene_expr_recon_loss: 366625.6319; train_masked_gp_l1_reg_loss: 420.8956; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 487260.3229; train_global_loss: 1153133.5833; train_optim_loss: 1153133.5833; val_kl_reg_loss: 10852.2510; val_edge_recon_loss: 285110.0625; val_gene_expr_recon_loss: 365456.4688; val_masked_gp_l1_reg_loss: 351.6257; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 483908.1562; val_global_loss: 1145678.5000; val_optim_loss: 1145678.5000
