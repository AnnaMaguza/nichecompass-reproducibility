[True, False, True]
Run timestamp: 02092023_121416_3.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', 'batch7', 'batch8', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', 'patient', '--cat_covariates_no_edges', 'True', 'False', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '100', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '5', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '1000000.0', '--contrastive_logits_pos_ratio', '0.0625', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--lambda_l1_addon', '1000.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_3']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch7...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch8...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 631979
Number of validation nodes: 70220
Number of training edges: 1492281
Number of validation edges: 165809
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8944; val_auprc_score: 0.9840; val_best_acc_score: 0.9213; val_best_f1_score: 0.9570; train_kl_reg_loss: 20311.3667; train_edge_recon_loss: 657289.9251; train_cat_covariates_contrastive_loss: 952749.4241; train_gene_expr_recon_loss: 2533147.4257; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 55246.4664; train_global_loss: 4218744.6105; train_optim_loss: 4218744.6105; val_kl_reg_loss: 21790.0398; val_edge_recon_loss: 651387.5675; val_cat_covariates_contrastive_loss: 954250.0739; val_gene_expr_recon_loss: 2195760.6779; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 14809.4541; val_global_loss: 3837997.8511; val_optim_loss: 3837997.8511
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8932; val_auprc_score: 0.9827; val_best_acc_score: 0.9197; val_best_f1_score: 0.9558; train_kl_reg_loss: 23624.7859; train_edge_recon_loss: 631608.1656; train_cat_covariates_contrastive_loss: 954167.7412; train_gene_expr_recon_loss: 2077952.3558; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15045.8950; train_global_loss: 3702398.9450; train_optim_loss: 3702398.9450; val_kl_reg_loss: 25569.8306; val_edge_recon_loss: 660562.0655; val_cat_covariates_contrastive_loss: 951339.8679; val_gene_expr_recon_loss: 2009762.1740; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15123.2490; val_global_loss: 3662357.1852; val_optim_loss: 3662357.1852
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9127; val_auprc_score: 0.9865; val_best_acc_score: 0.9283; val_best_f1_score: 0.9605; train_kl_reg_loss: 25045.6230; train_edge_recon_loss: 625384.2963; train_cat_covariates_contrastive_loss: 954237.8252; train_gene_expr_recon_loss: 1975955.4587; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15411.4969; train_global_loss: 3596034.6991; train_optim_loss: 3596034.6991; val_kl_reg_loss: 25460.1148; val_edge_recon_loss: 647139.1260; val_cat_covariates_contrastive_loss: 954352.8740; val_gene_expr_recon_loss: 1954789.8846; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15780.7432; val_global_loss: 3597522.7562; val_optim_loss: 3597522.7562
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9115; val_auprc_score: 0.9863; val_best_acc_score: 0.9263; val_best_f1_score: 0.9594; train_kl_reg_loss: 25658.2856; train_edge_recon_loss: 626460.9302; train_cat_covariates_contrastive_loss: 954436.5169; train_gene_expr_recon_loss: 1938372.1750; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15672.7646; train_global_loss: 3560600.6740; train_optim_loss: 3560600.6740; val_kl_reg_loss: 25567.4301; val_edge_recon_loss: 642045.6949; val_cat_covariates_contrastive_loss: 954350.2303; val_gene_expr_recon_loss: 1928560.7056; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15558.2490; val_global_loss: 3566082.3025; val_optim_loss: 3566082.3025
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9158; val_auprc_score: 0.9868; val_best_acc_score: 0.9299; val_best_f1_score: 0.9614; train_kl_reg_loss: 26158.7549; train_edge_recon_loss: 624877.9723; train_cat_covariates_contrastive_loss: 954489.8154; train_gene_expr_recon_loss: 1916661.6908; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15849.3575; train_global_loss: 3538037.5925; train_optim_loss: 3538037.5925; val_kl_reg_loss: 27779.8959; val_edge_recon_loss: 648182.2962; val_cat_covariates_contrastive_loss: 953934.1875; val_gene_expr_recon_loss: 1914233.8329; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15829.8945; val_global_loss: 3559960.2207; val_optim_loss: 3559960.2207
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9140; val_auprc_score: 0.9863; val_best_acc_score: 0.9286; val_best_f1_score: 0.9607; train_kl_reg_loss: 26333.9830; train_edge_recon_loss: 624870.1978; train_cat_covariates_contrastive_loss: 954438.0801; train_gene_expr_recon_loss: 1901369.2804; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15873.9623; train_global_loss: 3522885.5038; train_optim_loss: 3522885.5038; val_kl_reg_loss: 26283.2051; val_edge_recon_loss: 645721.2590; val_cat_covariates_contrastive_loss: 954019.9196; val_gene_expr_recon_loss: 1896923.2689; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15898.9277; val_global_loss: 3538846.6528; val_optim_loss: 3538846.6528
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9079; val_auprc_score: 0.9856; val_best_acc_score: 0.9243; val_best_f1_score: 0.9583; train_kl_reg_loss: 26800.7538; train_edge_recon_loss: 625023.1318; train_cat_covariates_contrastive_loss: 954731.9386; train_gene_expr_recon_loss: 1888860.8568; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15915.1057; train_global_loss: 3511331.7892; train_optim_loss: 3511331.7892; val_kl_reg_loss: 27062.6576; val_edge_recon_loss: 641798.3144; val_cat_covariates_contrastive_loss: 953211.4724; val_gene_expr_recon_loss: 1886692.6427; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15904.5889; val_global_loss: 3524669.5934; val_optim_loss: 3524669.5934
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9162; val_auprc_score: 0.9868; val_best_acc_score: 0.9300; val_best_f1_score: 0.9615; train_kl_reg_loss: 27148.5375; train_edge_recon_loss: 621264.5710; train_cat_covariates_contrastive_loss: 954944.3113; train_gene_expr_recon_loss: 1877290.5727; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16231.3094; train_global_loss: 3496879.3021; train_optim_loss: 3496879.3021; val_kl_reg_loss: 28188.5310; val_edge_recon_loss: 637860.1955; val_cat_covariates_contrastive_loss: 952964.3013; val_gene_expr_recon_loss: 1876248.2485; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16285.3398; val_global_loss: 3511546.5293; val_optim_loss: 3511546.5293
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9183; val_auprc_score: 0.9873; val_best_acc_score: 0.9297; val_best_f1_score: 0.9613; train_kl_reg_loss: 27541.0212; train_edge_recon_loss: 624494.7684; train_cat_covariates_contrastive_loss: 955059.0819; train_gene_expr_recon_loss: 1866694.9280; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16563.2654; train_global_loss: 3490353.0669; train_optim_loss: 3490353.0669; val_kl_reg_loss: 26716.0759; val_edge_recon_loss: 637495.9181; val_cat_covariates_contrastive_loss: 956415.1796; val_gene_expr_recon_loss: 1864756.8908; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16552.6523; val_global_loss: 3501936.8171; val_optim_loss: 3501936.8171
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9210; val_auprc_score: 0.9878; val_best_acc_score: 0.9310; val_best_f1_score: 0.9619; train_kl_reg_loss: 27849.0526; train_edge_recon_loss: 623951.7571; train_cat_covariates_contrastive_loss: 955287.0606; train_gene_expr_recon_loss: 1860389.5118; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16750.8823; train_global_loss: 3484228.2647; train_optim_loss: 3484228.2647; val_kl_reg_loss: 26743.1465; val_edge_recon_loss: 642913.5977; val_cat_covariates_contrastive_loss: 958117.7645; val_gene_expr_recon_loss: 1883734.6381; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16808.3613; val_global_loss: 3528317.3935; val_optim_loss: 3528317.3935
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9137; val_auprc_score: 0.9859; val_best_acc_score: 0.9298; val_best_f1_score: 0.9612; train_kl_reg_loss: 28137.0439; train_edge_recon_loss: 623292.9726; train_cat_covariates_contrastive_loss: 955440.0899; train_gene_expr_recon_loss: 1853168.6095; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16888.8990; train_global_loss: 3476927.6163; train_optim_loss: 3476927.6163; val_kl_reg_loss: 28314.5493; val_edge_recon_loss: 647348.2357; val_cat_covariates_contrastive_loss: 953352.3164; val_gene_expr_recon_loss: 1866102.5575; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16855.9473; val_global_loss: 3511973.6551; val_optim_loss: 3511973.6551
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9128; val_auprc_score: 0.9861; val_best_acc_score: 0.9249; val_best_f1_score: 0.9588; train_kl_reg_loss: 28444.2798; train_edge_recon_loss: 620369.2232; train_cat_covariates_contrastive_loss: 955556.4695; train_gene_expr_recon_loss: 1848733.6027; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16996.6610; train_global_loss: 3470100.2357; train_optim_loss: 3470100.2357; val_kl_reg_loss: 29555.6619; val_edge_recon_loss: 638943.6343; val_cat_covariates_contrastive_loss: 954010.1356; val_gene_expr_recon_loss: 1851727.1042; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17032.2344; val_global_loss: 3491268.7809; val_optim_loss: 3491268.7809
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9089; val_auprc_score: 0.9854; val_best_acc_score: 0.9242; val_best_f1_score: 0.9582; train_kl_reg_loss: 28478.5176; train_edge_recon_loss: 622040.1691; train_cat_covariates_contrastive_loss: 955460.4368; train_gene_expr_recon_loss: 1842159.3539; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17099.0329; train_global_loss: 3465237.5095; train_optim_loss: 3465237.5095; val_kl_reg_loss: 29145.6067; val_edge_recon_loss: 638113.6335; val_cat_covariates_contrastive_loss: 954292.8160; val_gene_expr_recon_loss: 1847104.3221; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17006.3672; val_global_loss: 3485662.6250; val_optim_loss: 3485662.6250
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9128; val_auprc_score: 0.9860; val_best_acc_score: 0.9291; val_best_f1_score: 0.9609; train_kl_reg_loss: 28477.9969; train_edge_recon_loss: 622564.2813; train_cat_covariates_contrastive_loss: 955285.0103; train_gene_expr_recon_loss: 1835276.6512; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17254.0961; train_global_loss: 3458858.0364; train_optim_loss: 3458858.0364; val_kl_reg_loss: 28768.3233; val_edge_recon_loss: 640977.0155; val_cat_covariates_contrastive_loss: 953767.1387; val_gene_expr_recon_loss: 1836566.8356; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17056.7773; val_global_loss: 3477136.0656; val_optim_loss: 3477136.0656
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9205; val_auprc_score: 0.9875; val_best_acc_score: 0.9281; val_best_f1_score: 0.9603; train_kl_reg_loss: 28603.3399; train_edge_recon_loss: 623012.8554; train_cat_covariates_contrastive_loss: 955556.4404; train_gene_expr_recon_loss: 1834847.9488; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17322.1366; train_global_loss: 3459342.7222; train_optim_loss: 3459342.7222; val_kl_reg_loss: 28508.9411; val_edge_recon_loss: 637517.3839; val_cat_covariates_contrastive_loss: 956043.8588; val_gene_expr_recon_loss: 1836708.6535; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17192.4062; val_global_loss: 3475971.3434; val_optim_loss: 3475971.3434
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9150; val_auprc_score: 0.9857; val_best_acc_score: 0.9316; val_best_f1_score: 0.9622; train_kl_reg_loss: 28736.0854; train_edge_recon_loss: 622356.7741; train_cat_covariates_contrastive_loss: 955483.9537; train_gene_expr_recon_loss: 1828795.5595; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17349.0677; train_global_loss: 3452721.4361; train_optim_loss: 3452721.4361; val_kl_reg_loss: 30937.7337; val_edge_recon_loss: 647001.1640; val_cat_covariates_contrastive_loss: 951860.8011; val_gene_expr_recon_loss: 1832085.7542; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17413.5176; val_global_loss: 3479298.9568; val_optim_loss: 3479298.9568
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9244; val_auprc_score: 0.9880; val_best_acc_score: 0.9333; val_best_f1_score: 0.9633; train_kl_reg_loss: 28098.2636; train_edge_recon_loss: 622799.9379; train_cat_covariates_contrastive_loss: 955145.6370; train_gene_expr_recon_loss: 1955858.5262; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17880.4714; train_global_loss: 3579782.8372; train_optim_loss: 3579782.8372; val_kl_reg_loss: 28617.3225; val_edge_recon_loss: 637429.2937; val_cat_covariates_contrastive_loss: 955754.4408; val_gene_expr_recon_loss: 1859346.9838; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17580.4141; val_global_loss: 3498728.5386; val_optim_loss: 3498728.5386
