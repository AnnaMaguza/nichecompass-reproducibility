Run timestamp: 14062023_091327.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'vizgen_merfish_human_ovarian_cancer', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '0.01', '--nichenet_max_n_target_genes_per_gp', '1000', '--include_mebocost_gps', '--mebocost_species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cond_embed_injection', 'gene_expr_decoder', '--n_cond_embed', '4', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cond_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cond_contrastive', '0.', '--contrastive_logits_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '5.', '--edge_batch_size', '2048', '--node_batch_size', 'None', '--timestamp_suffix', '_1']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 1726.
Number of gene programs after filtering and combining: 1585.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.05
LOG VARIATIONAL -> True
CONDITIONAL EMBEDDING INJECTION -> ['gene_expr_decoder']
ENCODER -> n_input: 500, n_cond_embed_input: 0, n_layers: 1, n_hidden: 500, n_latent: 803, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> n_cond_embed_input: 0, n_cond_embed_output: 803, dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 803, n_cond_embed_input: 4, n_addon_input: 0, n_output: 1000
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 759633
Number of validation nodes: 84404
Number of training edges: 5242555
Number of validation edges: 582506
Edge batch size: 2048
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9863; val_auprc_score: 0.9953; val_best_acc_score: 0.9553; val_best_f1_score: 0.9710; train_kl_reg_loss: 15653.9580; train_edge_recon_loss: 1273966.1424; train_gene_expr_recon_loss: 1406026.9872; train_masked_gp_l1_reg_loss: 2180.1300; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2697827.2203; train_optim_loss: 2697827.2203; val_kl_reg_loss: 6887.3658; val_edge_recon_loss: 1239968.6114; val_gene_expr_recon_loss: 1325313.1039; val_masked_gp_l1_reg_loss: 2570.6628; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2574739.8298; val_optim_loss: 2574739.8298
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9913; val_auprc_score: 0.9970; val_best_acc_score: 0.9653; val_best_f1_score: 0.9774; train_kl_reg_loss: 6385.9294; train_edge_recon_loss: 1225160.7750; train_gene_expr_recon_loss: 1312288.8788; train_masked_gp_l1_reg_loss: 2449.9755; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2546285.5642; train_optim_loss: 2546285.5642; val_kl_reg_loss: 6145.0954; val_edge_recon_loss: 1233932.4781; val_gene_expr_recon_loss: 1303562.1702; val_masked_gp_l1_reg_loss: 2363.1492; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2546002.9860; val_optim_loss: 2546002.9860
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9927; val_auprc_score: 0.9975; val_best_acc_score: 0.9692; val_best_f1_score: 0.9800; train_kl_reg_loss: 6191.8498; train_edge_recon_loss: 1222487.9267; train_gene_expr_recon_loss: 1299197.2367; train_masked_gp_l1_reg_loss: 2345.2434; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2530222.2588; train_optim_loss: 2530222.2588; val_kl_reg_loss: 6154.4162; val_edge_recon_loss: 1230974.5469; val_gene_expr_recon_loss: 1296400.4478; val_masked_gp_l1_reg_loss: 2332.1855; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2535861.6596; val_optim_loss: 2535861.6596
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9930; val_auprc_score: 0.9976; val_best_acc_score: 0.9701; val_best_f1_score: 0.9806; train_kl_reg_loss: 6267.5173; train_edge_recon_loss: 1220752.8549; train_gene_expr_recon_loss: 1293939.6798; train_masked_gp_l1_reg_loss: 2312.8294; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2523272.8846; train_optim_loss: 2523272.8846; val_kl_reg_loss: 6299.3527; val_edge_recon_loss: 1229648.0825; val_gene_expr_recon_loss: 1292568.0053; val_masked_gp_l1_reg_loss: 2299.7488; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2530815.1860; val_optim_loss: 2530815.1860
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9933; val_auprc_score: 0.9977; val_best_acc_score: 0.9712; val_best_f1_score: 0.9813; train_kl_reg_loss: 6337.9698; train_edge_recon_loss: 1220158.1150; train_gene_expr_recon_loss: 1290841.8600; train_masked_gp_l1_reg_loss: 2287.2711; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2519625.2126; train_optim_loss: 2519625.2126; val_kl_reg_loss: 6308.0916; val_edge_recon_loss: 1227217.2417; val_gene_expr_recon_loss: 1290793.2250; val_masked_gp_l1_reg_loss: 2264.0264; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2526582.5605; val_optim_loss: 2526582.5605
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9935; val_auprc_score: 0.9978; val_best_acc_score: 0.9717; val_best_f1_score: 0.9816; train_kl_reg_loss: 6415.6862; train_edge_recon_loss: 1218675.0069; train_gene_expr_recon_loss: 1288712.0252; train_masked_gp_l1_reg_loss: 2259.8727; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2516062.5903; train_optim_loss: 2516062.5903; val_kl_reg_loss: 6502.2295; val_edge_recon_loss: 1226067.9272; val_gene_expr_recon_loss: 1288861.9425; val_masked_gp_l1_reg_loss: 2251.9246; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2523684.0982; val_optim_loss: 2523684.0982
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9943; val_auprc_score: 0.9980; val_best_acc_score: 0.9740; val_best_f1_score: 0.9831; train_kl_reg_loss: 6524.6381; train_edge_recon_loss: 1217899.3127; train_gene_expr_recon_loss: 1286569.1193; train_masked_gp_l1_reg_loss: 2232.7846; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2513225.8547; train_optim_loss: 2513225.8547; val_kl_reg_loss: 6454.1659; val_edge_recon_loss: 1221370.9320; val_gene_expr_recon_loss: 1286195.2610; val_masked_gp_l1_reg_loss: 2216.0293; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2516236.3561; val_optim_loss: 2516236.3561
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9942; val_auprc_score: 0.9980; val_best_acc_score: 0.9738; val_best_f1_score: 0.9830; train_kl_reg_loss: 6584.9151; train_edge_recon_loss: 1218044.3340; train_gene_expr_recon_loss: 1284479.5695; train_masked_gp_l1_reg_loss: 2205.5184; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2511314.3365; train_optim_loss: 2511314.3365; val_kl_reg_loss: 6482.7857; val_edge_recon_loss: 1226104.7035; val_gene_expr_recon_loss: 1289979.6561; val_masked_gp_l1_reg_loss: 2191.9292; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2524759.1518; val_optim_loss: 2524759.1518
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9944; val_auprc_score: 0.9980; val_best_acc_score: 0.9747; val_best_f1_score: 0.9835; train_kl_reg_loss: 6665.0773; train_edge_recon_loss: 1217008.7660; train_gene_expr_recon_loss: 1282510.5452; train_masked_gp_l1_reg_loss: 2176.6830; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2508361.0702; train_optim_loss: 2508361.0702; val_kl_reg_loss: 6663.4940; val_edge_recon_loss: 1223633.4658; val_gene_expr_recon_loss: 1299039.6741; val_masked_gp_l1_reg_loss: 2161.8376; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2531498.3895; val_optim_loss: 2531498.3895
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9944; val_auprc_score: 0.9981; val_best_acc_score: 0.9743; val_best_f1_score: 0.9833; train_kl_reg_loss: 6726.3479; train_edge_recon_loss: 1217341.4470; train_gene_expr_recon_loss: 1280703.2423; train_masked_gp_l1_reg_loss: 2152.5406; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2506923.5744; train_optim_loss: 2506923.5744; val_kl_reg_loss: 6752.6538; val_edge_recon_loss: 1224144.5215; val_gene_expr_recon_loss: 1238118.3377; val_masked_gp_l1_reg_loss: 2145.1187; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2471160.5088; val_optim_loss: 2471160.5088
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9945; val_auprc_score: 0.9980; val_best_acc_score: 0.9753; val_best_f1_score: 0.9839; train_kl_reg_loss: 6779.7202; train_edge_recon_loss: 1217574.6501; train_gene_expr_recon_loss: 1282616.1438; train_masked_gp_l1_reg_loss: 2131.8432; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2509102.3584; train_optim_loss: 2509102.3584; val_kl_reg_loss: 6795.6046; val_edge_recon_loss: 1228327.2026; val_gene_expr_recon_loss: 1406178.5645; val_masked_gp_l1_reg_loss: 2120.2278; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2643421.6158; val_optim_loss: 2643421.6158
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9946; val_auprc_score: 0.9982; val_best_acc_score: 0.9747; val_best_f1_score: 0.9835; train_kl_reg_loss: 6821.5518; train_edge_recon_loss: 1216789.3937; train_gene_expr_recon_loss: 1284500.4209; train_masked_gp_l1_reg_loss: 2113.3421; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2510224.7097; train_optim_loss: 2510224.7097; val_kl_reg_loss: 6838.1318; val_edge_recon_loss: 1224525.3079; val_gene_expr_recon_loss: 1392547.0175; val_masked_gp_l1_reg_loss: 2106.6006; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2626016.9649; val_optim_loss: 2626016.9649
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9946; val_auprc_score: 0.9981; val_best_acc_score: 0.9755; val_best_f1_score: 0.9841; train_kl_reg_loss: 6877.7566; train_edge_recon_loss: 1217487.3647; train_gene_expr_recon_loss: 1252741.2178; train_masked_gp_l1_reg_loss: 2100.4990; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2479206.8397; train_optim_loss: 2479206.8397; val_kl_reg_loss: 6852.4323; val_edge_recon_loss: 1224948.7768; val_gene_expr_recon_loss: 1096835.8283; val_masked_gp_l1_reg_loss: 2090.1694; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2330727.2833; val_optim_loss: 2330727.2833
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9947; val_auprc_score: 0.9981; val_best_acc_score: 0.9758; val_best_f1_score: 0.9843; train_kl_reg_loss: 6920.3213; train_edge_recon_loss: 1216653.6552; train_gene_expr_recon_loss: 1180100.0392; train_masked_gp_l1_reg_loss: 2086.7507; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2405760.7668; train_optim_loss: 2405760.7668; val_kl_reg_loss: 6922.0438; val_edge_recon_loss: 1224062.6811; val_gene_expr_recon_loss: 1122493.9504; val_masked_gp_l1_reg_loss: 2081.3555; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2355559.9237; val_optim_loss: 2355559.9237
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9948; val_auprc_score: 0.9982; val_best_acc_score: 0.9758; val_best_f1_score: 0.9843; train_kl_reg_loss: 6951.1621; train_edge_recon_loss: 1215278.8605; train_gene_expr_recon_loss: 1136872.1593; train_masked_gp_l1_reg_loss: 2073.8145; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2361175.9995; train_optim_loss: 2361175.9995; val_kl_reg_loss: 6927.7188; val_edge_recon_loss: 1224999.7956; val_gene_expr_recon_loss: 1092676.2239; val_masked_gp_l1_reg_loss: 2064.3958; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2326668.2412; val_optim_loss: 2326668.2412
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9949; val_auprc_score: 0.9983; val_best_acc_score: 0.9758; val_best_f1_score: 0.9843; train_kl_reg_loss: 6990.5381; train_edge_recon_loss: 1217402.1293; train_gene_expr_recon_loss: 1113170.8204; train_masked_gp_l1_reg_loss: 2057.3587; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2339620.8460; train_optim_loss: 2339620.8460; val_kl_reg_loss: 6970.1098; val_edge_recon_loss: 1219249.1031; val_gene_expr_recon_loss: 1143703.1509; val_masked_gp_l1_reg_loss: 2046.2009; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2371968.6167; val_optim_loss: 2371968.6167
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9948; val_auprc_score: 0.9982; val_best_acc_score: 0.9760; val_best_f1_score: 0.9844; train_kl_reg_loss: 7029.7076; train_edge_recon_loss: 1215479.1330; train_gene_expr_recon_loss: 1108318.9122; train_masked_gp_l1_reg_loss: 2048.0861; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2332875.8407; train_optim_loss: 2332875.8407; val_kl_reg_loss: 6974.5426; val_edge_recon_loss: 1223995.9175; val_gene_expr_recon_loss: 1125621.1241; val_masked_gp_l1_reg_loss: 2039.0333; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2358630.5798; val_optim_loss: 2358630.5798
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9949; val_auprc_score: 0.9982; val_best_acc_score: 0.9766; val_best_f1_score: 0.9848; train_kl_reg_loss: 7051.6274; train_edge_recon_loss: 1216305.0503; train_gene_expr_recon_loss: 1105846.0846; train_masked_gp_l1_reg_loss: 2037.8408; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2331240.6026; train_optim_loss: 2331240.6026; val_kl_reg_loss: 6929.4656; val_edge_recon_loss: 1222888.9329; val_gene_expr_recon_loss: 1091945.4588; val_masked_gp_l1_reg_loss: 2031.2537; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2323795.1211; val_optim_loss: 2323795.1211
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9949; val_auprc_score: 0.9982; val_best_acc_score: 0.9761; val_best_f1_score: 0.9845; train_kl_reg_loss: 7074.2954; train_edge_recon_loss: 1215395.5331; train_gene_expr_recon_loss: 1101327.1455; train_masked_gp_l1_reg_loss: 2029.9222; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2325826.8974; train_optim_loss: 2325826.8974; val_kl_reg_loss: 7090.0613; val_edge_recon_loss: 1227059.9360; val_gene_expr_recon_loss: 1102233.6184; val_masked_gp_l1_reg_loss: 2026.8402; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2338410.3605; val_optim_loss: 2338410.3605
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9948; val_auprc_score: 0.9982; val_best_acc_score: 0.9761; val_best_f1_score: 0.9845; train_kl_reg_loss: 7092.7930; train_edge_recon_loss: 1215380.7777; train_gene_expr_recon_loss: 1099494.2115; train_masked_gp_l1_reg_loss: 2021.0989; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2323988.8806; train_optim_loss: 2323988.8806; val_kl_reg_loss: 7137.1903; val_edge_recon_loss: 1222903.9382; val_gene_expr_recon_loss: 1098879.1564; val_masked_gp_l1_reg_loss: 2020.8198; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2330941.0439; val_optim_loss: 2330941.0439
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9951; val_auprc_score: 0.9983; val_best_acc_score: 0.9771; val_best_f1_score: 0.9851; train_kl_reg_loss: 7118.3686; train_edge_recon_loss: 1215923.9769; train_gene_expr_recon_loss: 1098874.6017; train_masked_gp_l1_reg_loss: 2013.6451; train_group_lasso_reg_loss: 0.0000; train_global_loss: 2323930.5892; train_optim_loss: 2323930.5892; val_kl_reg_loss: 7201.4883; val_edge_recon_loss: 1223205.1154; val_gene_expr_recon_loss: 1099358.9890; val_masked_gp_l1_reg_loss: 2000.8452; val_group_lasso_reg_loss: 0.0000; val_global_loss: 2331766.3430; val_optim_loss: 2331766.3430
