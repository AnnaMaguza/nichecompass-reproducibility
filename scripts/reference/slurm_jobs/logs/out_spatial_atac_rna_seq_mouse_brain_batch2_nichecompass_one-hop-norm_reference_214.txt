[True]
Run timestamp: 10102023_091714_214.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'spatial_atac_rna_seq_mouse_brain_batch2', '--reference_batches', 'None', '--n_neighbors', '8', '--filter_genes', '--n_hvg', '0', '--n_svg', '3000', '--n_svp', '15000', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--include_collectri_gps', '--include_brain_marker_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--include_atac_modality', '--filter_peaks', '--min_cell_peak_thresh_ratio', '0.005', '--min_cell_gene_thresh_ratio', '0.005', '--model_label', 'reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '100', '--active_gp_thresh_ratio', '0.001', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'None', '--cat_covariates_embeds_nums', '0', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '1000000', '--lambda_gene_expr_recon', '5000', '--lambda_chrom_access_recon', '3000', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '300', '--lambda_l1_addon', '300.', '--edge_batch_size', '256', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_214']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 3404.
Number of gene programs after filtering and combining: 2803.

Filtering genes...
Starting with 22914 genes.
Keeping 12959 genes after filtering genes with expression in {} cells.
Keeping 3000 spatially variable, highly variable or gene program relevant genes.

Filtering peaks...
Starting with 121068 peaks.
Keeping 120652 peaks after filtering  peaks with counts in less than 46 cells.
Keeping 15000 peaks after filtering spatially variable peaks.
Keeping 2422 peaks after filtering peaks with no matching genes in gp mask.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb, include_chrom_access_recon_loss: True, atac_recon_loss: nb 
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.001
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['None']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ONE HOP GCN NORM ATAC NODE LABEL AGGREGATOR
ENCODER -> n_input: 5181, n_cat_covariates_embed_input: 0, n_hidden: 2310, n_latent: 2210, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 2210, n_addon_gp_input: 100, n_cat_covariates_embed_input: 0, n_output: 2759
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 2210, n_addon_gp_input: 100, n_cat_covariates_embed_input: 0, n_output: 2759
MASKED TARGET ATAC DECODER -> n_prior_gp_input: 2210, n_addon_gp_input: 100, n_cat_covariates_embed_input: 0, n_output: 2422
MASKED SOURCE ATAC DECODER -> n_prior_gp_input: 2210, n_addon_gp_input: 100, n_cat_covariates_embed_input: 0, n_output: 2422

--- INITIALIZING TRAINER ---
Number of training nodes: 8293
Number of validation nodes: 922
Number of training edges: 33399
Number of validation edges: 3711
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.7454; val_auprc_score: 0.7791; val_best_acc_score: 0.5329; val_best_f1_score: 0.6800; train_kl_reg_loss: 63935.4737; train_edge_recon_loss: 741567.3325; train_gene_expr_recon_loss: 22037512.4733; train_masked_gp_l1_reg_loss: 94799.0015; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 2406311.5515; train_chrom_access_recon_loss: 6694334.0267; train_global_loss: 32038459.8931; train_optim_loss: 32038459.8931; val_kl_reg_loss: 73802.7630; val_edge_recon_loss: 812697.8583; val_gene_expr_recon_loss: 20930353.6000; val_masked_gp_l1_reg_loss: 75674.4688; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 907353.9375; val_chrom_access_recon_loss: 6488957.0000; val_global_loss: 29288839.0667; val_optim_loss: 29288839.0667
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8813; val_auprc_score: 0.8810; val_best_acc_score: 0.8042; val_best_f1_score: 0.8122; train_kl_reg_loss: 71455.1248; train_edge_recon_loss: 733137.8302; train_gene_expr_recon_loss: 20828291.8015; train_masked_gp_l1_reg_loss: 73760.6381; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 490260.9783; train_chrom_access_recon_loss: 6469642.0687; train_global_loss: 28666548.3359; train_optim_loss: 28666548.3359; val_kl_reg_loss: 65455.6529; val_edge_recon_loss: 802285.9333; val_gene_expr_recon_loss: 20659879.8667; val_masked_gp_l1_reg_loss: 74080.4141; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 271948.0625; val_chrom_access_recon_loss: 6396706.6333; val_global_loss: 28270356.0000; val_optim_loss: 28270356.0000
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.8948; val_auprc_score: 0.8872; val_best_acc_score: 0.8045; val_best_f1_score: 0.8182; train_kl_reg_loss: 60925.4408; train_edge_recon_loss: 709483.1975; train_gene_expr_recon_loss: 20565783.7710; train_masked_gp_l1_reg_loss: 76585.9773; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 206103.5024; train_chrom_access_recon_loss: 6395470.1908; train_global_loss: 28014352.0153; train_optim_loss: 28014352.0153; val_kl_reg_loss: 58134.8268; val_edge_recon_loss: 691023.5500; val_gene_expr_recon_loss: 20348021.6000; val_masked_gp_l1_reg_loss: 79372.7578; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 163558.8281; val_chrom_access_recon_loss: 6331151.3667; val_global_loss: 27671261.2000; val_optim_loss: 27671261.2000
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9091; val_auprc_score: 0.8987; val_best_acc_score: 0.8257; val_best_f1_score: 0.8320; train_kl_reg_loss: 67862.1143; train_edge_recon_loss: 643306.7223; train_gene_expr_recon_loss: 20314404.4733; train_masked_gp_l1_reg_loss: 81121.1074; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 142347.4692; train_chrom_access_recon_loss: 6321948.8282; train_global_loss: 27570990.5191; train_optim_loss: 27570990.5191; val_kl_reg_loss: 69559.9156; val_edge_recon_loss: 634004.7458; val_gene_expr_recon_loss: 20096819.7333; val_masked_gp_l1_reg_loss: 83121.1641; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 125886.5078; val_chrom_access_recon_loss: 6285781.0667; val_global_loss: 27295173.4667; val_optim_loss: 27295173.4667
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9213; val_auprc_score: 0.9070; val_best_acc_score: 0.8425; val_best_f1_score: 0.8508; train_kl_reg_loss: 68808.3998; train_edge_recon_loss: 620212.5978; train_gene_expr_recon_loss: 20138574.2901; train_masked_gp_l1_reg_loss: 84422.1998; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 115332.5987; train_chrom_access_recon_loss: 6278385.9809; train_global_loss: 27305736.0763; train_optim_loss: 27305736.0763; val_kl_reg_loss: 69535.0802; val_edge_recon_loss: 614502.0583; val_gene_expr_recon_loss: 19905104.8000; val_masked_gp_l1_reg_loss: 85677.9609; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 107613.5078; val_chrom_access_recon_loss: 6224129.2667; val_global_loss: 27006563.3333; val_optim_loss: 27006563.3333
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9316; val_auprc_score: 0.9177; val_best_acc_score: 0.8579; val_best_f1_score: 0.8675; train_kl_reg_loss: 67700.9579; train_edge_recon_loss: 609168.7328; train_gene_expr_recon_loss: 19975063.0382; train_masked_gp_l1_reg_loss: 86936.5620; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 101868.0967; train_chrom_access_recon_loss: 6229347.7366; train_global_loss: 27070085.1450; train_optim_loss: 27070085.1450; val_kl_reg_loss: 65069.2096; val_edge_recon_loss: 610072.9542; val_gene_expr_recon_loss: 19790705.3333; val_masked_gp_l1_reg_loss: 88298.2734; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 97170.2812; val_chrom_access_recon_loss: 6188929.5667; val_global_loss: 26840245.2000; val_optim_loss: 26840245.2000
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9414; val_auprc_score: 0.9289; val_best_acc_score: 0.8748; val_best_f1_score: 0.8812; train_kl_reg_loss: 66205.7472; train_edge_recon_loss: 604371.4857; train_gene_expr_recon_loss: 19826117.6183; train_masked_gp_l1_reg_loss: 89065.6626; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 93268.9430; train_chrom_access_recon_loss: 6182033.3969; train_global_loss: 26861062.8855; train_optim_loss: 26861062.8855; val_kl_reg_loss: 65602.3966; val_edge_recon_loss: 606011.8167; val_gene_expr_recon_loss: 19757770.5333; val_masked_gp_l1_reg_loss: 90176.0469; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 89664.6719; val_chrom_access_recon_loss: 6182324.7000; val_global_loss: 26791549.3333; val_optim_loss: 26791549.3333
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9491; val_auprc_score: 0.9390; val_best_acc_score: 0.8821; val_best_f1_score: 0.8879; train_kl_reg_loss: 65116.9803; train_edge_recon_loss: 597698.9280; train_gene_expr_recon_loss: 19733759.2214; train_masked_gp_l1_reg_loss: 90778.4011; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 86809.7994; train_chrom_access_recon_loss: 6157191.3015; train_global_loss: 26731354.7634; train_optim_loss: 26731354.7634; val_kl_reg_loss: 63773.6581; val_edge_recon_loss: 598524.7375; val_gene_expr_recon_loss: 19644607.7333; val_masked_gp_l1_reg_loss: 91741.7656; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 85038.2422; val_chrom_access_recon_loss: 6129768.8000; val_global_loss: 26613454.9333; val_optim_loss: 26613454.9333
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9487; val_auprc_score: 0.9358; val_best_acc_score: 0.8851; val_best_f1_score: 0.8896; train_kl_reg_loss: 64216.1341; train_edge_recon_loss: 592874.4346; train_gene_expr_recon_loss: 19610849.1145; train_masked_gp_l1_reg_loss: 92239.0251; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 82435.0236; train_chrom_access_recon_loss: 6113241.2634; train_global_loss: 26555855.0076; train_optim_loss: 26555855.0076; val_kl_reg_loss: 61589.1469; val_edge_recon_loss: 598347.9208; val_gene_expr_recon_loss: 19545299.7333; val_masked_gp_l1_reg_loss: 92918.5234; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 80275.6875; val_chrom_access_recon_loss: 6125158.4667; val_global_loss: 26503589.4667; val_optim_loss: 26503589.4667
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9523; val_auprc_score: 0.9404; val_best_acc_score: 0.8906; val_best_f1_score: 0.8957; train_kl_reg_loss: 63007.8231; train_edge_recon_loss: 590447.4986; train_gene_expr_recon_loss: 19509913.5725; train_masked_gp_l1_reg_loss: 93523.9320; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 79130.5162; train_chrom_access_recon_loss: 6081392.2023; train_global_loss: 26417415.5420; train_optim_loss: 26417415.5420; val_kl_reg_loss: 63577.9104; val_edge_recon_loss: 591929.5000; val_gene_expr_recon_loss: 19402314.8000; val_masked_gp_l1_reg_loss: 94255.1094; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 77817.5391; val_chrom_access_recon_loss: 6035739.4333; val_global_loss: 26265635.7333; val_optim_loss: 26265635.7333
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9548; val_auprc_score: 0.9433; val_best_acc_score: 0.8948; val_best_f1_score: 0.8996; train_kl_reg_loss: 62411.5194; train_edge_recon_loss: 587347.4389; train_gene_expr_recon_loss: 19413818.2748; train_masked_gp_l1_reg_loss: 94584.1427; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 76804.8774; train_chrom_access_recon_loss: 6051696.2557; train_global_loss: 26286662.4885; train_optim_loss: 26286662.4885; val_kl_reg_loss: 61375.6042; val_edge_recon_loss: 589980.2208; val_gene_expr_recon_loss: 19394590.1333; val_masked_gp_l1_reg_loss: 95153.1641; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 76220.8906; val_chrom_access_recon_loss: 6041072.3667; val_global_loss: 26258392.2667; val_optim_loss: 26258392.2667
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9582; val_auprc_score: 0.9465; val_best_acc_score: 0.9018; val_best_f1_score: 0.9052; train_kl_reg_loss: 61450.1159; train_edge_recon_loss: 584679.2085; train_gene_expr_recon_loss: 19330884.4275; train_masked_gp_l1_reg_loss: 95841.8600; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 75444.4946; train_chrom_access_recon_loss: 6022799.0878; train_global_loss: 26171099.2672; train_optim_loss: 26171099.2672; val_kl_reg_loss: 59920.6844; val_edge_recon_loss: 584555.5667; val_gene_expr_recon_loss: 19237088.6667; val_masked_gp_l1_reg_loss: 96441.1797; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 74738.0703; val_chrom_access_recon_loss: 6008616.8667; val_global_loss: 26061361.7333; val_optim_loss: 26061361.7333
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9611; val_auprc_score: 0.9475; val_best_acc_score: 0.9070; val_best_f1_score: 0.9102; train_kl_reg_loss: 60739.5877; train_edge_recon_loss: 583122.6417; train_gene_expr_recon_loss: 19251749.4809; train_masked_gp_l1_reg_loss: 96965.7224; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 74381.5032; train_chrom_access_recon_loss: 5989078.6756; train_global_loss: 26056037.7863; train_optim_loss: 26056037.7863; val_kl_reg_loss: 60134.8393; val_edge_recon_loss: 583736.0417; val_gene_expr_recon_loss: 19185801.0667; val_masked_gp_l1_reg_loss: 97748.8672; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 74039.2344; val_chrom_access_recon_loss: 5989394.6000; val_global_loss: 25990854.6667; val_optim_loss: 25990854.6667
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9624; val_auprc_score: 0.9513; val_best_acc_score: 0.9092; val_best_f1_score: 0.9113; train_kl_reg_loss: 60156.8692; train_edge_recon_loss: 581497.8240; train_gene_expr_recon_loss: 19171116.9924; train_masked_gp_l1_reg_loss: 98323.6410; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 73785.1261; train_chrom_access_recon_loss: 5957715.3511; train_global_loss: 25942595.8473; train_optim_loss: 25942595.8473; val_kl_reg_loss: 60276.0167; val_edge_recon_loss: 581495.8542; val_gene_expr_recon_loss: 19073830.8000; val_masked_gp_l1_reg_loss: 98883.5000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 73585.5859; val_chrom_access_recon_loss: 5944731.7667; val_global_loss: 25832804.0000; val_optim_loss: 25832804.0000
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9633; val_auprc_score: 0.9517; val_best_acc_score: 0.9099; val_best_f1_score: 0.9120; train_kl_reg_loss: 59477.5259; train_edge_recon_loss: 581148.7538; train_gene_expr_recon_loss: 19090141.0076; train_masked_gp_l1_reg_loss: 99815.1129; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 73221.1154; train_chrom_access_recon_loss: 5926067.1374; train_global_loss: 25829870.5191; train_optim_loss: 25829870.5191; val_kl_reg_loss: 59320.5786; val_edge_recon_loss: 584718.0750; val_gene_expr_recon_loss: 19022257.3333; val_masked_gp_l1_reg_loss: 101017.1797; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 73587.0469; val_chrom_access_recon_loss: 5945728.7333; val_global_loss: 25786630.5333; val_optim_loss: 25786630.5333
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9630; val_auprc_score: 0.9520; val_best_acc_score: 0.9100; val_best_f1_score: 0.9133; train_kl_reg_loss: 58863.2058; train_edge_recon_loss: 580620.7557; train_gene_expr_recon_loss: 19012042.6107; train_masked_gp_l1_reg_loss: 101499.7594; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 73040.1561; train_chrom_access_recon_loss: 5900988.0344; train_global_loss: 25727054.5191; train_optim_loss: 25727054.5191; val_kl_reg_loss: 58890.4221; val_edge_recon_loss: 582351.7250; val_gene_expr_recon_loss: 18981289.4667; val_masked_gp_l1_reg_loss: 102622.0312; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 73578.0781; val_chrom_access_recon_loss: 5894157.3333; val_global_loss: 25692889.0667; val_optim_loss: 25692889.0667
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9645; val_auprc_score: 0.9562; val_best_acc_score: 0.9076; val_best_f1_score: 0.9116; train_kl_reg_loss: 58337.2487; train_edge_recon_loss: 578780.7266; train_gene_expr_recon_loss: 18929193.0534; train_masked_gp_l1_reg_loss: 103449.3149; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 72878.4132; train_chrom_access_recon_loss: 5870921.3893; train_global_loss: 25613560.3511; train_optim_loss: 25613560.3511; val_kl_reg_loss: 57806.4958; val_edge_recon_loss: 582246.1833; val_gene_expr_recon_loss: 18989960.8000; val_masked_gp_l1_reg_loss: 104381.8828; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 73351.6172; val_chrom_access_recon_loss: 5896029.5000; val_global_loss: 25703777.0667; val_optim_loss: 25703777.0667
