[True, False, True]
Run timestamp: 05102023_213300_20.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', 'batch7', 'batch8', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', 'patient', '--cat_covariates_no_edges', 'True', 'False', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '100', '--active_gp_thresh_ratio', '0.1', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '5', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', '960', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '1000000.0', '--contrastive_logits_pos_ratio', '0.015625', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '100.0', '--lambda_l1_addon', '100.0', '--edge_batch_size', '512', '--node_batch_size', '256', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_20']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2325.
Number of gene programs after filtering and combining: 1858.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch7...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch8...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.1
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1613, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1613, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 631979
Number of validation nodes: 70220
Number of training edges: 1492281
Number of validation edges: 165809
Edge batch size: 512
Node batch size: 256

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8911; val_auprc_score: 0.9805; val_best_acc_score: 0.9222; val_best_f1_score: 0.9573; train_kl_reg_loss: 16536.6098; train_edge_recon_loss: 645822.9213; train_cat_covariates_contrastive_loss: 948871.1875; train_gene_expr_recon_loss: 2758800.5105; train_masked_gp_l1_reg_loss: 12750.4920; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 30297.6981; train_global_loss: 4413079.4242; train_optim_loss: 4413079.4242; val_kl_reg_loss: 18386.6489; val_edge_recon_loss: 663899.2475; val_cat_covariates_contrastive_loss: 950839.7812; val_gene_expr_recon_loss: 2508408.9059; val_masked_gp_l1_reg_loss: 13269.1035; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16991.3125; val_global_loss: 4171794.9352; val_optim_loss: 4171794.9352
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8982; val_auprc_score: 0.9813; val_best_acc_score: 0.9268; val_best_f1_score: 0.9595; train_kl_reg_loss: 21614.2107; train_edge_recon_loss: 626135.2652; train_cat_covariates_contrastive_loss: 951784.7576; train_gene_expr_recon_loss: 2391061.6406; train_masked_gp_l1_reg_loss: 16084.7281; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17665.3807; train_global_loss: 4024345.9780; train_optim_loss: 4024345.9780; val_kl_reg_loss: 25372.2881; val_edge_recon_loss: 648186.5564; val_cat_covariates_contrastive_loss: 948461.1179; val_gene_expr_recon_loss: 2306017.2014; val_masked_gp_l1_reg_loss: 18108.9258; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18172.9316; val_global_loss: 3964319.1728; val_optim_loss: 3964319.1728
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9015; val_auprc_score: 0.9819; val_best_acc_score: 0.9294; val_best_f1_score: 0.9610; train_kl_reg_loss: 24079.2548; train_edge_recon_loss: 623121.2424; train_cat_covariates_contrastive_loss: 952949.2643; train_gene_expr_recon_loss: 2270438.3046; train_masked_gp_l1_reg_loss: 19847.4781; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18404.2151; train_global_loss: 3908839.7606; train_optim_loss: 3908839.7606; val_kl_reg_loss: 25127.3321; val_edge_recon_loss: 647303.8415; val_cat_covariates_contrastive_loss: 952975.4776; val_gene_expr_recon_loss: 2231235.0266; val_masked_gp_l1_reg_loss: 21296.8223; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18583.9199; val_global_loss: 3896522.4336; val_optim_loss: 3896522.4336
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9053; val_auprc_score: 0.9825; val_best_acc_score: 0.9301; val_best_f1_score: 0.9614; train_kl_reg_loss: 25444.3843; train_edge_recon_loss: 619207.4766; train_cat_covariates_contrastive_loss: 953591.8725; train_gene_expr_recon_loss: 2217081.3427; train_masked_gp_l1_reg_loss: 21852.6284; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18766.4760; train_global_loss: 3855944.1813; train_optim_loss: 3855944.1813; val_kl_reg_loss: 28678.5050; val_edge_recon_loss: 637727.9969; val_cat_covariates_contrastive_loss: 950435.1267; val_gene_expr_recon_loss: 2196718.6809; val_masked_gp_l1_reg_loss: 22377.9551; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18847.5625; val_global_loss: 3854785.8156; val_optim_loss: 3854785.8156
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9130; val_auprc_score: 0.9844; val_best_acc_score: 0.9296; val_best_f1_score: 0.9610; train_kl_reg_loss: 26856.8947; train_edge_recon_loss: 621642.0771; train_cat_covariates_contrastive_loss: 953885.3648; train_gene_expr_recon_loss: 2187796.0345; train_masked_gp_l1_reg_loss: 22668.5687; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 19043.6953; train_global_loss: 3831892.6341; train_optim_loss: 3831892.6341; val_kl_reg_loss: 28029.1623; val_edge_recon_loss: 640401.7076; val_cat_covariates_contrastive_loss: 954166.1757; val_gene_expr_recon_loss: 2175037.6755; val_masked_gp_l1_reg_loss: 22982.4863; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 19195.9453; val_global_loss: 3839813.2153; val_optim_loss: 3839813.2153
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9121; val_auprc_score: 0.9833; val_best_acc_score: 0.9319; val_best_f1_score: 0.9622; train_kl_reg_loss: 28052.4186; train_edge_recon_loss: 616674.2567; train_cat_covariates_contrastive_loss: 954218.4867; train_gene_expr_recon_loss: 2168614.9990; train_masked_gp_l1_reg_loss: 23236.7957; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 19118.6209; train_global_loss: 3809915.5821; train_optim_loss: 3809915.5821; val_kl_reg_loss: 28293.8412; val_edge_recon_loss: 645189.4111; val_cat_covariates_contrastive_loss: 954859.2332; val_gene_expr_recon_loss: 2156831.8036; val_masked_gp_l1_reg_loss: 23504.8027; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 19010.8730; val_global_loss: 3827689.7909; val_optim_loss: 3827689.7909
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9158; val_auprc_score: 0.9849; val_best_acc_score: 0.9309; val_best_f1_score: 0.9617; train_kl_reg_loss: 28444.7972; train_edge_recon_loss: 624865.5811; train_cat_covariates_contrastive_loss: 954427.8983; train_gene_expr_recon_loss: 2226931.8553; train_masked_gp_l1_reg_loss: 37782.4716; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 20584.7339; train_global_loss: 3893037.3372; train_optim_loss: 3893037.3372; val_kl_reg_loss: 29318.3923; val_edge_recon_loss: 640860.8230; val_cat_covariates_contrastive_loss: 954978.3320; val_gene_expr_recon_loss: 2216120.8453; val_masked_gp_l1_reg_loss: 45902.1602; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18794.5742; val_global_loss: 3905975.1474; val_optim_loss: 3905975.1474
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9234; val_auprc_score: 0.9862; val_best_acc_score: 0.9345; val_best_f1_score: 0.9637; train_kl_reg_loss: 30661.0981; train_edge_recon_loss: 619482.5929; train_cat_covariates_contrastive_loss: 955282.1759; train_gene_expr_recon_loss: 2176764.9248; train_masked_gp_l1_reg_loss: 29844.4597; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18678.5896; train_global_loss: 3830713.8444; train_optim_loss: 3830713.8444; val_kl_reg_loss: 29895.2355; val_edge_recon_loss: 641366.7677; val_cat_covariates_contrastive_loss: 957058.2660; val_gene_expr_recon_loss: 2145723.5482; val_masked_gp_l1_reg_loss: 23458.5938; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18685.6094; val_global_loss: 3816187.8156; val_optim_loss: 3816187.8156
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9252; val_auprc_score: 0.9864; val_best_acc_score: 0.9356; val_best_f1_score: 0.9643; train_kl_reg_loss: 31183.0121; train_edge_recon_loss: 619539.7386; train_cat_covariates_contrastive_loss: 955479.7596; train_gene_expr_recon_loss: 2139610.7011; train_masked_gp_l1_reg_loss: 23153.8285; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18817.1760; train_global_loss: 3787784.2172; train_optim_loss: 3787784.2172; val_kl_reg_loss: 30694.8210; val_edge_recon_loss: 644265.6706; val_cat_covariates_contrastive_loss: 956213.1188; val_gene_expr_recon_loss: 2124737.4606; val_masked_gp_l1_reg_loss: 23302.6562; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18879.5156; val_global_loss: 3798093.3287; val_optim_loss: 3798093.3287
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9174; val_auprc_score: 0.9850; val_best_acc_score: 0.9307; val_best_f1_score: 0.9616; train_kl_reg_loss: 30947.5528; train_edge_recon_loss: 621747.0825; train_cat_covariates_contrastive_loss: 954502.2446; train_gene_expr_recon_loss: 2236746.0483; train_masked_gp_l1_reg_loss: 41679.1097; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 23044.7200; train_global_loss: 3908666.7580; train_optim_loss: 3908666.7580; val_kl_reg_loss: 29424.6252; val_edge_recon_loss: 643519.9755; val_cat_covariates_contrastive_loss: 955174.6254; val_gene_expr_recon_loss: 2248987.7917; val_masked_gp_l1_reg_loss: 55888.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 19755.0996; val_global_loss: 3952750.0231; val_optim_loss: 3952750.0231
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9199; val_auprc_score: 0.9850; val_best_acc_score: 0.9358; val_best_f1_score: 0.9643; train_kl_reg_loss: 32237.5273; train_edge_recon_loss: 618432.8362; train_cat_covariates_contrastive_loss: 955557.1252; train_gene_expr_recon_loss: 2169158.9446; train_masked_gp_l1_reg_loss: 34601.6396; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18765.4494; train_global_loss: 3828753.5231; train_optim_loss: 3828753.5231; val_kl_reg_loss: 36097.5911; val_edge_recon_loss: 641889.9990; val_cat_covariates_contrastive_loss: 953046.8910; val_gene_expr_recon_loss: 2132484.3368; val_masked_gp_l1_reg_loss: 24529.6113; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18680.3574; val_global_loss: 3806728.5656; val_optim_loss: 3806728.5656
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9237; val_auprc_score: 0.9860; val_best_acc_score: 0.9353; val_best_f1_score: 0.9640; train_kl_reg_loss: 2214207.4704; train_edge_recon_loss: 618263.8422; train_cat_covariates_contrastive_loss: 956338.9322; train_gene_expr_recon_loss: 2135650.2304; train_masked_gp_l1_reg_loss: 23395.2057; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18882.6658; train_global_loss: 5966738.1220; train_optim_loss: 5966738.1220; val_kl_reg_loss: 34663.9599; val_edge_recon_loss: 642222.9898; val_cat_covariates_contrastive_loss: 956277.3258; val_gene_expr_recon_loss: 2122452.3283; val_masked_gp_l1_reg_loss: 22927.6875; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18714.8203; val_global_loss: 3797259.1103; val_optim_loss: 3797259.1103
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9278; val_auprc_score: 0.9869; val_best_acc_score: 0.9365; val_best_f1_score: 0.9647; train_kl_reg_loss: 35436.3237; train_edge_recon_loss: 618158.2794; train_cat_covariates_contrastive_loss: 956674.0688; train_gene_expr_recon_loss: 2121077.3901; train_masked_gp_l1_reg_loss: 23293.1873; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18930.6596; train_global_loss: 3773569.9056; train_optim_loss: 3773569.9056; val_kl_reg_loss: 34780.4829; val_edge_recon_loss: 637781.1218; val_cat_covariates_contrastive_loss: 956818.8225; val_gene_expr_recon_loss: 2114802.6478; val_masked_gp_l1_reg_loss: 23545.0684; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18988.7422; val_global_loss: 3786716.8202; val_optim_loss: 3786716.8202
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9257; val_auprc_score: 0.9865; val_best_acc_score: 0.9366; val_best_f1_score: 0.9648; train_kl_reg_loss: 35604.8186; train_edge_recon_loss: 617199.3781; train_cat_covariates_contrastive_loss: 956655.7747; train_gene_expr_recon_loss: 2111709.8686; train_masked_gp_l1_reg_loss: 23702.1632; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 19067.8397; train_global_loss: 3763939.8413; train_optim_loss: 3763939.8413; val_kl_reg_loss: 35037.9907; val_edge_recon_loss: 635903.8367; val_cat_covariates_contrastive_loss: 956845.3918; val_gene_expr_recon_loss: 2105460.7018; val_masked_gp_l1_reg_loss: 24009.9922; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 19105.9199; val_global_loss: 3776363.9236; val_optim_loss: 3776363.9236
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9256; val_auprc_score: 0.9864; val_best_acc_score: 0.9341; val_best_f1_score: 0.9633; train_kl_reg_loss: 37676.0756; train_edge_recon_loss: 626100.8622; train_cat_covariates_contrastive_loss: 956081.3868; train_gene_expr_recon_loss: 2218663.9539; train_masked_gp_l1_reg_loss: 51395.0432; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 20854.7605; train_global_loss: 3910772.0837; train_optim_loss: 3910772.0837; val_kl_reg_loss: 35631.6096; val_edge_recon_loss: 642211.7511; val_cat_covariates_contrastive_loss: 958726.6198; val_gene_expr_recon_loss: 2134902.1346; val_masked_gp_l1_reg_loss: 37257.6055; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18877.7207; val_global_loss: 3827607.3588; val_optim_loss: 3827607.3588
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9258; val_auprc_score: 0.9865; val_best_acc_score: 0.9344; val_best_f1_score: 0.9636; train_kl_reg_loss: 37362.4985; train_edge_recon_loss: 618485.9590; train_cat_covariates_contrastive_loss: 957048.2455; train_gene_expr_recon_loss: 2118769.6554; train_masked_gp_l1_reg_loss: 28014.3885; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18993.2021; train_global_loss: 3778673.9517; train_optim_loss: 3778673.9517; val_kl_reg_loss: 36525.4961; val_edge_recon_loss: 644174.8745; val_cat_covariates_contrastive_loss: 958594.8746; val_gene_expr_recon_loss: 2104942.4452; val_masked_gp_l1_reg_loss: 23842.5781; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 19080.3652; val_global_loss: 3787160.4468; val_optim_loss: 3787160.4468
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9236; val_auprc_score: 0.9859; val_best_acc_score: 0.9385; val_best_f1_score: 0.9659; train_kl_reg_loss: 39684.9569; train_edge_recon_loss: 619275.6031; train_cat_covariates_contrastive_loss: 957472.0307; train_gene_expr_recon_loss: 2104516.3632; train_masked_gp_l1_reg_loss: 23549.5731; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 19206.7532; train_global_loss: 3763705.2789; train_optim_loss: 3763705.2789; val_kl_reg_loss: 38437.4505; val_edge_recon_loss: 633524.2441; val_cat_covariates_contrastive_loss: 956461.5779; val_gene_expr_recon_loss: 2095221.7492; val_masked_gp_l1_reg_loss: 23722.1797; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 19247.4297; val_global_loss: 3766614.7716; val_optim_loss: 3766614.7716
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.9108; val_auprc_score: 0.9845; val_best_acc_score: 0.9290; val_best_f1_score: 0.9609; train_kl_reg_loss: 197448.3248; train_edge_recon_loss: 640282.9303; train_cat_covariates_contrastive_loss: 956960.9889; train_gene_expr_recon_loss: 2749222.8206; train_masked_gp_l1_reg_loss: 58591.3376; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 40178.2492; train_global_loss: 4642684.6528; train_optim_loss: 4642684.6528; val_kl_reg_loss: 38355.6502; val_edge_recon_loss: 642773.4102; val_cat_covariates_contrastive_loss: 953526.5885; val_gene_expr_recon_loss: 2407590.7222; val_masked_gp_l1_reg_loss: 131476.3438; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 76348.7188; val_global_loss: 4250071.3086; val_optim_loss: 4250071.3086
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.9278; val_auprc_score: 0.9873; val_best_acc_score: 0.9363; val_best_f1_score: 0.9646; train_kl_reg_loss: 40403.9310; train_edge_recon_loss: 617564.8149; train_cat_covariates_contrastive_loss: 956920.2800; train_gene_expr_recon_loss: 2194725.0992; train_masked_gp_l1_reg_loss: 67907.0352; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 37000.8803; train_global_loss: 3914522.0389; train_optim_loss: 3914522.0389; val_kl_reg_loss: 40233.7732; val_edge_recon_loss: 636990.0277; val_cat_covariates_contrastive_loss: 960952.6140; val_gene_expr_recon_loss: 2117622.9352; val_masked_gp_l1_reg_loss: 35861.1836; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 22352.9941; val_global_loss: 3814013.6057; val_optim_loss: 3814013.6057
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.9254; val_auprc_score: 0.9860; val_best_acc_score: 0.9383; val_best_f1_score: 0.9657; train_kl_reg_loss: 42179.3074; train_edge_recon_loss: 617852.6351; train_cat_covariates_contrastive_loss: 958379.3624; train_gene_expr_recon_loss: 2108324.2626; train_masked_gp_l1_reg_loss: 27517.6774; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 20066.9968; train_global_loss: 3774320.2415; train_optim_loss: 3774320.2415; val_kl_reg_loss: 41332.9510; val_edge_recon_loss: 643869.4283; val_cat_covariates_contrastive_loss: 957810.6493; val_gene_expr_recon_loss: 2095774.9514; val_masked_gp_l1_reg_loss: 23884.1348; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 19203.0508; val_global_loss: 3781875.2330; val_optim_loss: 3781875.2330
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.8182; val_auprc_score: 0.9726; val_best_acc_score: 0.8954; val_best_f1_score: 0.9440; train_kl_reg_loss: 9691199.5589; train_edge_recon_loss: 694250.5291; train_cat_covariates_contrastive_loss: 957280.8307; train_gene_expr_recon_loss: 4740958.7454; train_masked_gp_l1_reg_loss: 71368.8369; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 57365.6132; train_global_loss: 16212423.6934; train_optim_loss: 16212423.6934; val_kl_reg_loss: 172856.1117; val_edge_recon_loss: 836807.0750; val_cat_covariates_contrastive_loss: 957883.5384; val_gene_expr_recon_loss: 5968961.0170; val_masked_gp_l1_reg_loss: 184624.7812; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 111292.0547; val_global_loss: 8232424.7654; val_optim_loss: 8232424.7654

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.8802; val_auprc_score: 0.9793; val_best_acc_score: 0.9190; val_best_f1_score: 0.9556; train_kl_reg_loss: 113380.8420; train_edge_recon_loss: 711048.7331; train_cat_covariates_contrastive_loss: 963468.2520; train_gene_expr_recon_loss: 3325672.4701; train_masked_gp_l1_reg_loss: 170359.7955; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 96357.8487; train_global_loss: 5380287.9390; train_optim_loss: 5380287.9390; val_kl_reg_loss: 87290.0355; val_edge_recon_loss: 661852.4299; val_cat_covariates_contrastive_loss: 965417.7338; val_gene_expr_recon_loss: 2471615.7114; val_masked_gp_l1_reg_loss: 141766.1406; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 78772.3438; val_global_loss: 4406714.4630; val_optim_loss: 4406714.4630
Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.9009; val_auprc_score: 0.9822; val_best_acc_score: 0.9259; val_best_f1_score: 0.9591; train_kl_reg_loss: 76320.8413; train_edge_recon_loss: 630797.4641; train_cat_covariates_contrastive_loss: 962904.1658; train_gene_expr_recon_loss: 2396281.1703; train_masked_gp_l1_reg_loss: 110166.6753; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 60219.5539; train_global_loss: 4236689.8678; train_optim_loss: 4236689.8678; val_kl_reg_loss: 67021.8438; val_edge_recon_loss: 640546.2563; val_cat_covariates_contrastive_loss: 962435.3057; val_gene_expr_recon_loss: 2317815.6744; val_masked_gp_l1_reg_loss: 79575.0625; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 43149.1836; val_global_loss: 4110543.3025; val_optim_loss: 4110543.3025
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.9109; val_auprc_score: 0.9840; val_best_acc_score: 0.9276; val_best_f1_score: 0.9598; train_kl_reg_loss: 62290.2953; train_edge_recon_loss: 623790.4326; train_cat_covariates_contrastive_loss: 961859.4698; train_gene_expr_recon_loss: 2270004.6772; train_masked_gp_l1_reg_loss: 56171.9627; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 31427.9062; train_global_loss: 4005544.7393; train_optim_loss: 4005544.7393; val_kl_reg_loss: 58759.8418; val_edge_recon_loss: 643512.6600; val_cat_covariates_contrastive_loss: 961580.9140; val_gene_expr_recon_loss: 2218209.0602; val_masked_gp_l1_reg_loss: 37766.9023; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 22329.4668; val_global_loss: 3942158.9769; val_optim_loss: 3942158.9769
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.9180; val_auprc_score: 0.9849; val_best_acc_score: 0.9308; val_best_f1_score: 0.9616; train_kl_reg_loss: 57152.8422; train_edge_recon_loss: 620875.7716; train_cat_covariates_contrastive_loss: 961674.1933; train_gene_expr_recon_loss: 2196240.3786; train_masked_gp_l1_reg_loss: 28891.2453; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17904.2765; train_global_loss: 3882738.7044; train_optim_loss: 3882738.7044; val_kl_reg_loss: 54185.5162; val_edge_recon_loss: 645281.6730; val_cat_covariates_contrastive_loss: 962384.2292; val_gene_expr_recon_loss: 2170282.9823; val_masked_gp_l1_reg_loss: 23429.7637; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15096.5215; val_global_loss: 3870660.6520; val_optim_loss: 3870660.6520

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 227 min 25 sec.
Using best model state, which was in epoch 17.

--- MODEL EVALUATION ---
val AUROC score: 0.8847
val AUPRC score: 0.9766
val best accuracy score: 0.9247
val best F1 score: 0.9584
val target rna MSE score: 2.1272
val source rna MSE score: 0.7365
Val cat covariate0 mean sim diff: -0.0063
Val cat covariate1 mean sim diff: -0.0437
Val cat covariate2 mean sim diff: -0.0044

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
