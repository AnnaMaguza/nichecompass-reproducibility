[True]
Run timestamp: 02082023_185931_4.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'seqfish_mouse_organogenesis_imputed', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', '--n_neighbors', '8', '--filter_genes', '--n_hvg', '4000', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '300', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '20', '--lambda_l1_addon', '30', '--edge_batch_size', '256', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_4']

Preparing the gene program mask...
Epoch 30/100 |██████--------------| 30.0% val_auroc_score: 0.9761; val_auprc_score: 0.9943; val_best_acc_score: 0.9702; val_best_f1_score: 0.9827; train_kl_reg_loss: 12488.5066; train_edge_recon_loss: 769055.3688; train_gene_expr_recon_loss: 1440328.5185; train_masked_gp_l1_reg_loss: 8401.9058; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 4212.3966; train_global_loss: 2234486.6947; train_optim_loss: 2234486.6947; val_kl_reg_loss: 12615.5677; val_edge_recon_loss: 765801.6637; val_gene_expr_recon_loss: 1440071.9649; val_masked_gp_l1_reg_loss: 8408.3672; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 4200.4766; val_global_loss: 2231097.9658; val_optim_loss: 2231097.9658

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 31/100 |██████--------------| 31.0% val_auroc_score: 0.9778; val_auprc_score: 0.9949; val_best_acc_score: 0.9718; val_best_f1_score: 0.9836; train_kl_reg_loss: 12536.1195; train_edge_recon_loss: 769836.6237; train_gene_expr_recon_loss: 1439767.5139; train_masked_gp_l1_reg_loss: 8353.9184; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 4184.4441; train_global_loss: 2234678.6245; train_optim_loss: 2234678.6245; val_kl_reg_loss: 12472.5487; val_edge_recon_loss: 766297.3444; val_gene_expr_recon_loss: 1439778.6502; val_masked_gp_l1_reg_loss: 8347.3555; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 4179.5518; val_global_loss: 2231075.2986; val_optim_loss: 2231075.2986
Epoch 32/100 |██████--------------| 32.0% val_auroc_score: 0.9791; val_auprc_score: 0.9952; val_best_acc_score: 0.9726; val_best_f1_score: 0.9841; train_kl_reg_loss: 12491.2800; train_edge_recon_loss: 770257.2328; train_gene_expr_recon_loss: 1439750.4466; train_masked_gp_l1_reg_loss: 8347.8945; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 4176.8639; train_global_loss: 2235023.7094; train_optim_loss: 2235023.7094; val_kl_reg_loss: 12489.8818; val_edge_recon_loss: 765055.0157; val_gene_expr_recon_loss: 1439823.5279; val_masked_gp_l1_reg_loss: 8347.9277; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 4174.0674; val_global_loss: 2229890.4281; val_optim_loss: 2229890.4281
Epoch 33/100 |██████--------------| 33.0% val_auroc_score: 0.9784; val_auprc_score: 0.9950; val_best_acc_score: 0.9719; val_best_f1_score: 0.9836; train_kl_reg_loss: 12489.7681; train_edge_recon_loss: 765046.9869; train_gene_expr_recon_loss: 1439723.8585; train_masked_gp_l1_reg_loss: 8348.4465; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 4171.4358; train_global_loss: 2229780.5040; train_optim_loss: 2229780.5040; val_kl_reg_loss: 12503.5593; val_edge_recon_loss: 778951.5688; val_gene_expr_recon_loss: 1439962.0468; val_masked_gp_l1_reg_loss: 8348.8047; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 4167.4688; val_global_loss: 2243933.4317; val_optim_loss: 2243933.4317
Epoch 34/100 |██████--------------| 34.0% val_auroc_score: 0.9770; val_auprc_score: 0.9942; val_best_acc_score: 0.9701; val_best_f1_score: 0.9826; train_kl_reg_loss: 12455.1974; train_edge_recon_loss: 768791.9145; train_gene_expr_recon_loss: 1439726.5253; train_masked_gp_l1_reg_loss: 8349.6969; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 4166.5735; train_global_loss: 2233489.9043; train_optim_loss: 2233489.9043; val_kl_reg_loss: 12503.8532; val_edge_recon_loss: 780396.2014; val_gene_expr_recon_loss: 1440684.7338; val_masked_gp_l1_reg_loss: 8350.7949; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 4166.2520; val_global_loss: 2246101.7860; val_optim_loss: 2246101.7860

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 435 min 34 sec.
Using best model state, which was in epoch 26.

--- MODEL EVALUATION ---
val AUROC score: 0.9761
val AUPRC score: 0.9943
val best accuracy score: 0.9707
val best F1 score: 0.9829
val target rna MSE score: 1.1228
val source rna MSE score: 0.5014
Val cat covariate0 mean sim diff: -0.0017

Computing neighbor graph...

Computing UMAP embedding...

Saving model...
