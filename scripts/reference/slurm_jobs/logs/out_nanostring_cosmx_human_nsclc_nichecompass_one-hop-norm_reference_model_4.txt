Run timestamp: 14062023_155739.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '0.01', '--nichenet_max_n_target_genes_per_gp', '1000', '--include_mebocost_gps', '--mebocost_species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cond_embed_injection', 'gene_expr_decoder', '--n_cond_embed', '8', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cond_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cond_contrastive', '0.', '--contrastive_logits_ratio', '0.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '5.', '--edge_batch_size', '1024', '--node_batch_size', 'None', '--timestamp_suffix', '_4']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 1726.
Number of gene programs after filtering and combining: 1585.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.05
LOG VARIATIONAL -> True
CONDITIONAL EMBEDDING INJECTION -> ['gene_expr_decoder']
ENCODER -> n_input: 960, n_cond_embed_input: 0, n_layers: 1, n_hidden: 960, n_latent: 1064, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> n_cond_embed_input: 0, n_cond_embed_output: 1064, dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1064, n_cond_embed_input: 8, n_addon_input: 0, n_output: 1920
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 254337
Number of validation nodes: 28260
Number of training edges: 1722321
Number of validation edges: 191368
Edge batch size: 1024
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9833; val_auprc_score: 0.9932; val_best_acc_score: 0.9575; val_best_f1_score: 0.9720; train_kl_reg_loss: 17342.2619; train_edge_recon_loss: 1355158.2185; train_gene_expr_recon_loss: 1915435.8949; train_masked_gp_l1_reg_loss: 1999.9000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3289936.2779; train_optim_loss: 3289936.2779; val_kl_reg_loss: 7840.0718; val_edge_recon_loss: 1316801.7152; val_gene_expr_recon_loss: 1826874.2179; val_masked_gp_l1_reg_loss: 2212.8159; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3153728.7580; val_optim_loss: 3153728.7580
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9868; val_auprc_score: 0.9944; val_best_acc_score: 0.9657; val_best_f1_score: 0.9773; train_kl_reg_loss: 7661.0892; train_edge_recon_loss: 1301823.9275; train_gene_expr_recon_loss: 1791801.0438; train_masked_gp_l1_reg_loss: 2188.8645; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3103474.9260; train_optim_loss: 3103474.9260; val_kl_reg_loss: 7499.7121; val_edge_recon_loss: 1309386.7039; val_gene_expr_recon_loss: 1788372.6932; val_masked_gp_l1_reg_loss: 2203.3140; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3107462.3676; val_optim_loss: 3107462.3676
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9881; val_auprc_score: 0.9950; val_best_acc_score: 0.9674; val_best_f1_score: 0.9785; train_kl_reg_loss: 7519.9964; train_edge_recon_loss: 1297313.2988; train_gene_expr_recon_loss: 1766884.8675; train_masked_gp_l1_reg_loss: 2262.4644; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3073980.6274; train_optim_loss: 3073980.6274; val_kl_reg_loss: 7444.4814; val_edge_recon_loss: 1299407.3670; val_gene_expr_recon_loss: 1768748.7266; val_masked_gp_l1_reg_loss: 2318.8340; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3077919.3235; val_optim_loss: 3077919.3235
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9906; val_auprc_score: 0.9962; val_best_acc_score: 0.9727; val_best_f1_score: 0.9819; train_kl_reg_loss: 7624.3586; train_edge_recon_loss: 1296726.2805; train_gene_expr_recon_loss: 1754360.7290; train_masked_gp_l1_reg_loss: 2382.5367; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3061093.9056; train_optim_loss: 3061093.9056; val_kl_reg_loss: 7571.5072; val_edge_recon_loss: 1303674.6096; val_gene_expr_recon_loss: 1762289.3416; val_masked_gp_l1_reg_loss: 2439.3857; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3075974.9505; val_optim_loss: 3075974.9505
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9909; val_auprc_score: 0.9963; val_best_acc_score: 0.9725; val_best_f1_score: 0.9818; train_kl_reg_loss: 7753.7890; train_edge_recon_loss: 1296905.3265; train_gene_expr_recon_loss: 1747328.2157; train_masked_gp_l1_reg_loss: 2485.6221; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3054472.9556; train_optim_loss: 3054472.9556; val_kl_reg_loss: 7663.5368; val_edge_recon_loss: 1303183.1511; val_gene_expr_recon_loss: 1757786.5842; val_masked_gp_l1_reg_loss: 2520.5129; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3071153.7687; val_optim_loss: 3071153.7687
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9913; val_auprc_score: 0.9963; val_best_acc_score: 0.9745; val_best_f1_score: 0.9831; train_kl_reg_loss: 7928.9809; train_edge_recon_loss: 1293659.6313; train_gene_expr_recon_loss: 1742313.7617; train_masked_gp_l1_reg_loss: 2559.2073; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3046461.5785; train_optim_loss: 3046461.5785; val_kl_reg_loss: 7797.4504; val_edge_recon_loss: 1297393.7814; val_gene_expr_recon_loss: 1752555.5628; val_masked_gp_l1_reg_loss: 2581.9897; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3060328.7928; val_optim_loss: 3060328.7928
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9916; val_auprc_score: 0.9965; val_best_acc_score: 0.9754; val_best_f1_score: 0.9837; train_kl_reg_loss: 8076.5200; train_edge_recon_loss: 1292860.6104; train_gene_expr_recon_loss: 1737586.4518; train_masked_gp_l1_reg_loss: 2613.0898; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3041136.6702; train_optim_loss: 3041136.6702; val_kl_reg_loss: 8196.4322; val_edge_recon_loss: 1298334.8282; val_gene_expr_recon_loss: 1748877.2701; val_masked_gp_l1_reg_loss: 2632.2578; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3058040.7754; val_optim_loss: 3058040.7754
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9920; val_auprc_score: 0.9967; val_best_acc_score: 0.9758; val_best_f1_score: 0.9840; train_kl_reg_loss: 8188.5694; train_edge_recon_loss: 1293901.5650; train_gene_expr_recon_loss: 1735554.4914; train_masked_gp_l1_reg_loss: 2648.2129; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3040292.8365; train_optim_loss: 3040292.8365; val_kl_reg_loss: 8146.9569; val_edge_recon_loss: 1296969.0127; val_gene_expr_recon_loss: 1747080.5595; val_masked_gp_l1_reg_loss: 2666.7942; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3054863.2754; val_optim_loss: 3054863.2754
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9922; val_auprc_score: 0.9968; val_best_acc_score: 0.9768; val_best_f1_score: 0.9847; train_kl_reg_loss: 8314.4768; train_edge_recon_loss: 1290450.1467; train_gene_expr_recon_loss: 1733047.4550; train_masked_gp_l1_reg_loss: 2676.0120; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3034488.0889; train_optim_loss: 3034488.0889; val_kl_reg_loss: 8291.1166; val_edge_recon_loss: 1295964.4225; val_gene_expr_recon_loss: 1746264.8636; val_masked_gp_l1_reg_loss: 2683.3662; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3053203.6364; val_optim_loss: 3053203.6364
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9927; val_auprc_score: 0.9970; val_best_acc_score: 0.9778; val_best_f1_score: 0.9853; train_kl_reg_loss: 8436.8467; train_edge_recon_loss: 1292821.3357; train_gene_expr_recon_loss: 1730903.7805; train_masked_gp_l1_reg_loss: 2693.4378; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3034855.3968; train_optim_loss: 3034855.3968; val_kl_reg_loss: 8315.5788; val_edge_recon_loss: 1294957.4004; val_gene_expr_recon_loss: 1746924.1604; val_masked_gp_l1_reg_loss: 2698.6934; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3052895.8971; val_optim_loss: 3052895.8971
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9932; val_auprc_score: 0.9972; val_best_acc_score: 0.9781; val_best_f1_score: 0.9855; train_kl_reg_loss: 8506.2669; train_edge_recon_loss: 1290469.7261; train_gene_expr_recon_loss: 1728318.6485; train_masked_gp_l1_reg_loss: 2707.9438; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3030002.5834; train_optim_loss: 3030002.5834; val_kl_reg_loss: 8410.8508; val_edge_recon_loss: 1300066.3630; val_gene_expr_recon_loss: 1743219.4198; val_masked_gp_l1_reg_loss: 2713.5273; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3054410.1430; val_optim_loss: 3054410.1430
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9922; val_auprc_score: 0.9967; val_best_acc_score: 0.9778; val_best_f1_score: 0.9853; train_kl_reg_loss: 8593.6574; train_edge_recon_loss: 1290759.9555; train_gene_expr_recon_loss: 1727406.2826; train_masked_gp_l1_reg_loss: 2720.9289; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3029480.8298; train_optim_loss: 3029480.8298; val_kl_reg_loss: 8606.0725; val_edge_recon_loss: 1295262.5414; val_gene_expr_recon_loss: 1745145.3590; val_masked_gp_l1_reg_loss: 2725.8936; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3051739.9652; val_optim_loss: 3051739.9652
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9935; val_auprc_score: 0.9973; val_best_acc_score: 0.9797; val_best_f1_score: 0.9866; train_kl_reg_loss: 8646.6391; train_edge_recon_loss: 1290299.1471; train_gene_expr_recon_loss: 1725799.8905; train_masked_gp_l1_reg_loss: 2738.2404; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3027483.9159; train_optim_loss: 3027483.9159; val_kl_reg_loss: 8554.0914; val_edge_recon_loss: 1292517.2286; val_gene_expr_recon_loss: 1745640.7888; val_masked_gp_l1_reg_loss: 2735.6978; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3049447.8610; val_optim_loss: 3049447.8610
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9935; val_auprc_score: 0.9973; val_best_acc_score: 0.9796; val_best_f1_score: 0.9865; train_kl_reg_loss: 8732.6513; train_edge_recon_loss: 1290464.7504; train_gene_expr_recon_loss: 1725067.8887; train_masked_gp_l1_reg_loss: 2749.3354; train_group_lasso_reg_loss: 0.0000; train_global_loss: 3027014.6246; train_optim_loss: 3027014.6246; val_kl_reg_loss: 8651.9210; val_edge_recon_loss: 1291467.6397; val_gene_expr_recon_loss: 1746417.9639; val_masked_gp_l1_reg_loss: 2754.5823; val_group_lasso_reg_loss: 0.0000; val_global_loss: 3049292.0281; val_optim_loss: 3049292.0281
