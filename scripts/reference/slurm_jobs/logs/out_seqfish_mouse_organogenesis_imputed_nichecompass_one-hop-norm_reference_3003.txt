[True]
Run timestamp: 25072023_093729_3003.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'seqfish_mouse_organogenesis_imputed', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', '--n_neighbors', '20', '--filter_genes', '--n_hvg', '4000', '--nichenet_keep_target_genes_ratio', '0.1', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000.0', '--lambda_gene_expr_recon', '30.0', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '5.0', '--edge_batch_size', '64', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_3003']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Filtering genes...
Starting with 29452 genes.
Keeping 29452 genes after filtering genes with expression in 0 cells.
Keeping 4032 highly variable or gene program relevant genes.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.05
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ENCODER -> n_input: 4032, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 1540, n_latent: 1540, n_addon_latent: 0, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1540, n_cat_covariates_embed_input: 3, n_addon_input: 0, n_output: 8064
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 47311
Number of validation nodes: 5257
Number of training edges: 529546
Number of validation edges: 58838
Edge batch size: 64
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.8434; val_auprc_score: 0.9634; val_best_acc_score: 0.8858; val_best_f1_score: 0.9363; train_kl_reg_loss: 3755.9116; train_edge_recon_loss: 9837.3987; train_gene_expr_recon_loss: 86926.7030; train_masked_gp_l1_reg_loss: 2613.2721; train_group_lasso_reg_loss: 0.0000; train_global_loss: 103133.2854; train_optim_loss: 103133.2854; val_kl_reg_loss: 1377.7856; val_edge_recon_loss: 8873.5871; val_gene_expr_recon_loss: 76955.0018; val_masked_gp_l1_reg_loss: 1629.5227; val_group_lasso_reg_loss: 0.0000; val_global_loss: 88835.8980; val_optim_loss: 88835.8980
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.8628; val_auprc_score: 0.9704; val_best_acc_score: 0.8775; val_best_f1_score: 0.9318; train_kl_reg_loss: 1639.2340; train_edge_recon_loss: 9104.0429; train_gene_expr_recon_loss: 74406.5480; train_masked_gp_l1_reg_loss: 1558.4124; train_group_lasso_reg_loss: 0.0000; train_global_loss: 86708.2373; train_optim_loss: 86708.2373; val_kl_reg_loss: 1735.5846; val_edge_recon_loss: 8417.9316; val_gene_expr_recon_loss: 73339.2123; val_masked_gp_l1_reg_loss: 1572.5615; val_group_lasso_reg_loss: 0.0000; val_global_loss: 85065.2910; val_optim_loss: 85065.2910
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.8601; val_auprc_score: 0.9702; val_best_acc_score: 0.8741; val_best_f1_score: 0.9299; train_kl_reg_loss: 1747.7611; train_edge_recon_loss: 9065.3167; train_gene_expr_recon_loss: 73150.4934; train_masked_gp_l1_reg_loss: 1607.5048; train_group_lasso_reg_loss: 0.0000; train_global_loss: 85571.0761; train_optim_loss: 85571.0761; val_kl_reg_loss: 1889.4435; val_edge_recon_loss: 8501.2247; val_gene_expr_recon_loss: 72724.3381; val_masked_gp_l1_reg_loss: 1623.0524; val_group_lasso_reg_loss: 0.0000; val_global_loss: 84738.0609; val_optim_loss: 84738.0609
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.8581; val_auprc_score: 0.9691; val_best_acc_score: 0.8724; val_best_f1_score: 0.9292; train_kl_reg_loss: 1789.8281; train_edge_recon_loss: 9040.6359; train_gene_expr_recon_loss: 72784.6381; train_masked_gp_l1_reg_loss: 1641.6682; train_group_lasso_reg_loss: 0.0000; train_global_loss: 85256.7702; train_optim_loss: 85256.7702; val_kl_reg_loss: 1801.2968; val_edge_recon_loss: 8453.0564; val_gene_expr_recon_loss: 72610.8255; val_masked_gp_l1_reg_loss: 1682.7585; val_group_lasso_reg_loss: 0.0000; val_global_loss: 84547.9365; val_optim_loss: 84547.9365
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.8190; val_auprc_score: 0.9554; val_best_acc_score: 0.8737; val_best_f1_score: 0.9300; train_kl_reg_loss: 1759.5538; train_edge_recon_loss: 9087.6955; train_gene_expr_recon_loss: 73343.4983; train_masked_gp_l1_reg_loss: 1689.0848; train_group_lasso_reg_loss: 0.0000; train_global_loss: 85879.8325; train_optim_loss: 85879.8325; val_kl_reg_loss: 1440.4095; val_edge_recon_loss: 8903.5430; val_gene_expr_recon_loss: 74415.0901; val_masked_gp_l1_reg_loss: 1647.4973; val_group_lasso_reg_loss: 0.0000; val_global_loss: 86406.5426; val_optim_loss: 86406.5426
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.8591; val_auprc_score: 0.9692; val_best_acc_score: 0.8728; val_best_f1_score: 0.9283; train_kl_reg_loss: 1641.8918; train_edge_recon_loss: 9135.6351; train_gene_expr_recon_loss: 73261.1103; train_masked_gp_l1_reg_loss: 1614.9244; train_group_lasso_reg_loss: 0.0000; train_global_loss: 85653.5616; train_optim_loss: 85653.5616; val_kl_reg_loss: 1839.2870; val_edge_recon_loss: 8438.9342; val_gene_expr_recon_loss: 72203.0097; val_masked_gp_l1_reg_loss: 1674.8456; val_group_lasso_reg_loss: 0.0000; val_global_loss: 84156.0746; val_optim_loss: 84156.0746
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.8576; val_auprc_score: 0.9687; val_best_acc_score: 0.8732; val_best_f1_score: 0.9285; train_kl_reg_loss: 1821.0948; train_edge_recon_loss: 8993.3703; train_gene_expr_recon_loss: 72251.6730; train_masked_gp_l1_reg_loss: 1690.6676; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84756.8057; train_optim_loss: 84756.8057; val_kl_reg_loss: 1782.1852; val_edge_recon_loss: 8452.2850; val_gene_expr_recon_loss: 71978.0275; val_masked_gp_l1_reg_loss: 1659.2682; val_group_lasso_reg_loss: 0.0000; val_global_loss: 83871.7635; val_optim_loss: 83871.7635
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.8535; val_auprc_score: 0.9681; val_best_acc_score: 0.8725; val_best_f1_score: 0.9285; train_kl_reg_loss: 1826.6078; train_edge_recon_loss: 9024.5152; train_gene_expr_recon_loss: 72145.9099; train_masked_gp_l1_reg_loss: 1699.8697; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84696.9027; train_optim_loss: 84696.9027; val_kl_reg_loss: 1909.1816; val_edge_recon_loss: 8539.6057; val_gene_expr_recon_loss: 71967.1942; val_masked_gp_l1_reg_loss: 1702.1803; val_group_lasso_reg_loss: 0.0000; val_global_loss: 84118.1612; val_optim_loss: 84118.1612
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.8536; val_auprc_score: 0.9683; val_best_acc_score: 0.8665; val_best_f1_score: 0.9257; train_kl_reg_loss: 1846.1771; train_edge_recon_loss: 9034.6972; train_gene_expr_recon_loss: 72261.2924; train_masked_gp_l1_reg_loss: 1710.6128; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84852.7795; train_optim_loss: 84852.7795; val_kl_reg_loss: 1839.6992; val_edge_recon_loss: 8349.3272; val_gene_expr_recon_loss: 71924.8238; val_masked_gp_l1_reg_loss: 1690.2863; val_group_lasso_reg_loss: 0.0000; val_global_loss: 83804.1393; val_optim_loss: 83804.1393
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.8538; val_auprc_score: 0.9679; val_best_acc_score: 0.8669; val_best_f1_score: 0.9259; train_kl_reg_loss: 1822.8903; train_edge_recon_loss: 9020.7125; train_gene_expr_recon_loss: 72160.1496; train_masked_gp_l1_reg_loss: 1704.0987; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84707.8512; train_optim_loss: 84707.8512; val_kl_reg_loss: 1876.2829; val_edge_recon_loss: 8492.3517; val_gene_expr_recon_loss: 71741.5753; val_masked_gp_l1_reg_loss: 1698.0076; val_group_lasso_reg_loss: 0.0000; val_global_loss: 83808.2177; val_optim_loss: 83808.2177
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.8516; val_auprc_score: 0.9683; val_best_acc_score: 0.8686; val_best_f1_score: 0.9270; train_kl_reg_loss: 1849.8575; train_edge_recon_loss: 8986.2057; train_gene_expr_recon_loss: 71987.7811; train_masked_gp_l1_reg_loss: 1704.9854; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84528.8298; train_optim_loss: 84528.8298; val_kl_reg_loss: 1964.9731; val_edge_recon_loss: 8477.9001; val_gene_expr_recon_loss: 71941.4039; val_masked_gp_l1_reg_loss: 1769.4302; val_group_lasso_reg_loss: 0.0000; val_global_loss: 84153.7067; val_optim_loss: 84153.7067
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.8569; val_auprc_score: 0.9687; val_best_acc_score: 0.8700; val_best_f1_score: 0.9262; train_kl_reg_loss: 1863.6239; train_edge_recon_loss: 9003.8624; train_gene_expr_recon_loss: 71793.4883; train_masked_gp_l1_reg_loss: 1704.4328; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84365.4074; train_optim_loss: 84365.4074; val_kl_reg_loss: 1862.7596; val_edge_recon_loss: 8460.6338; val_gene_expr_recon_loss: 71659.3473; val_masked_gp_l1_reg_loss: 1690.9766; val_group_lasso_reg_loss: 0.0000; val_global_loss: 83673.7174; val_optim_loss: 83673.7174
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.8595; val_auprc_score: 0.9694; val_best_acc_score: 0.8733; val_best_f1_score: 0.9290; train_kl_reg_loss: 1873.1184; train_edge_recon_loss: 8985.5234; train_gene_expr_recon_loss: 71828.9963; train_masked_gp_l1_reg_loss: 1720.9389; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84408.5770; train_optim_loss: 84408.5770; val_kl_reg_loss: 1926.7519; val_edge_recon_loss: 8465.7932; val_gene_expr_recon_loss: 72040.7897; val_masked_gp_l1_reg_loss: 1712.8876; val_group_lasso_reg_loss: 0.0000; val_global_loss: 84146.2254; val_optim_loss: 84146.2254
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.8543; val_auprc_score: 0.9681; val_best_acc_score: 0.8652; val_best_f1_score: 0.9255; train_kl_reg_loss: 1711.9218; train_edge_recon_loss: 9096.4043; train_gene_expr_recon_loss: 73482.4619; train_masked_gp_l1_reg_loss: 1624.2904; train_group_lasso_reg_loss: 0.0000; train_global_loss: 85915.0782; train_optim_loss: 85915.0782; val_kl_reg_loss: 1870.1589; val_edge_recon_loss: 8483.2730; val_gene_expr_recon_loss: 71986.6782; val_masked_gp_l1_reg_loss: 1640.6984; val_group_lasso_reg_loss: 0.0000; val_global_loss: 83980.8056; val_optim_loss: 83980.8056
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.8464; val_auprc_score: 0.9661; val_best_acc_score: 0.8659; val_best_f1_score: 0.9255; train_kl_reg_loss: 1856.3896; train_edge_recon_loss: 8971.0584; train_gene_expr_recon_loss: 71841.4874; train_masked_gp_l1_reg_loss: 1694.1564; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84363.0917; train_optim_loss: 84363.0917; val_kl_reg_loss: 1851.0399; val_edge_recon_loss: 8582.4822; val_gene_expr_recon_loss: 72048.8044; val_masked_gp_l1_reg_loss: 1719.9021; val_group_lasso_reg_loss: 0.0000; val_global_loss: 84202.2248; val_optim_loss: 84202.2248
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.8538; val_auprc_score: 0.9686; val_best_acc_score: 0.8645; val_best_f1_score: 0.9249; train_kl_reg_loss: 1876.9758; train_edge_recon_loss: 8964.2725; train_gene_expr_recon_loss: 71723.8125; train_masked_gp_l1_reg_loss: 1709.0115; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84274.0722; train_optim_loss: 84274.0722; val_kl_reg_loss: 1880.4683; val_edge_recon_loss: 8439.4969; val_gene_expr_recon_loss: 71439.0822; val_masked_gp_l1_reg_loss: 1691.4130; val_group_lasso_reg_loss: 0.0000; val_global_loss: 83450.4615; val_optim_loss: 83450.4615
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.8399; val_auprc_score: 0.9614; val_best_acc_score: 0.8819; val_best_f1_score: 0.9339; train_kl_reg_loss: 1738.5046; train_edge_recon_loss: 9151.8013; train_gene_expr_recon_loss: 73885.7235; train_masked_gp_l1_reg_loss: 1713.1470; train_group_lasso_reg_loss: 0.0000; train_global_loss: 86489.1764; train_optim_loss: 86489.1764; val_kl_reg_loss: 1537.3305; val_edge_recon_loss: 8666.4404; val_gene_expr_recon_loss: 74463.7343; val_masked_gp_l1_reg_loss: 1522.2316; val_group_lasso_reg_loss: 0.0000; val_global_loss: 86189.7397; val_optim_loss: 86189.7397
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.8458; val_auprc_score: 0.9635; val_best_acc_score: 0.8904; val_best_f1_score: 0.9386; train_kl_reg_loss: 1567.1314; train_edge_recon_loss: 9154.3870; train_gene_expr_recon_loss: 73971.8582; train_masked_gp_l1_reg_loss: 1525.3761; train_group_lasso_reg_loss: 0.0000; train_global_loss: 86218.7526; train_optim_loss: 86218.7526; val_kl_reg_loss: 1614.3076; val_edge_recon_loss: 8417.0290; val_gene_expr_recon_loss: 74239.0205; val_masked_gp_l1_reg_loss: 1558.1592; val_group_lasso_reg_loss: 0.0000; val_global_loss: 85828.5133; val_optim_loss: 85828.5133
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.8322; val_auprc_score: 0.9609; val_best_acc_score: 0.8771; val_best_f1_score: 0.9310; train_kl_reg_loss: 1552.0929; train_edge_recon_loss: 9206.1944; train_gene_expr_recon_loss: 74321.6909; train_masked_gp_l1_reg_loss: 1538.1094; train_group_lasso_reg_loss: 0.0000; train_global_loss: 86618.0877; train_optim_loss: 86618.0877; val_kl_reg_loss: 1666.4688; val_edge_recon_loss: 8596.4427; val_gene_expr_recon_loss: 73655.4730; val_masked_gp_l1_reg_loss: 1511.1310; val_group_lasso_reg_loss: 0.0000; val_global_loss: 85429.5173; val_optim_loss: 85429.5173
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.8386; val_auprc_score: 0.9622; val_best_acc_score: 0.8801; val_best_f1_score: 0.9325; train_kl_reg_loss: 1620.4170; train_edge_recon_loss: 9131.8421; train_gene_expr_recon_loss: 73572.6949; train_masked_gp_l1_reg_loss: 1530.5340; train_group_lasso_reg_loss: 0.0000; train_global_loss: 85855.4880; train_optim_loss: 85855.4880; val_kl_reg_loss: 1675.4246; val_edge_recon_loss: 8568.0476; val_gene_expr_recon_loss: 73524.0521; val_masked_gp_l1_reg_loss: 1500.1458; val_group_lasso_reg_loss: 0.0000; val_global_loss: 85267.6727; val_optim_loss: 85267.6727

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.8396; val_auprc_score: 0.9618; val_best_acc_score: 0.8828; val_best_f1_score: 0.9340; train_kl_reg_loss: 1636.0902; train_edge_recon_loss: 9076.4481; train_gene_expr_recon_loss: 73042.6374; train_masked_gp_l1_reg_loss: 1238.4631; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84993.6388; train_optim_loss: 84993.6388; val_kl_reg_loss: 1680.9941; val_edge_recon_loss: 8583.9777; val_gene_expr_recon_loss: 73054.1195; val_masked_gp_l1_reg_loss: 1249.8383; val_group_lasso_reg_loss: 0.0000; val_global_loss: 84568.9270; val_optim_loss: 84568.9270
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.8404; val_auprc_score: 0.9622; val_best_acc_score: 0.8837; val_best_f1_score: 0.9347; train_kl_reg_loss: 1640.7171; train_edge_recon_loss: 9104.4491; train_gene_expr_recon_loss: 72941.6764; train_masked_gp_l1_reg_loss: 1256.7759; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84943.6186; train_optim_loss: 84943.6186; val_kl_reg_loss: 1687.0169; val_edge_recon_loss: 8516.6235; val_gene_expr_recon_loss: 73040.4309; val_masked_gp_l1_reg_loss: 1266.3094; val_group_lasso_reg_loss: 0.0000; val_global_loss: 84510.3839; val_optim_loss: 84510.3839
Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.8404; val_auprc_score: 0.9626; val_best_acc_score: 0.8816; val_best_f1_score: 0.9335; train_kl_reg_loss: 1649.3249; train_edge_recon_loss: 9084.3965; train_gene_expr_recon_loss: 72904.8168; train_masked_gp_l1_reg_loss: 1270.9185; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84909.4567; train_optim_loss: 84909.4567; val_kl_reg_loss: 1667.9455; val_edge_recon_loss: 8538.3237; val_gene_expr_recon_loss: 72911.1017; val_masked_gp_l1_reg_loss: 1273.9357; val_group_lasso_reg_loss: 0.0000; val_global_loss: 84391.3085; val_optim_loss: 84391.3085
Epoch 24/100 |████----------------| 24.0% val_auroc_score: 0.8428; val_auprc_score: 0.9630; val_best_acc_score: 0.8841; val_best_f1_score: 0.9353; train_kl_reg_loss: 1649.8971; train_edge_recon_loss: 9063.6290; train_gene_expr_recon_loss: 72872.9286; train_masked_gp_l1_reg_loss: 1277.4863; train_group_lasso_reg_loss: 0.0000; train_global_loss: 84863.9411; train_optim_loss: 84863.9411; val_kl_reg_loss: 1672.9118; val_edge_recon_loss: 8426.4699; val_gene_expr_recon_loss: 72898.3696; val_masked_gp_l1_reg_loss: 1279.8484; val_group_lasso_reg_loss: 0.0000; val_global_loss: 84277.6028; val_optim_loss: 84277.6028
