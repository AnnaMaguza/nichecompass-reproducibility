Run timestamp: 26062023_120614_6.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', '--n_neighbors', '12', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'encoder', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '10', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000.', '--lambda_gene_expr_recon', '300.', '--lambda_cat_covariates_contrastive', '250000.0', '--contrastive_logits_pos_ratio', '0.0625', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--edge_batch_size', '512', '--node_batch_size', 'None', '--timestamp_suffix', '_6']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.05
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['encoder', 'gene_expr_decoder']
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 13, n_layers: 1, n_hidden: 960, n_latent: 1494, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1494, n_cat_covariates_embed_input: 13, n_addon_input: 0, n_output: 1920
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 271450
Number of validation nodes: 30161
Number of training edges: 1835678
Number of validation edges: 203964
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.8846; val_auprc_score: 0.8899; val_best_acc_score: 0.8190; val_best_f1_score: 0.8418; train_kl_reg_loss: 4833.2471; train_edge_recon_loss: 8120.0836; train_cat_covariates_contrastive_loss: 158095.4447; train_gene_expr_recon_loss: 299209.4085; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 470258.1838; train_optim_loss: 470258.1838; val_kl_reg_loss: 4665.6063; val_edge_recon_loss: 7586.3875; val_cat_covariates_contrastive_loss: 157268.3687; val_gene_expr_recon_loss: 271016.0688; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 440536.4315; val_optim_loss: 440536.4315
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.8895; val_auprc_score: 0.8983; val_best_acc_score: 0.8203; val_best_f1_score: 0.8372; train_kl_reg_loss: 4658.4136; train_edge_recon_loss: 7667.9724; train_cat_covariates_contrastive_loss: 158076.6937; train_gene_expr_recon_loss: 266292.1481; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 436695.2277; train_optim_loss: 436695.2277; val_kl_reg_loss: 4604.1150; val_edge_recon_loss: 7797.9166; val_cat_covariates_contrastive_loss: 157593.6717; val_gene_expr_recon_loss: 263829.9308; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 433825.6339; val_optim_loss: 433825.6339
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.8908; val_auprc_score: 0.9016; val_best_acc_score: 0.8205; val_best_f1_score: 0.8350; train_kl_reg_loss: 4764.0075; train_edge_recon_loss: 7493.6488; train_cat_covariates_contrastive_loss: 158032.1399; train_gene_expr_recon_loss: 263320.0823; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 433609.8786; train_optim_loss: 433609.8786; val_kl_reg_loss: 4572.5907; val_edge_recon_loss: 7429.3487; val_cat_covariates_contrastive_loss: 157573.3319; val_gene_expr_recon_loss: 262582.1250; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 432157.3969; val_optim_loss: 432157.3969
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.8901; val_auprc_score: 0.8998; val_best_acc_score: 0.8165; val_best_f1_score: 0.8321; train_kl_reg_loss: 4819.5571; train_edge_recon_loss: 7504.1617; train_cat_covariates_contrastive_loss: 157984.6223; train_gene_expr_recon_loss: 262393.5295; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 432701.8707; train_optim_loss: 432701.8707; val_kl_reg_loss: 4960.5830; val_edge_recon_loss: 7175.1712; val_cat_covariates_contrastive_loss: 157435.9634; val_gene_expr_recon_loss: 261829.3681; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 431401.0851; val_optim_loss: 431401.0851
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.8782; val_auprc_score: 0.8884; val_best_acc_score: 0.8112; val_best_f1_score: 0.8303; train_kl_reg_loss: 4844.7570; train_edge_recon_loss: 7544.6149; train_cat_covariates_contrastive_loss: 157944.3390; train_gene_expr_recon_loss: 261924.0573; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 432257.7684; train_optim_loss: 432257.7684; val_kl_reg_loss: 4924.8231; val_edge_recon_loss: 7308.7148; val_cat_covariates_contrastive_loss: 157349.0601; val_gene_expr_recon_loss: 261635.2541; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 431217.8514; val_optim_loss: 431217.8514
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.8988; val_auprc_score: 0.9087; val_best_acc_score: 0.8274; val_best_f1_score: 0.8395; train_kl_reg_loss: 4877.7438; train_edge_recon_loss: 7493.2682; train_cat_covariates_contrastive_loss: 157914.6808; train_gene_expr_recon_loss: 261638.1360; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 431923.8290; train_optim_loss: 431923.8290; val_kl_reg_loss: 4552.8147; val_edge_recon_loss: 7657.5563; val_cat_covariates_contrastive_loss: 157565.4895; val_gene_expr_recon_loss: 261371.5143; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 431147.3747; val_optim_loss: 431147.3747
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.8922; val_auprc_score: 0.9010; val_best_acc_score: 0.8235; val_best_f1_score: 0.8382; train_kl_reg_loss: 4891.3351; train_edge_recon_loss: 7460.0749; train_cat_covariates_contrastive_loss: 157889.5792; train_gene_expr_recon_loss: 261352.5536; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 431593.5430; train_optim_loss: 431593.5430; val_kl_reg_loss: 4898.3850; val_edge_recon_loss: 7396.0300; val_cat_covariates_contrastive_loss: 157402.6409; val_gene_expr_recon_loss: 261034.8822; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 430731.9377; val_optim_loss: 430731.9377
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.8904; val_auprc_score: 0.9010; val_best_acc_score: 0.8208; val_best_f1_score: 0.8348; train_kl_reg_loss: 4922.2213; train_edge_recon_loss: 7449.7181; train_cat_covariates_contrastive_loss: 157880.5701; train_gene_expr_recon_loss: 261200.1838; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 431452.6933; train_optim_loss: 431452.6933; val_kl_reg_loss: 5301.9371; val_edge_recon_loss: 7309.0824; val_cat_covariates_contrastive_loss: 157344.5645; val_gene_expr_recon_loss: 261055.5315; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 431011.1144; val_optim_loss: 431011.1144
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.8972; val_auprc_score: 0.9061; val_best_acc_score: 0.8271; val_best_f1_score: 0.8415; train_kl_reg_loss: 4952.2274; train_edge_recon_loss: 7486.3439; train_cat_covariates_contrastive_loss: 157867.7778; train_gene_expr_recon_loss: 261017.8004; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 431324.1493; train_optim_loss: 431324.1493; val_kl_reg_loss: 4689.4276; val_edge_recon_loss: 7157.6965; val_cat_covariates_contrastive_loss: 157491.4120; val_gene_expr_recon_loss: 260872.8958; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 430211.4320; val_optim_loss: 430211.4320
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.8943; val_auprc_score: 0.9025; val_best_acc_score: 0.8283; val_best_f1_score: 0.8430; train_kl_reg_loss: 4945.3376; train_edge_recon_loss: 7475.6286; train_cat_covariates_contrastive_loss: 157859.6623; train_gene_expr_recon_loss: 260865.9215; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 431146.5506; train_optim_loss: 431146.5506; val_kl_reg_loss: 5337.0693; val_edge_recon_loss: 7069.2346; val_cat_covariates_contrastive_loss: 157304.0240; val_gene_expr_recon_loss: 261007.2375; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 430717.5657; val_optim_loss: 430717.5657
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9009; val_auprc_score: 0.9094; val_best_acc_score: 0.8329; val_best_f1_score: 0.8457; train_kl_reg_loss: 4950.4728; train_edge_recon_loss: 7421.6739; train_cat_covariates_contrastive_loss: 157844.3905; train_gene_expr_recon_loss: 260809.7771; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 431026.3146; train_optim_loss: 431026.3146; val_kl_reg_loss: 4698.8371; val_edge_recon_loss: 7007.8658; val_cat_covariates_contrastive_loss: 157477.8566; val_gene_expr_recon_loss: 260727.9652; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 429912.5251; val_optim_loss: 429912.5251
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.8899; val_auprc_score: 0.8988; val_best_acc_score: 0.8248; val_best_f1_score: 0.8401; train_kl_reg_loss: 4966.2095; train_edge_recon_loss: 7361.0575; train_cat_covariates_contrastive_loss: 157841.8297; train_gene_expr_recon_loss: 260709.0143; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 430878.1108; train_optim_loss: 430878.1108; val_kl_reg_loss: 5049.0032; val_edge_recon_loss: 7257.1508; val_cat_covariates_contrastive_loss: 157320.4008; val_gene_expr_recon_loss: 261133.0582; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 430759.6133; val_optim_loss: 430759.6133
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.8878; val_auprc_score: 0.8961; val_best_acc_score: 0.8251; val_best_f1_score: 0.8410; train_kl_reg_loss: 4972.5452; train_edge_recon_loss: 7360.7471; train_cat_covariates_contrastive_loss: 157837.4754; train_gene_expr_recon_loss: 260616.7849; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 430787.5527; train_optim_loss: 430787.5527; val_kl_reg_loss: 5140.0397; val_edge_recon_loss: 7239.9036; val_cat_covariates_contrastive_loss: 157291.1429; val_gene_expr_recon_loss: 260601.7921; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 430272.8781; val_optim_loss: 430272.8781
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.8928; val_auprc_score: 0.9018; val_best_acc_score: 0.8276; val_best_f1_score: 0.8422; train_kl_reg_loss: 4980.7885; train_edge_recon_loss: 7420.9960; train_cat_covariates_contrastive_loss: 157826.6480; train_gene_expr_recon_loss: 260566.8056; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 430795.2378; train_optim_loss: 430795.2378; val_kl_reg_loss: 5404.1237; val_edge_recon_loss: 6955.9700; val_cat_covariates_contrastive_loss: 157289.3757; val_gene_expr_recon_loss: 260621.3430; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 430270.8130; val_optim_loss: 430270.8130

Reducing learning rate: metric has not improved more than 0.0 in the last 3 epochs.
New learning rate is 0.0001.

Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.8992; val_auprc_score: 0.9094; val_best_acc_score: 0.8321; val_best_f1_score: 0.8439; train_kl_reg_loss: 4903.5988; train_edge_recon_loss: 7322.7611; train_cat_covariates_contrastive_loss: 157840.1324; train_gene_expr_recon_loss: 259674.6955; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 429741.1879; train_optim_loss: 429741.1879; val_kl_reg_loss: 4867.4155; val_edge_recon_loss: 7193.9208; val_cat_covariates_contrastive_loss: 157455.8640; val_gene_expr_recon_loss: 259918.8180; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 429436.0186; val_optim_loss: 429436.0186
