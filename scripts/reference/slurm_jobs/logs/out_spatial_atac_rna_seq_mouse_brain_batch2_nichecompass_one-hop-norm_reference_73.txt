[True]
Run timestamp: 07082023_194019_73.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'spatial_atac_rna_seq_mouse_brain_batch2', '--reference_batches', 'None', '--n_neighbors', '8', '--filter_genes', '--n_hvg', '4000', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--include_collectri_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--include_atac_modality', '--filter_peaks', '--min_cell_peak_thresh_ratio', '0.01', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '0', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'None', '--cat_covariates_embeds_nums', '0', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '300', '--lambda_chrom_access_recon', '300', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '5', '--lambda_l1_addon', '10.', '--edge_batch_size', '4096', '--node_batch_size', 'None', '--n_sampled_neighbors', '8', '--timestamp_suffix', '_73']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 3396.
Number of gene programs after filtering and combining: 2766.

Filtering genes...
Starting with 22914 genes.
Keeping 22914 genes after filtering genes with expression in 0 cells.
Keeping 5114 highly variable or gene program relevant genes.

Filtering peaks...
Starting with 121068 peaks.
Keeping 112141 peaks after filtering  peaks with counts in less than 92 cells.
Keeping 19267 peaks after filtering peaks with no matching genes in gp mask.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb, include_chrom_access_recon_loss: True, atac_recon_loss: nb 
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.05
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['None']
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 23942, n_cat_covariates_embed_input: 0, n_hidden: 2573, n_latent: 2573, n_addon_latent: 0, n_fc_layers: 1, n_layers: 1, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 2573, n_addon_gp_input: 0, n_cat_covariates_embed_input: 0, n_output: 4675
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 2573, n_addon_gp_input: 0, n_cat_covariates_embed_input: 0, n_output: 4675
MASKED TARGET ATAC DECODER -> n_prior_gp_input: 2573, n_addon_gp_input: 0, n_cat_covariates_embed_input: 0, n_output: 19267
MASKED SOURCE ATAC DECODER -> n_prior_gp_input: 2573, n_addon_gp_input: 0, n_cat_covariates_embed_input: 0, n_output: 19267

--- INITIALIZING TRAINER ---
Number of training nodes: 8293
Number of validation nodes: 922
Number of training edges: 33399
Number of validation edges: 3711
Edge batch size: 4096
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9106; val_auprc_score: 0.9181; val_best_acc_score: 0.5282; val_best_f1_score: 0.6792; train_kl_reg_loss: 5302.4724; train_edge_recon_loss: 348553.8160; train_gene_expr_recon_loss: 631360.2222; train_masked_gp_l1_reg_loss: 4512.5499; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 795811.5417; train_global_loss: 1785540.5833; train_optim_loss: 1785540.5833; val_kl_reg_loss: 7744.8721; val_edge_recon_loss: 406347.6875; val_gene_expr_recon_loss: 598913.7500; val_masked_gp_l1_reg_loss: 3911.5698; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 796519.5625; val_global_loss: 1813437.5000; val_optim_loss: 1813437.5000
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9115; val_auprc_score: 0.9118; val_best_acc_score: 0.5224; val_best_f1_score: 0.6766; train_kl_reg_loss: 12652.3014; train_edge_recon_loss: 355576.3160; train_gene_expr_recon_loss: 566601.9236; train_masked_gp_l1_reg_loss: 3727.2718; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 782725.7083; train_global_loss: 1721283.4861; train_optim_loss: 1721283.4861; val_kl_reg_loss: 17051.0664; val_edge_recon_loss: 406361.7500; val_gene_expr_recon_loss: 538128.0000; val_masked_gp_l1_reg_loss: 3590.8604; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 780990.0625; val_global_loss: 1746121.7500; val_optim_loss: 1746121.7500
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9045; val_auprc_score: 0.9046; val_best_acc_score: 0.5577; val_best_f1_score: 0.6918; train_kl_reg_loss: 17834.1829; train_edge_recon_loss: 359205.0972; train_gene_expr_recon_loss: 517810.3021; train_masked_gp_l1_reg_loss: 3625.6477; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 767016.9792; train_global_loss: 1665492.2361; train_optim_loss: 1665492.2361; val_kl_reg_loss: 20409.3789; val_edge_recon_loss: 406164.5938; val_gene_expr_recon_loss: 506522.5000; val_masked_gp_l1_reg_loss: 3692.6052; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 768419.0000; val_global_loss: 1705208.1250; val_optim_loss: 1705208.1250
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9053; val_auprc_score: 0.9023; val_best_acc_score: 0.6365; val_best_f1_score: 0.7303; train_kl_reg_loss: 21148.0514; train_edge_recon_loss: 360182.1458; train_gene_expr_recon_loss: 495917.8021; train_masked_gp_l1_reg_loss: 3720.1226; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 764059.6458; train_global_loss: 1645027.7500; train_optim_loss: 1645027.7500; val_kl_reg_loss: 19866.2500; val_edge_recon_loss: 405667.3125; val_gene_expr_recon_loss: 486245.0000; val_masked_gp_l1_reg_loss: 3733.2190; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 758874.6250; val_global_loss: 1674386.5000; val_optim_loss: 1674386.5000
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9126; val_auprc_score: 0.9082; val_best_acc_score: 0.7491; val_best_f1_score: 0.7944; train_kl_reg_loss: 22541.1617; train_edge_recon_loss: 360494.6285; train_gene_expr_recon_loss: 474320.9062; train_masked_gp_l1_reg_loss: 3733.8924; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 749312.2708; train_global_loss: 1610402.8611; train_optim_loss: 1610402.8611; val_kl_reg_loss: 21775.4395; val_edge_recon_loss: 404588.1250; val_gene_expr_recon_loss: 472286.8750; val_masked_gp_l1_reg_loss: 3721.9775; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 750794.8750; val_global_loss: 1653167.2500; val_optim_loss: 1653167.2500
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9075; val_auprc_score: 0.8992; val_best_acc_score: 0.8285; val_best_f1_score: 0.8393; train_kl_reg_loss: 23514.5074; train_edge_recon_loss: 360283.8090; train_gene_expr_recon_loss: 460838.1771; train_masked_gp_l1_reg_loss: 3719.4095; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 739890.4931; train_global_loss: 1588246.4167; train_optim_loss: 1588246.4167; val_kl_reg_loss: 23211.6504; val_edge_recon_loss: 401900.5312; val_gene_expr_recon_loss: 461535.1250; val_masked_gp_l1_reg_loss: 3709.3247; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 743876.1250; val_global_loss: 1634232.7500; val_optim_loss: 1634232.7500
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9082; val_auprc_score: 0.8942; val_best_acc_score: 0.8053; val_best_f1_score: 0.8299; train_kl_reg_loss: 24123.7311; train_edge_recon_loss: 358883.4201; train_gene_expr_recon_loss: 453082.9167; train_masked_gp_l1_reg_loss: 3706.9812; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 735573.7708; train_global_loss: 1575370.8056; train_optim_loss: 1575370.8056; val_kl_reg_loss: 22104.1016; val_edge_recon_loss: 390395.7812; val_gene_expr_recon_loss: 456566.0625; val_masked_gp_l1_reg_loss: 3703.5618; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 739157.2500; val_global_loss: 1611926.7500; val_optim_loss: 1611926.7500
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9107; val_auprc_score: 0.8939; val_best_acc_score: 0.8296; val_best_f1_score: 0.8403; train_kl_reg_loss: 23887.4410; train_edge_recon_loss: 351319.5174; train_gene_expr_recon_loss: 447995.0347; train_masked_gp_l1_reg_loss: 3716.6745; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 729675.1389; train_global_loss: 1556593.7639; train_optim_loss: 1556593.7639; val_kl_reg_loss: 24060.1660; val_edge_recon_loss: 357376.3750; val_gene_expr_recon_loss: 452660.5625; val_masked_gp_l1_reg_loss: 3727.0996; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 735779.3125; val_global_loss: 1573603.5000; val_optim_loss: 1573603.5000
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9060; val_auprc_score: 0.8925; val_best_acc_score: 0.8195; val_best_f1_score: 0.8276; train_kl_reg_loss: 29612.9193; train_edge_recon_loss: 329840.5972; train_gene_expr_recon_loss: 446397.6250; train_masked_gp_l1_reg_loss: 3752.5409; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 729433.2153; train_global_loss: 1539036.9306; train_optim_loss: 1539036.9306; val_kl_reg_loss: 32957.8477; val_edge_recon_loss: 318244.9375; val_gene_expr_recon_loss: 453419.3750; val_masked_gp_l1_reg_loss: 3779.9253; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 734939.1875; val_global_loss: 1543341.2500; val_optim_loss: 1543341.2500
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9208; val_auprc_score: 0.9071; val_best_acc_score: 0.8335; val_best_f1_score: 0.8427; train_kl_reg_loss: 34132.2897; train_edge_recon_loss: 314374.2951; train_gene_expr_recon_loss: 445628.8229; train_masked_gp_l1_reg_loss: 3809.4426; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 727071.1667; train_global_loss: 1525016.0417; train_optim_loss: 1525016.0417; val_kl_reg_loss: 31539.6445; val_edge_recon_loss: 316812.4062; val_gene_expr_recon_loss: 447135.0938; val_masked_gp_l1_reg_loss: 3839.6787; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 730548.3125; val_global_loss: 1529875.1250; val_optim_loss: 1529875.1250
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9247; val_auprc_score: 0.9075; val_best_acc_score: 0.8453; val_best_f1_score: 0.8553; train_kl_reg_loss: 32868.4668; train_edge_recon_loss: 312622.2118; train_gene_expr_recon_loss: 439523.6354; train_masked_gp_l1_reg_loss: 3869.2524; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 720861.2708; train_global_loss: 1509744.8194; train_optim_loss: 1509744.8194; val_kl_reg_loss: 33156.1367; val_edge_recon_loss: 307841.8438; val_gene_expr_recon_loss: 443945.5625; val_masked_gp_l1_reg_loss: 3901.3716; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 727744.5625; val_global_loss: 1516589.5000; val_optim_loss: 1516589.5000
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9339; val_auprc_score: 0.9150; val_best_acc_score: 0.8639; val_best_f1_score: 0.8699; train_kl_reg_loss: 33299.3494; train_edge_recon_loss: 308946.1250; train_gene_expr_recon_loss: 438218.7326; train_masked_gp_l1_reg_loss: 3932.1185; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 720200.5347; train_global_loss: 1504596.8611; train_optim_loss: 1504596.8611; val_kl_reg_loss: 32312.9004; val_edge_recon_loss: 306190.2812; val_gene_expr_recon_loss: 440821.0312; val_masked_gp_l1_reg_loss: 3962.9546; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 725217.3125; val_global_loss: 1508504.5000; val_optim_loss: 1508504.5000
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9393; val_auprc_score: 0.9213; val_best_acc_score: 0.8697; val_best_f1_score: 0.8771; train_kl_reg_loss: 33159.7956; train_edge_recon_loss: 306382.4132; train_gene_expr_recon_loss: 432967.8542; train_masked_gp_l1_reg_loss: 3991.0771; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 718825.7708; train_global_loss: 1495326.9306; train_optim_loss: 1495326.9306; val_kl_reg_loss: 31915.8711; val_edge_recon_loss: 304472.2812; val_gene_expr_recon_loss: 439087.7500; val_masked_gp_l1_reg_loss: 4016.8774; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 723193.0000; val_global_loss: 1502685.7500; val_optim_loss: 1502685.7500
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9527; val_auprc_score: 0.9350; val_best_acc_score: 0.8949; val_best_f1_score: 0.8989; train_kl_reg_loss: 33848.8976; train_edge_recon_loss: 302450.6979; train_gene_expr_recon_loss: 435230.4410; train_masked_gp_l1_reg_loss: 4041.2339; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 718633.5000; train_global_loss: 1494204.7500; train_optim_loss: 1494204.7500; val_kl_reg_loss: 32290.6465; val_edge_recon_loss: 302154.1250; val_gene_expr_recon_loss: 435596.2500; val_masked_gp_l1_reg_loss: 4064.9170; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 720397.0000; val_global_loss: 1494503.0000; val_optim_loss: 1494503.0000
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9602; val_auprc_score: 0.9469; val_best_acc_score: 0.9043; val_best_f1_score: 0.9091; train_kl_reg_loss: 33414.0022; train_edge_recon_loss: 301350.8646; train_gene_expr_recon_loss: 428193.6701; train_masked_gp_l1_reg_loss: 4089.1212; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 712062.2639; train_global_loss: 1479109.9167; train_optim_loss: 1479109.9167; val_kl_reg_loss: 33508.8086; val_edge_recon_loss: 299549.7500; val_gene_expr_recon_loss: 434038.0938; val_masked_gp_l1_reg_loss: 4111.1133; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 717934.0000; val_global_loss: 1489141.7500; val_optim_loss: 1489141.7500
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9679; val_auprc_score: 0.9587; val_best_acc_score: 0.9139; val_best_f1_score: 0.9173; train_kl_reg_loss: 33604.9648; train_edge_recon_loss: 299247.4410; train_gene_expr_recon_loss: 426975.7535; train_masked_gp_l1_reg_loss: 4131.4155; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 711512.7708; train_global_loss: 1475472.3333; train_optim_loss: 1475472.3333; val_kl_reg_loss: 31830.1777; val_edge_recon_loss: 297104.3438; val_gene_expr_recon_loss: 433634.3750; val_masked_gp_l1_reg_loss: 4151.9561; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 716902.0625; val_global_loss: 1483622.8750; val_optim_loss: 1483622.8750
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9654; val_auprc_score: 0.9557; val_best_acc_score: 0.9140; val_best_f1_score: 0.9173; train_kl_reg_loss: 33568.6222; train_edge_recon_loss: 297622.6562; train_gene_expr_recon_loss: 426634.0069; train_masked_gp_l1_reg_loss: 4174.6057; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 707924.3681; train_global_loss: 1469924.2500; train_optim_loss: 1469924.2500; val_kl_reg_loss: 33624.6797; val_edge_recon_loss: 298969.6250; val_gene_expr_recon_loss: 429519.5312; val_masked_gp_l1_reg_loss: 4192.5967; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 713941.3750; val_global_loss: 1480247.8750; val_optim_loss: 1480247.8750
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9710; val_auprc_score: 0.9613; val_best_acc_score: 0.9239; val_best_f1_score: 0.9263; train_kl_reg_loss: 33268.7400; train_edge_recon_loss: 296837.7812; train_gene_expr_recon_loss: 425426.0486; train_masked_gp_l1_reg_loss: 4214.5284; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 708080.2569; train_global_loss: 1467827.3750; train_optim_loss: 1467827.3750; val_kl_reg_loss: 32928.2812; val_edge_recon_loss: 293805.4375; val_gene_expr_recon_loss: 430696.7500; val_masked_gp_l1_reg_loss: 4234.4321; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 713085.0625; val_global_loss: 1474750.0000; val_optim_loss: 1474750.0000
