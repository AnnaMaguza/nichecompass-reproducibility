Run timestamp: 20062023_154812_2.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'xenium_human_breast_cancer', '--reference_batches', 'batch1', 'batch2', '--n_neighbors', '8', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.05', '--gene_expr_recon_dist', 'nb', '--cond_embed_injection', 'encoder', 'gene_expr_decoder', '--n_cond_embed', '2', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gcnconv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cond_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000.', '--lambda_gene_expr_recon', '300.', '--lambda_cond_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '5.0', '--edge_batch_size', '4096', '--node_batch_size', 'None', '--timestamp_suffix', '_2']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.05
LOG VARIATIONAL -> True
CONDITIONAL EMBEDDING INJECTION -> ['encoder', 'gene_expr_decoder']
ENCODER -> n_input: 313, n_cond_embed_input: 2, n_layers: 1, n_hidden: 313, n_latent: 1302, n_addon_latent: 0, conv_layer: gcnconv, n_attention_heads: 0, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> n_cond_embed_input: 0, n_cond_embed_output: 1302, dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1302, n_cond_embed_input: 2, n_addon_input: 0, n_output: 626
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 254127
Number of validation nodes: 28236
Number of training edges: 1155480
Number of validation edges: 128386
Edge batch size: 4096
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9562; val_auprc_score: 0.9701; val_best_acc_score: 0.9176; val_best_f1_score: 0.9398; train_kl_reg_loss: 5927.7250; train_edge_recon_loss: 189799.4507; train_gene_expr_recon_loss: 89250.2864; train_masked_gp_l1_reg_loss: 1245.0837; train_group_lasso_reg_loss: 0.0000; train_global_loss: 286222.5467; train_optim_loss: 286222.5467; val_kl_reg_loss: 6108.8447; val_edge_recon_loss: 182297.9180; val_gene_expr_recon_loss: 78358.3589; val_masked_gp_l1_reg_loss: 1207.4263; val_group_lasso_reg_loss: 0.0000; val_global_loss: 267972.5586; val_optim_loss: 267972.5586
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9714; val_auprc_score: 0.9813; val_best_acc_score: 0.9347; val_best_f1_score: 0.9519; train_kl_reg_loss: 5684.6528; train_edge_recon_loss: 180970.2448; train_gene_expr_recon_loss: 75490.4593; train_masked_gp_l1_reg_loss: 1238.5623; train_group_lasso_reg_loss: 0.0000; train_global_loss: 263383.9194; train_optim_loss: 263383.9194; val_kl_reg_loss: 5237.6263; val_edge_recon_loss: 179633.3623; val_gene_expr_recon_loss: 73181.2344; val_masked_gp_l1_reg_loss: 1245.9353; val_group_lasso_reg_loss: 0.0000; val_global_loss: 259298.1597; val_optim_loss: 259298.1597
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9778; val_auprc_score: 0.9858; val_best_acc_score: 0.9435; val_best_f1_score: 0.9581; train_kl_reg_loss: 5146.8265; train_edge_recon_loss: 179181.7205; train_gene_expr_recon_loss: 71610.2136; train_masked_gp_l1_reg_loss: 1208.4076; train_group_lasso_reg_loss: 0.0000; train_global_loss: 257147.1675; train_optim_loss: 257147.1675; val_kl_reg_loss: 4929.5403; val_edge_recon_loss: 178918.8799; val_gene_expr_recon_loss: 70352.6631; val_masked_gp_l1_reg_loss: 1160.7498; val_group_lasso_reg_loss: 0.0000; val_global_loss: 255361.8320; val_optim_loss: 255361.8320
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9810; val_auprc_score: 0.9878; val_best_acc_score: 0.9485; val_best_f1_score: 0.9618; train_kl_reg_loss: 4948.5858; train_edge_recon_loss: 178212.6823; train_gene_expr_recon_loss: 69478.4581; train_masked_gp_l1_reg_loss: 1108.9572; train_group_lasso_reg_loss: 0.0000; train_global_loss: 253748.6831; train_optim_loss: 253748.6831; val_kl_reg_loss: 4904.8865; val_edge_recon_loss: 179155.0337; val_gene_expr_recon_loss: 68778.0671; val_masked_gp_l1_reg_loss: 1057.4270; val_group_lasso_reg_loss: 0.0000; val_global_loss: 253895.4092; val_optim_loss: 253895.4092
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9833; val_auprc_score: 0.9896; val_best_acc_score: 0.9503; val_best_f1_score: 0.9631; train_kl_reg_loss: 4879.0952; train_edge_recon_loss: 177927.8271; train_gene_expr_recon_loss: 68189.7893; train_masked_gp_l1_reg_loss: 1007.5659; train_group_lasso_reg_loss: 0.0000; train_global_loss: 252004.2776; train_optim_loss: 252004.2776; val_kl_reg_loss: 4749.8629; val_edge_recon_loss: 178174.0356; val_gene_expr_recon_loss: 67806.7217; val_masked_gp_l1_reg_loss: 959.3310; val_group_lasso_reg_loss: 0.0000; val_global_loss: 251689.9492; val_optim_loss: 251689.9492
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9844; val_auprc_score: 0.9904; val_best_acc_score: 0.9530; val_best_f1_score: 0.9651; train_kl_reg_loss: 4847.8513; train_edge_recon_loss: 177488.9134; train_gene_expr_recon_loss: 67349.5902; train_masked_gp_l1_reg_loss: 924.4252; train_group_lasso_reg_loss: 0.0000; train_global_loss: 250610.7807; train_optim_loss: 250610.7807; val_kl_reg_loss: 4744.6116; val_edge_recon_loss: 178211.0825; val_gene_expr_recon_loss: 67118.3569; val_masked_gp_l1_reg_loss: 893.8018; val_group_lasso_reg_loss: 0.0000; val_global_loss: 250967.8501; val_optim_loss: 250967.8501
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9851; val_auprc_score: 0.9906; val_best_acc_score: 0.9549; val_best_f1_score: 0.9664; train_kl_reg_loss: 4844.5849; train_edge_recon_loss: 177310.0049; train_gene_expr_recon_loss: 66741.3311; train_masked_gp_l1_reg_loss: 862.1100; train_group_lasso_reg_loss: 0.0000; train_global_loss: 249758.0308; train_optim_loss: 249758.0308; val_kl_reg_loss: 4738.2026; val_edge_recon_loss: 178053.6855; val_gene_expr_recon_loss: 66582.3557; val_masked_gp_l1_reg_loss: 834.8896; val_group_lasso_reg_loss: 0.0000; val_global_loss: 250209.1323; val_optim_loss: 250209.1323
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9859; val_auprc_score: 0.9911; val_best_acc_score: 0.9561; val_best_f1_score: 0.9673; train_kl_reg_loss: 4842.3356; train_edge_recon_loss: 177429.9163; train_gene_expr_recon_loss: 66232.1091; train_masked_gp_l1_reg_loss: 811.2708; train_group_lasso_reg_loss: 0.0000; train_global_loss: 249315.6316; train_optim_loss: 249315.6316; val_kl_reg_loss: 4833.2315; val_edge_recon_loss: 177863.7954; val_gene_expr_recon_loss: 66074.3396; val_masked_gp_l1_reg_loss: 792.0916; val_group_lasso_reg_loss: 0.0000; val_global_loss: 249563.4604; val_optim_loss: 249563.4604
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9869; val_auprc_score: 0.9918; val_best_acc_score: 0.9580; val_best_f1_score: 0.9686; train_kl_reg_loss: 4841.9655; train_edge_recon_loss: 177293.8525; train_gene_expr_recon_loss: 65844.4044; train_masked_gp_l1_reg_loss: 774.9946; train_group_lasso_reg_loss: 0.0000; train_global_loss: 248755.2174; train_optim_loss: 248755.2174; val_kl_reg_loss: 4762.9073; val_edge_recon_loss: 177815.9653; val_gene_expr_recon_loss: 65714.0021; val_masked_gp_l1_reg_loss: 760.6015; val_group_lasso_reg_loss: 0.0000; val_global_loss: 249053.4668; val_optim_loss: 249053.4668
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9874; val_auprc_score: 0.9922; val_best_acc_score: 0.9592; val_best_f1_score: 0.9696; train_kl_reg_loss: 4848.3458; train_edge_recon_loss: 177239.4366; train_gene_expr_recon_loss: 65492.7604; train_masked_gp_l1_reg_loss: 749.6298; train_group_lasso_reg_loss: 0.0000; train_global_loss: 248330.1730; train_optim_loss: 248330.1730; val_kl_reg_loss: 4792.9193; val_edge_recon_loss: 178041.7505; val_gene_expr_recon_loss: 65407.4180; val_masked_gp_l1_reg_loss: 739.9659; val_group_lasso_reg_loss: 0.0000; val_global_loss: 248982.0532; val_optim_loss: 248982.0532
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9885; val_auprc_score: 0.9927; val_best_acc_score: 0.9605; val_best_f1_score: 0.9705; train_kl_reg_loss: 4851.9113; train_edge_recon_loss: 176888.6060; train_gene_expr_recon_loss: 65222.0579; train_masked_gp_l1_reg_loss: 731.9661; train_group_lasso_reg_loss: 0.0000; train_global_loss: 247694.5405; train_optim_loss: 247694.5405; val_kl_reg_loss: 4725.7029; val_edge_recon_loss: 177801.0249; val_gene_expr_recon_loss: 65159.4414; val_masked_gp_l1_reg_loss: 722.9529; val_group_lasso_reg_loss: 0.0000; val_global_loss: 248409.1211; val_optim_loss: 248409.1211
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9888; val_auprc_score: 0.9930; val_best_acc_score: 0.9610; val_best_f1_score: 0.9708; train_kl_reg_loss: 4855.7832; train_edge_recon_loss: 177019.8417; train_gene_expr_recon_loss: 64970.4862; train_masked_gp_l1_reg_loss: 715.6594; train_group_lasso_reg_loss: 0.0000; train_global_loss: 247561.7702; train_optim_loss: 247561.7702; val_kl_reg_loss: 4755.9236; val_edge_recon_loss: 177161.9458; val_gene_expr_recon_loss: 64905.2854; val_masked_gp_l1_reg_loss: 707.7821; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247530.9336; val_optim_loss: 247530.9336
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9896; val_auprc_score: 0.9936; val_best_acc_score: 0.9628; val_best_f1_score: 0.9722; train_kl_reg_loss: 4862.6375; train_edge_recon_loss: 177238.7873; train_gene_expr_recon_loss: 64748.2154; train_masked_gp_l1_reg_loss: 702.9132; train_group_lasso_reg_loss: 0.0000; train_global_loss: 247552.5534; train_optim_loss: 247552.5534; val_kl_reg_loss: 4814.5050; val_edge_recon_loss: 177494.0112; val_gene_expr_recon_loss: 64655.5143; val_masked_gp_l1_reg_loss: 696.6772; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247660.7021; val_optim_loss: 247660.7021
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9893; val_auprc_score: 0.9934; val_best_acc_score: 0.9628; val_best_f1_score: 0.9721; train_kl_reg_loss: 4867.8783; train_edge_recon_loss: 176708.0517; train_gene_expr_recon_loss: 64602.5741; train_masked_gp_l1_reg_loss: 691.9359; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246870.4390; train_optim_loss: 246870.4390; val_kl_reg_loss: 4788.8780; val_edge_recon_loss: 177917.4819; val_gene_expr_recon_loss: 64572.2142; val_masked_gp_l1_reg_loss: 686.1069; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247964.6826; val_optim_loss: 247964.6826
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9896; val_auprc_score: 0.9936; val_best_acc_score: 0.9629; val_best_f1_score: 0.9723; train_kl_reg_loss: 4873.1259; train_edge_recon_loss: 176811.0348; train_gene_expr_recon_loss: 64433.1447; train_masked_gp_l1_reg_loss: 682.5974; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246799.9034; train_optim_loss: 246799.9034; val_kl_reg_loss: 4772.0077; val_edge_recon_loss: 177731.3882; val_gene_expr_recon_loss: 64463.4340; val_masked_gp_l1_reg_loss: 677.2777; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247644.1118; val_optim_loss: 247644.1118

Reducing learning rate: metric has not improved more than 0.0 in the last 3 epochs.
New learning rate is 0.0001.

Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9896; val_auprc_score: 0.9936; val_best_acc_score: 0.9632; val_best_f1_score: 0.9725; train_kl_reg_loss: 4861.6204; train_edge_recon_loss: 176862.4396; train_gene_expr_recon_loss: 64306.3378; train_masked_gp_l1_reg_loss: 642.8024; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246673.2004; train_optim_loss: 246673.2004; val_kl_reg_loss: 4779.2909; val_edge_recon_loss: 177798.1948; val_gene_expr_recon_loss: 64410.1260; val_masked_gp_l1_reg_loss: 640.8276; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247628.4380; val_optim_loss: 247628.4380
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9901; val_auprc_score: 0.9939; val_best_acc_score: 0.9641; val_best_f1_score: 0.9732; train_kl_reg_loss: 4862.6596; train_edge_recon_loss: 176802.8582; train_gene_expr_recon_loss: 64262.9461; train_masked_gp_l1_reg_loss: 640.5321; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246568.9955; train_optim_loss: 246568.9955; val_kl_reg_loss: 4800.4694; val_edge_recon_loss: 177167.8599; val_gene_expr_recon_loss: 64373.9030; val_masked_gp_l1_reg_loss: 640.4263; val_group_lasso_reg_loss: 0.0000; val_global_loss: 246982.6523; val_optim_loss: 246982.6523
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9901; val_auprc_score: 0.9939; val_best_acc_score: 0.9638; val_best_f1_score: 0.9730; train_kl_reg_loss: 4863.1507; train_edge_recon_loss: 176972.2995; train_gene_expr_recon_loss: 64262.5985; train_masked_gp_l1_reg_loss: 639.8099; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246737.8584; train_optim_loss: 246737.8584; val_kl_reg_loss: 4789.5321; val_edge_recon_loss: 177265.2471; val_gene_expr_recon_loss: 64380.1998; val_masked_gp_l1_reg_loss: 639.7435; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247074.7295; val_optim_loss: 247074.7295
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9899; val_auprc_score: 0.9937; val_best_acc_score: 0.9639; val_best_f1_score: 0.9731; train_kl_reg_loss: 4865.9266; train_edge_recon_loss: 176772.7831; train_gene_expr_recon_loss: 64244.4458; train_masked_gp_l1_reg_loss: 639.0665; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246522.2215; train_optim_loss: 246522.2215; val_kl_reg_loss: 4798.1457; val_edge_recon_loss: 177146.9043; val_gene_expr_recon_loss: 64379.7421; val_masked_gp_l1_reg_loss: 638.6756; val_group_lasso_reg_loss: 0.0000; val_global_loss: 246963.4619; val_optim_loss: 246963.4619
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9902; val_auprc_score: 0.9940; val_best_acc_score: 0.9643; val_best_f1_score: 0.9733; train_kl_reg_loss: 4867.9640; train_edge_recon_loss: 176745.0156; train_gene_expr_recon_loss: 64230.8457; train_masked_gp_l1_reg_loss: 638.3983; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246482.2241; train_optim_loss: 246482.2241; val_kl_reg_loss: 4800.5368; val_edge_recon_loss: 177366.1875; val_gene_expr_recon_loss: 64230.6796; val_masked_gp_l1_reg_loss: 638.0297; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247035.4365; val_optim_loss: 247035.4365
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9900; val_auprc_score: 0.9938; val_best_acc_score: 0.9645; val_best_f1_score: 0.9734; train_kl_reg_loss: 4861.5332; train_edge_recon_loss: 176763.8546; train_gene_expr_recon_loss: 64215.4645; train_masked_gp_l1_reg_loss: 638.2031; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246479.0556; train_optim_loss: 246479.0556; val_kl_reg_loss: 4760.2441; val_edge_recon_loss: 177546.6968; val_gene_expr_recon_loss: 64280.3020; val_masked_gp_l1_reg_loss: 638.4496; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247225.6958; val_optim_loss: 247225.6958
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9901; val_auprc_score: 0.9937; val_best_acc_score: 0.9641; val_best_f1_score: 0.9731; train_kl_reg_loss: 4868.4237; train_edge_recon_loss: 176718.0727; train_gene_expr_recon_loss: 64169.2856; train_masked_gp_l1_reg_loss: 637.9704; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246393.7524; train_optim_loss: 246393.7524; val_kl_reg_loss: 4801.0992; val_edge_recon_loss: 177746.7739; val_gene_expr_recon_loss: 64311.4089; val_masked_gp_l1_reg_loss: 637.4210; val_group_lasso_reg_loss: 0.0000; val_global_loss: 247496.7036; val_optim_loss: 247496.7036

Reducing learning rate: metric has not improved more than 0.0 in the last 3 epochs.
New learning rate is 1e-05.

Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.9906; val_auprc_score: 0.9942; val_best_acc_score: 0.9652; val_best_f1_score: 0.9740; train_kl_reg_loss: 4871.6512; train_edge_recon_loss: 176711.8998; train_gene_expr_recon_loss: 64158.7856; train_masked_gp_l1_reg_loss: 632.3105; train_group_lasso_reg_loss: 0.0000; train_global_loss: 246374.6473; train_optim_loss: 246374.6473; val_kl_reg_loss: 4800.4071; val_edge_recon_loss: 177026.1421; val_gene_expr_recon_loss: 64225.9318; val_masked_gp_l1_reg_loss: 631.8121; val_group_lasso_reg_loss: 0.0000; val_global_loss: 246684.2935; val_optim_loss: 246684.2935
