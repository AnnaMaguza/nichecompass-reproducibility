[True]
Run timestamp: 10082023_145555_2.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'spatial_atac_rna_seq_mouse_brain_batch2', '--reference_batches', 'None', '--n_neighbors', '8', '--filter_genes', '--n_hvg', '0', '--n_svg', '3000', '--n_svp', '0', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--include_collectri_gps', '--include_brain_marker_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--include_atac_modality', '--filter_peaks', '--min_cell_peak_thresh_ratio', '0.01', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '20', '--active_gp_thresh_ratio', '0.03', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'None', '--cat_covariates_embeds_nums', '0', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000', '--lambda_gene_expr_recon', '3000', '--lambda_chrom_access_recon', '1000', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '50', '--lambda_l1_addon', '50.', '--edge_batch_size', '256', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_2']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 3404.
Number of gene programs after filtering and combining: 2774.

Filtering genes...
Starting with 22914 genes.
Keeping 22914 genes after filtering genes with expression in 0 cells.
Keeping 4429 spatially variable, highly variable or gene program relevant genes.

Filtering peaks...
Starting with 121068 peaks.
Keeping 112141 peaks after filtering  peaks with counts in less than 92 cells.
Keeping 23741 peaks after filtering peaks with no matching genes in gp mask.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb, include_chrom_access_recon_loss: True, atac_recon_loss: nb 
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['None']
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 27892, n_cat_covariates_embed_input: 0, n_hidden: 2622, n_latent: 2602, n_addon_latent: 20, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 2602, n_addon_gp_input: 20, n_cat_covariates_embed_input: 0, n_output: 4151
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 2602, n_addon_gp_input: 20, n_cat_covariates_embed_input: 0, n_output: 4151
MASKED TARGET ATAC DECODER -> n_prior_gp_input: 2602, n_addon_gp_input: 20, n_cat_covariates_embed_input: 0, n_output: 23741
MASKED SOURCE ATAC DECODER -> n_prior_gp_input: 2602, n_addon_gp_input: 20, n_cat_covariates_embed_input: 0, n_output: 23741

--- INITIALIZING TRAINER ---
Number of training nodes: 8293
Number of validation nodes: 922
Number of training edges: 33399
Number of validation edges: 3711
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.7920; val_auprc_score: 0.8040; val_best_acc_score: 0.5757; val_best_f1_score: 0.6987; train_kl_reg_loss: 81047.6074; train_edge_recon_loss: 3582070.0038; train_gene_expr_recon_loss: 15095271.0840; train_masked_gp_l1_reg_loss: 80508.9653; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 239971.4515; train_chrom_access_recon_loss: 11127080.8321; train_global_loss: 30205949.9237; train_optim_loss: 30205949.9237; val_kl_reg_loss: 139369.4516; val_edge_recon_loss: 4061329.4167; val_gene_expr_recon_loss: 12971490.3333; val_masked_gp_l1_reg_loss: 77725.1797; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 227495.4531; val_chrom_access_recon_loss: 10284694.4667; val_global_loss: 27762105.8667; val_optim_loss: 27762105.8667
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.8192; val_auprc_score: 0.8211; val_best_acc_score: 0.7249; val_best_f1_score: 0.7591; train_kl_reg_loss: 122683.9983; train_edge_recon_loss: 3533818.1069; train_gene_expr_recon_loss: 12668806.5878; train_masked_gp_l1_reg_loss: 72999.5587; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 212149.2733; train_chrom_access_recon_loss: 10340526.2595; train_global_loss: 26950983.7710; train_optim_loss: 26950983.7710; val_kl_reg_loss: 110989.4703; val_edge_recon_loss: 3842885.1500; val_gene_expr_recon_loss: 12534938.8000; val_masked_gp_l1_reg_loss: 71843.2422; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 196388.9844; val_chrom_access_recon_loss: 10116312.0667; val_global_loss: 26873357.6000; val_optim_loss: 26873357.6000
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.8471; val_auprc_score: 0.8343; val_best_acc_score: 0.7475; val_best_f1_score: 0.7855; train_kl_reg_loss: 132292.3015; train_edge_recon_loss: 3141722.0840; train_gene_expr_recon_loss: 12459494.6947; train_masked_gp_l1_reg_loss: 74775.1849; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 181437.5687; train_chrom_access_recon_loss: 10230132.1145; train_global_loss: 26219853.8168; train_optim_loss: 26219853.8168; val_kl_reg_loss: 141592.9510; val_edge_recon_loss: 3029984.3833; val_gene_expr_recon_loss: 12351047.6000; val_masked_gp_l1_reg_loss: 76313.1875; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 166764.9219; val_chrom_access_recon_loss: 10002708.0667; val_global_loss: 25768410.6667; val_optim_loss: 25768410.6667
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.8651; val_auprc_score: 0.8514; val_best_acc_score: 0.7643; val_best_f1_score: 0.7957; train_kl_reg_loss: 139933.2223; train_edge_recon_loss: 2979796.2767; train_gene_expr_recon_loss: 12287017.9924; train_masked_gp_l1_reg_loss: 77781.2674; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 153500.7786; train_chrom_access_recon_loss: 10132332.2672; train_global_loss: 25770361.7252; train_optim_loss: 25770361.7252; val_kl_reg_loss: 126820.9880; val_edge_recon_loss: 2963314.9667; val_gene_expr_recon_loss: 12310404.6000; val_masked_gp_l1_reg_loss: 79443.9531; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 140772.5312; val_chrom_access_recon_loss: 9956382.1333; val_global_loss: 25577139.7333; val_optim_loss: 25577139.7333
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.8850; val_auprc_score: 0.8706; val_best_acc_score: 0.7953; val_best_f1_score: 0.8110; train_kl_reg_loss: 127570.2307; train_edge_recon_loss: 2946497.3855; train_gene_expr_recon_loss: 12153322.7481; train_masked_gp_l1_reg_loss: 81444.0106; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 129744.8130; train_chrom_access_recon_loss: 10043225.9924; train_global_loss: 25481805.0992; train_optim_loss: 25481805.0992; val_kl_reg_loss: 124648.8682; val_edge_recon_loss: 2916300.0167; val_gene_expr_recon_loss: 12143987.9333; val_masked_gp_l1_reg_loss: 83344.9219; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 119338.7422; val_chrom_access_recon_loss: 9897006.7333; val_global_loss: 25284627.7333; val_optim_loss: 25284627.7333
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9089; val_auprc_score: 0.8898; val_best_acc_score: 0.8402; val_best_f1_score: 0.8536; train_kl_reg_loss: 121448.6951; train_edge_recon_loss: 2889140.9962; train_gene_expr_recon_loss: 12034979.1145; train_masked_gp_l1_reg_loss: 84899.3684; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 110681.6533; train_chrom_access_recon_loss: 9963548.7557; train_global_loss: 25204698.6412; train_optim_loss: 25204698.6412; val_kl_reg_loss: 119657.0682; val_edge_recon_loss: 2876314.5833; val_gene_expr_recon_loss: 12014063.3333; val_masked_gp_l1_reg_loss: 86809.1484; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 102758.2422; val_chrom_access_recon_loss: 9772369.9333; val_global_loss: 24971972.2667; val_optim_loss: 24971972.2667
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9326; val_auprc_score: 0.9179; val_best_acc_score: 0.8659; val_best_f1_score: 0.8753; train_kl_reg_loss: 120309.7746; train_edge_recon_loss: 2835537.0935; train_gene_expr_recon_loss: 11944652.9618; train_masked_gp_l1_reg_loss: 87954.4241; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 96273.7629; train_chrom_access_recon_loss: 9892971.3053; train_global_loss: 24977699.3740; train_optim_loss: 24977699.3740; val_kl_reg_loss: 119589.1516; val_edge_recon_loss: 2844267.7667; val_gene_expr_recon_loss: 11896693.4000; val_masked_gp_l1_reg_loss: 88863.1562; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 90306.9375; val_chrom_access_recon_loss: 9682330.0667; val_global_loss: 24722050.5333; val_optim_loss: 24722050.5333
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9413; val_auprc_score: 0.9213; val_best_acc_score: 0.8828; val_best_f1_score: 0.8892; train_kl_reg_loss: 120534.8232; train_edge_recon_loss: 2795063.9046; train_gene_expr_recon_loss: 11847963.2443; train_masked_gp_l1_reg_loss: 89917.0714; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 85333.9203; train_chrom_access_recon_loss: 9819441.9924; train_global_loss: 24758254.8550; train_optim_loss: 24758254.8550; val_kl_reg_loss: 114819.9104; val_edge_recon_loss: 2809307.5333; val_gene_expr_recon_loss: 11859796.2000; val_masked_gp_l1_reg_loss: 90936.1562; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 80523.8594; val_chrom_access_recon_loss: 9701512.3333; val_global_loss: 24656896.0000; val_optim_loss: 24656896.0000
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9469; val_auprc_score: 0.9351; val_best_acc_score: 0.8875; val_best_f1_score: 0.8943; train_kl_reg_loss: 118120.3858; train_edge_recon_loss: 2777390.9065; train_gene_expr_recon_loss: 11761849.2519; train_masked_gp_l1_reg_loss: 91949.7969; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 76380.5089; train_chrom_access_recon_loss: 9756458.4198; train_global_loss: 24582149.3282; train_optim_loss: 24582149.3282; val_kl_reg_loss: 119050.8422; val_edge_recon_loss: 2789936.8000; val_gene_expr_recon_loss: 11739415.2667; val_masked_gp_l1_reg_loss: 93084.6172; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 72505.5312; val_chrom_access_recon_loss: 9563341.3667; val_global_loss: 24377335.4667; val_optim_loss: 24377335.4667
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9485; val_auprc_score: 0.9328; val_best_acc_score: 0.8922; val_best_f1_score: 0.8997; train_kl_reg_loss: 116282.2569; train_edge_recon_loss: 2759107.4447; train_gene_expr_recon_loss: 11691607.6641; train_masked_gp_l1_reg_loss: 94026.0519; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 69066.4848; train_chrom_access_recon_loss: 9700176.4275; train_global_loss: 24430266.2137; train_optim_loss: 24430266.2137; val_kl_reg_loss: 112794.0807; val_edge_recon_loss: 2777096.1333; val_gene_expr_recon_loss: 11694322.8000; val_masked_gp_l1_reg_loss: 94881.4062; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 65755.4453; val_chrom_access_recon_loss: 9537366.6667; val_global_loss: 24282215.6000; val_optim_loss: 24282215.6000
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9521; val_auprc_score: 0.9395; val_best_acc_score: 0.8878; val_best_f1_score: 0.8953; train_kl_reg_loss: 112832.7191; train_edge_recon_loss: 2751353.4962; train_gene_expr_recon_loss: 11619633.3130; train_masked_gp_l1_reg_loss: 95958.5686; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 62971.6791; train_chrom_access_recon_loss: 9637809.0802; train_global_loss: 24280558.7939; train_optim_loss: 24280558.7939; val_kl_reg_loss: 113128.4844; val_edge_recon_loss: 2792192.0167; val_gene_expr_recon_loss: 11659304.2667; val_masked_gp_l1_reg_loss: 96849.8438; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 60304.2773; val_chrom_access_recon_loss: 9497716.2000; val_global_loss: 24219494.9333; val_optim_loss: 24219494.9333
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9563; val_auprc_score: 0.9448; val_best_acc_score: 0.8988; val_best_f1_score: 0.9036; train_kl_reg_loss: 110754.1438; train_edge_recon_loss: 2746988.7500; train_gene_expr_recon_loss: 11559825.0840; train_masked_gp_l1_reg_loss: 97687.2737; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 57983.8889; train_chrom_access_recon_loss: 9584621.3206; train_global_loss: 24157860.5496; train_optim_loss: 24157860.5496; val_kl_reg_loss: 112958.4339; val_edge_recon_loss: 2733000.4667; val_gene_expr_recon_loss: 11586650.2000; val_masked_gp_l1_reg_loss: 98507.0312; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 55789.4102; val_chrom_access_recon_loss: 9495073.9333; val_global_loss: 24081979.4667; val_optim_loss: 24081979.4667
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9586; val_auprc_score: 0.9464; val_best_acc_score: 0.9046; val_best_f1_score: 0.9089; train_kl_reg_loss: 108544.4812; train_edge_recon_loss: 2740983.2481; train_gene_expr_recon_loss: 11518374.8244; train_masked_gp_l1_reg_loss: 99456.1261; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 53862.5277; train_chrom_access_recon_loss: 9550016.0153; train_global_loss: 24071237.1298; train_optim_loss: 24071237.1298; val_kl_reg_loss: 107772.6307; val_edge_recon_loss: 2739011.2500; val_gene_expr_recon_loss: 11559422.9333; val_masked_gp_l1_reg_loss: 100375.6484; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 52121.4727; val_chrom_access_recon_loss: 9448697.2667; val_global_loss: 24007401.4667; val_optim_loss: 24007401.4667
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9593; val_auprc_score: 0.9457; val_best_acc_score: 0.9077; val_best_f1_score: 0.9130; train_kl_reg_loss: 106734.7172; train_edge_recon_loss: 2733725.2214; train_gene_expr_recon_loss: 11470904.7252; train_masked_gp_l1_reg_loss: 101074.6011; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 50460.8929; train_chrom_access_recon_loss: 9506731.4046; train_global_loss: 23969631.4656; train_optim_loss: 23969631.4656; val_kl_reg_loss: 104640.6187; val_edge_recon_loss: 2752565.3500; val_gene_expr_recon_loss: 11494728.3333; val_masked_gp_l1_reg_loss: 102003.3906; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 48832.5859; val_chrom_access_recon_loss: 9413602.4667; val_global_loss: 23916372.9333; val_optim_loss: 23916372.9333
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9647; val_auprc_score: 0.9568; val_best_acc_score: 0.9091; val_best_f1_score: 0.9134; train_kl_reg_loss: 104832.3186; train_edge_recon_loss: 2726880.9905; train_gene_expr_recon_loss: 11429719.3435; train_masked_gp_l1_reg_loss: 102676.5852; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 47344.7990; train_chrom_access_recon_loss: 9468266.9466; train_global_loss: 23879720.9313; train_optim_loss: 23879720.9313; val_kl_reg_loss: 102694.7630; val_edge_recon_loss: 2734451.2167; val_gene_expr_recon_loss: 11467621.0000; val_masked_gp_l1_reg_loss: 103466.5781; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 45894.2266; val_chrom_access_recon_loss: 9336724.6000; val_global_loss: 23790852.5333; val_optim_loss: 23790852.5333
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9657; val_auprc_score: 0.9551; val_best_acc_score: 0.9128; val_best_f1_score: 0.9159; train_kl_reg_loss: 102497.8064; train_edge_recon_loss: 2727230.2042; train_gene_expr_recon_loss: 11384520.3740; train_masked_gp_l1_reg_loss: 104143.0784; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 44579.6135; train_chrom_access_recon_loss: 9424103.4733; train_global_loss: 23787074.6107; train_optim_loss: 23787074.6107; val_kl_reg_loss: 103423.6469; val_edge_recon_loss: 2719189.7500; val_gene_expr_recon_loss: 11418647.0667; val_masked_gp_l1_reg_loss: 104885.9141; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 43257.3438; val_chrom_access_recon_loss: 9308310.2000; val_global_loss: 23697713.7333; val_optim_loss: 23697713.7333
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9683; val_auprc_score: 0.9579; val_best_acc_score: 0.9167; val_best_f1_score: 0.9198; train_kl_reg_loss: 100310.5147; train_edge_recon_loss: 2720209.5095; train_gene_expr_recon_loss: 11347357.4580; train_masked_gp_l1_reg_loss: 105506.1817; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 42084.1665; train_chrom_access_recon_loss: 9384673.4962; train_global_loss: 23700141.3282; train_optim_loss: 23700141.3282; val_kl_reg_loss: 98794.8359; val_edge_recon_loss: 2736027.7333; val_gene_expr_recon_loss: 11382513.0667; val_masked_gp_l1_reg_loss: 106304.7734; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 40993.5312; val_chrom_access_recon_loss: 9276907.3333; val_global_loss: 23641542.0000; val_optim_loss: 23641542.0000
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9674; val_auprc_score: 0.9584; val_best_acc_score: 0.9174; val_best_f1_score: 0.9203; train_kl_reg_loss: 99276.2142; train_edge_recon_loss: 2713625.3244; train_gene_expr_recon_loss: 11305898.3359; train_masked_gp_l1_reg_loss: 106980.9702; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 39939.4223; train_chrom_access_recon_loss: 9346873.4122; train_global_loss: 23612593.7252; train_optim_loss: 23612593.7252; val_kl_reg_loss: 101971.7839; val_edge_recon_loss: 2737475.4667; val_gene_expr_recon_loss: 11374069.3333; val_masked_gp_l1_reg_loss: 107625.3672; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 39051.1250; val_chrom_access_recon_loss: 9274151.5333; val_global_loss: 23634343.7333; val_optim_loss: 23634343.7333
