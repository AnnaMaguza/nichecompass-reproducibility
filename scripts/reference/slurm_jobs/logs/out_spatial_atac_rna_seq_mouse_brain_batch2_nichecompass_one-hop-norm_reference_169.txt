[True]
Run timestamp: 08082023_064426_169.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'spatial_atac_rna_seq_mouse_brain_batch2', '--reference_batches', 'None', '--n_neighbors', '8', '--filter_genes', '--n_hvg', '4000', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--include_collectri_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--include_atac_modality', '--filter_peaks', '--min_cell_peak_thresh_ratio', '0.01', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '0', '--active_gp_thresh_ratio', '0.03', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'None', '--cat_covariates_embeds_nums', '0', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '50000', '--lambda_gene_expr_recon', '300', '--lambda_chrom_access_recon', '300', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '10', '--lambda_l1_addon', '10.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_169']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 3396.
Number of gene programs after filtering and combining: 2766.

Filtering genes...
Starting with 22914 genes.
Keeping 22914 genes after filtering genes with expression in 0 cells.
Keeping 5114 highly variable or gene program relevant genes.

Filtering peaks...
Starting with 121068 peaks.
Keeping 112141 peaks after filtering  peaks with counts in less than 92 cells.
Keeping 19267 peaks after filtering peaks with no matching genes in gp mask.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb, include_chrom_access_recon_loss: True, atac_recon_loss: nb 
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['None']
ONE HOP GCN NORM NODE LABEL AGGREGATOR
ENCODER -> n_input: 23942, n_cat_covariates_embed_input: 0, n_hidden: 2573, n_latent: 2573, n_addon_latent: 0, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 2573, n_addon_gp_input: 0, n_cat_covariates_embed_input: 0, n_output: 4675
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 2573, n_addon_gp_input: 0, n_cat_covariates_embed_input: 0, n_output: 4675
MASKED TARGET ATAC DECODER -> n_prior_gp_input: 2573, n_addon_gp_input: 0, n_cat_covariates_embed_input: 0, n_output: 19267
MASKED SOURCE ATAC DECODER -> n_prior_gp_input: 2573, n_addon_gp_input: 0, n_cat_covariates_embed_input: 0, n_output: 19267

--- INITIALIZING TRAINER ---
Number of training nodes: 8293
Number of validation nodes: 922
Number of training edges: 33399
Number of validation edges: 3711
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.6739; val_auprc_score: 0.7052; val_best_acc_score: 0.5449; val_best_f1_score: 0.6778; train_kl_reg_loss: 16728.3270; train_edge_recon_loss: 37683.7594; train_gene_expr_recon_loss: 530369.7069; train_masked_gp_l1_reg_loss: 5966.4490; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 782892.4025; train_global_loss: 1373640.6364; train_optim_loss: 1373640.6364; val_kl_reg_loss: 27015.9019; val_edge_recon_loss: 40621.1157; val_gene_expr_recon_loss: 458182.9961; val_masked_gp_l1_reg_loss: 5887.1216; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 752578.6562; val_global_loss: 1284285.7812; val_optim_loss: 1284285.7812
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.7438; val_auprc_score: 0.7649; val_best_acc_score: 0.6187; val_best_f1_score: 0.6975; train_kl_reg_loss: 30118.4661; train_edge_recon_loss: 39493.1340; train_gene_expr_recon_loss: 431306.2169; train_masked_gp_l1_reg_loss: 5828.4313; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 730852.0246; train_global_loss: 1237598.2689; train_optim_loss: 1237598.2689; val_kl_reg_loss: 27604.0649; val_edge_recon_loss: 40571.6396; val_gene_expr_recon_loss: 423947.4453; val_masked_gp_l1_reg_loss: 5825.5640; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 723766.0469; val_global_loss: 1221714.7500; val_optim_loss: 1221714.7500
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.8404; val_auprc_score: 0.8464; val_best_acc_score: 0.7538; val_best_f1_score: 0.7715; train_kl_reg_loss: 27798.9123; train_edge_recon_loss: 39403.8704; train_gene_expr_recon_loss: 414876.3419; train_masked_gp_l1_reg_loss: 5848.3476; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 714149.5123; train_global_loss: 1202076.9792; train_optim_loss: 1202076.9792; val_kl_reg_loss: 27337.8000; val_edge_recon_loss: 40405.8643; val_gene_expr_recon_loss: 414611.3359; val_masked_gp_l1_reg_loss: 5896.2832; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 710413.6250; val_global_loss: 1198664.9062; val_optim_loss: 1198664.9062
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.8970; val_auprc_score: 0.8929; val_best_acc_score: 0.7992; val_best_f1_score: 0.7788; train_kl_reg_loss: 25279.4705; train_edge_recon_loss: 39143.7356; train_gene_expr_recon_loss: 408017.7765; train_masked_gp_l1_reg_loss: 5925.1852; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 703622.0436; train_global_loss: 1181988.2083; train_optim_loss: 1181988.2083; val_kl_reg_loss: 22827.2522; val_edge_recon_loss: 40088.5918; val_gene_expr_recon_loss: 411925.3359; val_masked_gp_l1_reg_loss: 5974.8672; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 710901.8828; val_global_loss: 1191717.9219; val_optim_loss: 1191717.9219
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9083; val_auprc_score: 0.8988; val_best_acc_score: 0.7828; val_best_f1_score: 0.8172; train_kl_reg_loss: 23316.8916; train_edge_recon_loss: 38847.0369; train_gene_expr_recon_loss: 403795.1965; train_masked_gp_l1_reg_loss: 6016.1581; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 695902.6070; train_global_loss: 1167877.8920; train_optim_loss: 1167877.8920; val_kl_reg_loss: 22232.5615; val_edge_recon_loss: 39816.2012; val_gene_expr_recon_loss: 408720.8945; val_masked_gp_l1_reg_loss: 6067.6680; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 703706.0625; val_global_loss: 1180543.4062; val_optim_loss: 1180543.4062
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9175; val_auprc_score: 0.9094; val_best_acc_score: 0.8168; val_best_f1_score: 0.8390; train_kl_reg_loss: 21758.7144; train_edge_recon_loss: 38533.2100; train_gene_expr_recon_loss: 400551.7330; train_masked_gp_l1_reg_loss: 6102.5923; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 690242.7585; train_global_loss: 1157189.0000; train_optim_loss: 1157189.0000; val_kl_reg_loss: 20304.8562; val_edge_recon_loss: 39557.5303; val_gene_expr_recon_loss: 408333.2383; val_masked_gp_l1_reg_loss: 6133.4580; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 697835.3438; val_global_loss: 1172164.4531; val_optim_loss: 1172164.4531
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9245; val_auprc_score: 0.9177; val_best_acc_score: 0.8378; val_best_f1_score: 0.8518; train_kl_reg_loss: 20427.9804; train_edge_recon_loss: 38258.6876; train_gene_expr_recon_loss: 397845.1212; train_masked_gp_l1_reg_loss: 6175.4894; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 685662.0294; train_global_loss: 1148369.3106; train_optim_loss: 1148369.3106; val_kl_reg_loss: 19267.2620; val_edge_recon_loss: 39335.8193; val_gene_expr_recon_loss: 402119.8477; val_masked_gp_l1_reg_loss: 6219.4312; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 686534.3359; val_global_loss: 1153476.6875; val_optim_loss: 1153476.6875
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9269; val_auprc_score: 0.9203; val_best_acc_score: 0.8463; val_best_f1_score: 0.8547; train_kl_reg_loss: 19508.0147; train_edge_recon_loss: 38056.0328; train_gene_expr_recon_loss: 395007.8958; train_masked_gp_l1_reg_loss: 6241.7502; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 680016.0833; train_global_loss: 1138829.7727; train_optim_loss: 1138829.7727; val_kl_reg_loss: 18557.9978; val_edge_recon_loss: 39089.2095; val_gene_expr_recon_loss: 395201.3203; val_masked_gp_l1_reg_loss: 6285.2676; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 675114.3359; val_global_loss: 1134248.1406; val_optim_loss: 1134248.1406
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9350; val_auprc_score: 0.9293; val_best_acc_score: 0.8588; val_best_f1_score: 0.8609; train_kl_reg_loss: 18712.2293; train_edge_recon_loss: 37847.9714; train_gene_expr_recon_loss: 392720.0459; train_masked_gp_l1_reg_loss: 6306.7890; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 674158.4167; train_global_loss: 1129745.4489; train_optim_loss: 1129745.4489; val_kl_reg_loss: 18068.8296; val_edge_recon_loss: 38922.8579; val_gene_expr_recon_loss: 396463.8672; val_masked_gp_l1_reg_loss: 6328.4907; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 679215.3984; val_global_loss: 1138999.4688; val_optim_loss: 1138999.4688
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9388; val_auprc_score: 0.9345; val_best_acc_score: 0.8554; val_best_f1_score: 0.8595; train_kl_reg_loss: 18011.4121; train_edge_recon_loss: 37652.1702; train_gene_expr_recon_loss: 391114.9583; train_masked_gp_l1_reg_loss: 6361.7550; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 671948.3712; train_global_loss: 1125088.6648; train_optim_loss: 1125088.6648; val_kl_reg_loss: 17190.6179; val_edge_recon_loss: 38723.6396; val_gene_expr_recon_loss: 395261.5898; val_masked_gp_l1_reg_loss: 6382.3535; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 672829.2500; val_global_loss: 1130387.4531; val_optim_loss: 1130387.4531
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9394; val_auprc_score: 0.9329; val_best_acc_score: 0.8557; val_best_f1_score: 0.8636; train_kl_reg_loss: 17318.2904; train_edge_recon_loss: 37464.8377; train_gene_expr_recon_loss: 389140.2315; train_masked_gp_l1_reg_loss: 6413.8975; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 668877.9801; train_global_loss: 1119215.2386; train_optim_loss: 1119215.2386; val_kl_reg_loss: 16239.1068; val_edge_recon_loss: 38488.8960; val_gene_expr_recon_loss: 391613.2578; val_masked_gp_l1_reg_loss: 6440.1514; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 666328.1172; val_global_loss: 1119109.5312; val_optim_loss: 1119109.5312
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9388; val_auprc_score: 0.9311; val_best_acc_score: 0.8600; val_best_f1_score: 0.8655; train_kl_reg_loss: 16876.5840; train_edge_recon_loss: 37310.9221; train_gene_expr_recon_loss: 387249.2566; train_masked_gp_l1_reg_loss: 6464.3627; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 666183.9962; train_global_loss: 1114085.1193; train_optim_loss: 1114085.1193; val_kl_reg_loss: 16340.2131; val_edge_recon_loss: 38370.1182; val_gene_expr_recon_loss: 394197.2695; val_masked_gp_l1_reg_loss: 6487.3105; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 665218.5078; val_global_loss: 1120613.4062; val_optim_loss: 1120613.4062
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9378; val_auprc_score: 0.9351; val_best_acc_score: 0.8541; val_best_f1_score: 0.8570; train_kl_reg_loss: 16451.8768; train_edge_recon_loss: 37170.1380; train_gene_expr_recon_loss: 385174.3807; train_masked_gp_l1_reg_loss: 6502.6697; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 661574.8513; train_global_loss: 1106873.9186; train_optim_loss: 1106873.9186; val_kl_reg_loss: 16039.4894; val_edge_recon_loss: 38320.3862; val_gene_expr_recon_loss: 389467.7695; val_masked_gp_l1_reg_loss: 6516.0098; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 668926.8203; val_global_loss: 1119270.4531; val_optim_loss: 1119270.4531
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9450; val_auprc_score: 0.9441; val_best_acc_score: 0.8626; val_best_f1_score: 0.8638; train_kl_reg_loss: 16011.0916; train_edge_recon_loss: 36990.9340; train_gene_expr_recon_loss: 383675.9413; train_masked_gp_l1_reg_loss: 6539.8798; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 659150.9545; train_global_loss: 1102368.7898; train_optim_loss: 1102368.7898; val_kl_reg_loss: 15565.6271; val_edge_recon_loss: 38097.6187; val_gene_expr_recon_loss: 385637.0820; val_masked_gp_l1_reg_loss: 6571.0889; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 659315.3906; val_global_loss: 1105186.8281; val_optim_loss: 1105186.8281
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9465; val_auprc_score: 0.9461; val_best_acc_score: 0.8612; val_best_f1_score: 0.8667; train_kl_reg_loss: 15620.7292; train_edge_recon_loss: 36838.4566; train_gene_expr_recon_loss: 381709.1714; train_masked_gp_l1_reg_loss: 6597.3119; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 654746.3958; train_global_loss: 1095512.0663; train_optim_loss: 1095512.0663; val_kl_reg_loss: 15331.3750; val_edge_recon_loss: 37877.4575; val_gene_expr_recon_loss: 383438.1953; val_masked_gp_l1_reg_loss: 6610.9053; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 663046.7031; val_global_loss: 1106304.6250; val_optim_loss: 1106304.6250
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9496; val_auprc_score: 0.9483; val_best_acc_score: 0.8716; val_best_f1_score: 0.8735; train_kl_reg_loss: 15260.0840; train_edge_recon_loss: 36687.4703; train_gene_expr_recon_loss: 379775.0028; train_masked_gp_l1_reg_loss: 6631.1667; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 653537.7595; train_global_loss: 1091891.4811; train_optim_loss: 1091891.4811; val_kl_reg_loss: 14812.2649; val_edge_recon_loss: 37719.4297; val_gene_expr_recon_loss: 387425.6367; val_masked_gp_l1_reg_loss: 6655.5571; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 657958.3750; val_global_loss: 1104571.2812; val_optim_loss: 1104571.2812
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9495; val_auprc_score: 0.9495; val_best_acc_score: 0.8694; val_best_f1_score: 0.8705; train_kl_reg_loss: 14975.6111; train_edge_recon_loss: 36541.3485; train_gene_expr_recon_loss: 378142.9304; train_masked_gp_l1_reg_loss: 6667.0555; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 649993.5350; train_global_loss: 1086320.4801; train_optim_loss: 1086320.4801; val_kl_reg_loss: 14478.0118; val_edge_recon_loss: 37583.0444; val_gene_expr_recon_loss: 383588.5000; val_masked_gp_l1_reg_loss: 6682.4463; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 652102.3203; val_global_loss: 1094434.3281; val_optim_loss: 1094434.3281
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9522; val_auprc_score: 0.9519; val_best_acc_score: 0.8724; val_best_f1_score: 0.8753; train_kl_reg_loss: 14817.1601; train_edge_recon_loss: 36429.7712; train_gene_expr_recon_loss: 376056.2874; train_masked_gp_l1_reg_loss: 6701.2156; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 646841.8580; train_global_loss: 1080846.2945; train_optim_loss: 1080846.2945; val_kl_reg_loss: 14255.5830; val_edge_recon_loss: 37412.8345; val_gene_expr_recon_loss: 384832.0156; val_masked_gp_l1_reg_loss: 6724.0752; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 657040.8438; val_global_loss: 1100265.3438; val_optim_loss: 1100265.3438
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9574; val_auprc_score: 0.9587; val_best_acc_score: 0.8820; val_best_f1_score: 0.8819; train_kl_reg_loss: 14579.5952; train_edge_recon_loss: 36312.9384; train_gene_expr_recon_loss: 374973.2595; train_masked_gp_l1_reg_loss: 6734.7822; train_group_lasso_reg_loss: 0.0000; train_chrom_access_recon_loss: 646393.2282; train_global_loss: 1078993.8059; train_optim_loss: 1078993.8059; val_kl_reg_loss: 13763.9409; val_edge_recon_loss: 37116.1274; val_gene_expr_recon_loss: 381796.2773; val_masked_gp_l1_reg_loss: 6746.5654; val_group_lasso_reg_loss: 0.0000; val_chrom_access_recon_loss: 646858.6641; val_global_loss: 1086281.5625; val_optim_loss: 1086281.5625
