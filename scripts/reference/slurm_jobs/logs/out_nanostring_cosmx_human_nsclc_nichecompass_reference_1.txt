[True, False, True]
Run timestamp: 05092023_121353_1.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', 'batch7', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', 'patient', '--cat_covariates_no_edges', 'True', 'False', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '100', '--active_gp_thresh_ratio', '0.03', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '5', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '500000.0', '--contrastive_logits_pos_ratio', '0.015625', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--lambda_l1_addon', '1000.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_1']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch7...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 563097
Number of validation nodes: 62566
Number of training edges: 1330101
Number of validation edges: 147789
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9032; val_auprc_score: 0.9811; val_best_acc_score: 0.9213; val_best_f1_score: 0.9560; train_kl_reg_loss: 16585.5276; train_edge_recon_loss: 723444.7090; train_cat_covariates_contrastive_loss: 478071.4880; train_gene_expr_recon_loss: 2558668.2738; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 59416.8946; train_global_loss: 3836186.8941; train_optim_loss: 3836186.8941; val_kl_reg_loss: 18500.5193; val_edge_recon_loss: 715047.2645; val_cat_covariates_contrastive_loss: 477009.4430; val_gene_expr_recon_loss: 2229690.4766; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 14845.0234; val_global_loss: 3455092.7024; val_optim_loss: 3455092.7024
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9133; val_auprc_score: 0.9825; val_best_acc_score: 0.9277; val_best_f1_score: 0.9594; train_kl_reg_loss: 19362.7320; train_edge_recon_loss: 693602.2145; train_cat_covariates_contrastive_loss: 478471.7640; train_gene_expr_recon_loss: 2094761.4954; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15083.7363; train_global_loss: 3301281.9410; train_optim_loss: 3301281.9410; val_kl_reg_loss: 21644.9748; val_edge_recon_loss: 715183.7738; val_cat_covariates_contrastive_loss: 477226.8954; val_gene_expr_recon_loss: 2016470.5947; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15182.2686; val_global_loss: 3245708.4905; val_optim_loss: 3245708.4905
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9212; val_auprc_score: 0.9841; val_best_acc_score: 0.9316; val_best_f1_score: 0.9616; train_kl_reg_loss: 21240.3333; train_edge_recon_loss: 691316.9301; train_cat_covariates_contrastive_loss: 478597.7786; train_gene_expr_recon_loss: 1974915.9557; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15745.1883; train_global_loss: 3181816.1887; train_optim_loss: 3181816.1887; val_kl_reg_loss: 21945.0700; val_edge_recon_loss: 713272.8162; val_cat_covariates_contrastive_loss: 477546.1285; val_gene_expr_recon_loss: 1947943.6311; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16051.4941; val_global_loss: 3176759.1367; val_optim_loss: 3176759.1367
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9248; val_auprc_score: 0.9848; val_best_acc_score: 0.9314; val_best_f1_score: 0.9614; train_kl_reg_loss: 22011.6281; train_edge_recon_loss: 687094.9119; train_cat_covariates_contrastive_loss: 478910.1463; train_gene_expr_recon_loss: 1931385.8362; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16061.1180; train_global_loss: 3135463.6351; train_optim_loss: 3135463.6351; val_kl_reg_loss: 22494.3890; val_edge_recon_loss: 716494.1304; val_cat_covariates_contrastive_loss: 478233.2301; val_gene_expr_recon_loss: 1934425.0333; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16108.4102; val_global_loss: 3167755.2889; val_optim_loss: 3167755.2889
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9270; val_auprc_score: 0.9858; val_best_acc_score: 0.9300; val_best_f1_score: 0.9607; train_kl_reg_loss: 22622.4097; train_edge_recon_loss: 688424.5876; train_cat_covariates_contrastive_loss: 479000.3257; train_gene_expr_recon_loss: 1906414.4319; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16162.6499; train_global_loss: 3112624.4094; train_optim_loss: 3112624.4094; val_kl_reg_loss: 22336.6990; val_edge_recon_loss: 711167.8739; val_cat_covariates_contrastive_loss: 480538.1718; val_gene_expr_recon_loss: 1910844.1730; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16223.7432; val_global_loss: 3141110.6661; val_optim_loss: 3141110.6661
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9335; val_auprc_score: 0.9874; val_best_acc_score: 0.9349; val_best_f1_score: 0.9634; train_kl_reg_loss: 23165.3928; train_edge_recon_loss: 687941.0784; train_cat_covariates_contrastive_loss: 479056.0725; train_gene_expr_recon_loss: 1889119.9078; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16257.6913; train_global_loss: 3095540.1410; train_optim_loss: 3095540.1410; val_kl_reg_loss: 22881.9365; val_edge_recon_loss: 707494.5409; val_cat_covariates_contrastive_loss: 481847.9324; val_gene_expr_recon_loss: 1891498.0727; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16295.8525; val_global_loss: 3120018.2370; val_optim_loss: 3120018.2370
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9313; val_auprc_score: 0.9863; val_best_acc_score: 0.9333; val_best_f1_score: 0.9625; train_kl_reg_loss: 23575.5267; train_edge_recon_loss: 688619.4068; train_cat_covariates_contrastive_loss: 479266.9272; train_gene_expr_recon_loss: 1876119.7180; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16341.8644; train_global_loss: 3083923.4457; train_optim_loss: 3083923.4457; val_kl_reg_loss: 22723.8874; val_edge_recon_loss: 713996.0712; val_cat_covariates_contrastive_loss: 480673.7618; val_gene_expr_recon_loss: 1873867.0917; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16444.4180; val_global_loss: 3107705.3088; val_optim_loss: 3107705.3088
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9326; val_auprc_score: 0.9866; val_best_acc_score: 0.9359; val_best_f1_score: 0.9640; train_kl_reg_loss: 24085.1079; train_edge_recon_loss: 689266.8900; train_cat_covariates_contrastive_loss: 479483.2334; train_gene_expr_recon_loss: 1881395.3230; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16480.9783; train_global_loss: 3090711.5272; train_optim_loss: 3090711.5272; val_kl_reg_loss: 24525.5716; val_edge_recon_loss: 715577.1990; val_cat_covariates_contrastive_loss: 480922.8819; val_gene_expr_recon_loss: 1914394.1233; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16546.9395; val_global_loss: 3151966.7811; val_optim_loss: 3151966.7811
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9312; val_auprc_score: 0.9862; val_best_acc_score: 0.9352; val_best_f1_score: 0.9635; train_kl_reg_loss: 25292.4905; train_edge_recon_loss: 686800.9070; train_cat_covariates_contrastive_loss: 479725.4105; train_gene_expr_recon_loss: 1861202.2254; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16511.3726; train_global_loss: 3069532.4070; train_optim_loss: 3069532.4070; val_kl_reg_loss: 24188.3891; val_edge_recon_loss: 716133.1565; val_cat_covariates_contrastive_loss: 481262.8764; val_gene_expr_recon_loss: 1856996.8240; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16597.7715; val_global_loss: 3095178.9939; val_optim_loss: 3095178.9939
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9292; val_auprc_score: 0.9851; val_best_acc_score: 0.9375; val_best_f1_score: 0.9648; train_kl_reg_loss: 25071.7733; train_edge_recon_loss: 686882.8205; train_cat_covariates_contrastive_loss: 479740.7480; train_gene_expr_recon_loss: 1846230.1322; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16659.0841; train_global_loss: 3054584.5623; train_optim_loss: 3054584.5623; val_kl_reg_loss: 25754.3250; val_edge_recon_loss: 710874.7909; val_cat_covariates_contrastive_loss: 478564.4041; val_gene_expr_recon_loss: 1850911.7128; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16674.0020; val_global_loss: 3082779.2240; val_optim_loss: 3082779.2240
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9340; val_auprc_score: 0.9869; val_best_acc_score: 0.9349; val_best_f1_score: 0.9635; train_kl_reg_loss: 25278.1672; train_edge_recon_loss: 687380.7883; train_cat_covariates_contrastive_loss: 479828.5549; train_gene_expr_recon_loss: 1839568.9767; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16777.0982; train_global_loss: 3048833.5855; train_optim_loss: 3048833.5855; val_kl_reg_loss: 25663.7544; val_edge_recon_loss: 708409.4135; val_cat_covariates_contrastive_loss: 480788.8724; val_gene_expr_recon_loss: 1846380.3378; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16866.6445; val_global_loss: 3078109.1332; val_optim_loss: 3078109.1332
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9327; val_auprc_score: 0.9870; val_best_acc_score: 0.9340; val_best_f1_score: 0.9629; train_kl_reg_loss: 25771.9404; train_edge_recon_loss: 686720.9699; train_cat_covariates_contrastive_loss: 479880.3706; train_gene_expr_recon_loss: 1834393.3276; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16839.7307; train_global_loss: 3043606.3420; train_optim_loss: 3043606.3420; val_kl_reg_loss: 25895.3195; val_edge_recon_loss: 700104.0929; val_cat_covariates_contrastive_loss: 480718.6597; val_gene_expr_recon_loss: 1839070.2617; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16612.1738; val_global_loss: 3062400.5804; val_optim_loss: 3062400.5804
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9363; val_auprc_score: 0.9870; val_best_acc_score: 0.9408; val_best_f1_score: 0.9667; train_kl_reg_loss: 26417.8363; train_edge_recon_loss: 684134.1885; train_cat_covariates_contrastive_loss: 479915.0912; train_gene_expr_recon_loss: 1829028.4401; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16990.5235; train_global_loss: 3036486.0787; train_optim_loss: 3036486.0787; val_kl_reg_loss: 26542.8927; val_edge_recon_loss: 705333.0598; val_cat_covariates_contrastive_loss: 479503.1056; val_gene_expr_recon_loss: 1834227.5696; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17078.3887; val_global_loss: 3062685.1220; val_optim_loss: 3062685.1220
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9359; val_auprc_score: 0.9872; val_best_acc_score: 0.9370; val_best_f1_score: 0.9645; train_kl_reg_loss: 26358.5145; train_edge_recon_loss: 689085.2062; train_cat_covariates_contrastive_loss: 479868.1446; train_gene_expr_recon_loss: 1824496.8188; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17070.7195; train_global_loss: 3036879.4006; train_optim_loss: 3036879.4006; val_kl_reg_loss: 25220.0176; val_edge_recon_loss: 711018.5450; val_cat_covariates_contrastive_loss: 481580.7803; val_gene_expr_recon_loss: 1830402.2383; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17014.9941; val_global_loss: 3065236.5830; val_optim_loss: 3065236.5830
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9368; val_auprc_score: 0.9874; val_best_acc_score: 0.9389; val_best_f1_score: 0.9656; train_kl_reg_loss: 26644.0008; train_edge_recon_loss: 686356.9981; train_cat_covariates_contrastive_loss: 480053.8191; train_gene_expr_recon_loss: 1821863.4215; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17104.7421; train_global_loss: 3032022.9834; train_optim_loss: 3032022.9834; val_kl_reg_loss: 26304.5934; val_edge_recon_loss: 702466.2778; val_cat_covariates_contrastive_loss: 480477.9481; val_gene_expr_recon_loss: 1829789.1838; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17268.4180; val_global_loss: 3056306.5009; val_optim_loss: 3056306.5009
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9362; val_auprc_score: 0.9875; val_best_acc_score: 0.9385; val_best_f1_score: 0.9654; train_kl_reg_loss: 26587.5844; train_edge_recon_loss: 688932.1979; train_cat_covariates_contrastive_loss: 480081.8865; train_gene_expr_recon_loss: 1838840.8301; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17218.7049; train_global_loss: 3051661.2063; train_optim_loss: 3051661.2063; val_kl_reg_loss: 27834.3411; val_edge_recon_loss: 700385.2820; val_cat_covariates_contrastive_loss: 480263.8821; val_gene_expr_recon_loss: 1851746.6337; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17175.0723; val_global_loss: 3077405.1401; val_optim_loss: 3077405.1401
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9355; val_auprc_score: 0.9869; val_best_acc_score: 0.9389; val_best_f1_score: 0.9655; train_kl_reg_loss: 27651.1792; train_edge_recon_loss: 686403.2038; train_cat_covariates_contrastive_loss: 480173.2418; train_gene_expr_recon_loss: 1818687.9739; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17188.0062; train_global_loss: 3030103.6010; train_optim_loss: 3030103.6010; val_kl_reg_loss: 26594.9203; val_edge_recon_loss: 710992.4970; val_cat_covariates_contrastive_loss: 481194.0393; val_gene_expr_recon_loss: 1821157.8815; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17037.2871; val_global_loss: 3056976.5839; val_optim_loss: 3056976.5839
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.9323; val_auprc_score: 0.9858; val_best_acc_score: 0.9383; val_best_f1_score: 0.9653; train_kl_reg_loss: 26964.6009; train_edge_recon_loss: 686195.4005; train_cat_covariates_contrastive_loss: 480181.7417; train_gene_expr_recon_loss: 1811692.3579; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17234.4579; train_global_loss: 3022268.5568; train_optim_loss: 3022268.5568; val_kl_reg_loss: 28212.5199; val_edge_recon_loss: 712965.7301; val_cat_covariates_contrastive_loss: 478669.9617; val_gene_expr_recon_loss: 1822832.6933; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17094.5879; val_global_loss: 3059775.4092; val_optim_loss: 3059775.4092
