[True, False, True]
Run timestamp: 02092023_121424_1.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', 'batch7', 'batch8', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', 'patient', '--cat_covariates_no_edges', 'True', 'False', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '100', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '5', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '1000000.0', '--contrastive_logits_pos_ratio', '0.0625', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--lambda_l1_addon', '100.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_1']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch7...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch8...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 631979
Number of validation nodes: 70220
Number of training edges: 1492281
Number of validation edges: 165809
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8824; val_auprc_score: 0.9813; val_best_acc_score: 0.9197; val_best_f1_score: 0.9561; train_kl_reg_loss: 18353.8099; train_edge_recon_loss: 656343.8796; train_cat_covariates_contrastive_loss: 953284.6118; train_gene_expr_recon_loss: 2568128.7768; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16617.7309; train_global_loss: 4212728.8058; train_optim_loss: 4212728.8058; val_kl_reg_loss: 22740.6053; val_edge_recon_loss: 655332.2111; val_cat_covariates_contrastive_loss: 949081.9844; val_gene_expr_recon_loss: 2207751.4900; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 8462.5850; val_global_loss: 3843368.7863; val_optim_loss: 3843368.7863
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8859; val_auprc_score: 0.9815; val_best_acc_score: 0.9163; val_best_f1_score: 0.9539; train_kl_reg_loss: 22310.8224; train_edge_recon_loss: 630585.3833; train_cat_covariates_contrastive_loss: 953715.4901; train_gene_expr_recon_loss: 2069222.5575; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 8485.5483; train_global_loss: 3684319.8009; train_optim_loss: 3684319.8009; val_kl_reg_loss: 23611.6683; val_edge_recon_loss: 654961.1866; val_cat_covariates_contrastive_loss: 952094.2625; val_gene_expr_recon_loss: 1980028.9780; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 8560.8984; val_global_loss: 3619257.0980; val_optim_loss: 3619257.0980
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9074; val_auprc_score: 0.9854; val_best_acc_score: 0.9265; val_best_f1_score: 0.9596; train_kl_reg_loss: 24232.3208; train_edge_recon_loss: 626560.9237; train_cat_covariates_contrastive_loss: 954383.4534; train_gene_expr_recon_loss: 1952447.7566; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 8662.0530; train_global_loss: 3566286.5121; train_optim_loss: 3566286.5121; val_kl_reg_loss: 25707.6037; val_edge_recon_loss: 647747.3581; val_cat_covariates_contrastive_loss: 952965.6063; val_gene_expr_recon_loss: 1921810.1470; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 8783.4170; val_global_loss: 3557014.2045; val_optim_loss: 3557014.2045
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9185; val_auprc_score: 0.9877; val_best_acc_score: 0.9298; val_best_f1_score: 0.9613; train_kl_reg_loss: 25116.2223; train_edge_recon_loss: 625891.1442; train_cat_covariates_contrastive_loss: 954212.2964; train_gene_expr_recon_loss: 1910527.9694; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 8801.3236; train_global_loss: 3524548.9546; train_optim_loss: 3524548.9546; val_kl_reg_loss: 24467.6630; val_edge_recon_loss: 640122.3070; val_cat_covariates_contrastive_loss: 958490.9682; val_gene_expr_recon_loss: 1892877.3858; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 8886.6475; val_global_loss: 3524845.0710; val_optim_loss: 3524845.0710
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9177; val_auprc_score: 0.9873; val_best_acc_score: 0.9302; val_best_f1_score: 0.9615; train_kl_reg_loss: 25760.4000; train_edge_recon_loss: 627626.3486; train_cat_covariates_contrastive_loss: 954574.3433; train_gene_expr_recon_loss: 1889455.3450; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 8881.8276; train_global_loss: 3506298.2674; train_optim_loss: 3506298.2674; val_kl_reg_loss: 25083.0258; val_edge_recon_loss: 645482.4849; val_cat_covariates_contrastive_loss: 957314.9354; val_gene_expr_recon_loss: 1880048.1887; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 8933.7002; val_global_loss: 3516862.3804; val_optim_loss: 3516862.3804
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9111; val_auprc_score: 0.9858; val_best_acc_score: 0.9258; val_best_f1_score: 0.9591; train_kl_reg_loss: 26314.4703; train_edge_recon_loss: 624132.7319; train_cat_covariates_contrastive_loss: 954976.6271; train_gene_expr_recon_loss: 1871906.6944; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 8982.0002; train_global_loss: 3486312.5232; train_optim_loss: 3486312.5232; val_kl_reg_loss: 26470.5700; val_edge_recon_loss: 644300.4894; val_cat_covariates_contrastive_loss: 954253.0625; val_gene_expr_recon_loss: 1870177.5413; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9020.0078; val_global_loss: 3504221.6644; val_optim_loss: 3504221.6644
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9233; val_auprc_score: 0.9883; val_best_acc_score: 0.9332; val_best_f1_score: 0.9632; train_kl_reg_loss: 26746.8428; train_edge_recon_loss: 624738.3561; train_cat_covariates_contrastive_loss: 955148.3287; train_gene_expr_recon_loss: 1859110.1530; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9100.5087; train_global_loss: 3474844.1865; train_optim_loss: 3474844.1865; val_kl_reg_loss: 24486.4839; val_edge_recon_loss: 641885.4452; val_cat_covariates_contrastive_loss: 959473.5430; val_gene_expr_recon_loss: 1855352.4194; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9241.1357; val_global_loss: 3490439.1366; val_optim_loss: 3490439.1366
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9053; val_auprc_score: 0.9848; val_best_acc_score: 0.9242; val_best_f1_score: 0.9585; train_kl_reg_loss: 27213.6722; train_edge_recon_loss: 625007.6246; train_cat_covariates_contrastive_loss: 955090.2312; train_gene_expr_recon_loss: 1847510.5579; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9211.5590; train_global_loss: 3464033.6421; train_optim_loss: 3464033.6421; val_kl_reg_loss: 28189.6479; val_edge_recon_loss: 643374.6601; val_cat_covariates_contrastive_loss: 953335.8480; val_gene_expr_recon_loss: 1842955.0320; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9242.9551; val_global_loss: 3477098.1867; val_optim_loss: 3477098.1867
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9151; val_auprc_score: 0.9866; val_best_acc_score: 0.9281; val_best_f1_score: 0.9605; train_kl_reg_loss: 27591.0595; train_edge_recon_loss: 622236.8399; train_cat_covariates_contrastive_loss: 955307.9290; train_gene_expr_recon_loss: 1838813.8381; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9316.3249; train_global_loss: 3453265.9928; train_optim_loss: 3453265.9928; val_kl_reg_loss: 27124.1530; val_edge_recon_loss: 648884.0925; val_cat_covariates_contrastive_loss: 957992.1296; val_gene_expr_recon_loss: 1844481.7940; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9437.1113; val_global_loss: 3487919.1651; val_optim_loss: 3487919.1651
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9166; val_auprc_score: 0.9868; val_best_acc_score: 0.9276; val_best_f1_score: 0.9601; train_kl_reg_loss: 27866.3259; train_edge_recon_loss: 622855.5818; train_cat_covariates_contrastive_loss: 955551.9134; train_gene_expr_recon_loss: 1831249.2693; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9411.3253; train_global_loss: 3446934.4142; train_optim_loss: 3446934.4142; val_kl_reg_loss: 27223.5365; val_edge_recon_loss: 641891.6863; val_cat_covariates_contrastive_loss: 956593.4410; val_gene_expr_recon_loss: 1829503.1319; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9385.1709; val_global_loss: 3464597.0471; val_optim_loss: 3464597.0471
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9187; val_auprc_score: 0.9876; val_best_acc_score: 0.9252; val_best_f1_score: 0.9588; train_kl_reg_loss: 28108.2233; train_edge_recon_loss: 622548.1032; train_cat_covariates_contrastive_loss: 955740.8536; train_gene_expr_recon_loss: 1825046.2732; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9421.6755; train_global_loss: 3440865.1311; train_optim_loss: 3440865.1311; val_kl_reg_loss: 26982.9576; val_edge_recon_loss: 638288.3416; val_cat_covariates_contrastive_loss: 958686.2035; val_gene_expr_recon_loss: 1821265.9101; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9397.4824; val_global_loss: 3454620.9151; val_optim_loss: 3454620.9151
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9076; val_auprc_score: 0.9852; val_best_acc_score: 0.9258; val_best_f1_score: 0.9590; train_kl_reg_loss: 28008.8568; train_edge_recon_loss: 624377.6923; train_cat_covariates_contrastive_loss: 957057.5683; train_gene_expr_recon_loss: 1820417.4551; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9457.6374; train_global_loss: 3439319.2120; train_optim_loss: 3439319.2120; val_kl_reg_loss: 27268.8805; val_edge_recon_loss: 649088.8539; val_cat_covariates_contrastive_loss: 958248.0563; val_gene_expr_recon_loss: 1817186.8812; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9494.2715; val_global_loss: 3461286.9190; val_optim_loss: 3461286.9190
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9099; val_auprc_score: 0.9858; val_best_acc_score: 0.9271; val_best_f1_score: 0.9598; train_kl_reg_loss: 28055.7360; train_edge_recon_loss: 622149.1785; train_cat_covariates_contrastive_loss: 956995.2059; train_gene_expr_recon_loss: 1814292.1986; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9474.7936; train_global_loss: 3430967.1123; train_optim_loss: 3430967.1123; val_kl_reg_loss: 27775.2479; val_edge_recon_loss: 639406.2542; val_cat_covariates_contrastive_loss: 956150.9334; val_gene_expr_recon_loss: 1806399.9059; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9541.3203; val_global_loss: 3439273.5895; val_optim_loss: 3439273.5895
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9190; val_auprc_score: 0.9871; val_best_acc_score: 0.9307; val_best_f1_score: 0.9617; train_kl_reg_loss: 28148.5200; train_edge_recon_loss: 623114.3808; train_cat_covariates_contrastive_loss: 956559.9322; train_gene_expr_recon_loss: 1811886.6092; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9588.2185; train_global_loss: 3429297.6647; train_optim_loss: 3429297.6647; val_kl_reg_loss: 27964.3001; val_edge_recon_loss: 640407.6909; val_cat_covariates_contrastive_loss: 956447.3515; val_gene_expr_recon_loss: 1817433.5606; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9668.7656; val_global_loss: 3451921.6497; val_optim_loss: 3451921.6497
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9165; val_auprc_score: 0.9865; val_best_acc_score: 0.9291; val_best_f1_score: 0.9609; train_kl_reg_loss: 28190.4952; train_edge_recon_loss: 622083.7965; train_cat_covariates_contrastive_loss: 956016.1550; train_gene_expr_recon_loss: 1805428.2119; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9624.2296; train_global_loss: 3421342.8827; train_optim_loss: 3421342.8827; val_kl_reg_loss: 28525.8690; val_edge_recon_loss: 641681.9801; val_cat_covariates_contrastive_loss: 954754.3980; val_gene_expr_recon_loss: 1803712.4568; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9684.2646; val_global_loss: 3438358.9529; val_optim_loss: 3438358.9529
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9204; val_auprc_score: 0.9872; val_best_acc_score: 0.9349; val_best_f1_score: 0.9641; train_kl_reg_loss: 28407.5117; train_edge_recon_loss: 621769.7079; train_cat_covariates_contrastive_loss: 956222.6995; train_gene_expr_recon_loss: 1803609.9367; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9659.2772; train_global_loss: 3419669.1343; train_optim_loss: 3419669.1343; val_kl_reg_loss: 29025.3856; val_edge_recon_loss: 642244.0747; val_cat_covariates_contrastive_loss: 953693.1981; val_gene_expr_recon_loss: 1812290.0428; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9822.9619; val_global_loss: 3447075.7083; val_optim_loss: 3447075.7083
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9198; val_auprc_score: 0.9871; val_best_acc_score: 0.9312; val_best_f1_score: 0.9620; train_kl_reg_loss: 28510.7403; train_edge_recon_loss: 619868.6211; train_cat_covariates_contrastive_loss: 956102.8846; train_gene_expr_recon_loss: 1799555.7849; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 9723.7018; train_global_loss: 3413761.7291; train_optim_loss: 3413761.7291; val_kl_reg_loss: 29019.6374; val_edge_recon_loss: 642581.7616; val_cat_covariates_contrastive_loss: 955315.8287; val_gene_expr_recon_loss: 1798487.0513; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 9691.9590; val_global_loss: 3435096.2809; val_optim_loss: 3435096.2809
