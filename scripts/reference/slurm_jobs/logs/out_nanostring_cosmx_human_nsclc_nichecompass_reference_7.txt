[True, False, True]
Run timestamp: 05092023_121353_7.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch5', 'batch6', 'batch7', 'batch8', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', 'patient', '--cat_covariates_no_edges', 'True', 'False', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '100', '--active_gp_thresh_ratio', '0.03', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '5', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '500000.0', '--contrastive_logits_pos_ratio', '0.0078125', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--lambda_l1_addon', '1000.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_7']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch7...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch8...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 556628
Number of validation nodes: 61848
Number of training edges: 1316511
Number of validation edges: 146278
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9033; val_auprc_score: 0.9804; val_best_acc_score: 0.9197; val_best_f1_score: 0.9550; train_kl_reg_loss: 14865.8559; train_edge_recon_loss: 719485.1057; train_cat_covariates_contrastive_loss: 477427.2875; train_gene_expr_recon_loss: 2588699.5988; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 58397.5944; train_global_loss: 3858875.4470; train_optim_loss: 3858875.4470; val_kl_reg_loss: 16550.4494; val_edge_recon_loss: 721616.8007; val_cat_covariates_contrastive_loss: 475986.0564; val_gene_expr_recon_loss: 2238337.8068; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 14528.2266; val_global_loss: 3467019.3689; val_optim_loss: 3467019.3689
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9090; val_auprc_score: 0.9811; val_best_acc_score: 0.9221; val_best_f1_score: 0.9563; train_kl_reg_loss: 18044.4756; train_edge_recon_loss: 692738.0250; train_cat_covariates_contrastive_loss: 477132.5538; train_gene_expr_recon_loss: 2097690.7430; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 14647.6805; train_global_loss: 3300253.4761; train_optim_loss: 3300253.4761; val_kl_reg_loss: 20514.3819; val_edge_recon_loss: 721892.7104; val_cat_covariates_contrastive_loss: 475886.1235; val_gene_expr_recon_loss: 2008746.5905; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 14826.2510; val_global_loss: 3241866.0594; val_optim_loss: 3241866.0594
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9199; val_auprc_score: 0.9834; val_best_acc_score: 0.9276; val_best_f1_score: 0.9593; train_kl_reg_loss: 20171.0400; train_edge_recon_loss: 691581.4490; train_cat_covariates_contrastive_loss: 477468.0380; train_gene_expr_recon_loss: 1971071.2099; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 14747.1693; train_global_loss: 3175038.9028; train_optim_loss: 3175038.9028; val_kl_reg_loss: 21237.5051; val_edge_recon_loss: 720343.7157; val_cat_covariates_contrastive_loss: 477169.9491; val_gene_expr_recon_loss: 1943739.0275; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 14701.6934; val_global_loss: 3177191.9449; val_optim_loss: 3177191.9449
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9279; val_auprc_score: 0.9853; val_best_acc_score: 0.9318; val_best_f1_score: 0.9616; train_kl_reg_loss: 21183.5044; train_edge_recon_loss: 691913.2836; train_cat_covariates_contrastive_loss: 477493.6353; train_gene_expr_recon_loss: 1924869.0753; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 14939.6386; train_global_loss: 3130399.1376; train_optim_loss: 3130399.1376; val_kl_reg_loss: 21889.8137; val_edge_recon_loss: 707463.2933; val_cat_covariates_contrastive_loss: 476874.5686; val_gene_expr_recon_loss: 1910733.9515; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15166.0840; val_global_loss: 3132127.6320; val_optim_loss: 3132127.6320
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9284; val_auprc_score: 0.9851; val_best_acc_score: 0.9323; val_best_f1_score: 0.9618; train_kl_reg_loss: 21901.1124; train_edge_recon_loss: 691833.6378; train_cat_covariates_contrastive_loss: 477603.8147; train_gene_expr_recon_loss: 1898909.0252; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15262.6656; train_global_loss: 3105510.2551; train_optim_loss: 3105510.2551; val_kl_reg_loss: 22682.3296; val_edge_recon_loss: 712999.0968; val_cat_covariates_contrastive_loss: 477000.6176; val_gene_expr_recon_loss: 1887845.8610; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15283.4902; val_global_loss: 3115811.4030; val_optim_loss: 3115811.4030
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9313; val_auprc_score: 0.9859; val_best_acc_score: 0.9330; val_best_f1_score: 0.9621; train_kl_reg_loss: 22521.1730; train_edge_recon_loss: 687885.3752; train_cat_covariates_contrastive_loss: 477726.7767; train_gene_expr_recon_loss: 1882987.0729; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15340.1633; train_global_loss: 3086460.5631; train_optim_loss: 3086460.5631; val_kl_reg_loss: 22631.7119; val_edge_recon_loss: 714694.0691; val_cat_covariates_contrastive_loss: 477790.2949; val_gene_expr_recon_loss: 1875623.7107; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15440.2295; val_global_loss: 3106180.0428; val_optim_loss: 3106180.0428
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9281; val_auprc_score: 0.9847; val_best_acc_score: 0.9304; val_best_f1_score: 0.9607; train_kl_reg_loss: 23026.5920; train_edge_recon_loss: 689610.7018; train_cat_covariates_contrastive_loss: 478000.8034; train_gene_expr_recon_loss: 1868291.6111; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15501.0653; train_global_loss: 3074430.7733; train_optim_loss: 3074430.7733; val_kl_reg_loss: 23037.7236; val_edge_recon_loss: 722781.5986; val_cat_covariates_contrastive_loss: 477482.3989; val_gene_expr_recon_loss: 1861890.9327; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15612.4473; val_global_loss: 3100805.1530; val_optim_loss: 3100805.1530
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9325; val_auprc_score: 0.9859; val_best_acc_score: 0.9331; val_best_f1_score: 0.9622; train_kl_reg_loss: 23404.5866; train_edge_recon_loss: 689135.1824; train_cat_covariates_contrastive_loss: 478086.6248; train_gene_expr_recon_loss: 1857054.8528; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15649.9281; train_global_loss: 3063331.1750; train_optim_loss: 3063331.1750; val_kl_reg_loss: 24031.1643; val_edge_recon_loss: 712929.7874; val_cat_covariates_contrastive_loss: 477442.6523; val_gene_expr_recon_loss: 1857347.0739; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15781.0469; val_global_loss: 3087531.6818; val_optim_loss: 3087531.6818
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9334; val_auprc_score: 0.9865; val_best_acc_score: 0.9335; val_best_f1_score: 0.9625; train_kl_reg_loss: 23848.6756; train_edge_recon_loss: 687536.6803; train_cat_covariates_contrastive_loss: 478158.4883; train_gene_expr_recon_loss: 1847495.9365; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15655.5673; train_global_loss: 3052695.3522; train_optim_loss: 3052695.3522; val_kl_reg_loss: 23948.0111; val_edge_recon_loss: 711601.4449; val_cat_covariates_contrastive_loss: 479793.7701; val_gene_expr_recon_loss: 1847692.3422; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15664.7188; val_global_loss: 3078700.3173; val_optim_loss: 3078700.3173
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9321; val_auprc_score: 0.9857; val_best_acc_score: 0.9339; val_best_f1_score: 0.9627; train_kl_reg_loss: 24232.8568; train_edge_recon_loss: 688454.1452; train_cat_covariates_contrastive_loss: 478303.3387; train_gene_expr_recon_loss: 1840140.1859; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15701.2830; train_global_loss: 3046831.8091; train_optim_loss: 3046831.8091; val_kl_reg_loss: 24256.3138; val_edge_recon_loss: 712168.1267; val_cat_covariates_contrastive_loss: 477985.0532; val_gene_expr_recon_loss: 1840275.5341; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15884.6328; val_global_loss: 3070569.7902; val_optim_loss: 3070569.7902
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9305; val_auprc_score: 0.9850; val_best_acc_score: 0.9341; val_best_f1_score: 0.9626; train_kl_reg_loss: 24497.4217; train_edge_recon_loss: 689000.4385; train_cat_covariates_contrastive_loss: 478327.6813; train_gene_expr_recon_loss: 1832557.6388; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15794.9988; train_global_loss: 3040178.1816; train_optim_loss: 3040178.1816; val_kl_reg_loss: 25373.5076; val_edge_recon_loss: 718520.4685; val_cat_covariates_contrastive_loss: 477453.6335; val_gene_expr_recon_loss: 1834524.0629; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15714.3271; val_global_loss: 3071585.9170; val_optim_loss: 3071585.9170
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9364; val_auprc_score: 0.9865; val_best_acc_score: 0.9369; val_best_f1_score: 0.9644; train_kl_reg_loss: 24680.4211; train_edge_recon_loss: 685465.1124; train_cat_covariates_contrastive_loss: 478441.3318; train_gene_expr_recon_loss: 1826751.1026; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15956.7755; train_global_loss: 3031294.7446; train_optim_loss: 3031294.7446; val_kl_reg_loss: 24954.7072; val_edge_recon_loss: 712274.8494; val_cat_covariates_contrastive_loss: 478288.9540; val_gene_expr_recon_loss: 1829243.3733; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15834.6621; val_global_loss: 3060596.6355; val_optim_loss: 3060596.6355
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9369; val_auprc_score: 0.9868; val_best_acc_score: 0.9369; val_best_f1_score: 0.9643; train_kl_reg_loss: 24948.5215; train_edge_recon_loss: 690885.2862; train_cat_covariates_contrastive_loss: 478530.8779; train_gene_expr_recon_loss: 1823058.9802; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16049.5206; train_global_loss: 3033473.1826; train_optim_loss: 3033473.1826; val_kl_reg_loss: 24611.3409; val_edge_recon_loss: 715222.0227; val_cat_covariates_contrastive_loss: 479407.9732; val_gene_expr_recon_loss: 1822028.0376; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16068.1934; val_global_loss: 3057337.6233; val_optim_loss: 3057337.6233
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9345; val_auprc_score: 0.9859; val_best_acc_score: 0.9362; val_best_f1_score: 0.9639; train_kl_reg_loss: 25063.3441; train_edge_recon_loss: 688009.2199; train_cat_covariates_contrastive_loss: 478534.7991; train_gene_expr_recon_loss: 1819203.6137; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16146.7239; train_global_loss: 3026957.7019; train_optim_loss: 3026957.7019; val_kl_reg_loss: 25989.6702; val_edge_recon_loss: 711505.8352; val_cat_covariates_contrastive_loss: 477765.7654; val_gene_expr_recon_loss: 1819247.8698; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16090.1035; val_global_loss: 3050599.1451; val_optim_loss: 3050599.1451
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9337; val_auprc_score: 0.9863; val_best_acc_score: 0.9326; val_best_f1_score: 0.9619; train_kl_reg_loss: 25318.8610; train_edge_recon_loss: 688175.4955; train_cat_covariates_contrastive_loss: 478661.6079; train_gene_expr_recon_loss: 1816378.9879; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16249.1757; train_global_loss: 3024784.1238; train_optim_loss: 3024784.1238; val_kl_reg_loss: 25224.4997; val_edge_recon_loss: 712775.0939; val_cat_covariates_contrastive_loss: 479065.6471; val_gene_expr_recon_loss: 1822830.8081; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16341.5166; val_global_loss: 3056237.5568; val_optim_loss: 3056237.5568
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9411; val_auprc_score: 0.9878; val_best_acc_score: 0.9384; val_best_f1_score: 0.9651; train_kl_reg_loss: 25358.0041; train_edge_recon_loss: 686866.8313; train_cat_covariates_contrastive_loss: 478607.3925; train_gene_expr_recon_loss: 1812800.4056; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16405.3528; train_global_loss: 3020037.9851; train_optim_loss: 3020037.9851; val_kl_reg_loss: 26817.2453; val_edge_recon_loss: 736860.3717; val_cat_covariates_contrastive_loss: 478833.0687; val_gene_expr_recon_loss: 2073996.6508; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16839.7891; val_global_loss: 3333347.0717; val_optim_loss: 3333347.0717
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9335; val_auprc_score: 0.9860; val_best_acc_score: 0.9343; val_best_f1_score: 0.9629; train_kl_reg_loss: 221781.8516; train_edge_recon_loss: 691414.0484; train_cat_covariates_contrastive_loss: 479231.0650; train_gene_expr_recon_loss: 1921723.6000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16411.3874; train_global_loss: 3330561.9391; train_optim_loss: 3330561.9391; val_kl_reg_loss: 29494.0457; val_edge_recon_loss: 713273.5249; val_cat_covariates_contrastive_loss: 478638.2326; val_gene_expr_recon_loss: 1842666.5275; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16242.3896; val_global_loss: 3080314.8226; val_optim_loss: 3080314.8226
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.9348; val_auprc_score: 0.9861; val_best_acc_score: 0.9373; val_best_f1_score: 0.9646; train_kl_reg_loss: 28562.2308; train_edge_recon_loss: 691420.6219; train_cat_covariates_contrastive_loss: 479322.9129; train_gene_expr_recon_loss: 1831793.4551; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16402.1854; train_global_loss: 3047501.4071; train_optim_loss: 3047501.4071; val_kl_reg_loss: 29088.2087; val_edge_recon_loss: 714410.6377; val_cat_covariates_contrastive_loss: 478908.4212; val_gene_expr_recon_loss: 1827505.7308; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16458.8633; val_global_loss: 3066371.7649; val_optim_loss: 3066371.7649
