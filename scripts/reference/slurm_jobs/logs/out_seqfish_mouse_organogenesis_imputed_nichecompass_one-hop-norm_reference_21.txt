[True]
Run timestamp: 27072023_082006_21.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'seqfish_mouse_organogenesis_imputed', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', '--n_neighbors', '4', '--filter_genes', '--n_hvg', '4000', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'one-hop-norm_reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--active_gp_thresh_ratio', '0.0', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '3000', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '5', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '-1', '--timestamp_suffix', '_21']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2324.
Number of gene programs after filtering and combining: 1818.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Filtering genes...
Starting with 29452 genes.
Keeping 29452 genes after filtering genes with expression in 0 cells.
Keeping 4032 highly variable or gene program relevant genes.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, gene_expr_recon_dist: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ENCODER -> n_input: 4032, n_cat_covariates_embed_input: 0, n_layers: 1, n_hidden: 1540, n_latent: 1540, n_addon_latent: 0, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED GENE EXPRESSION DECODER -> n_input: 1540, n_cat_covariates_embed_input: 3, n_addon_input: 0, n_output: 8064
ONE HOP GCN NORM NODE LABEL AGGREGATOR

--- INITIALIZING TRAINER ---
Number of training nodes: 47311
Number of validation nodes: 5257
Number of training edges: 109836
Number of validation edges: 12204
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.8217; val_auprc_score: 0.9578; val_best_acc_score: 0.8523; val_best_f1_score: 0.9203; train_kl_reg_loss: 210310.8516; train_edge_recon_loss: 117910.9661; train_gene_expr_recon_loss: 14110228.6744; train_masked_gp_l1_reg_loss: 8743.1613; train_group_lasso_reg_loss: 0.0000; train_global_loss: 14447193.7023; train_optim_loss: 14447193.7023; val_kl_reg_loss: 214256.1094; val_edge_recon_loss: 120119.3880; val_gene_expr_recon_loss: 10148539.0417; val_masked_gp_l1_reg_loss: 8725.9473; val_group_lasso_reg_loss: 0.0000; val_global_loss: 10491640.5000; val_optim_loss: 10491640.5000
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.8285; val_auprc_score: 0.9603; val_best_acc_score: 0.8606; val_best_f1_score: 0.9240; train_kl_reg_loss: 178733.3980; train_edge_recon_loss: 119637.3714; train_gene_expr_recon_loss: 9859683.2140; train_masked_gp_l1_reg_loss: 8667.0333; train_group_lasso_reg_loss: 0.0000; train_global_loss: 10166721.0140; train_optim_loss: 10166721.0140; val_kl_reg_loss: 152065.2995; val_edge_recon_loss: 120707.0465; val_gene_expr_recon_loss: 9547273.4167; val_masked_gp_l1_reg_loss: 8686.4639; val_group_lasso_reg_loss: 0.0000; val_global_loss: 9828731.8333; val_optim_loss: 9828731.8333
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.8439; val_auprc_score: 0.9669; val_best_acc_score: 0.8710; val_best_f1_score: 0.9290; train_kl_reg_loss: 137820.2624; train_edge_recon_loss: 118355.9165; train_gene_expr_recon_loss: 9299321.0977; train_masked_gp_l1_reg_loss: 8754.0102; train_group_lasso_reg_loss: 0.0000; train_global_loss: 9564251.2744; train_optim_loss: 9564251.2744; val_kl_reg_loss: 125867.3708; val_edge_recon_loss: 118135.2337; val_gene_expr_recon_loss: 9081114.4167; val_masked_gp_l1_reg_loss: 8875.9160; val_group_lasso_reg_loss: 0.0000; val_global_loss: 9333992.9583; val_optim_loss: 9333992.9583
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.8511; val_auprc_score: 0.9688; val_best_acc_score: 0.8702; val_best_f1_score: 0.9284; train_kl_reg_loss: 116770.0228; train_edge_recon_loss: 118256.1791; train_gene_expr_recon_loss: 8909648.4512; train_masked_gp_l1_reg_loss: 9020.7797; train_group_lasso_reg_loss: 0.0000; train_global_loss: 9153695.4605; train_optim_loss: 9153695.4605; val_kl_reg_loss: 108899.3154; val_edge_recon_loss: 116471.6553; val_gene_expr_recon_loss: 8752051.7500; val_masked_gp_l1_reg_loss: 9138.3691; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8986560.6667; val_optim_loss: 8986560.6667
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.8550; val_auprc_score: 0.9694; val_best_acc_score: 0.8672; val_best_f1_score: 0.9272; train_kl_reg_loss: 102973.1018; train_edge_recon_loss: 116539.9340; train_gene_expr_recon_loss: 8630517.2140; train_masked_gp_l1_reg_loss: 9247.3156; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8859277.5814; train_optim_loss: 8859277.5814; val_kl_reg_loss: 96947.6074; val_edge_recon_loss: 115018.1722; val_gene_expr_recon_loss: 8510086.0833; val_masked_gp_l1_reg_loss: 9358.0967; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8731409.9583; val_optim_loss: 8731409.9583
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.8659; val_auprc_score: 0.9733; val_best_acc_score: 0.8693; val_best_f1_score: 0.9282; train_kl_reg_loss: 92215.2043; train_edge_recon_loss: 115781.6539; train_gene_expr_recon_loss: 8412448.2814; train_masked_gp_l1_reg_loss: 9502.2027; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8629947.2977; train_optim_loss: 8629947.2977; val_kl_reg_loss: 87989.9004; val_edge_recon_loss: 113057.3441; val_gene_expr_recon_loss: 8312783.8333; val_masked_gp_l1_reg_loss: 9666.2910; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8523497.0833; val_optim_loss: 8523497.0833
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.8712; val_auprc_score: 0.9751; val_best_acc_score: 0.8666; val_best_f1_score: 0.9270; train_kl_reg_loss: 83909.6472; train_edge_recon_loss: 114145.6887; train_gene_expr_recon_loss: 8223453.2721; train_masked_gp_l1_reg_loss: 9835.5948; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8431344.2140; train_optim_loss: 8431344.2140; val_kl_reg_loss: 80085.9743; val_edge_recon_loss: 112783.2988; val_gene_expr_recon_loss: 8136690.1250; val_masked_gp_l1_reg_loss: 10008.8877; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8339568.3125; val_optim_loss: 8339568.3125
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.8728; val_auprc_score: 0.9740; val_best_acc_score: 0.8626; val_best_f1_score: 0.9242; train_kl_reg_loss: 77162.1228; train_edge_recon_loss: 114522.6136; train_gene_expr_recon_loss: 8057265.4023; train_masked_gp_l1_reg_loss: 10162.8599; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8259113.0047; train_optim_loss: 8259113.0047; val_kl_reg_loss: 73783.5895; val_edge_recon_loss: 116364.2122; val_gene_expr_recon_loss: 7985155.5417; val_masked_gp_l1_reg_loss: 10301.0430; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8185604.3125; val_optim_loss: 8185604.3125
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.8801; val_auprc_score: 0.9764; val_best_acc_score: 0.8666; val_best_f1_score: 0.9262; train_kl_reg_loss: 71543.2811; train_edge_recon_loss: 113477.1301; train_gene_expr_recon_loss: 7910343.5860; train_masked_gp_l1_reg_loss: 10429.3198; train_group_lasso_reg_loss: 0.0000; train_global_loss: 8105793.3140; train_optim_loss: 8105793.3140; val_kl_reg_loss: 68705.6966; val_edge_recon_loss: 113390.6175; val_gene_expr_recon_loss: 7843461.2292; val_masked_gp_l1_reg_loss: 10551.4209; val_group_lasso_reg_loss: 0.0000; val_global_loss: 8036109.0417; val_optim_loss: 8036109.0417
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.8821; val_auprc_score: 0.9761; val_best_acc_score: 0.8646; val_best_f1_score: 0.9252; train_kl_reg_loss: 66856.6282; train_edge_recon_loss: 114261.8392; train_gene_expr_recon_loss: 7781353.8163; train_masked_gp_l1_reg_loss: 10675.8421; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7973148.1163; train_optim_loss: 7973148.1163; val_kl_reg_loss: 64441.6284; val_edge_recon_loss: 115845.1989; val_gene_expr_recon_loss: 7724363.0000; val_masked_gp_l1_reg_loss: 10796.8867; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7915446.8333; val_optim_loss: 7915446.8333
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.8908; val_auprc_score: 0.9778; val_best_acc_score: 0.8667; val_best_f1_score: 0.9253; train_kl_reg_loss: 62881.0517; train_edge_recon_loss: 113271.1733; train_gene_expr_recon_loss: 7666067.7535; train_masked_gp_l1_reg_loss: 10925.3110; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7853145.3047; train_optim_loss: 7853145.3047; val_kl_reg_loss: 60805.9574; val_edge_recon_loss: 114924.9287; val_gene_expr_recon_loss: 7613868.7292; val_masked_gp_l1_reg_loss: 11051.3184; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7800651.1250; val_optim_loss: 7800651.1250
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.8935; val_auprc_score: 0.9798; val_best_acc_score: 0.8699; val_best_f1_score: 0.9272; train_kl_reg_loss: 59236.3352; train_edge_recon_loss: 113084.8241; train_gene_expr_recon_loss: 7561652.4907; train_masked_gp_l1_reg_loss: 11156.1767; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7745129.8256; train_optim_loss: 7745129.8256; val_kl_reg_loss: 57477.8880; val_edge_recon_loss: 111501.5804; val_gene_expr_recon_loss: 7514670.5208; val_masked_gp_l1_reg_loss: 11254.5166; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7694904.4792; val_optim_loss: 7694904.4792
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.8916; val_auprc_score: 0.9789; val_best_acc_score: 0.8676; val_best_f1_score: 0.9261; train_kl_reg_loss: 55868.1168; train_edge_recon_loss: 112942.6508; train_gene_expr_recon_loss: 7470426.2279; train_masked_gp_l1_reg_loss: 11350.9832; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7650587.9907; train_optim_loss: 7650587.9907; val_kl_reg_loss: 53824.6395; val_edge_recon_loss: 112803.9277; val_gene_expr_recon_loss: 7438865.8750; val_masked_gp_l1_reg_loss: 11445.5283; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7616939.8958; val_optim_loss: 7616939.8958
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.8886; val_auprc_score: 0.9778; val_best_acc_score: 0.8688; val_best_f1_score: 0.9276; train_kl_reg_loss: 52743.5227; train_edge_recon_loss: 111644.6018; train_gene_expr_recon_loss: 7386381.4465; train_masked_gp_l1_reg_loss: 11533.1397; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7562302.6791; train_optim_loss: 7562302.6791; val_kl_reg_loss: 51227.3875; val_edge_recon_loss: 110732.9196; val_gene_expr_recon_loss: 7347885.8125; val_masked_gp_l1_reg_loss: 11620.3789; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7521466.6042; val_optim_loss: 7521466.6042
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.8888; val_auprc_score: 0.9775; val_best_acc_score: 0.8643; val_best_f1_score: 0.9248; train_kl_reg_loss: 49936.0842; train_edge_recon_loss: 111844.7391; train_gene_expr_recon_loss: 7311312.2419; train_masked_gp_l1_reg_loss: 11708.2655; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7484801.3302; train_optim_loss: 7484801.3302; val_kl_reg_loss: 48709.5210; val_edge_recon_loss: 114323.5811; val_gene_expr_recon_loss: 7276433.7500; val_masked_gp_l1_reg_loss: 11796.4473; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7451263.3750; val_optim_loss: 7451263.3750
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.8919; val_auprc_score: 0.9781; val_best_acc_score: 0.8691; val_best_f1_score: 0.9268; train_kl_reg_loss: 47195.7477; train_edge_recon_loss: 111265.4468; train_gene_expr_recon_loss: 7249511.4093; train_masked_gp_l1_reg_loss: 11909.8984; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7419882.5116; train_optim_loss: 7419882.5116; val_kl_reg_loss: 46168.0570; val_edge_recon_loss: 111743.4541; val_gene_expr_recon_loss: 7207799.9583; val_masked_gp_l1_reg_loss: 11981.1475; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7377692.5417; val_optim_loss: 7377692.5417
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.8885; val_auprc_score: 0.9775; val_best_acc_score: 0.8645; val_best_f1_score: 0.9244; train_kl_reg_loss: 44993.4219; train_edge_recon_loss: 110848.8336; train_gene_expr_recon_loss: 7181751.6302; train_masked_gp_l1_reg_loss: 12056.0404; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7349649.9233; train_optim_loss: 7349649.9233; val_kl_reg_loss: 43381.8696; val_edge_recon_loss: 113480.0052; val_gene_expr_recon_loss: 7163752.0417; val_masked_gp_l1_reg_loss: 12134.5234; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7332748.3958; val_optim_loss: 7332748.3958
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.8882; val_auprc_score: 0.9772; val_best_acc_score: 0.8669; val_best_f1_score: 0.9264; train_kl_reg_loss: 42878.7039; train_edge_recon_loss: 110704.8897; train_gene_expr_recon_loss: 7119844.8326; train_masked_gp_l1_reg_loss: 12216.7616; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7285645.1884; train_optim_loss: 7285645.1884; val_kl_reg_loss: 41582.5734; val_edge_recon_loss: 109978.5312; val_gene_expr_recon_loss: 7090906.2917; val_masked_gp_l1_reg_loss: 12293.9727; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7254761.4167; val_optim_loss: 7254761.4167
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.8945; val_auprc_score: 0.9789; val_best_acc_score: 0.8672; val_best_f1_score: 0.9266; train_kl_reg_loss: 40876.2716; train_edge_recon_loss: 110189.8795; train_gene_expr_recon_loss: 7064840.3814; train_masked_gp_l1_reg_loss: 12374.6905; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7228281.2070; train_optim_loss: 7228281.2070; val_kl_reg_loss: 39590.2682; val_edge_recon_loss: 111062.8522; val_gene_expr_recon_loss: 7043224.6875; val_masked_gp_l1_reg_loss: 12458.7490; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7206336.2500; val_optim_loss: 7206336.2500
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.8894; val_auprc_score: 0.9786; val_best_acc_score: 0.8705; val_best_f1_score: 0.9282; train_kl_reg_loss: 39008.6224; train_edge_recon_loss: 108851.4582; train_gene_expr_recon_loss: 7013535.0767; train_masked_gp_l1_reg_loss: 12542.1717; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7173937.3116; train_optim_loss: 7173937.3116; val_kl_reg_loss: 38055.6357; val_edge_recon_loss: 108267.5605; val_gene_expr_recon_loss: 6987841.2917; val_masked_gp_l1_reg_loss: 12622.5020; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7146786.9792; val_optim_loss: 7146786.9792
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.8949; val_auprc_score: 0.9788; val_best_acc_score: 0.8698; val_best_f1_score: 0.9275; train_kl_reg_loss: 37313.6395; train_edge_recon_loss: 110060.8327; train_gene_expr_recon_loss: 6967501.5349; train_masked_gp_l1_reg_loss: 12704.5233; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7127580.5535; train_optim_loss: 7127580.5535; val_kl_reg_loss: 36592.3276; val_edge_recon_loss: 109841.8737; val_gene_expr_recon_loss: 6943352.3542; val_masked_gp_l1_reg_loss: 12786.9248; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7102573.5833; val_optim_loss: 7102573.5833
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.9002; val_auprc_score: 0.9793; val_best_acc_score: 0.8766; val_best_f1_score: 0.9302; train_kl_reg_loss: 35805.7334; train_edge_recon_loss: 108719.6379; train_gene_expr_recon_loss: 6923821.7395; train_masked_gp_l1_reg_loss: 12863.8318; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7081210.9535; train_optim_loss: 7081210.9535; val_kl_reg_loss: 35239.2272; val_edge_recon_loss: 107962.3669; val_gene_expr_recon_loss: 6901094.9792; val_masked_gp_l1_reg_loss: 12939.2480; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7057235.5833; val_optim_loss: 7057235.5833
Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.8979; val_auprc_score: 0.9798; val_best_acc_score: 0.8796; val_best_f1_score: 0.9324; train_kl_reg_loss: 34601.3711; train_edge_recon_loss: 107550.5868; train_gene_expr_recon_loss: 6882033.4767; train_masked_gp_l1_reg_loss: 13020.5614; train_group_lasso_reg_loss: 0.0000; train_global_loss: 7037205.9884; train_optim_loss: 7037205.9884; val_kl_reg_loss: 34100.1497; val_edge_recon_loss: 106758.6146; val_gene_expr_recon_loss: 6862237.3750; val_masked_gp_l1_reg_loss: 13098.9111; val_group_lasso_reg_loss: 0.0000; val_global_loss: 7016195.1458; val_optim_loss: 7016195.1458
