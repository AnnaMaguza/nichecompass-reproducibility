[True, False, True]
Run timestamp: 05092023_121353_6.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch5', 'batch6', 'batch7', 'batch8', '--n_neighbors', '4', '--no-filter_genes', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--cat_covariates_keys', 'batch', 'fov', 'patient', '--cat_covariates_no_edges', 'True', 'False', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '100', '--active_gp_thresh_ratio', '0.03', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '30', '5', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '500000.0', '--contrastive_logits_pos_ratio', '0.015625', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--lambda_l1_addon', '1000.', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_6']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch7...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch8...
Loading data...
Computing spatial neighborhood graph...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 38, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 556628
Number of validation nodes: 61848
Number of training edges: 1316511
Number of validation edges: 146278
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9016; val_auprc_score: 0.9805; val_best_acc_score: 0.9193; val_best_f1_score: 0.9548; train_kl_reg_loss: 16947.5027; train_edge_recon_loss: 722249.3804; train_cat_covariates_contrastive_loss: 478221.0511; train_gene_expr_recon_loss: 2557912.8273; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 58052.6760; train_global_loss: 3833383.4328; train_optim_loss: 3833383.4328; val_kl_reg_loss: 17087.2088; val_edge_recon_loss: 724684.0039; val_cat_covariates_contrastive_loss: 478374.4810; val_gene_expr_recon_loss: 2234039.6941; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 14183.3496; val_global_loss: 3468368.6469; val_optim_loss: 3468368.6469
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9169; val_auprc_score: 0.9835; val_best_acc_score: 0.9275; val_best_f1_score: 0.9594; train_kl_reg_loss: 19034.5006; train_edge_recon_loss: 696590.5974; train_cat_covariates_contrastive_loss: 477991.9246; train_gene_expr_recon_loss: 2092604.1850; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 14503.6370; train_global_loss: 3300724.8438; train_optim_loss: 3300724.8438; val_kl_reg_loss: 19832.1427; val_edge_recon_loss: 714891.6840; val_cat_covariates_contrastive_loss: 479201.8443; val_gene_expr_recon_loss: 2014382.9462; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 14553.0264; val_global_loss: 3242861.6066; val_optim_loss: 3242861.6066
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9222; val_auprc_score: 0.9847; val_best_acc_score: 0.9290; val_best_f1_score: 0.9600; train_kl_reg_loss: 20954.0959; train_edge_recon_loss: 694335.2086; train_cat_covariates_contrastive_loss: 478300.5167; train_gene_expr_recon_loss: 1971095.7426; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 14836.4547; train_global_loss: 3179522.0190; train_optim_loss: 3179522.0190; val_kl_reg_loss: 21010.6939; val_edge_recon_loss: 721915.7439; val_cat_covariates_contrastive_loss: 479047.9395; val_gene_expr_recon_loss: 1954355.2111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 14889.0029; val_global_loss: 3191218.5883; val_optim_loss: 3191218.5883
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9276; val_auprc_score: 0.9858; val_best_acc_score: 0.9318; val_best_f1_score: 0.9617; train_kl_reg_loss: 21861.5500; train_edge_recon_loss: 691531.0138; train_cat_covariates_contrastive_loss: 478296.7197; train_gene_expr_recon_loss: 1925175.5942; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15246.9660; train_global_loss: 3132111.8456; train_optim_loss: 3132111.8456; val_kl_reg_loss: 21515.9751; val_edge_recon_loss: 712016.3920; val_cat_covariates_contrastive_loss: 479512.4149; val_gene_expr_recon_loss: 1923365.9921; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15333.3193; val_global_loss: 3151744.0288; val_optim_loss: 3151744.0288
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9223; val_auprc_score: 0.9843; val_best_acc_score: 0.9298; val_best_f1_score: 0.9606; train_kl_reg_loss: 22523.2742; train_edge_recon_loss: 689749.5205; train_cat_covariates_contrastive_loss: 478479.0966; train_gene_expr_recon_loss: 1898301.4418; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15623.0668; train_global_loss: 3104676.4008; train_optim_loss: 3104676.4008; val_kl_reg_loss: 23325.8817; val_edge_recon_loss: 713774.3879; val_cat_covariates_contrastive_loss: 477599.6420; val_gene_expr_recon_loss: 1898649.2247; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15666.1650; val_global_loss: 3129015.3846; val_optim_loss: 3129015.3846
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9274; val_auprc_score: 0.9855; val_best_acc_score: 0.9321; val_best_f1_score: 0.9619; train_kl_reg_loss: 23140.3499; train_edge_recon_loss: 692762.1423; train_cat_covariates_contrastive_loss: 478684.7523; train_gene_expr_recon_loss: 1881221.9332; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 15915.6905; train_global_loss: 3091724.8708; train_optim_loss: 3091724.8708; val_kl_reg_loss: 23109.1089; val_edge_recon_loss: 712994.0116; val_cat_covariates_contrastive_loss: 479574.7308; val_gene_expr_recon_loss: 1881977.2609; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 15936.8301; val_global_loss: 3113591.8566; val_optim_loss: 3113591.8566
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9267; val_auprc_score: 0.9851; val_best_acc_score: 0.9321; val_best_f1_score: 0.9617; train_kl_reg_loss: 23627.6127; train_edge_recon_loss: 687537.5331; train_cat_covariates_contrastive_loss: 478886.6406; train_gene_expr_recon_loss: 1865449.5942; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16194.9221; train_global_loss: 3071696.3024; train_optim_loss: 3071696.3024; val_kl_reg_loss: 24058.7252; val_edge_recon_loss: 717298.7012; val_cat_covariates_contrastive_loss: 478572.8797; val_gene_expr_recon_loss: 1866858.4480; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16399.6113; val_global_loss: 3103188.2552; val_optim_loss: 3103188.2552
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9233; val_auprc_score: 0.9841; val_best_acc_score: 0.9323; val_best_f1_score: 0.9619; train_kl_reg_loss: 24072.5808; train_edge_recon_loss: 688909.3972; train_cat_covariates_contrastive_loss: 479062.6065; train_gene_expr_recon_loss: 1854186.9110; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16389.8812; train_global_loss: 3062621.3790; train_optim_loss: 3062621.3790; val_kl_reg_loss: 25486.2088; val_edge_recon_loss: 712392.5491; val_cat_covariates_contrastive_loss: 477455.4559; val_gene_expr_recon_loss: 1857841.8129; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16521.8438; val_global_loss: 3089697.7736; val_optim_loss: 3089697.7736
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.9308; val_auprc_score: 0.9863; val_best_acc_score: 0.9348; val_best_f1_score: 0.9633; train_kl_reg_loss: 24540.9611; train_edge_recon_loss: 690331.6843; train_cat_covariates_contrastive_loss: 479153.0492; train_gene_expr_recon_loss: 1846014.5097; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16524.8590; train_global_loss: 3056565.0608; train_optim_loss: 3056565.0608; val_kl_reg_loss: 25272.4245; val_edge_recon_loss: 704000.0479; val_cat_covariates_contrastive_loss: 478270.4396; val_gene_expr_recon_loss: 1854354.6390; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16500.5938; val_global_loss: 3078398.0481; val_optim_loss: 3078398.0481
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.9296; val_auprc_score: 0.9855; val_best_acc_score: 0.9340; val_best_f1_score: 0.9628; train_kl_reg_loss: 24892.7914; train_edge_recon_loss: 688328.3328; train_cat_covariates_contrastive_loss: 479250.1037; train_gene_expr_recon_loss: 1837216.8099; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16623.9340; train_global_loss: 3046311.9694; train_optim_loss: 3046311.9694; val_kl_reg_loss: 25380.1552; val_edge_recon_loss: 718942.7633; val_cat_covariates_contrastive_loss: 478606.7873; val_gene_expr_recon_loss: 1841740.3112; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16661.3242; val_global_loss: 3081331.2675; val_optim_loss: 3081331.2675
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.9316; val_auprc_score: 0.9863; val_best_acc_score: 0.9346; val_best_f1_score: 0.9632; train_kl_reg_loss: 25168.8869; train_edge_recon_loss: 689835.2643; train_cat_covariates_contrastive_loss: 479411.3141; train_gene_expr_recon_loss: 1830455.1007; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16672.7310; train_global_loss: 3041543.2973; train_optim_loss: 3041543.2973; val_kl_reg_loss: 25062.3209; val_edge_recon_loss: 709199.6368; val_cat_covariates_contrastive_loss: 479561.0091; val_gene_expr_recon_loss: 1838002.2539; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16775.5234; val_global_loss: 3068600.7185; val_optim_loss: 3068600.7185
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.9331; val_auprc_score: 0.9865; val_best_acc_score: 0.9372; val_best_f1_score: 0.9646; train_kl_reg_loss: 25413.4204; train_edge_recon_loss: 692304.4355; train_cat_covariates_contrastive_loss: 479475.9340; train_gene_expr_recon_loss: 1826498.4500; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16759.6519; train_global_loss: 3040451.8941; train_optim_loss: 3040451.8941; val_kl_reg_loss: 26333.1213; val_edge_recon_loss: 711035.9679; val_cat_covariates_contrastive_loss: 478985.0928; val_gene_expr_recon_loss: 1833827.1897; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16659.1367; val_global_loss: 3066840.6154; val_optim_loss: 3066840.6154
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.9340; val_auprc_score: 0.9868; val_best_acc_score: 0.9340; val_best_f1_score: 0.9627; train_kl_reg_loss: 25588.2221; train_edge_recon_loss: 693187.5369; train_cat_covariates_contrastive_loss: 479634.1865; train_gene_expr_recon_loss: 1821124.3025; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16773.8696; train_global_loss: 3036308.1228; train_optim_loss: 3036308.1228; val_kl_reg_loss: 25097.7563; val_edge_recon_loss: 712436.3295; val_cat_covariates_contrastive_loss: 480270.1903; val_gene_expr_recon_loss: 1828477.8523; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16729.7676; val_global_loss: 3063011.8733; val_optim_loss: 3063011.8733
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.9350; val_auprc_score: 0.9872; val_best_acc_score: 0.9358; val_best_f1_score: 0.9637; train_kl_reg_loss: 25678.7109; train_edge_recon_loss: 689098.4451; train_cat_covariates_contrastive_loss: 479605.7681; train_gene_expr_recon_loss: 1817429.2379; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16863.4741; train_global_loss: 3028675.6354; train_optim_loss: 3028675.6354; val_kl_reg_loss: 25749.7242; val_edge_recon_loss: 709721.5493; val_cat_covariates_contrastive_loss: 480168.4427; val_gene_expr_recon_loss: 1828049.5621; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16854.5840; val_global_loss: 3060543.7780; val_optim_loss: 3060543.7780
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.9356; val_auprc_score: 0.9869; val_best_acc_score: 0.9367; val_best_f1_score: 0.9643; train_kl_reg_loss: 25855.0751; train_edge_recon_loss: 688834.0773; train_cat_covariates_contrastive_loss: 479526.0480; train_gene_expr_recon_loss: 1812267.8984; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16918.9573; train_global_loss: 3023402.0546; train_optim_loss: 3023402.0546; val_kl_reg_loss: 25451.2956; val_edge_recon_loss: 716890.7461; val_cat_covariates_contrastive_loss: 479414.1329; val_gene_expr_recon_loss: 1818679.4283; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17022.5352; val_global_loss: 3057458.1093; val_optim_loss: 3057458.1093
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.9333; val_auprc_score: 0.9862; val_best_acc_score: 0.9378; val_best_f1_score: 0.9650; train_kl_reg_loss: 26007.9457; train_edge_recon_loss: 689827.2030; train_cat_covariates_contrastive_loss: 479654.2688; train_gene_expr_recon_loss: 1811631.8295; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 16976.3506; train_global_loss: 3024097.5992; train_optim_loss: 3024097.5992; val_kl_reg_loss: 27049.3999; val_edge_recon_loss: 713538.2651; val_cat_covariates_contrastive_loss: 478358.1286; val_gene_expr_recon_loss: 1815777.4952; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17126.1934; val_global_loss: 3051849.5455; val_optim_loss: 3051849.5455
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.9321; val_auprc_score: 0.9861; val_best_acc_score: 0.9365; val_best_f1_score: 0.9642; train_kl_reg_loss: 26258.6049; train_edge_recon_loss: 689204.4557; train_cat_covariates_contrastive_loss: 479693.0515; train_gene_expr_recon_loss: 1810932.2042; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17005.5746; train_global_loss: 3023093.8914; train_optim_loss: 3023093.8914; val_kl_reg_loss: 27119.0968; val_edge_recon_loss: 710308.2147; val_cat_covariates_contrastive_loss: 478577.7315; val_gene_expr_recon_loss: 1816075.9685; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 16953.0586; val_global_loss: 3049034.0175; val_optim_loss: 3049034.0175
