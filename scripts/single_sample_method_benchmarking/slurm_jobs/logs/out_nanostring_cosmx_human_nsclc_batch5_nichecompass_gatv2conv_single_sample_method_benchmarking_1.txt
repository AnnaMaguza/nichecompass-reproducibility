Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.9863; val_auprc_score: 0.9833; val_best_acc_score: 0.9467; val_best_f1_score: 0.9474; train_kl_reg_loss: 27449.3605; train_edge_recon_loss: 2615315.5579; train_gene_expr_recon_loss: 1966307.4358; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4609072.3515; train_optim_loss: 4609072.3515; val_kl_reg_loss: 27500.5866; val_edge_recon_loss: 2644852.4420; val_gene_expr_recon_loss: 1995044.2989; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4667397.3116; val_optim_loss: 4667397.3116
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.9848; val_auprc_score: 0.9804; val_best_acc_score: 0.9461; val_best_f1_score: 0.9470; train_kl_reg_loss: 27337.7995; train_edge_recon_loss: 2614946.8830; train_gene_expr_recon_loss: 1960151.7416; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4602436.4299; train_optim_loss: 4602436.4299; val_kl_reg_loss: 27596.7564; val_edge_recon_loss: 2640119.0833; val_gene_expr_recon_loss: 1987768.6232; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4655484.4855; val_optim_loss: 4655484.4855
Run timestamp: 18082023_185135_1.
Script arguments:
['../train_nichecompass_benchmarking_models.py', '--adata_new_name', 'None', '--n_neighbors_list', '8', '8', '4', '4', '--edge_batch_size_list', '512', '512', '512', '512', '--node_batch_size_list', 'None', 'None', 'None', 'None', '--seeds', '3', '2', '1', '0', '--run_index', '4', '3', '2', '1', '--cell_type_key', 'cell_type', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'human', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--dataset', 'nanostring_cosmx_human_nsclc_batch5', '--reference_batches', 'None', '--counts_key', 'counts', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--no-filter_genes', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'gatv2conv_single_sample_method_benchmarking', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '10', '--active_gp_thresh_ratio', '0.', '--gene_expr_recon_dist', 'nb', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--lambda_l1_addon', '0.', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_1']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2264.
Number of gene programs after filtering and combining: 1691.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.0
LOG VARIATIONAL -> True
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 10, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 10, n_cat_covariates_embed_input: 0, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 69652
Number of validation nodes: 7739
Number of training edges: 313451
Number of validation edges: 34827
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.9325; val_auprc_score: 0.9206; val_best_acc_score: 0.8593; val_best_f1_score: 0.8682; train_kl_reg_loss: 22241.0327; train_edge_recon_loss: 2806467.1937; train_gene_expr_recon_loss: 3049881.1109; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5878589.3442; train_optim_loss: 5878589.3442; val_kl_reg_loss: 24029.6797; val_edge_recon_loss: 2731714.8949; val_gene_expr_recon_loss: 2862748.6558; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5618493.2246; val_optim_loss: 5618493.2246
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.9530; val_auprc_score: 0.9440; val_best_acc_score: 0.8890; val_best_f1_score: 0.8947; train_kl_reg_loss: 22837.6373; train_edge_recon_loss: 2676368.6232; train_gene_expr_recon_loss: 2787890.3153; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5487096.5718; train_optim_loss: 5487096.5718; val_kl_reg_loss: 22973.8987; val_edge_recon_loss: 2694863.4928; val_gene_expr_recon_loss: 2717925.8297; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5435763.2319; val_optim_loss: 5435763.2319
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.9628; val_auprc_score: 0.9553; val_best_acc_score: 0.9034; val_best_f1_score: 0.9075; train_kl_reg_loss: 22284.4552; train_edge_recon_loss: 2659327.6436; train_gene_expr_recon_loss: 2652632.1301; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5334244.2219; train_optim_loss: 5334244.2219; val_kl_reg_loss: 21095.7452; val_edge_recon_loss: 2675867.9094; val_gene_expr_recon_loss: 2579369.8514; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5276333.5145; val_optim_loss: 5276333.5145
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.9716; val_auprc_score: 0.9660; val_best_acc_score: 0.9177; val_best_f1_score: 0.9198; train_kl_reg_loss: 21687.0801; train_edge_recon_loss: 2644226.1264; train_gene_expr_recon_loss: 2510374.4935; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5176287.7080; train_optim_loss: 5176287.7080; val_kl_reg_loss: 21871.4135; val_edge_recon_loss: 2669078.6014; val_gene_expr_recon_loss: 2430445.5109; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5121395.4855; val_optim_loss: 5121395.4855
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.9755; val_auprc_score: 0.9704; val_best_acc_score: 0.9248; val_best_f1_score: 0.9268; train_kl_reg_loss: 22723.6158; train_edge_recon_loss: 2639127.9042; train_gene_expr_recon_loss: 2382239.2551; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5044090.7716; train_optim_loss: 5044090.7716; val_kl_reg_loss: 24318.1306; val_edge_recon_loss: 2665165.4420; val_gene_expr_recon_loss: 2325946.7138; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5015430.2246; val_optim_loss: 5015430.2246
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.9752; val_auprc_score: 0.9694; val_best_acc_score: 0.9264; val_best_f1_score: 0.9284; train_kl_reg_loss: 23955.9201; train_edge_recon_loss: 2635491.7708; train_gene_expr_recon_loss: 2287677.0783; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4947124.7684; train_optim_loss: 4947124.7684; val_kl_reg_loss: 24562.7961; val_edge_recon_loss: 2660360.2029; val_gene_expr_recon_loss: 2257108.3949; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4942031.3696; val_optim_loss: 4942031.3696
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.9771; val_auprc_score: 0.9713; val_best_acc_score: 0.9297; val_best_f1_score: 0.9313; train_kl_reg_loss: 25031.5173; train_edge_recon_loss: 2629730.3740; train_gene_expr_recon_loss: 2211564.5924; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4866326.4804; train_optim_loss: 4866326.4804; val_kl_reg_loss: 25991.3524; val_edge_recon_loss: 2657556.4058; val_gene_expr_recon_loss: 2188289.7464; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4871837.5217; val_optim_loss: 4871837.5217
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.9781; val_auprc_score: 0.9737; val_best_acc_score: 0.9309; val_best_f1_score: 0.9329; train_kl_reg_loss: 25723.4733; train_edge_recon_loss: 2629874.9910; train_gene_expr_recon_loss: 2160103.9649; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 4815702.4290; train_optim_loss: 4815702.4290; val_kl_reg_loss: 26934.5229; val_edge_recon_loss: 2656036.6159; val_gene_expr_recon_loss: 2148932.9710; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 4831904.1014; val_optim_loss: 4831904.1014
