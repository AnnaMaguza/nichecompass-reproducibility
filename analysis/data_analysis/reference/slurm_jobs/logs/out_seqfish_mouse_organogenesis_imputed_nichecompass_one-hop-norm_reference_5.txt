[True]
Run timestamp: 01082024_160515_5.
Script arguments:
['../train_nichecompass_reference_model.py', '--dataset', 'seqfish_mouse_organogenesis_imputed', '--reference_batches', 'batch1', 'batch2', 'batch3', 'batch4', 'batch5', 'batch6', '--n_neighbors', '12', '--filter_genes', '--n_hvg', '0', '--n_svg', '5000', '--nichenet_keep_target_genes_ratio', '1.0', '--nichenet_max_n_target_genes_per_gp', '250', '--include_mebocost_gps', '--species', 'mouse', '--gp_filter_mode', 'subset', '--combine_overlap_gps', '--overlap_thresh_source_genes', '0.9', '--overlap_thresh_target_genes', '0.9', '--overlap_thresh_genes', '0.9', '--counts_key', 'counts', '--condition_key', 'batch', '--cat_covariates_keys', 'batch', '--cat_covariates_no_edges', 'True', '--spatial_key', 'spatial', '--adj_key', 'spatial_connectivities', '--mapping_entity_key', 'mapping_entity', '--gp_targets_mask_key', 'nichecompass_gp_targets', '--gp_sources_mask_key', 'nichecompass_gp_sources', '--gp_names_key', 'nichecompass_gp_names', '--model_label', 'reference', '--active_gp_names_key', 'nichecompass_active_gp_names', '--latent_key', 'nichecompass_latent', '--n_addon_gp', '100', '--active_gp_thresh_ratio', '0.01', '--gene_expr_recon_dist', 'nb', '--cat_covariates_embeds_injection', 'gene_expr_decoder', '--cat_covariates_embeds_nums', '3', '--log_variational', '--node_label_method', 'one-hop-norm', '--n_layers_encoder', '1', '--n_hidden_encoder', 'None', '--conv_layer_encoder', 'gatv2conv', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000', '--lambda_gene_expr_recon', '300', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0', '--lambda_l1_addon', '30.0', '--edge_batch_size', '256', '--node_batch_size', 'None', '--n_sampled_neighbors', '4', '--timestamp_suffix', '_5']

Preparing the gene program mask...
Number of gene programs before filtering and combining: 2444.
Number of gene programs after filtering and combining: 2109.

Processing batch batch1...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch2...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Filtering genes...
Starting with 29239 genes.
Keeping 8574 genes after filtering genes with expression in {} cells.
Keeping 5000 spatially variable, highly variable or gene program relevant genes.

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.01
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 5000, n_cat_covariates_embed_input: 0, n_hidden: 1958, n_latent: 1858, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, 
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1858, n_addon_gp_input: 100, n_cat_covariates_embed_input: 3, n_output: 5000
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1858, n_addon_gp_input: 100, n_cat_covariates_embed_input: 3, n_output: 5000

--- INITIALIZING TRAINER ---
Number of training nodes: 47311
Number of validation nodes: 5257
Number of training edges: 319410
Number of validation edges: 35490
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.8910; val_auprc_score: 0.9779; val_best_acc_score: 0.8878; val_best_f1_score: 0.9367; train_kl_reg_loss: 42478.9817; train_edge_recon_loss: 109514.5553; train_gene_expr_recon_loss: 4282634.7350; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 204568.3234; train_global_loss: 4639196.5946; train_optim_loss: 4639196.5946; val_kl_reg_loss: 29702.8643; val_edge_recon_loss: 104473.3090; val_gene_expr_recon_loss: 3799794.1565; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 41271.7305; val_global_loss: 3975242.0719; val_optim_loss: 3975242.0719
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9375; val_auprc_score: 0.9864; val_best_acc_score: 0.9296; val_best_f1_score: 0.9594; train_kl_reg_loss: 25953.5670; train_edge_recon_loss: 99036.3222; train_gene_expr_recon_loss: 3595682.0156; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 30021.1513; train_global_loss: 3750693.0567; train_optim_loss: 3750693.0567; val_kl_reg_loss: 23090.6347; val_edge_recon_loss: 96703.5182; val_gene_expr_recon_loss: 3426432.4173; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 24984.4512; val_global_loss: 3571211.0719; val_optim_loss: 3571211.0719
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9532; val_auprc_score: 0.9895; val_best_acc_score: 0.9451; val_best_f1_score: 0.9684; train_kl_reg_loss: 20825.6789; train_edge_recon_loss: 93658.9354; train_gene_expr_recon_loss: 3314149.3608; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 24958.0470; train_global_loss: 3453592.0242; train_optim_loss: 3453592.0242; val_kl_reg_loss: 19093.6207; val_edge_recon_loss: 91288.1894; val_gene_expr_recon_loss: 3214575.9173; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 26081.2461; val_global_loss: 3351038.9748; val_optim_loss: 3351038.9748
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9577; val_auprc_score: 0.9900; val_best_acc_score: 0.9530; val_best_f1_score: 0.9727; train_kl_reg_loss: 17358.5941; train_edge_recon_loss: 89745.5062; train_gene_expr_recon_loss: 3148898.0312; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 27418.4335; train_global_loss: 3283420.5639; train_optim_loss: 3283420.5639; val_kl_reg_loss: 16457.7057; val_edge_recon_loss: 89265.3312; val_gene_expr_recon_loss: 3091148.4874; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 28699.5488; val_global_loss: 3225571.0360; val_optim_loss: 3225571.0360
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9621; val_auprc_score: 0.9910; val_best_acc_score: 0.9585; val_best_f1_score: 0.9761; train_kl_reg_loss: 15206.9424; train_edge_recon_loss: 86433.2512; train_gene_expr_recon_loss: 3052010.1753; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 29278.8883; train_global_loss: 3182929.2562; train_optim_loss: 3182929.2562; val_kl_reg_loss: 14581.2150; val_edge_recon_loss: 84340.3851; val_gene_expr_recon_loss: 3018534.0989; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 29798.7715; val_global_loss: 3147254.4496; val_optim_loss: 3147254.4496
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9658; val_auprc_score: 0.9918; val_best_acc_score: 0.9605; val_best_f1_score: 0.9772; train_kl_reg_loss: 13816.6809; train_edge_recon_loss: 84467.9430; train_gene_expr_recon_loss: 2997479.6334; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 29448.4699; train_global_loss: 3125212.7300; train_optim_loss: 3125212.7300; val_kl_reg_loss: 13658.8234; val_edge_recon_loss: 83353.8679; val_gene_expr_recon_loss: 2980987.4263; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 29103.9863; val_global_loss: 3107104.1169; val_optim_loss: 3107104.1169
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9653; val_auprc_score: 0.9918; val_best_acc_score: 0.9593; val_best_f1_score: 0.9765; train_kl_reg_loss: 12837.0678; train_edge_recon_loss: 83598.5544; train_gene_expr_recon_loss: 2967761.7296; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 28891.2965; train_global_loss: 3093088.6456; train_optim_loss: 3093088.6456; val_kl_reg_loss: 12665.0658; val_edge_recon_loss: 83046.9750; val_gene_expr_recon_loss: 2954038.6871; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 28448.1699; val_global_loss: 3078198.9730; val_optim_loss: 3078198.9730
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9671; val_auprc_score: 0.9928; val_best_acc_score: 0.9604; val_best_f1_score: 0.9771; train_kl_reg_loss: 12115.8650; train_edge_recon_loss: 82180.4851; train_gene_expr_recon_loss: 2949407.5994; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 28334.8870; train_global_loss: 3072038.8335; train_optim_loss: 3072038.8335; val_kl_reg_loss: 12042.6583; val_edge_recon_loss: 81325.7548; val_gene_expr_recon_loss: 2943726.8633; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 28254.1953; val_global_loss: 3065349.5216; val_optim_loss: 3065349.5216
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9675; val_auprc_score: 0.9921; val_best_acc_score: 0.9630; val_best_f1_score: 0.9785; train_kl_reg_loss: 11547.0748; train_edge_recon_loss: 81459.7215; train_gene_expr_recon_loss: 2938600.9040; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 28114.5226; train_global_loss: 3059722.2222; train_optim_loss: 3059722.2222; val_kl_reg_loss: 11326.8483; val_edge_recon_loss: 82112.4446; val_gene_expr_recon_loss: 2932945.8076; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 28138.4258; val_global_loss: 3054523.5971; val_optim_loss: 3054523.5971
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9703; val_auprc_score: 0.9930; val_best_acc_score: 0.9632; val_best_f1_score: 0.9787; train_kl_reg_loss: 11209.7435; train_edge_recon_loss: 80525.3089; train_gene_expr_recon_loss: 2932438.8125; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 28023.8265; train_global_loss: 3052197.6911; train_optim_loss: 3052197.6911; val_kl_reg_loss: 11154.0311; val_edge_recon_loss: 80977.4296; val_gene_expr_recon_loss: 2927588.0665; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 28066.0781; val_global_loss: 3047785.5414; val_optim_loss: 3047785.5414
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9610; val_auprc_score: 0.9912; val_best_acc_score: 0.9552; val_best_f1_score: 0.9742; train_kl_reg_loss: 10791.6938; train_edge_recon_loss: 81430.6428; train_gene_expr_recon_loss: 2939063.3425; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 29154.4795; train_global_loss: 3060440.1609; train_optim_loss: 3060440.1609; val_kl_reg_loss: 10233.9154; val_edge_recon_loss: 80326.8771; val_gene_expr_recon_loss: 2948760.5845; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 28408.7891; val_global_loss: 3067730.1187; val_optim_loss: 3067730.1187
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9656; val_auprc_score: 0.9916; val_best_acc_score: 0.9593; val_best_f1_score: 0.9764; train_kl_reg_loss: 10226.9018; train_edge_recon_loss: 80081.7100; train_gene_expr_recon_loss: 2941951.1376; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 26443.6398; train_global_loss: 3058703.3912; train_optim_loss: 3058703.3912; val_kl_reg_loss: 10286.0338; val_edge_recon_loss: 81077.1273; val_gene_expr_recon_loss: 2935717.9299; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 26213.9121; val_global_loss: 3053295.0917; val_optim_loss: 3053295.0917
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9639; val_auprc_score: 0.9917; val_best_acc_score: 0.9572; val_best_f1_score: 0.9753; train_kl_reg_loss: 10134.0346; train_edge_recon_loss: 79997.0137; train_gene_expr_recon_loss: 2937152.9147; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 25853.8539; train_global_loss: 3053137.8161; train_optim_loss: 3053137.8161; val_kl_reg_loss: 10097.1397; val_edge_recon_loss: 79694.6088; val_gene_expr_recon_loss: 2934976.1421; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 25506.1367; val_global_loss: 3050274.1385; val_optim_loss: 3050274.1385
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.9664; val_auprc_score: 0.9922; val_best_acc_score: 0.9589; val_best_f1_score: 0.9762; train_kl_reg_loss: 10043.9056; train_edge_recon_loss: 80071.6984; train_gene_expr_recon_loss: 2935326.5501; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 25616.2396; train_global_loss: 3051058.3978; train_optim_loss: 3051058.3978; val_kl_reg_loss: 9848.2504; val_edge_recon_loss: 81007.3264; val_gene_expr_recon_loss: 2932467.3291; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 25831.3633; val_global_loss: 3049154.1637; val_optim_loss: 3049154.1637

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.9661; val_auprc_score: 0.9922; val_best_acc_score: 0.9598; val_best_f1_score: 0.9768; train_kl_reg_loss: 10222.3852; train_edge_recon_loss: 79244.6687; train_gene_expr_recon_loss: 2924422.0721; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 20015.5063; train_global_loss: 3033904.6296; train_optim_loss: 3033904.6296; val_kl_reg_loss: 10537.5441; val_edge_recon_loss: 78956.0407; val_gene_expr_recon_loss: 2923661.1601; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 19292.6328; val_global_loss: 3032447.5108; val_optim_loss: 3032447.5108
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.9656; val_auprc_score: 0.9920; val_best_acc_score: 0.9590; val_best_f1_score: 0.9763; train_kl_reg_loss: 10788.6184; train_edge_recon_loss: 79689.5374; train_gene_expr_recon_loss: 2923569.1601; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18941.3358; train_global_loss: 3032988.6534; train_optim_loss: 3032988.6534; val_kl_reg_loss: 11071.5607; val_edge_recon_loss: 79922.4930; val_gene_expr_recon_loss: 2921722.2572; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18574.5996; val_global_loss: 3031290.8112; val_optim_loss: 3031290.8112
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.9707; val_auprc_score: 0.9932; val_best_acc_score: 0.9629; val_best_f1_score: 0.9785; train_kl_reg_loss: 11266.6377; train_edge_recon_loss: 79148.5492; train_gene_expr_recon_loss: 2923176.3389; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 18284.1183; train_global_loss: 3031875.6448; train_optim_loss: 3031875.6448; val_kl_reg_loss: 11553.2375; val_edge_recon_loss: 79526.4315; val_gene_expr_recon_loss: 2921304.4784; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 18052.8184; val_global_loss: 3030436.8921; val_optim_loss: 3030436.8921
Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.9696; val_auprc_score: 0.9929; val_best_acc_score: 0.9614; val_best_f1_score: 0.9776; train_kl_reg_loss: 11644.9650; train_edge_recon_loss: 79112.7985; train_gene_expr_recon_loss: 2922796.3069; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17850.3145; train_global_loss: 3031404.3806; train_optim_loss: 3031404.3806; val_kl_reg_loss: 11834.6722; val_edge_recon_loss: 79971.2459; val_gene_expr_recon_loss: 2920736.9892; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17697.9980; val_global_loss: 3030240.9029; val_optim_loss: 3030240.9029
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.9668; val_auprc_score: 0.9923; val_best_acc_score: 0.9599; val_best_f1_score: 0.9768; train_kl_reg_loss: 11927.3257; train_edge_recon_loss: 79069.3969; train_gene_expr_recon_loss: 2922119.3151; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17517.0967; train_global_loss: 3030633.1296; train_optim_loss: 3030633.1296; val_kl_reg_loss: 12102.1175; val_edge_recon_loss: 77913.8059; val_gene_expr_recon_loss: 2921273.0701; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17311.1289; val_global_loss: 3028600.2356; val_optim_loss: 3028600.2356
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.9697; val_auprc_score: 0.9928; val_best_acc_score: 0.9607; val_best_f1_score: 0.9772; train_kl_reg_loss: 12167.1361; train_edge_recon_loss: 79264.0299; train_gene_expr_recon_loss: 2921450.1560; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17247.7200; train_global_loss: 3030129.0429; train_optim_loss: 3030129.0429; val_kl_reg_loss: 12299.0464; val_edge_recon_loss: 79760.7697; val_gene_expr_recon_loss: 2920060.9568; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17107.1992; val_global_loss: 3029228.0234; val_optim_loss: 3029228.0234
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.9667; val_auprc_score: 0.9919; val_best_acc_score: 0.9609; val_best_f1_score: 0.9774; train_kl_reg_loss: 12347.7523; train_edge_recon_loss: 79415.8445; train_gene_expr_recon_loss: 2921279.0803; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 17049.9677; train_global_loss: 3030092.6468; train_optim_loss: 3030092.6468; val_kl_reg_loss: 12487.8438; val_edge_recon_loss: 79553.3337; val_gene_expr_recon_loss: 2920197.1619; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 17035.7500; val_global_loss: 3029274.0845; val_optim_loss: 3029274.0845
