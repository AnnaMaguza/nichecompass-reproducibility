Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'seqfish_mouse_organogenesis_imputed', '--query_batches', 'batch3', 'batch4', '--n_neighbors', '8', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '31072024_212252_2', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '500000.', '--lambda_gene_expr_recon', '300.', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '256', '--node_batch_size', 'None']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.01
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 5000, n_cat_covariates_embed_input: 0, n_hidden: 1956, n_latent: 1856, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, 
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1856, n_addon_gp_input: 100, n_cat_covariates_embed_input: 3, n_output: 5000
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1856, n_addon_gp_input: 100, n_cat_covariates_embed_input: 3, n_output: 5000

Processing batch batch3...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch4...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.01
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 5000, n_cat_covariates_embed_input: 0, n_hidden: 1956, n_latent: 1856, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, 
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1856, n_addon_gp_input: 100, n_cat_covariates_embed_input: 3, n_output: 5000
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1856, n_addon_gp_input: 100, n_cat_covariates_embed_input: 3, n_output: 5000

--- INITIALIZING TRAINER ---
Number of training nodes: 12767
Number of validation nodes: 1418
Number of training edges: 57317
Number of validation edges: 6368
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.9686; val_auprc_score: 0.9800; val_best_acc_score: 0.9324; val_best_f1_score: 0.9505; train_kl_reg_loss: 12798.3637; train_edge_recon_loss: 182752.2648; train_gene_expr_recon_loss: 47754699.1786; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 47950249.6429; train_optim_loss: 47950249.6429; val_kl_reg_loss: 12710.9469; val_edge_recon_loss: 180668.6856; val_gene_expr_recon_loss: 43865397.6000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 44058777.2800; val_optim_loss: 44058777.2800
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.9666; val_auprc_score: 0.9786; val_best_acc_score: 0.9301; val_best_f1_score: 0.9484; train_kl_reg_loss: 12776.6441; train_edge_recon_loss: 183686.2899; train_gene_expr_recon_loss: 40416831.2321; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 40613294.1250; train_optim_loss: 40613294.1250; val_kl_reg_loss: 12780.8399; val_edge_recon_loss: 181436.2762; val_gene_expr_recon_loss: 37155784.9600; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 37350002.2400; val_optim_loss: 37350002.2400
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.9668; val_auprc_score: 0.9788; val_best_acc_score: 0.9303; val_best_f1_score: 0.9489; train_kl_reg_loss: 12782.6904; train_edge_recon_loss: 182487.3218; train_gene_expr_recon_loss: 34019913.4643; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 34215183.4821; train_optim_loss: 34215183.4821; val_kl_reg_loss: 12734.9229; val_edge_recon_loss: 183054.6700; val_gene_expr_recon_loss: 30972427.6800; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 31168217.2000; val_optim_loss: 31168217.2000
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.9698; val_auprc_score: 0.9810; val_best_acc_score: 0.9323; val_best_f1_score: 0.9505; train_kl_reg_loss: 12783.5605; train_edge_recon_loss: 183062.8629; train_gene_expr_recon_loss: 28454092.8929; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 28649939.2946; train_optim_loss: 28649939.2946; val_kl_reg_loss: 12762.0131; val_edge_recon_loss: 180937.8606; val_gene_expr_recon_loss: 26196650.8800; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 26390350.8800; val_optim_loss: 26390350.8800
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.9700; val_auprc_score: 0.9815; val_best_acc_score: 0.9332; val_best_f1_score: 0.9511; train_kl_reg_loss: 12782.4883; train_edge_recon_loss: 183053.0216; train_gene_expr_recon_loss: 23735141.4107; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 23930976.9464; train_optim_loss: 23930976.9464; val_kl_reg_loss: 12767.1332; val_edge_recon_loss: 179373.1663; val_gene_expr_recon_loss: 21838837.7600; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 22030978.0000; val_optim_loss: 22030978.0000
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.9694; val_auprc_score: 0.9804; val_best_acc_score: 0.9325; val_best_f1_score: 0.9506; train_kl_reg_loss: 12795.8273; train_edge_recon_loss: 181253.8998; train_gene_expr_recon_loss: 19850993.0893; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 20045042.7857; train_optim_loss: 20045042.7857; val_kl_reg_loss: 12797.1354; val_edge_recon_loss: 179808.2456; val_gene_expr_recon_loss: 18343158.5200; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 18535763.9600; val_optim_loss: 18535763.9600
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.9692; val_auprc_score: 0.9779; val_best_acc_score: 0.9324; val_best_f1_score: 0.9502; train_kl_reg_loss: 12797.4186; train_edge_recon_loss: 183516.3941; train_gene_expr_recon_loss: 16667479.1027; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 16863792.9464; train_optim_loss: 16863792.9464; val_kl_reg_loss: 12779.4059; val_edge_recon_loss: 182855.4256; val_gene_expr_recon_loss: 15384176.2800; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 15579811.2000; val_optim_loss: 15579811.2000
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.9692; val_auprc_score: 0.9799; val_best_acc_score: 0.9307; val_best_f1_score: 0.9494; train_kl_reg_loss: 12781.3373; train_edge_recon_loss: 183237.5323; train_gene_expr_recon_loss: 14066254.9152; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 14262273.7589; train_optim_loss: 14262273.7589; val_kl_reg_loss: 12776.0126; val_edge_recon_loss: 180554.3525; val_gene_expr_recon_loss: 13016450.6400; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 13209781.0400; val_optim_loss: 13209781.0400
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.9684; val_auprc_score: 0.9795; val_best_acc_score: 0.9305; val_best_f1_score: 0.9487; train_kl_reg_loss: 12780.9567; train_edge_recon_loss: 182952.0272; train_gene_expr_recon_loss: 11989402.0580; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 12185135.0223; train_optim_loss: 12185135.0223; val_kl_reg_loss: 12783.2015; val_edge_recon_loss: 181470.6556; val_gene_expr_recon_loss: 11145773.4000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 11340027.3600; val_optim_loss: 11340027.3600
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.9676; val_auprc_score: 0.9788; val_best_acc_score: 0.9307; val_best_f1_score: 0.9494; train_kl_reg_loss: 12785.2806; train_edge_recon_loss: 182481.1470; train_gene_expr_recon_loss: 10333005.2545; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 10528271.7143; train_optim_loss: 10528271.7143; val_kl_reg_loss: 12789.9112; val_edge_recon_loss: 180173.8656; val_gene_expr_recon_loss: 9616527.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 9809490.8000; val_optim_loss: 9809490.8000
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.9686; val_auprc_score: 0.9779; val_best_acc_score: 0.9327; val_best_f1_score: 0.9510; train_kl_reg_loss: 12775.9477; train_edge_recon_loss: 182795.1149; train_gene_expr_recon_loss: 8980735.3438; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 9176306.3817; train_optim_loss: 9176306.3817; val_kl_reg_loss: 12787.1695; val_edge_recon_loss: 178432.3469; val_gene_expr_recon_loss: 8435862.6000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 8627082.0800; val_optim_loss: 8627082.0800
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.9702; val_auprc_score: 0.9801; val_best_acc_score: 0.9330; val_best_f1_score: 0.9506; train_kl_reg_loss: 12788.0543; train_edge_recon_loss: 182084.5110; train_gene_expr_recon_loss: 7904250.5246; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 8099123.1138; train_optim_loss: 8099123.1138; val_kl_reg_loss: 12784.1663; val_edge_recon_loss: 181894.9194; val_gene_expr_recon_loss: 7436833.0600; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 7631512.1200; val_optim_loss: 7631512.1200
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.9683; val_auprc_score: 0.9778; val_best_acc_score: 0.9291; val_best_f1_score: 0.9480; train_kl_reg_loss: 12780.8154; train_edge_recon_loss: 182758.2348; train_gene_expr_recon_loss: 7015826.0536; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 7211365.0871; train_optim_loss: 7211365.0871; val_kl_reg_loss: 12766.1936; val_edge_recon_loss: 182068.7431; val_gene_expr_recon_loss: 6630395.3400; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 6825230.3000; val_optim_loss: 6825230.3000
