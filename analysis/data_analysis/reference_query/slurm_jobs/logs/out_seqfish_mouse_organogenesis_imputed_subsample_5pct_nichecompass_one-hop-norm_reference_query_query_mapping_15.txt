Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--reference_dataset', 'seqfish_mouse_organogenesis_imputed_subsample_5pct', '--query_dataset', 'seqfish_mouse_organogenesis_imputed', '--query_batches', 'batch5', 'batch6', '--n_neighbors', '8', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '08082024_140042_15', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '256', '--node_batch_size', 'None']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.01
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 5000, n_cat_covariates_embed_input: 0, n_hidden: 1841, n_latent: 1841, n_addon_latent: 0, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, 
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1841, n_addon_gp_input: 0, n_cat_covariates_embed_input: 3, n_output: 5000
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1841, n_addon_gp_input: 0, n_cat_covariates_embed_input: 3, n_output: 5000

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.01
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 5000, n_cat_covariates_embed_input: 0, n_hidden: 1841, n_latent: 1841, n_addon_latent: 0, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, 
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1841, n_addon_gp_input: 0, n_cat_covariates_embed_input: 3, n_output: 5000
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1841, n_addon_gp_input: 0, n_cat_covariates_embed_input: 3, n_output: 5000

--- INITIALIZING TRAINER ---
Number of training nodes: 18519
Number of validation nodes: 2058
Number of training edges: 84228
Number of validation edges: 9358
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.8298; val_auprc_score: 0.9073; val_best_acc_score: 0.7663; val_best_f1_score: 0.8304; train_kl_reg_loss: 40851.1340; train_edge_recon_loss: 2383652.7114; train_gene_expr_recon_loss: 17722315.0970; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20146818.9212; train_optim_loss: 20146818.9212; val_kl_reg_loss: 41156.2569; val_edge_recon_loss: 2554126.8514; val_gene_expr_recon_loss: 17202758.5946; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19798041.5676; val_optim_loss: 19798041.5676
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.8342; val_auprc_score: 0.9131; val_best_acc_score: 0.7725; val_best_f1_score: 0.8344; train_kl_reg_loss: 40873.4893; train_edge_recon_loss: 2384990.1591; train_gene_expr_recon_loss: 16811850.1121; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19237713.7333; train_optim_loss: 19237713.7333; val_kl_reg_loss: 41109.7734; val_edge_recon_loss: 2534424.9865; val_gene_expr_recon_loss: 16421754.4865; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 18997289.2973; val_optim_loss: 18997289.2973
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.8346; val_auprc_score: 0.9129; val_best_acc_score: 0.7700; val_best_f1_score: 0.8326; train_kl_reg_loss: 40836.3005; train_edge_recon_loss: 2395449.1227; train_gene_expr_recon_loss: 16185200.8848; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 18621486.2909; train_optim_loss: 18621486.2909; val_kl_reg_loss: 41111.5075; val_edge_recon_loss: 2557282.0135; val_gene_expr_recon_loss: 15926701.2162; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 18525094.8649; val_optim_loss: 18525094.8649
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.8314; val_auprc_score: 0.9103; val_best_acc_score: 0.7674; val_best_f1_score: 0.8314; train_kl_reg_loss: 40867.5998; train_edge_recon_loss: 2392811.7102; train_gene_expr_recon_loss: 15741495.3667; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 18175174.6727; train_optim_loss: 18175174.6727; val_kl_reg_loss: 41044.4161; val_edge_recon_loss: 2552412.8041; val_gene_expr_recon_loss: 15552536.1622; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 18145993.2432; val_optim_loss: 18145993.2432
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.8327; val_auprc_score: 0.9122; val_best_acc_score: 0.7724; val_best_f1_score: 0.8334; train_kl_reg_loss: 40862.8709; train_edge_recon_loss: 2385714.9352; train_gene_expr_recon_loss: 15432259.7727; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17858837.6121; train_optim_loss: 17858837.6121; val_kl_reg_loss: 40964.1078; val_edge_recon_loss: 2534559.5608; val_gene_expr_recon_loss: 15293489.2162; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17869012.9189; val_optim_loss: 17869012.9189
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.8363; val_auprc_score: 0.9132; val_best_acc_score: 0.7716; val_best_f1_score: 0.8327; train_kl_reg_loss: 40859.3324; train_edge_recon_loss: 2389934.1170; train_gene_expr_recon_loss: 15209664.9061; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17640458.4000; train_optim_loss: 17640458.4000; val_kl_reg_loss: 41200.0456; val_edge_recon_loss: 2542942.0811; val_gene_expr_recon_loss: 15099896.3784; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17684038.4324; val_optim_loss: 17684038.4324
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.8350; val_auprc_score: 0.9120; val_best_acc_score: 0.7734; val_best_f1_score: 0.8341; train_kl_reg_loss: 40860.7885; train_edge_recon_loss: 2388577.1841; train_gene_expr_recon_loss: 15068786.9697; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17498224.9242; train_optim_loss: 17498224.9242; val_kl_reg_loss: 41025.6744; val_edge_recon_loss: 2537464.7230; val_gene_expr_recon_loss: 14987625.7027; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17566116.2162; val_optim_loss: 17566116.2162
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.8338; val_auprc_score: 0.9112; val_best_acc_score: 0.7678; val_best_f1_score: 0.8329; train_kl_reg_loss: 40857.1310; train_edge_recon_loss: 2395044.6636; train_gene_expr_recon_loss: 14958418.6061; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17394320.4364; train_optim_loss: 17394320.4364; val_kl_reg_loss: 41066.5730; val_edge_recon_loss: 2573589.7973; val_gene_expr_recon_loss: 14885620.6486; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17500276.9189; val_optim_loss: 17500276.9189
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.8306; val_auprc_score: 0.9082; val_best_acc_score: 0.7688; val_best_f1_score: 0.8311; train_kl_reg_loss: 40849.6140; train_edge_recon_loss: 2393400.9515; train_gene_expr_recon_loss: 14889732.4424; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17323983.0242; train_optim_loss: 17323983.0242; val_kl_reg_loss: 41082.3275; val_edge_recon_loss: 2554784.5203; val_gene_expr_recon_loss: 14836997.8378; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17432864.6486; val_optim_loss: 17432864.6486
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.8369; val_auprc_score: 0.9125; val_best_acc_score: 0.7739; val_best_f1_score: 0.8356; train_kl_reg_loss: 40858.0241; train_edge_recon_loss: 2390528.7023; train_gene_expr_recon_loss: 14841978.2515; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17273364.9545; train_optim_loss: 17273364.9545; val_kl_reg_loss: 41056.7335; val_edge_recon_loss: 2532660.4257; val_gene_expr_recon_loss: 14809431.0270; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17383148.1622; val_optim_loss: 17383148.1622
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.8310; val_auprc_score: 0.9109; val_best_acc_score: 0.7692; val_best_f1_score: 0.8331; train_kl_reg_loss: 40842.6808; train_edge_recon_loss: 2392154.3625; train_gene_expr_recon_loss: 14811095.6939; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17244092.7636; train_optim_loss: 17244092.7636; val_kl_reg_loss: 41133.0073; val_edge_recon_loss: 2536670.2973; val_gene_expr_recon_loss: 14782519.3784; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17360322.7568; val_optim_loss: 17360322.7568
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.8350; val_auprc_score: 0.9123; val_best_acc_score: 0.7696; val_best_f1_score: 0.8327; train_kl_reg_loss: 40851.1886; train_edge_recon_loss: 2390034.3758; train_gene_expr_recon_loss: 14793978.0667; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17224863.6242; train_optim_loss: 17224863.6242; val_kl_reg_loss: 41135.3211; val_edge_recon_loss: 2561605.7838; val_gene_expr_recon_loss: 14751757.2432; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17354498.3784; val_optim_loss: 17354498.3784
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.8406; val_auprc_score: 0.9173; val_best_acc_score: 0.7766; val_best_f1_score: 0.8387; train_kl_reg_loss: 40849.8775; train_edge_recon_loss: 2397395.8655; train_gene_expr_recon_loss: 14780505.5182; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17218751.2182; train_optim_loss: 17218751.2182; val_kl_reg_loss: 41224.8371; val_edge_recon_loss: 2516703.1757; val_gene_expr_recon_loss: 14752717.0811; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17310644.9189; val_optim_loss: 17310644.9189
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.8359; val_auprc_score: 0.9112; val_best_acc_score: 0.7707; val_best_f1_score: 0.8341; train_kl_reg_loss: 40878.9850; train_edge_recon_loss: 2401391.1875; train_gene_expr_recon_loss: 14772349.1788; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17214619.3818; train_optim_loss: 17214619.3818; val_kl_reg_loss: 41057.5938; val_edge_recon_loss: 2546216.8446; val_gene_expr_recon_loss: 14759252.0270; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17346526.4324; val_optim_loss: 17346526.4324
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.8338; val_auprc_score: 0.9124; val_best_acc_score: 0.7712; val_best_f1_score: 0.8346; train_kl_reg_loss: 40859.8845; train_edge_recon_loss: 2388571.1083; train_gene_expr_recon_loss: 14764018.9424; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17193449.8970; train_optim_loss: 17193449.8970; val_kl_reg_loss: 41103.3123; val_edge_recon_loss: 2539409.3649; val_gene_expr_recon_loss: 14744207.4865; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17324720.2703; val_optim_loss: 17324720.2703
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.8297; val_auprc_score: 0.9102; val_best_acc_score: 0.7666; val_best_f1_score: 0.8296; train_kl_reg_loss: 40850.8798; train_edge_recon_loss: 2389139.2311; train_gene_expr_recon_loss: 14762597.8303; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17192587.9394; train_optim_loss: 17192587.9394; val_kl_reg_loss: 41087.1548; val_edge_recon_loss: 2557814.9189; val_gene_expr_recon_loss: 14733106.5946; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17332008.7027; val_optim_loss: 17332008.7027
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.8315; val_auprc_score: 0.9102; val_best_acc_score: 0.7705; val_best_f1_score: 0.8321; train_kl_reg_loss: 40847.5548; train_edge_recon_loss: 2387456.9996; train_gene_expr_recon_loss: 14761059.0212; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17189363.5970; train_optim_loss: 17189363.5970; val_kl_reg_loss: 41207.1787; val_edge_recon_loss: 2554224.1757; val_gene_expr_recon_loss: 14746543.2432; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17341974.5946; val_optim_loss: 17341974.5946

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.8313; val_auprc_score: 0.9110; val_best_acc_score: 0.7685; val_best_f1_score: 0.8305; train_kl_reg_loss: 40872.1284; train_edge_recon_loss: 2396267.4966; train_gene_expr_recon_loss: 14762979.1909; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17200118.7939; train_optim_loss: 17200118.7939; val_kl_reg_loss: 41091.9577; val_edge_recon_loss: 2546603.1689; val_gene_expr_recon_loss: 14732903.4054; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17320598.3784; val_optim_loss: 17320598.3784
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.8355; val_auprc_score: 0.9120; val_best_acc_score: 0.7724; val_best_f1_score: 0.8339; train_kl_reg_loss: 40837.0675; train_edge_recon_loss: 2391397.3436; train_gene_expr_recon_loss: 14762682.6303; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17194917.0788; train_optim_loss: 17194917.0788; val_kl_reg_loss: 41118.6527; val_edge_recon_loss: 2551246.3514; val_gene_expr_recon_loss: 14751785.5946; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17344150.6486; val_optim_loss: 17344150.6486
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.8378; val_auprc_score: 0.9140; val_best_acc_score: 0.7752; val_best_f1_score: 0.8354; train_kl_reg_loss: 40864.6712; train_edge_recon_loss: 2385980.4159; train_gene_expr_recon_loss: 14762530.9667; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17189376.0424; train_optim_loss: 17189376.0424; val_kl_reg_loss: 40992.7956; val_edge_recon_loss: 2537222.1959; val_gene_expr_recon_loss: 14745263.6486; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17323478.4865; val_optim_loss: 17323478.4865
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.8339; val_auprc_score: 0.9131; val_best_acc_score: 0.7691; val_best_f1_score: 0.8343; train_kl_reg_loss: 40881.4516; train_edge_recon_loss: 2397031.7417; train_gene_expr_recon_loss: 14759616.0424; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17197529.2697; train_optim_loss: 17197529.2697; val_kl_reg_loss: 41029.8894; val_edge_recon_loss: 2528513.4257; val_gene_expr_recon_loss: 14732380.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17301923.3514; val_optim_loss: 17301923.3514
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.8328; val_auprc_score: 0.9134; val_best_acc_score: 0.7682; val_best_f1_score: 0.8340; train_kl_reg_loss: 40864.6926; train_edge_recon_loss: 2390818.2674; train_gene_expr_recon_loss: 14758352.9606; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17190035.9606; train_optim_loss: 17190035.9606; val_kl_reg_loss: 41114.0040; val_edge_recon_loss: 2530603.8581; val_gene_expr_recon_loss: 14741718.2432; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17313436.0541; val_optim_loss: 17313436.0541
Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.8386; val_auprc_score: 0.9148; val_best_acc_score: 0.7749; val_best_f1_score: 0.8350; train_kl_reg_loss: 40834.0009; train_edge_recon_loss: 2381379.5909; train_gene_expr_recon_loss: 14763161.9818; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17185375.5394; train_optim_loss: 17185375.5394; val_kl_reg_loss: 40992.0876; val_edge_recon_loss: 2536458.5135; val_gene_expr_recon_loss: 14731469.8919; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17308920.6486; val_optim_loss: 17308920.6486
Epoch 24/100 |████----------------| 24.0% val_auroc_score: 0.8336; val_auprc_score: 0.9117; val_best_acc_score: 0.7696; val_best_f1_score: 0.8317; train_kl_reg_loss: 40857.0118; train_edge_recon_loss: 2393089.7159; train_gene_expr_recon_loss: 14760143.4152; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17194090.0970; train_optim_loss: 17194090.0970; val_kl_reg_loss: 40954.6361; val_edge_recon_loss: 2560896.4595; val_gene_expr_recon_loss: 14743125.4324; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17344976.4865; val_optim_loss: 17344976.4865
Epoch 25/100 |█████---------------| 25.0% val_auroc_score: 0.8321; val_auprc_score: 0.9102; val_best_acc_score: 0.7673; val_best_f1_score: 0.8314; train_kl_reg_loss: 40879.0267; train_edge_recon_loss: 2399586.9197; train_gene_expr_recon_loss: 14760440.3848; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 17200906.4000; train_optim_loss: 17200906.4000; val_kl_reg_loss: 41170.6147; val_edge_recon_loss: 2549748.1419; val_gene_expr_recon_loss: 14748747.9189; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 17339666.7027; val_optim_loss: 17339666.7027

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 26/100 |█████---------------| 26.0% val_auroc_score: 0.8360; val_auprc_score: 0.9122; val_best_acc_score: 0.7709; val_best_f1_score: 0.8339; train_kl_reg_loss: 40883.5289; train_edge_recon_loss: 2451241.5462; train_gene_expr_recon_loss: 14344007.6182; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16836132.7576; train_optim_loss: 16836132.7576; val_kl_reg_loss: 40359.2029; val_edge_recon_loss: 2552077.0676; val_gene_expr_recon_loss: 14351357.7838; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16943794.1892; val_optim_loss: 16943794.1892
Epoch 27/100 |█████---------------| 27.0% val_auroc_score: 0.8326; val_auprc_score: 0.9103; val_best_acc_score: 0.7692; val_best_f1_score: 0.8329; train_kl_reg_loss: 40866.6968; train_edge_recon_loss: 2464994.2712; train_gene_expr_recon_loss: 14343803.9303; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16849664.8788; train_optim_loss: 16849664.8788; val_kl_reg_loss: 40304.8751; val_edge_recon_loss: 2547788.7905; val_gene_expr_recon_loss: 14342928.5405; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16931022.1892; val_optim_loss: 16931022.1892
Epoch 28/100 |█████---------------| 28.0% val_auroc_score: 0.8336; val_auprc_score: 0.9116; val_best_acc_score: 0.7713; val_best_f1_score: 0.8325; train_kl_reg_loss: 40896.7853; train_edge_recon_loss: 2458208.7223; train_gene_expr_recon_loss: 14342557.1212; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16841662.6242; train_optim_loss: 16841662.6242; val_kl_reg_loss: 40525.8584; val_edge_recon_loss: 2566542.1014; val_gene_expr_recon_loss: 14333117.6757; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16940185.5405; val_optim_loss: 16940185.5405
Epoch 29/100 |█████---------------| 29.0% val_auroc_score: 0.8363; val_auprc_score: 0.9130; val_best_acc_score: 0.7751; val_best_f1_score: 0.8357; train_kl_reg_loss: 40843.5331; train_edge_recon_loss: 2448622.3981; train_gene_expr_recon_loss: 14343719.0636; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16833184.9758; train_optim_loss: 16833184.9758; val_kl_reg_loss: 40377.8291; val_edge_recon_loss: 2534059.8514; val_gene_expr_recon_loss: 14355452.2703; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16929890.0000; val_optim_loss: 16929890.0000
Epoch 30/100 |██████--------------| 30.0% val_auroc_score: 0.8332; val_auprc_score: 0.9115; val_best_acc_score: 0.7699; val_best_f1_score: 0.8329; train_kl_reg_loss: 40867.5672; train_edge_recon_loss: 2469226.7504; train_gene_expr_recon_loss: 14343319.4697; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16853413.8091; train_optim_loss: 16853413.8091; val_kl_reg_loss: 40309.9917; val_edge_recon_loss: 2548057.0676; val_gene_expr_recon_loss: 14360637.9730; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16949005.0811; val_optim_loss: 16949005.0811
Epoch 31/100 |██████--------------| 31.0% val_auroc_score: 0.8319; val_auprc_score: 0.9098; val_best_acc_score: 0.7686; val_best_f1_score: 0.8320; train_kl_reg_loss: 40838.4006; train_edge_recon_loss: 2452560.6705; train_gene_expr_recon_loss: 14345084.2727; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16838483.3091; train_optim_loss: 16838483.3091; val_kl_reg_loss: 40447.7624; val_edge_recon_loss: 2560917.6689; val_gene_expr_recon_loss: 14348176.0270; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16949541.3784; val_optim_loss: 16949541.3784
Epoch 32/100 |██████--------------| 32.0% val_auroc_score: 0.8287; val_auprc_score: 0.9072; val_best_acc_score: 0.7667; val_best_f1_score: 0.8307; train_kl_reg_loss: 40862.4506; train_edge_recon_loss: 2448967.5549; train_gene_expr_recon_loss: 14343282.0121; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16833112.0515; train_optim_loss: 16833112.0515; val_kl_reg_loss: 40337.6252; val_edge_recon_loss: 2567140.1149; val_gene_expr_recon_loss: 14352702.5946; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16960180.2973; val_optim_loss: 16960180.2973
Epoch 33/100 |██████--------------| 33.0% val_auroc_score: 0.8336; val_auprc_score: 0.9101; val_best_acc_score: 0.7716; val_best_f1_score: 0.8361; train_kl_reg_loss: 40861.3556; train_edge_recon_loss: 2442908.3152; train_gene_expr_recon_loss: 14341688.7061; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16825458.3848; train_optim_loss: 16825458.3848; val_kl_reg_loss: 40353.7954; val_edge_recon_loss: 2532679.8851; val_gene_expr_recon_loss: 14349152.2703; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16922185.9459; val_optim_loss: 16922185.9459
Epoch 34/100 |██████--------------| 34.0% val_auroc_score: 0.8313; val_auprc_score: 0.9102; val_best_acc_score: 0.7694; val_best_f1_score: 0.8329; train_kl_reg_loss: 40884.2302; train_edge_recon_loss: 2452901.1129; train_gene_expr_recon_loss: 14343212.3879; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16836997.6788; train_optim_loss: 16836997.6788; val_kl_reg_loss: 40382.0408; val_edge_recon_loss: 2538078.0541; val_gene_expr_recon_loss: 14360100.1351; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16938560.1351; val_optim_loss: 16938560.1351
Epoch 35/100 |███████-------------| 35.0% val_auroc_score: 0.8319; val_auprc_score: 0.9084; val_best_acc_score: 0.7696; val_best_f1_score: 0.8314; train_kl_reg_loss: 40833.0745; train_edge_recon_loss: 2440292.4811; train_gene_expr_recon_loss: 14345129.5545; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16826255.1182; train_optim_loss: 16826255.1182; val_kl_reg_loss: 40438.7121; val_edge_recon_loss: 2573154.4459; val_gene_expr_recon_loss: 14339826.7027; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16953419.9459; val_optim_loss: 16953419.9459
Epoch 36/100 |███████-------------| 36.0% val_auroc_score: 0.8283; val_auprc_score: 0.9094; val_best_acc_score: 0.7693; val_best_f1_score: 0.8343; train_kl_reg_loss: 40877.1329; train_edge_recon_loss: 2457758.5788; train_gene_expr_recon_loss: 14343086.6788; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16841722.3879; train_optim_loss: 16841722.3879; val_kl_reg_loss: 40420.8792; val_edge_recon_loss: 2522629.9527; val_gene_expr_recon_loss: 14352709.8649; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16915760.9189; val_optim_loss: 16915760.9189
Epoch 37/100 |███████-------------| 37.0% val_auroc_score: 0.8352; val_auprc_score: 0.9116; val_best_acc_score: 0.7701; val_best_f1_score: 0.8323; train_kl_reg_loss: 40870.5223; train_edge_recon_loss: 2453478.6576; train_gene_expr_recon_loss: 14341242.4303; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16835591.5788; train_optim_loss: 16835591.5788; val_kl_reg_loss: 40343.3533; val_edge_recon_loss: 2578434.8649; val_gene_expr_recon_loss: 14338936.2973; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16957714.5676; val_optim_loss: 16957714.5676
Epoch 38/100 |███████-------------| 38.0% val_auroc_score: 0.8353; val_auprc_score: 0.9138; val_best_acc_score: 0.7721; val_best_f1_score: 0.8362; train_kl_reg_loss: 40874.0014; train_edge_recon_loss: 2445893.1220; train_gene_expr_recon_loss: 14339234.9152; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16826002.0758; train_optim_loss: 16826002.0758; val_kl_reg_loss: 40343.7540; val_edge_recon_loss: 2525340.6149; val_gene_expr_recon_loss: 14325485.4054; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16891169.8649; val_optim_loss: 16891169.8649
Epoch 39/100 |███████-------------| 39.0% val_auroc_score: 0.8321; val_auprc_score: 0.9074; val_best_acc_score: 0.7703; val_best_f1_score: 0.8317; train_kl_reg_loss: 40867.7437; train_edge_recon_loss: 2454552.8652; train_gene_expr_recon_loss: 14339452.1576; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16834872.7364; train_optim_loss: 16834872.7364; val_kl_reg_loss: 40452.6990; val_edge_recon_loss: 2581989.9122; val_gene_expr_recon_loss: 14334140.5946; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16956583.2432; val_optim_loss: 16956583.2432
Epoch 40/100 |████████------------| 40.0% val_auroc_score: 0.8376; val_auprc_score: 0.9158; val_best_acc_score: 0.7734; val_best_f1_score: 0.8346; train_kl_reg_loss: 40850.4936; train_edge_recon_loss: 2460822.1826; train_gene_expr_recon_loss: 14336420.7727; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16838093.4424; train_optim_loss: 16838093.4424; val_kl_reg_loss: 40279.4563; val_edge_recon_loss: 2540442.9595; val_gene_expr_recon_loss: 14346128.1892; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16926850.7297; val_optim_loss: 16926850.7297
Epoch 41/100 |████████------------| 41.0% val_auroc_score: 0.8347; val_auprc_score: 0.9123; val_best_acc_score: 0.7717; val_best_f1_score: 0.8348; train_kl_reg_loss: 40865.8013; train_edge_recon_loss: 2462368.2780; train_gene_expr_recon_loss: 14340126.3636; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16843360.4364; train_optim_loss: 16843360.4364; val_kl_reg_loss: 40387.8883; val_edge_recon_loss: 2544461.6149; val_gene_expr_recon_loss: 14329415.9459; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16914265.2162; val_optim_loss: 16914265.2162
Epoch 42/100 |████████------------| 42.0% val_auroc_score: 0.8316; val_auprc_score: 0.9098; val_best_acc_score: 0.7689; val_best_f1_score: 0.8321; train_kl_reg_loss: 40868.4720; train_edge_recon_loss: 2456937.0917; train_gene_expr_recon_loss: 14338662.1727; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16836467.7545; train_optim_loss: 16836467.7545; val_kl_reg_loss: 40326.7363; val_edge_recon_loss: 2562226.9324; val_gene_expr_recon_loss: 14343450.1892; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16946003.7568; val_optim_loss: 16946003.7568

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1.0000000000000002e-06.

Epoch 43/100 |████████------------| 43.0% val_auroc_score: 0.8301; val_auprc_score: 0.9105; val_best_acc_score: 0.7667; val_best_f1_score: 0.8320; train_kl_reg_loss: 40840.2000; train_edge_recon_loss: 2464704.0356; train_gene_expr_recon_loss: 14339574.6030; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16845118.8121; train_optim_loss: 16845118.8121; val_kl_reg_loss: 40371.5049; val_edge_recon_loss: 2548781.9257; val_gene_expr_recon_loss: 14335795.0811; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16924948.6216; val_optim_loss: 16924948.6216
Epoch 44/100 |████████------------| 44.0% val_auroc_score: 0.8305; val_auprc_score: 0.9087; val_best_acc_score: 0.7709; val_best_f1_score: 0.8334; train_kl_reg_loss: 40857.0617; train_edge_recon_loss: 2460842.0477; train_gene_expr_recon_loss: 14339682.8182; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16841381.9667; train_optim_loss: 16841381.9667; val_kl_reg_loss: 40225.9023; val_edge_recon_loss: 2551614.0068; val_gene_expr_recon_loss: 14339371.9730; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16931211.8378; val_optim_loss: 16931211.8378
Epoch 45/100 |█████████-----------| 45.0% val_auroc_score: 0.8324; val_auprc_score: 0.9118; val_best_acc_score: 0.7687; val_best_f1_score: 0.8324; train_kl_reg_loss: 40846.1762; train_edge_recon_loss: 2459057.9136; train_gene_expr_recon_loss: 14338652.9152; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16838557.0000; train_optim_loss: 16838557.0000; val_kl_reg_loss: 40377.5525; val_edge_recon_loss: 2567653.0473; val_gene_expr_recon_loss: 14340798.4324; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16948828.9459; val_optim_loss: 16948828.9459
Epoch 46/100 |█████████-----------| 46.0% val_auroc_score: 0.8364; val_auprc_score: 0.9151; val_best_acc_score: 0.7720; val_best_f1_score: 0.8335; train_kl_reg_loss: 40831.8052; train_edge_recon_loss: 2458762.1545; train_gene_expr_recon_loss: 14339013.4303; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 16838607.3394; train_optim_loss: 16838607.3394; val_kl_reg_loss: 40255.6462; val_edge_recon_loss: 2550054.7635; val_gene_expr_recon_loss: 14328538.1892; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 16918848.5405; val_optim_loss: 16918848.5405

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 108 min 45 sec.
Using best model state, which was in epoch 38.

--- MODEL EVALUATION ---
val AUROC score: 0.8297
val AUPRC score: 0.9095
val best accuracy score: 0.7656
val best F1 score: 0.8314
val target rna MSE score: 12.0087
val source rna MSE score: 14.4914
Val cat covariate0 mean sim diff: -0.0003

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
