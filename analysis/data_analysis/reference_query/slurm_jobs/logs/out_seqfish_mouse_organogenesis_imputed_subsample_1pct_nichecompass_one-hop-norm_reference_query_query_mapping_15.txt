Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--reference_dataset', 'seqfish_mouse_organogenesis_imputed_subsample_1pct', '--query_dataset', 'seqfish_mouse_organogenesis_imputed', '--query_batches', 'batch5', 'batch6', '--n_neighbors', '8', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '08082024_140042_16', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query', '--n_epochs', '100', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.', '--edge_batch_size', '256', '--node_batch_size', 'None']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.01
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 5000, n_cat_covariates_embed_input: 0, n_hidden: 1801, n_latent: 1801, n_addon_latent: 0, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, 
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1801, n_addon_gp_input: 0, n_cat_covariates_embed_input: 3, n_output: 5000
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1801, n_addon_gp_input: 0, n_cat_covariates_embed_input: 3, n_output: 5000

Processing batch batch5...
Loading data...
Computing spatial neighborhood graph...

Processing batch batch6...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.01
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 5000, n_cat_covariates_embed_input: 0, n_hidden: 1801, n_latent: 1801, n_addon_latent: 0, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, 
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1801, n_addon_gp_input: 0, n_cat_covariates_embed_input: 3, n_output: 5000
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1801, n_addon_gp_input: 0, n_cat_covariates_embed_input: 3, n_output: 5000

--- INITIALIZING TRAINER ---
Number of training nodes: 18519
Number of validation nodes: 2058
Number of training edges: 84228
Number of validation edges: 9358
Edge batch size: 256
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/100 |--------------------| 1.0% val_auroc_score: 0.8477; val_auprc_score: 0.9166; val_best_acc_score: 0.6633; val_best_f1_score: 0.7975; train_kl_reg_loss: 106668.9048; train_edge_recon_loss: 2692999.8227; train_gene_expr_recon_loss: 19218456.3152; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 22018125.0788; train_optim_loss: 22018125.0788; val_kl_reg_loss: 106683.7468; val_edge_recon_loss: 2733352.4257; val_gene_expr_recon_loss: 18823288.6486; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 21663324.9189; val_optim_loss: 21663324.9189
Epoch 2/100 |--------------------| 2.0% val_auroc_score: 0.8498; val_auprc_score: 0.9183; val_best_acc_score: 0.6665; val_best_f1_score: 0.7998; train_kl_reg_loss: 106670.9561; train_edge_recon_loss: 2694965.8583; train_gene_expr_recon_loss: 18528852.9879; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 21330489.8242; train_optim_loss: 21330489.8242; val_kl_reg_loss: 106715.1586; val_edge_recon_loss: 2709971.6554; val_gene_expr_recon_loss: 18258375.5135; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 21075062.2703; val_optim_loss: 21075062.2703
Epoch 3/100 |--------------------| 3.0% val_auroc_score: 0.8499; val_auprc_score: 0.9174; val_best_acc_score: 0.6632; val_best_f1_score: 0.7975; train_kl_reg_loss: 106669.0376; train_edge_recon_loss: 2706040.1360; train_gene_expr_recon_loss: 18073635.1758; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20886344.3697; train_optim_loss: 20886344.3697; val_kl_reg_loss: 106690.4675; val_edge_recon_loss: 2734790.3649; val_gene_expr_recon_loss: 17902396.7027; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20743877.5135; val_optim_loss: 20743877.5135
Epoch 4/100 |--------------------| 4.0% val_auroc_score: 0.8474; val_auprc_score: 0.9166; val_best_acc_score: 0.6640; val_best_f1_score: 0.7981; train_kl_reg_loss: 106667.0595; train_edge_recon_loss: 2704443.6580; train_gene_expr_recon_loss: 17766786.6848; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20577897.4970; train_optim_loss: 20577897.4970; val_kl_reg_loss: 106676.1845; val_edge_recon_loss: 2728179.2027; val_gene_expr_recon_loss: 17651968.4865; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20486823.7838; val_optim_loss: 20486823.7838
Epoch 5/100 |█-------------------| 5.0% val_auroc_score: 0.8480; val_auprc_score: 0.9161; val_best_acc_score: 0.6672; val_best_f1_score: 0.8004; train_kl_reg_loss: 106665.5667; train_edge_recon_loss: 2697250.7652; train_gene_expr_recon_loss: 17562131.5273; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20366047.8848; train_optim_loss: 20366047.8848; val_kl_reg_loss: 106635.9405; val_edge_recon_loss: 2706038.8243; val_gene_expr_recon_loss: 17479296.4324; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20291971.2432; val_optim_loss: 20291971.2432
Epoch 6/100 |█-------------------| 6.0% val_auroc_score: 0.8555; val_auprc_score: 0.9224; val_best_acc_score: 0.6647; val_best_f1_score: 0.7985; train_kl_reg_loss: 106677.8525; train_edge_recon_loss: 2699504.7545; train_gene_expr_recon_loss: 17418233.6788; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20224416.2848; train_optim_loss: 20224416.2848; val_kl_reg_loss: 106725.9715; val_edge_recon_loss: 2723875.6419; val_gene_expr_recon_loss: 17361028.2703; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20191629.7838; val_optim_loss: 20191629.7838
Epoch 7/100 |█-------------------| 7.0% val_auroc_score: 0.8482; val_auprc_score: 0.9167; val_best_acc_score: 0.6656; val_best_f1_score: 0.7992; train_kl_reg_loss: 106668.9619; train_edge_recon_loss: 2697773.1455; train_gene_expr_recon_loss: 17331262.0000; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20135704.0667; train_optim_loss: 20135704.0667; val_kl_reg_loss: 106654.0731; val_edge_recon_loss: 2718278.9730; val_gene_expr_recon_loss: 17293523.7838; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20118456.8108; val_optim_loss: 20118456.8108
Epoch 8/100 |█-------------------| 8.0% val_auroc_score: 0.8510; val_auprc_score: 0.9174; val_best_acc_score: 0.6610; val_best_f1_score: 0.7959; train_kl_reg_loss: 106662.9298; train_edge_recon_loss: 2708045.1515; train_gene_expr_recon_loss: 17266627.6303; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20081335.7212; train_optim_loss: 20081335.7212; val_kl_reg_loss: 106698.1978; val_edge_recon_loss: 2753927.9932; val_gene_expr_recon_loss: 17236628.8108; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20097255.0811; val_optim_loss: 20097255.0811
Epoch 9/100 |█-------------------| 9.0% val_auroc_score: 0.8486; val_auprc_score: 0.9186; val_best_acc_score: 0.6641; val_best_f1_score: 0.7981; train_kl_reg_loss: 106674.3565; train_edge_recon_loss: 2703814.5534; train_gene_expr_recon_loss: 17230395.6121; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20040884.5091; train_optim_loss: 20040884.5091; val_kl_reg_loss: 106718.9829; val_edge_recon_loss: 2729231.9054; val_gene_expr_recon_loss: 17212678.0541; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20048628.8649; val_optim_loss: 20048628.8649
Epoch 10/100 |██------------------| 10.0% val_auroc_score: 0.8537; val_auprc_score: 0.9206; val_best_acc_score: 0.6650; val_best_f1_score: 0.7988; train_kl_reg_loss: 106659.4070; train_edge_recon_loss: 2703503.8731; train_gene_expr_recon_loss: 17206037.6061; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20016200.9152; train_optim_loss: 20016200.9152; val_kl_reg_loss: 106673.5557; val_edge_recon_loss: 2717793.9662; val_gene_expr_recon_loss: 17202272.3784; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20026739.9459; val_optim_loss: 20026739.9459
Epoch 11/100 |██------------------| 11.0% val_auroc_score: 0.8496; val_auprc_score: 0.9185; val_best_acc_score: 0.6658; val_best_f1_score: 0.7994; train_kl_reg_loss: 106662.0283; train_edge_recon_loss: 2705161.0356; train_gene_expr_recon_loss: 17193142.3333; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20004965.3939; train_optim_loss: 20004965.3939; val_kl_reg_loss: 106715.0492; val_edge_recon_loss: 2712957.3041; val_gene_expr_recon_loss: 17193579.0270; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20013251.3514; val_optim_loss: 20013251.3514
Epoch 12/100 |██------------------| 12.0% val_auroc_score: 0.8505; val_auprc_score: 0.9177; val_best_acc_score: 0.6624; val_best_f1_score: 0.7969; train_kl_reg_loss: 106671.4063; train_edge_recon_loss: 2703028.9000; train_gene_expr_recon_loss: 17189313.3394; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19999013.6061; train_optim_loss: 19999013.6061; val_kl_reg_loss: 106703.2654; val_edge_recon_loss: 2744251.6622; val_gene_expr_recon_loss: 17173760.0541; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20024715.0811; val_optim_loss: 20024715.0811
Epoch 13/100 |██------------------| 13.0% val_auroc_score: 0.8562; val_auprc_score: 0.9213; val_best_acc_score: 0.6675; val_best_f1_score: 0.8005; train_kl_reg_loss: 106666.0220; train_edge_recon_loss: 2708334.6424; train_gene_expr_recon_loss: 17185276.2182; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20000276.8485; train_optim_loss: 20000276.8485; val_kl_reg_loss: 106735.8568; val_edge_recon_loss: 2702819.6554; val_gene_expr_recon_loss: 17190523.8378; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20000079.4595; val_optim_loss: 20000079.4595
Epoch 14/100 |██------------------| 14.0% val_auroc_score: 0.8505; val_auprc_score: 0.9193; val_best_acc_score: 0.6639; val_best_f1_score: 0.7980; train_kl_reg_loss: 106683.9338; train_edge_recon_loss: 2713202.6545; train_gene_expr_recon_loss: 17185474.8182; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20005361.3879; train_optim_loss: 20005361.3879; val_kl_reg_loss: 106636.6710; val_edge_recon_loss: 2728160.5608; val_gene_expr_recon_loss: 17191284.4865; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20026081.8378; val_optim_loss: 20026081.8378
Epoch 15/100 |███-----------------| 15.0% val_auroc_score: 0.8504; val_auprc_score: 0.9208; val_best_acc_score: 0.6656; val_best_f1_score: 0.7992; train_kl_reg_loss: 106678.8174; train_edge_recon_loss: 2700328.7038; train_gene_expr_recon_loss: 17183173.2182; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19990180.7697; train_optim_loss: 19990180.7697; val_kl_reg_loss: 106742.5914; val_edge_recon_loss: 2717986.2973; val_gene_expr_recon_loss: 17179896.5405; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20004625.5676; val_optim_loss: 20004625.5676
Epoch 16/100 |███-----------------| 16.0% val_auroc_score: 0.8477; val_auprc_score: 0.9169; val_best_acc_score: 0.6640; val_best_f1_score: 0.7981; train_kl_reg_loss: 106666.4662; train_edge_recon_loss: 2700202.8424; train_gene_expr_recon_loss: 17182666.8727; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19989536.2242; train_optim_loss: 19989536.2242; val_kl_reg_loss: 106701.9685; val_edge_recon_loss: 2732372.0608; val_gene_expr_recon_loss: 17174205.6757; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20013279.7297; val_optim_loss: 20013279.7297
Epoch 17/100 |███-----------------| 17.0% val_auroc_score: 0.8513; val_auprc_score: 0.9185; val_best_acc_score: 0.6639; val_best_f1_score: 0.7980; train_kl_reg_loss: 106676.0732; train_edge_recon_loss: 2696813.0330; train_gene_expr_recon_loss: 17183634.1939; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19987123.2788; train_optim_loss: 19987123.2788; val_kl_reg_loss: 106685.8524; val_edge_recon_loss: 2733529.0203; val_gene_expr_recon_loss: 17184593.7297; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20024808.7027; val_optim_loss: 20024808.7027

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 18/100 |███-----------------| 18.0% val_auroc_score: 0.8508; val_auprc_score: 0.9194; val_best_acc_score: 0.6651; val_best_f1_score: 0.7989; train_kl_reg_loss: 106665.2622; train_edge_recon_loss: 2706177.5795; train_gene_expr_recon_loss: 17186714.1394; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19999557.0303; train_optim_loss: 19999557.0303; val_kl_reg_loss: 106680.6835; val_edge_recon_loss: 2719758.4797; val_gene_expr_recon_loss: 17175451.5135; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20001890.7568; val_optim_loss: 20001890.7568
Epoch 19/100 |███-----------------| 19.0% val_auroc_score: 0.8511; val_auprc_score: 0.9181; val_best_acc_score: 0.6639; val_best_f1_score: 0.7980; train_kl_reg_loss: 106674.4576; train_edge_recon_loss: 2701430.2674; train_gene_expr_recon_loss: 17186535.4485; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19994640.1515; train_optim_loss: 19994640.1515; val_kl_reg_loss: 106703.3144; val_edge_recon_loss: 2731300.8311; val_gene_expr_recon_loss: 17188645.4595; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20026649.5135; val_optim_loss: 20026649.5135
Epoch 20/100 |████----------------| 20.0% val_auroc_score: 0.8568; val_auprc_score: 0.9228; val_best_acc_score: 0.6655; val_best_f1_score: 0.7991; train_kl_reg_loss: 106656.1481; train_edge_recon_loss: 2697595.5720; train_gene_expr_recon_loss: 17185178.2788; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19989430.0000; train_optim_loss: 19989430.0000; val_kl_reg_loss: 106663.6605; val_edge_recon_loss: 2718003.3986; val_gene_expr_recon_loss: 17184680.7027; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20009347.7838; val_optim_loss: 20009347.7838
Epoch 21/100 |████----------------| 21.0% val_auroc_score: 0.8477; val_auprc_score: 0.9167; val_best_acc_score: 0.6667; val_best_f1_score: 0.8000; train_kl_reg_loss: 106671.2226; train_edge_recon_loss: 2710081.9508; train_gene_expr_recon_loss: 17182968.0909; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19999721.3212; train_optim_loss: 19999721.3212; val_kl_reg_loss: 106687.3454; val_edge_recon_loss: 2708754.2297; val_gene_expr_recon_loss: 17176655.2432; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19992096.7027; val_optim_loss: 19992096.7027
Epoch 22/100 |████----------------| 22.0% val_auroc_score: 0.8525; val_auprc_score: 0.9207; val_best_acc_score: 0.6670; val_best_f1_score: 0.8002; train_kl_reg_loss: 106669.4385; train_edge_recon_loss: 2699286.0939; train_gene_expr_recon_loss: 17183909.7818; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19989865.2909; train_optim_loss: 19989865.2909; val_kl_reg_loss: 106690.6208; val_edge_recon_loss: 2706437.1081; val_gene_expr_recon_loss: 17181507.1351; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19994634.9189; val_optim_loss: 19994634.9189
Epoch 23/100 |████----------------| 23.0% val_auroc_score: 0.8569; val_auprc_score: 0.9230; val_best_acc_score: 0.6658; val_best_f1_score: 0.7994; train_kl_reg_loss: 106672.2281; train_edge_recon_loss: 2693073.7818; train_gene_expr_recon_loss: 17186704.3030; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19986450.2970; train_optim_loss: 19986450.2970; val_kl_reg_loss: 106648.5011; val_edge_recon_loss: 2716214.8108; val_gene_expr_recon_loss: 17178582.9189; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20001446.1622; val_optim_loss: 20001446.1622
Epoch 24/100 |████----------------| 24.0% val_auroc_score: 0.8500; val_auprc_score: 0.9181; val_best_acc_score: 0.6627; val_best_f1_score: 0.7971; train_kl_reg_loss: 106665.0928; train_edge_recon_loss: 2704349.7114; train_gene_expr_recon_loss: 17184586.7939; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19995601.5273; train_optim_loss: 19995601.5273; val_kl_reg_loss: 106669.1824; val_edge_recon_loss: 2740202.6689; val_gene_expr_recon_loss: 17181584.7027; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20028456.4865; val_optim_loss: 20028456.4865
Epoch 25/100 |█████---------------| 25.0% val_auroc_score: 0.8502; val_auprc_score: 0.9172; val_best_acc_score: 0.6639; val_best_f1_score: 0.7980; train_kl_reg_loss: 106664.4106; train_edge_recon_loss: 2710901.5591; train_gene_expr_recon_loss: 17184357.0970; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 20001923.0545; train_optim_loss: 20001923.0545; val_kl_reg_loss: 106710.8205; val_edge_recon_loss: 2728736.1757; val_gene_expr_recon_loss: 17183940.5405; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 20019387.4595; val_optim_loss: 20019387.4595

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 26/100 |█████---------------| 26.0% val_auroc_score: 0.8497; val_auprc_score: 0.9160; val_best_acc_score: 0.6639; val_best_f1_score: 0.7980; train_kl_reg_loss: 106678.3588; train_edge_recon_loss: 2701920.5765; train_gene_expr_recon_loss: 16748037.9121; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19556636.8606; train_optim_loss: 19556636.8606; val_kl_reg_loss: 105919.9014; val_edge_recon_loss: 2729112.1149; val_gene_expr_recon_loss: 16754549.9189; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19589582.0000; val_optim_loss: 19589582.0000
Epoch 27/100 |█████---------------| 27.0% val_auroc_score: 0.8494; val_auprc_score: 0.9158; val_best_acc_score: 0.6655; val_best_f1_score: 0.7991; train_kl_reg_loss: 106677.9660; train_edge_recon_loss: 2717395.7417; train_gene_expr_recon_loss: 16748136.3636; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19572210.0788; train_optim_loss: 19572210.0788; val_kl_reg_loss: 105958.1225; val_edge_recon_loss: 2717133.1216; val_gene_expr_recon_loss: 16750266.2432; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19573357.4595; val_optim_loss: 19573357.4595
Epoch 28/100 |█████---------------| 28.0% val_auroc_score: 0.8475; val_auprc_score: 0.9142; val_best_acc_score: 0.6630; val_best_f1_score: 0.7974; train_kl_reg_loss: 106681.8717; train_edge_recon_loss: 2708554.7023; train_gene_expr_recon_loss: 16747160.6333; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19562397.2121; train_optim_loss: 19562397.2121; val_kl_reg_loss: 105975.3824; val_edge_recon_loss: 2738113.8378; val_gene_expr_recon_loss: 16749108.5676; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19593197.7838; val_optim_loss: 19593197.7838
Epoch 29/100 |█████---------------| 29.0% val_auroc_score: 0.8537; val_auprc_score: 0.9193; val_best_acc_score: 0.6668; val_best_f1_score: 0.8001; train_kl_reg_loss: 106663.0427; train_edge_recon_loss: 2699862.4602; train_gene_expr_recon_loss: 16747373.7455; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19553899.2788; train_optim_loss: 19553899.2788; val_kl_reg_loss: 105909.8929; val_edge_recon_loss: 2710976.4122; val_gene_expr_recon_loss: 16753387.5946; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19570273.6757; val_optim_loss: 19570273.6757
Epoch 30/100 |██████--------------| 30.0% val_auroc_score: 0.8500; val_auprc_score: 0.9167; val_best_acc_score: 0.6653; val_best_f1_score: 0.7990; train_kl_reg_loss: 106666.6611; train_edge_recon_loss: 2722406.0530; train_gene_expr_recon_loss: 16747197.2091; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19576269.9394; train_optim_loss: 19576269.9394; val_kl_reg_loss: 105987.0386; val_edge_recon_loss: 2717855.1824; val_gene_expr_recon_loss: 16763970.8108; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19587813.1892; val_optim_loss: 19587813.1892
Epoch 31/100 |██████--------------| 31.0% val_auroc_score: 0.8498; val_auprc_score: 0.9163; val_best_acc_score: 0.6635; val_best_f1_score: 0.7977; train_kl_reg_loss: 106663.0352; train_edge_recon_loss: 2704876.3720; train_gene_expr_recon_loss: 16748037.6364; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19559577.0788; train_optim_loss: 19559577.0788; val_kl_reg_loss: 105983.4172; val_edge_recon_loss: 2733747.1554; val_gene_expr_recon_loss: 16754908.3514; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19594638.9189; val_optim_loss: 19594638.9189
Epoch 32/100 |██████--------------| 32.0% val_auroc_score: 0.8463; val_auprc_score: 0.9142; val_best_acc_score: 0.6635; val_best_f1_score: 0.7977; train_kl_reg_loss: 106668.9961; train_edge_recon_loss: 2699763.6106; train_gene_expr_recon_loss: 16747655.2697; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19554087.9030; train_optim_loss: 19554087.9030; val_kl_reg_loss: 105925.6026; val_edge_recon_loss: 2735125.5608; val_gene_expr_recon_loss: 16758112.8649; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19599164.2162; val_optim_loss: 19599164.2162
Epoch 33/100 |██████--------------| 33.0% val_auroc_score: 0.8490; val_auprc_score: 0.9158; val_best_acc_score: 0.6675; val_best_f1_score: 0.8006; train_kl_reg_loss: 106672.7065; train_edge_recon_loss: 2695262.5636; train_gene_expr_recon_loss: 16745763.3939; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19547698.6909; train_optim_loss: 19547698.6909; val_kl_reg_loss: 105951.2297; val_edge_recon_loss: 2704393.2770; val_gene_expr_recon_loss: 16755999.3514; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19566343.8919; val_optim_loss: 19566343.8919
Epoch 34/100 |██████--------------| 34.0% val_auroc_score: 0.8463; val_auprc_score: 0.9153; val_best_acc_score: 0.6667; val_best_f1_score: 0.8000; train_kl_reg_loss: 106674.4305; train_edge_recon_loss: 2703664.1534; train_gene_expr_recon_loss: 16747156.0939; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19557494.6848; train_optim_loss: 19557494.6848; val_kl_reg_loss: 105942.3974; val_edge_recon_loss: 2706874.3514; val_gene_expr_recon_loss: 16763315.2973; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19576132.1081; val_optim_loss: 19576132.1081
Epoch 35/100 |███████-------------| 35.0% val_auroc_score: 0.8476; val_auprc_score: 0.9145; val_best_acc_score: 0.6619; val_best_f1_score: 0.7966; train_kl_reg_loss: 106662.7824; train_edge_recon_loss: 2689320.6447; train_gene_expr_recon_loss: 16746931.6242; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19542915.0061; train_optim_loss: 19542915.0061; val_kl_reg_loss: 105922.6362; val_edge_recon_loss: 2747777.2635; val_gene_expr_recon_loss: 16745028.0270; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19598727.8378; val_optim_loss: 19598727.8378
Epoch 36/100 |███████-------------| 36.0% val_auroc_score: 0.8455; val_auprc_score: 0.9150; val_best_acc_score: 0.6690; val_best_f1_score: 0.8016; train_kl_reg_loss: 106673.0202; train_edge_recon_loss: 2709317.0811; train_gene_expr_recon_loss: 16748460.9636; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19564451.0727; train_optim_loss: 19564451.0727; val_kl_reg_loss: 105912.7160; val_edge_recon_loss: 2691497.5000; val_gene_expr_recon_loss: 16760688.6486; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19558098.9189; val_optim_loss: 19558098.9189
Epoch 37/100 |███████-------------| 37.0% val_auroc_score: 0.8548; val_auprc_score: 0.9197; val_best_acc_score: 0.6607; val_best_f1_score: 0.7957; train_kl_reg_loss: 106682.4482; train_edge_recon_loss: 2704836.9765; train_gene_expr_recon_loss: 16746372.7879; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19557892.2242; train_optim_loss: 19557892.2242; val_kl_reg_loss: 105925.7038; val_edge_recon_loss: 2755838.8581; val_gene_expr_recon_loss: 16756873.6486; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19618638.1622; val_optim_loss: 19618638.1622
Epoch 38/100 |███████-------------| 38.0% val_auroc_score: 0.8501; val_auprc_score: 0.9177; val_best_acc_score: 0.6679; val_best_f1_score: 0.8009; train_kl_reg_loss: 106675.4685; train_edge_recon_loss: 2695868.9636; train_gene_expr_recon_loss: 16747907.1364; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19550451.5818; train_optim_loss: 19550451.5818; val_kl_reg_loss: 105973.5973; val_edge_recon_loss: 2697837.1689; val_gene_expr_recon_loss: 16738641.7027; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19542452.4865; val_optim_loss: 19542452.4865
Epoch 39/100 |███████-------------| 39.0% val_auroc_score: 0.8507; val_auprc_score: 0.9168; val_best_acc_score: 0.6600; val_best_f1_score: 0.7952; train_kl_reg_loss: 106674.0378; train_edge_recon_loss: 2706766.5614; train_gene_expr_recon_loss: 16747260.3545; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19560700.9515; train_optim_loss: 19560700.9515; val_kl_reg_loss: 105934.3247; val_edge_recon_loss: 2760660.2500; val_gene_expr_recon_loss: 16743933.3514; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19610528.0000; val_optim_loss: 19610528.0000
Epoch 40/100 |████████------------| 40.0% val_auroc_score: 0.8516; val_auprc_score: 0.9191; val_best_acc_score: 0.6663; val_best_f1_score: 0.7998; train_kl_reg_loss: 106667.0067; train_edge_recon_loss: 2713615.7235; train_gene_expr_recon_loss: 16744637.7121; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19564920.4545; train_optim_loss: 19564920.4545; val_kl_reg_loss: 105916.6168; val_edge_recon_loss: 2711911.2568; val_gene_expr_recon_loss: 16753960.9459; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19571788.9730; val_optim_loss: 19571788.9730
Epoch 41/100 |████████------------| 41.0% val_auroc_score: 0.8500; val_auprc_score: 0.9175; val_best_acc_score: 0.6654; val_best_f1_score: 0.7991; train_kl_reg_loss: 106678.5151; train_edge_recon_loss: 2714600.1614; train_gene_expr_recon_loss: 16747558.7121; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19568837.4000; train_optim_loss: 19568837.4000; val_kl_reg_loss: 105997.0895; val_edge_recon_loss: 2717397.6081; val_gene_expr_recon_loss: 16749261.1351; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19572656.0000; val_optim_loss: 19572656.0000
Epoch 42/100 |████████------------| 42.0% val_auroc_score: 0.8453; val_auprc_score: 0.9131; val_best_acc_score: 0.6635; val_best_f1_score: 0.7977; train_kl_reg_loss: 106675.2913; train_edge_recon_loss: 2707228.9663; train_gene_expr_recon_loss: 16747424.5606; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19561328.7879; train_optim_loss: 19561328.7879; val_kl_reg_loss: 105930.2190; val_edge_recon_loss: 2734651.8649; val_gene_expr_recon_loss: 16751287.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19591869.0811; val_optim_loss: 19591869.0811

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1.0000000000000002e-06.

Epoch 43/100 |████████------------| 43.0% val_auroc_score: 0.8488; val_auprc_score: 0.9160; val_best_acc_score: 0.6660; val_best_f1_score: 0.7995; train_kl_reg_loss: 106672.1538; train_edge_recon_loss: 2717618.7780; train_gene_expr_recon_loss: 16747669.7242; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19571960.6970; train_optim_loss: 19571960.6970; val_kl_reg_loss: 105974.5408; val_edge_recon_loss: 2716194.5676; val_gene_expr_recon_loss: 16751173.5676; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19573342.6486; val_optim_loss: 19573342.6486
Epoch 44/100 |████████------------| 44.0% val_auroc_score: 0.8502; val_auprc_score: 0.9164; val_best_acc_score: 0.6650; val_best_f1_score: 0.7988; train_kl_reg_loss: 106666.5637; train_edge_recon_loss: 2715206.9970; train_gene_expr_recon_loss: 16747260.1182; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19569133.6667; train_optim_loss: 19569133.6667; val_kl_reg_loss: 105928.9360; val_edge_recon_loss: 2724450.6622; val_gene_expr_recon_loss: 16752002.8108; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19582382.5405; val_optim_loss: 19582382.5405
Epoch 45/100 |█████████-----------| 45.0% val_auroc_score: 0.8460; val_auprc_score: 0.9137; val_best_acc_score: 0.6634; val_best_f1_score: 0.7976; train_kl_reg_loss: 106661.9953; train_edge_recon_loss: 2710928.8879; train_gene_expr_recon_loss: 16747578.3394; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19565169.2485; train_optim_loss: 19565169.2485; val_kl_reg_loss: 105974.4975; val_edge_recon_loss: 2736713.8514; val_gene_expr_recon_loss: 16749961.1351; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19592649.5676; val_optim_loss: 19592649.5676
Epoch 46/100 |█████████-----------| 46.0% val_auroc_score: 0.8538; val_auprc_score: 0.9198; val_best_acc_score: 0.6654; val_best_f1_score: 0.7991; train_kl_reg_loss: 106672.9495; train_edge_recon_loss: 2708473.3750; train_gene_expr_recon_loss: 16746684.0939; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_global_loss: 19561830.3697; train_optim_loss: 19561830.3697; val_kl_reg_loss: 105963.7981; val_edge_recon_loss: 2718078.9392; val_gene_expr_recon_loss: 16738566.4324; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_global_loss: 19562609.2432; val_optim_loss: 19562609.2432

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 103 min 5 sec.
Using best model state, which was in epoch 38.

--- MODEL EVALUATION ---
val AUROC score: 0.8486
val AUPRC score: 0.9164
val best accuracy score: 0.6659
val best F1 score: 0.7995
val target rna MSE score: 18.0696
val source rna MSE score: 20.5437
Val cat covariate0 mean sim diff: -0.0000

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
