Script arguments:
['../map_query_on_nichecompass_reference_model.py', '--dataset', 'nanostring_cosmx_human_nsclc', '--query_batches', 'batch8', '--n_neighbors', '4', '--spatial_key', 'spatial', '--mapping_entity_key', 'mapping_entity', '--gp_names_key', 'nichecompass_gp_names', '--reference_model_label', 'reference', '--load_timestamp', '03092023_001238_3', '--query_model_label', 'query', '--reference_query_model_label', 'reference_query_mapping', '--n_epochs', '400', '--n_epochs_all_gps', '25', '--n_epochs_no_cat_covariates_contrastive', '0', '--lr', '0.001', '--lambda_edge_recon', '5000000.', '--lambda_gene_expr_recon', '3000.', '--lambda_cat_covariates_contrastive', '0.0', '--contrastive_logits_pos_ratio', '0.0', '--contrastive_logits_neg_ratio', '0.0', '--lambda_group_lasso', '0.', '--lambda_l1_masked', '0.0', '--edge_batch_size', '512', '--node_batch_size', 'None', '--n_sampled_neighbors', '4']
Retrieving reference model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 33, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 33, n_output: 960

Processing batch batch8...
Loading data...
Computing spatial neighborhood graph...

Filtering for genes used in reference...

Training model...
--- INITIALIZING NEW NETWORK MODULE: VARIATIONAL GENE PROGRAM GRAPH AUTOENCODER ---
LOSS -> include_edge_recon_loss: True, include_gene_expr_recon_loss: True, rna_recon_loss: nb
NODE LABEL METHOD -> one-hop-norm
ACTIVE GP THRESHOLD RATIO -> 0.03
LOG VARIATIONAL -> True
CATEGORICAL COVARIATES EMBEDDINGS INJECTION -> ['gene_expr_decoder']
ONE HOP GCN NORM RNA NODE LABEL AGGREGATOR
ENCODER -> n_input: 960, n_cat_covariates_embed_input: 0, n_hidden: 960, n_latent: 1494, n_addon_latent: 100, n_fc_layers: 1, n_layers: 1, conv_layer: gatv2conv, n_attention_heads: 4, dropout_rate: 0.0, use_bn: False
COSINE SIM GRAPH DECODER -> dropout_rate: 0.0
MASKED TARGET RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 33, n_output: 960
MASKED SOURCE RNA DECODER -> n_prior_gp_input: 1494, n_addon_gp_input: 100, n_cat_covariates_embed_input: 33, n_output: 960

--- INITIALIZING TRAINER ---
Number of training nodes: 68882
Number of validation nodes: 7654
Number of training edges: 162180
Number of validation edges: 18020
Edge batch size: 512
Node batch size: None

--- MODEL TRAINING ---
Epoch 1/400 |--------------------| 0.2% val_auroc_score: 0.8425; val_auprc_score: 0.8440; val_best_acc_score: 0.7613; val_best_f1_score: 0.7728; train_kl_reg_loss: 19578.8779; train_edge_recon_loss: 3259293.4874; train_gene_expr_recon_loss: 2953120.5268; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 6231992.9132; train_optim_loss: 6231992.9132; val_kl_reg_loss: 19576.2840; val_edge_recon_loss: 3322983.8264; val_gene_expr_recon_loss: 2535961.5694; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5878521.7222; val_optim_loss: 5878521.7222
Epoch 2/400 |--------------------| 0.5% val_auroc_score: 0.8397; val_auprc_score: 0.8422; val_best_acc_score: 0.7582; val_best_f1_score: 0.7690; train_kl_reg_loss: 19575.0209; train_edge_recon_loss: 3259848.3084; train_gene_expr_recon_loss: 2304981.0296; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5584404.3549; train_optim_loss: 5584404.3549; val_kl_reg_loss: 19599.1245; val_edge_recon_loss: 3332316.5486; val_gene_expr_recon_loss: 2143310.0903; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5495225.7083; val_optim_loss: 5495225.7083
Epoch 3/400 |--------------------| 0.8% val_auroc_score: 0.8391; val_auprc_score: 0.8415; val_best_acc_score: 0.7572; val_best_f1_score: 0.7696; train_kl_reg_loss: 19586.5709; train_edge_recon_loss: 3260468.1435; train_gene_expr_recon_loss: 2063113.2839; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5343168.0110; train_optim_loss: 5343168.0110; val_kl_reg_loss: 19564.0341; val_edge_recon_loss: 3336462.7500; val_gene_expr_recon_loss: 2024776.5347; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5380803.3194; val_optim_loss: 5380803.3194
Epoch 4/400 |--------------------| 1.0% val_auroc_score: 0.8407; val_auprc_score: 0.8447; val_best_acc_score: 0.7583; val_best_f1_score: 0.7692; train_kl_reg_loss: 19584.6645; train_edge_recon_loss: 3260544.5726; train_gene_expr_recon_loss: 2002419.5398; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5282548.7855; train_optim_loss: 5282548.7855; val_kl_reg_loss: 19560.2458; val_edge_recon_loss: 3336700.4028; val_gene_expr_recon_loss: 1989739.6111; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5346000.1944; val_optim_loss: 5346000.1944
Epoch 5/400 |--------------------| 1.2% val_auroc_score: 0.8450; val_auprc_score: 0.8499; val_best_acc_score: 0.7623; val_best_f1_score: 0.7723; train_kl_reg_loss: 19586.0743; train_edge_recon_loss: 3260533.4235; train_gene_expr_recon_loss: 1980309.8813; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5260429.3801; train_optim_loss: 5260429.3801; val_kl_reg_loss: 19574.6817; val_edge_recon_loss: 3327938.4236; val_gene_expr_recon_loss: 1980989.6319; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5328502.7222; val_optim_loss: 5328502.7222
Epoch 6/400 |--------------------| 1.5% val_auroc_score: 0.8419; val_auprc_score: 0.8449; val_best_acc_score: 0.7596; val_best_f1_score: 0.7718; train_kl_reg_loss: 19593.5210; train_edge_recon_loss: 3259985.8762; train_gene_expr_recon_loss: 1969786.1459; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5249365.5473; train_optim_loss: 5249365.5473; val_kl_reg_loss: 19603.4583; val_edge_recon_loss: 3330018.2222; val_gene_expr_recon_loss: 1970828.4583; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5320450.1389; val_optim_loss: 5320450.1389
Epoch 7/400 |--------------------| 1.8% val_auroc_score: 0.8434; val_auprc_score: 0.8472; val_best_acc_score: 0.7608; val_best_f1_score: 0.7730; train_kl_reg_loss: 19584.2571; train_edge_recon_loss: 3260504.3817; train_gene_expr_recon_loss: 1965368.9010; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5245457.5426; train_optim_loss: 5245457.5426; val_kl_reg_loss: 19566.9902; val_edge_recon_loss: 3327728.0903; val_gene_expr_recon_loss: 1961998.9201; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5309294.0694; val_optim_loss: 5309294.0694
Epoch 8/400 |--------------------| 2.0% val_auroc_score: 0.8417; val_auprc_score: 0.8462; val_best_acc_score: 0.7579; val_best_f1_score: 0.7692; train_kl_reg_loss: 19587.2365; train_edge_recon_loss: 3258999.6467; train_gene_expr_recon_loss: 1959879.1360; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5238466.0237; train_optim_loss: 5238466.0237; val_kl_reg_loss: 19588.4903; val_edge_recon_loss: 3328825.1528; val_gene_expr_recon_loss: 1957889.3576; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5306303.0278; val_optim_loss: 5306303.0278
Epoch 9/400 |--------------------| 2.2% val_auroc_score: 0.8411; val_auprc_score: 0.8445; val_best_acc_score: 0.7587; val_best_f1_score: 0.7703; train_kl_reg_loss: 19583.9786; train_edge_recon_loss: 3260359.7200; train_gene_expr_recon_loss: 1956959.5430; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5236903.2445; train_optim_loss: 5236903.2445; val_kl_reg_loss: 19549.6614; val_edge_recon_loss: 3328339.0556; val_gene_expr_recon_loss: 1957855.7847; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5305744.5278; val_optim_loss: 5305744.5278
Epoch 10/400 |--------------------| 2.5% val_auroc_score: 0.8406; val_auprc_score: 0.8427; val_best_acc_score: 0.7583; val_best_f1_score: 0.7711; train_kl_reg_loss: 19582.6090; train_edge_recon_loss: 3261601.0292; train_gene_expr_recon_loss: 1953573.0142; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5234756.6498; train_optim_loss: 5234756.6498; val_kl_reg_loss: 19556.4235; val_edge_recon_loss: 3328692.3056; val_gene_expr_recon_loss: 1958985.2708; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5307233.9583; val_optim_loss: 5307233.9583
Epoch 11/400 |--------------------| 2.8% val_auroc_score: 0.8424; val_auprc_score: 0.8456; val_best_acc_score: 0.7599; val_best_f1_score: 0.7713; train_kl_reg_loss: 19585.1661; train_edge_recon_loss: 3259769.5134; train_gene_expr_recon_loss: 1950537.1349; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5229891.8139; train_optim_loss: 5229891.8139; val_kl_reg_loss: 19579.3205; val_edge_recon_loss: 3328762.8472; val_gene_expr_recon_loss: 1953287.9132; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5301630.0972; val_optim_loss: 5301630.0972
Epoch 12/400 |--------------------| 3.0% val_auroc_score: 0.8421; val_auprc_score: 0.8454; val_best_acc_score: 0.7597; val_best_f1_score: 0.7713; train_kl_reg_loss: 19593.0534; train_edge_recon_loss: 3261191.3856; train_gene_expr_recon_loss: 1948112.7677; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5228897.2224; train_optim_loss: 5228897.2224; val_kl_reg_loss: 19557.8173; val_edge_recon_loss: 3329464.4306; val_gene_expr_recon_loss: 1950333.4965; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5299355.6806; val_optim_loss: 5299355.6806
Epoch 13/400 |--------------------| 3.2% val_auroc_score: 0.8396; val_auprc_score: 0.8442; val_best_acc_score: 0.7571; val_best_f1_score: 0.7698; train_kl_reg_loss: 19579.1371; train_edge_recon_loss: 3261204.1246; train_gene_expr_recon_loss: 1947409.5521; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5228192.8202; train_optim_loss: 5228192.8202; val_kl_reg_loss: 19558.1179; val_edge_recon_loss: 3337260.0208; val_gene_expr_recon_loss: 1951280.6215; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5308098.8333; val_optim_loss: 5308098.8333
Epoch 14/400 |--------------------| 3.5% val_auroc_score: 0.8417; val_auprc_score: 0.8452; val_best_acc_score: 0.7591; val_best_f1_score: 0.7701; train_kl_reg_loss: 19588.2286; train_edge_recon_loss: 3261535.9716; train_gene_expr_recon_loss: 1945659.2953; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5226783.5047; train_optim_loss: 5226783.5047; val_kl_reg_loss: 19583.5130; val_edge_recon_loss: 3326925.3611; val_gene_expr_recon_loss: 1947540.7500; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5294049.5833; val_optim_loss: 5294049.5833
Epoch 15/400 |--------------------| 3.8% val_auroc_score: 0.8430; val_auprc_score: 0.8472; val_best_acc_score: 0.7617; val_best_f1_score: 0.7711; train_kl_reg_loss: 19581.4160; train_edge_recon_loss: 3256948.5315; train_gene_expr_recon_loss: 1944213.0946; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5220743.0473; train_optim_loss: 5220743.0473; val_kl_reg_loss: 19570.8169; val_edge_recon_loss: 3333462.2292; val_gene_expr_recon_loss: 1947740.3368; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5300773.4306; val_optim_loss: 5300773.4306
Epoch 16/400 |--------------------| 4.0% val_auroc_score: 0.8422; val_auprc_score: 0.8458; val_best_acc_score: 0.7622; val_best_f1_score: 0.7709; train_kl_reg_loss: 19584.6152; train_edge_recon_loss: 3260161.8107; train_gene_expr_recon_loss: 1943788.5517; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5223534.9890; train_optim_loss: 5223534.9890; val_kl_reg_loss: 19600.9661; val_edge_recon_loss: 3329692.0972; val_gene_expr_recon_loss: 1943155.0000; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5292448.0972; val_optim_loss: 5292448.0972
Epoch 17/400 |--------------------| 4.2% val_auroc_score: 0.8400; val_auprc_score: 0.8435; val_best_acc_score: 0.7585; val_best_f1_score: 0.7692; train_kl_reg_loss: 19587.7286; train_edge_recon_loss: 3259435.5820; train_gene_expr_recon_loss: 1941912.5099; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5220935.8438; train_optim_loss: 5220935.8438; val_kl_reg_loss: 19563.6138; val_edge_recon_loss: 3335849.7708; val_gene_expr_recon_loss: 1947648.3021; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5303061.6528; val_optim_loss: 5303061.6528
Epoch 18/400 |--------------------| 4.5% val_auroc_score: 0.8438; val_auprc_score: 0.8472; val_best_acc_score: 0.7616; val_best_f1_score: 0.7727; train_kl_reg_loss: 19585.1741; train_edge_recon_loss: 3258544.7516; train_gene_expr_recon_loss: 1940502.8348; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5218632.7603; train_optim_loss: 5218632.7603; val_kl_reg_loss: 19569.0186; val_edge_recon_loss: 3323442.2569; val_gene_expr_recon_loss: 1948231.9410; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5291243.2222; val_optim_loss: 5291243.2222
Epoch 19/400 |--------------------| 4.8% val_auroc_score: 0.8423; val_auprc_score: 0.8461; val_best_acc_score: 0.7601; val_best_f1_score: 0.7698; train_kl_reg_loss: 19585.7478; train_edge_recon_loss: 3261114.7768; train_gene_expr_recon_loss: 1941497.0004; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5222197.5347; train_optim_loss: 5222197.5347; val_kl_reg_loss: 19553.8255; val_edge_recon_loss: 3331046.8125; val_gene_expr_recon_loss: 1950064.9375; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5300665.5833; val_optim_loss: 5300665.5833
Epoch 20/400 |█-------------------| 5.0% val_auroc_score: 0.8404; val_auprc_score: 0.8452; val_best_acc_score: 0.7579; val_best_f1_score: 0.7695; train_kl_reg_loss: 19589.3647; train_edge_recon_loss: 3258387.5024; train_gene_expr_recon_loss: 1939570.3994; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5217547.2603; train_optim_loss: 5217547.2603; val_kl_reg_loss: 19582.0133; val_edge_recon_loss: 3336012.4236; val_gene_expr_recon_loss: 1936879.5486; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5292473.9167; val_optim_loss: 5292473.9167
Epoch 21/400 |█-------------------| 5.2% val_auroc_score: 0.8422; val_auprc_score: 0.8453; val_best_acc_score: 0.7604; val_best_f1_score: 0.7712; train_kl_reg_loss: 19587.9334; train_edge_recon_loss: 3263020.1798; train_gene_expr_recon_loss: 1936016.7938; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5218624.9148; train_optim_loss: 5218624.9148; val_kl_reg_loss: 19564.3730; val_edge_recon_loss: 3328471.0833; val_gene_expr_recon_loss: 1945594.3750; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5293629.8611; val_optim_loss: 5293629.8611
Epoch 22/400 |█-------------------| 5.5% val_auroc_score: 0.8400; val_auprc_score: 0.8425; val_best_acc_score: 0.7589; val_best_f1_score: 0.7698; train_kl_reg_loss: 19587.3671; train_edge_recon_loss: 3261518.7539; train_gene_expr_recon_loss: 1938824.4062; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5219930.5205; train_optim_loss: 5219930.5205; val_kl_reg_loss: 19564.3080; val_edge_recon_loss: 3332388.2986; val_gene_expr_recon_loss: 1944970.6146; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5296923.2083; val_optim_loss: 5296923.2083

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 0.0001.

Epoch 23/400 |█-------------------| 5.8% val_auroc_score: 0.8413; val_auprc_score: 0.8432; val_best_acc_score: 0.7606; val_best_f1_score: 0.7702; train_kl_reg_loss: 19585.1997; train_edge_recon_loss: 3260885.1356; train_gene_expr_recon_loss: 1939902.6676; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5220372.9921; train_optim_loss: 5220372.9921; val_kl_reg_loss: 19587.8455; val_edge_recon_loss: 3330105.5278; val_gene_expr_recon_loss: 1938980.7153; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5288674.1111; val_optim_loss: 5288674.1111
Epoch 24/400 |█-------------------| 6.0% val_auroc_score: 0.8411; val_auprc_score: 0.8458; val_best_acc_score: 0.7587; val_best_f1_score: 0.7692; train_kl_reg_loss: 19588.6240; train_edge_recon_loss: 3260398.5252; train_gene_expr_recon_loss: 1938337.3273; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5218324.4779; train_optim_loss: 5218324.4779; val_kl_reg_loss: 19560.5625; val_edge_recon_loss: 3329600.8819; val_gene_expr_recon_loss: 1945323.5486; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5294485.0000; val_optim_loss: 5294485.0000
Epoch 25/400 |█-------------------| 6.2% val_auroc_score: 0.8410; val_auprc_score: 0.8453; val_best_acc_score: 0.7591; val_best_f1_score: 0.7697; train_kl_reg_loss: 19591.3651; train_edge_recon_loss: 3258719.6782; train_gene_expr_recon_loss: 1939257.7110; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5217568.7445; train_optim_loss: 5217568.7445; val_kl_reg_loss: 19577.5340; val_edge_recon_loss: 3331523.8403; val_gene_expr_recon_loss: 1938060.7292; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5289162.1111; val_optim_loss: 5289162.1111
Epoch 26/400 |█-------------------| 6.5% val_auroc_score: 0.8145; val_auprc_score: 0.8112; val_best_acc_score: 0.7313; val_best_f1_score: 0.7545; train_kl_reg_loss: 19587.5020; train_edge_recon_loss: 3217082.6767; train_gene_expr_recon_loss: 1868067.4826; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5104737.6451; train_optim_loss: 5104737.6451; val_kl_reg_loss: 14537.3595; val_edge_recon_loss: 3288735.5764; val_gene_expr_recon_loss: 1870229.6597; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5173502.6389; val_optim_loss: 5173502.6389
Epoch 27/400 |█-------------------| 6.8% val_auroc_score: 0.8158; val_auprc_score: 0.8123; val_best_acc_score: 0.7320; val_best_f1_score: 0.7545; train_kl_reg_loss: 19576.8342; train_edge_recon_loss: 3215772.1388; train_gene_expr_recon_loss: 1861978.3880; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5097327.3722; train_optim_loss: 5097327.3722; val_kl_reg_loss: 14547.1239; val_edge_recon_loss: 3283830.8056; val_gene_expr_recon_loss: 1868959.4861; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5167337.3889; val_optim_loss: 5167337.3889
Epoch 28/400 |█-------------------| 7.0% val_auroc_score: 0.8153; val_auprc_score: 0.8117; val_best_acc_score: 0.7310; val_best_f1_score: 0.7541; train_kl_reg_loss: 19590.4502; train_edge_recon_loss: 3215430.6333; train_gene_expr_recon_loss: 1860406.6092; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5095427.6924; train_optim_loss: 5095427.6924; val_kl_reg_loss: 14566.2736; val_edge_recon_loss: 3284441.2986; val_gene_expr_recon_loss: 1862447.3819; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5161454.9306; val_optim_loss: 5161454.9306
Epoch 29/400 |█-------------------| 7.2% val_auroc_score: 0.8178; val_auprc_score: 0.8156; val_best_acc_score: 0.7335; val_best_f1_score: 0.7565; train_kl_reg_loss: 19585.4489; train_edge_recon_loss: 3216724.9543; train_gene_expr_recon_loss: 1862965.6396; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5099276.0347; train_optim_loss: 5099276.0347; val_kl_reg_loss: 14542.2798; val_edge_recon_loss: 3278916.4514; val_gene_expr_recon_loss: 1862811.1771; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5156269.9444; val_optim_loss: 5156269.9444
Epoch 30/400 |█-------------------| 7.5% val_auroc_score: 0.8155; val_auprc_score: 0.8133; val_best_acc_score: 0.7317; val_best_f1_score: 0.7548; train_kl_reg_loss: 19587.6299; train_edge_recon_loss: 3214722.6798; train_gene_expr_recon_loss: 1862171.0836; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5096481.3912; train_optim_loss: 5096481.3912; val_kl_reg_loss: 14546.7032; val_edge_recon_loss: 3284791.2153; val_gene_expr_recon_loss: 1869062.3056; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5168400.2639; val_optim_loss: 5168400.2639
Epoch 31/400 |█-------------------| 7.8% val_auroc_score: 0.8183; val_auprc_score: 0.8150; val_best_acc_score: 0.7344; val_best_f1_score: 0.7561; train_kl_reg_loss: 19584.6617; train_edge_recon_loss: 3214055.1325; train_gene_expr_recon_loss: 1860525.3557; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5094165.1356; train_optim_loss: 5094165.1356; val_kl_reg_loss: 14536.4524; val_edge_recon_loss: 3280567.6667; val_gene_expr_recon_loss: 1857960.7083; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5153064.8194; val_optim_loss: 5153064.8194
Epoch 32/400 |█-------------------| 8.0% val_auroc_score: 0.8146; val_auprc_score: 0.8110; val_best_acc_score: 0.7310; val_best_f1_score: 0.7558; train_kl_reg_loss: 19584.8564; train_edge_recon_loss: 3214330.0260; train_gene_expr_recon_loss: 1859328.6297; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5093243.5032; train_optim_loss: 5093243.5032; val_kl_reg_loss: 14552.7348; val_edge_recon_loss: 3292207.5208; val_gene_expr_recon_loss: 1864717.8472; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5171478.1250; val_optim_loss: 5171478.1250
Epoch 33/400 |█-------------------| 8.2% val_auroc_score: 0.8145; val_auprc_score: 0.8105; val_best_acc_score: 0.7326; val_best_f1_score: 0.7543; train_kl_reg_loss: 19592.2121; train_edge_recon_loss: 3215202.6798; train_gene_expr_recon_loss: 1857048.2366; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5091843.1120; train_optim_loss: 5091843.1120; val_kl_reg_loss: 14545.0741; val_edge_recon_loss: 3285470.3056; val_gene_expr_recon_loss: 1866904.2014; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5166919.6250; val_optim_loss: 5166919.6250
Epoch 34/400 |█-------------------| 8.5% val_auroc_score: 0.8128; val_auprc_score: 0.8099; val_best_acc_score: 0.7289; val_best_f1_score: 0.7521; train_kl_reg_loss: 19588.3480; train_edge_recon_loss: 3213997.5757; train_gene_expr_recon_loss: 1859541.3076; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5093127.2303; train_optim_loss: 5093127.2303; val_kl_reg_loss: 14550.2635; val_edge_recon_loss: 3293160.1528; val_gene_expr_recon_loss: 1870704.2222; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5178414.6250; val_optim_loss: 5178414.6250
Epoch 35/400 |█-------------------| 8.8% val_auroc_score: 0.8151; val_auprc_score: 0.8107; val_best_acc_score: 0.7325; val_best_f1_score: 0.7559; train_kl_reg_loss: 19588.5852; train_edge_recon_loss: 3214268.4211; train_gene_expr_recon_loss: 1859875.1218; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5093732.1325; train_optim_loss: 5093732.1325; val_kl_reg_loss: 14549.7789; val_edge_recon_loss: 3284999.7847; val_gene_expr_recon_loss: 1862257.8854; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5161807.4444; val_optim_loss: 5161807.4444

Reducing learning rate: metric has not improved more than 0.0 in the last 4 epochs.
New learning rate is 1e-05.

Epoch 36/400 |█-------------------| 9.0% val_auroc_score: 0.8142; val_auprc_score: 0.8099; val_best_acc_score: 0.7322; val_best_f1_score: 0.7548; train_kl_reg_loss: 19583.3061; train_edge_recon_loss: 3217092.1435; train_gene_expr_recon_loss: 1861507.6069; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5098183.0568; train_optim_loss: 5098183.0568; val_kl_reg_loss: 14537.7734; val_edge_recon_loss: 3286475.1042; val_gene_expr_recon_loss: 1861964.1667; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5162977.0556; val_optim_loss: 5162977.0556
Epoch 37/400 |█-------------------| 9.2% val_auroc_score: 0.8139; val_auprc_score: 0.8099; val_best_acc_score: 0.7319; val_best_f1_score: 0.7539; train_kl_reg_loss: 19589.7525; train_edge_recon_loss: 3215233.4543; train_gene_expr_recon_loss: 1858467.0028; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5093290.2224; train_optim_loss: 5093290.2224; val_kl_reg_loss: 14543.6208; val_edge_recon_loss: 3290231.3681; val_gene_expr_recon_loss: 1865526.0069; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5170301.0139; val_optim_loss: 5170301.0139
Epoch 38/400 |█-------------------| 9.5% val_auroc_score: 0.8144; val_auprc_score: 0.8091; val_best_acc_score: 0.7317; val_best_f1_score: 0.7544; train_kl_reg_loss: 19592.4567; train_edge_recon_loss: 3213523.6964; train_gene_expr_recon_loss: 1858577.6266; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5091693.7965; train_optim_loss: 5091693.7965; val_kl_reg_loss: 14545.3493; val_edge_recon_loss: 3291723.4375; val_gene_expr_recon_loss: 1862663.0243; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5168931.8194; val_optim_loss: 5168931.8194
Epoch 39/400 |█-------------------| 9.8% val_auroc_score: 0.8162; val_auprc_score: 0.8133; val_best_acc_score: 0.7329; val_best_f1_score: 0.7553; train_kl_reg_loss: 19595.0702; train_edge_recon_loss: 3217614.2760; train_gene_expr_recon_loss: 1859267.4290; train_masked_gp_l1_reg_loss: 0.0000; train_group_lasso_reg_loss: 0.0000; train_addon_gp_l1_reg_loss: 0.0000; train_global_loss: 5096476.7713; train_optim_loss: 5096476.7713; val_kl_reg_loss: 14539.4900; val_edge_recon_loss: 3285910.0694; val_gene_expr_recon_loss: 1863453.4306; val_masked_gp_l1_reg_loss: 0.0000; val_group_lasso_reg_loss: 0.0000; val_addon_gp_l1_reg_loss: 0.0000; val_global_loss: 5163902.9583; val_optim_loss: 5163902.9583

Stopping early: metric has not improved more than 0.0 in the last 8 epochs.
If the early stopping criterion is too strong, please instantiate it with different parameters in the train method.
Model training finished after 68 min 44 sec.
Using best model state, which was in epoch 31.

--- MODEL EVALUATION ---
val AUROC score: 0.8144
val AUPRC score: 0.8131
val best accuracy score: 0.7307
val best F1 score: 0.7536
val target rna MSE score: 1.2889
val source rna MSE score: 0.5292
Val cat covariate0 mean sim diff: nan
Val cat covariate1 mean sim diff: -0.0114

Saving query model...

Integrating reference and query adata...

Computing reference query latent embedding...

Computing neighbor graph...

Computing UMAP embedding...

Saving reference query model...
